@model Milestone.Models.GameModels.Board
@{
    ViewData["Title"] = "Minesweeper";
    var isLoadedGame = TempData["LoadedGameState"] as bool? ?? false;
    var initialState = new List<Dictionary<string, object>>();

    // Prepare initial state for each cell
    for (int i = 0; i < Model.Size; i++)
    {
        for (int j = 0; j < Model.Size; j++)
        {
            var cell = Model.Grid[i, j];
            if (cell.Visited || cell.Flagged)
            {
                initialState.Add(new Dictionary<string, object>
                        {
                            ["row"] = i,
                            ["column"] = j,
                            ["isRevealed"] = cell.Visited,
                            ["isMine"] = cell.Live,
                            ["isFlagged"] = cell.Flagged,
                            ["neighborCount"] = cell.LiveNeighbors
                        });
            }
        }
    }
}

<div class="container text-center">
    <h1>Minesweeper</h1>
    <div class="game-info">
        <span id="timer">00:00</span>
        <span class="mine-counter">000</span>
    </div>

    <div id="gameBoard"
         class="game-board"
         data-game-id="@Model.GameId"
         data-mines="@((int)(Model.Size * Model.Size * Model.Difficulty))"
         data-initial-state="@Json.Serialize(initialState)">
        @for (int i = 0; i < Model.Size; i++)
        {
            <div class="board-row">
                @for (int j = 0; j < Model.Size; j++)
                {
                    <div class="cell"
                         data-row="@i"
                         data-col="@j"
                    @(Model.Grid[i, j].Visited ? "data-revealed=true" : "")
                    @(Model.Grid[i, j].Flagged ? "data-flagged=true" : "")>
                    </div>
                }
            </div>
        }
    </div>

    <div class="game-controls mb-3">
        <button id="saveGameBtn" class="btn btn-success">Save Game</button>
        <a href="/SavedGames" class="btn btn-info">Saved Games</a>
    </div>

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-primary">New Game</a>
    </div>
</div>

@section Scripts {
    <script src="~/js/minesweeper.js"></script>
}