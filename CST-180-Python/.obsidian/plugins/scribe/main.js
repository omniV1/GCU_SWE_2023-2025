/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
https://github.com/Mikodin/obsidian-scribe
*/

var WN=Object.create;var hc=Object.defineProperty;var ek=Object.getOwnPropertyDescriptor;var tk=Object.getOwnPropertyNames;var nk=Object.getPrototypeOf,rk=Object.prototype.hasOwnProperty;var C0=t=>{throw TypeError(t)};var ak=(t,e,n)=>e in t?hc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ik=(t,e)=>()=>(t&&(e=t(t=0)),e);var P=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Lg=(t,e)=>{for(var n in e)hc(t,n,{get:e[n],enumerable:!0})},I0=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of tk(e))!rk.call(t,a)&&a!==n&&hc(t,a,{get:()=>e[a],enumerable:!(r=ek(e,a))||r.enumerable});return t};var Z=(t,e,n)=>(n=t!=null?WN(nk(t)):{},I0(e||!t||!t.__esModule?hc(n,"default",{value:t,enumerable:!0}):n,t)),mc=t=>I0(hc({},"__esModule",{value:!0}),t);var Ue=(t,e,n)=>ak(t,typeof e!="symbol"?e+"":e,n),P0=(t,e,n)=>e.has(t)||C0("Cannot "+n);var fe=(t,e,n)=>(P0(t,e,"read from private field"),n?n.call(t):e.get(t)),ii=(t,e,n)=>e.has(t)?C0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),gc=(t,e,n,r)=>(P0(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);var B0=P(ze=>{"use strict";function Fg(t,e){var n=t.length;t.push(e);e:for(;0<n;){var r=n-1>>>1,a=t[r];if(0<jd(a,e))t[r]=e,t[n]=a,n=r;else break e}}function kr(t){return t.length===0?null:t[0]}function $d(t){if(t.length===0)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;e:for(var r=0,a=t.length,i=a>>>1;r<i;){var s=2*(r+1)-1,o=t[s],u=s+1,l=t[u];if(0>jd(o,n))u<a&&0>jd(l,o)?(t[r]=l,t[u]=n,r=u):(t[r]=o,t[s]=n,r=s);else if(u<a&&0>jd(l,n))t[r]=l,t[u]=n,r=u;else break e}}return e}function jd(t,e){var n=t.sortIndex-e.sortIndex;return n!==0?n:t.id-e.id}ze.unstable_now=void 0;typeof performance=="object"&&typeof performance.now=="function"?(N0=performance,ze.unstable_now=function(){return N0.now()}):(Ug=Date,k0=Ug.now(),ze.unstable_now=function(){return Ug.now()-k0});var N0,Ug,k0,ca=[],si=[],sk=1,Bn=null,Dt=3,qg=!1,yc=!1,bc=!1,Hg=!1,M0=typeof setTimeout=="function"?setTimeout:null,$0=typeof clearTimeout=="function"?clearTimeout:null,D0=typeof setImmediate!="undefined"?setImmediate:null;function Md(t){for(var e=kr(si);e!==null;){if(e.callback===null)$d(si);else if(e.startTime<=t)$d(si),e.sortIndex=e.expirationTime,Fg(ca,e);else break;e=kr(si)}}function Vg(t){if(bc=!1,Md(t),!yc)if(kr(ca)!==null)yc=!0,Wo||(Wo=!0,Qo());else{var e=kr(si);e!==null&&Gg(Vg,e.startTime-t)}}var Wo=!1,_c=-1,L0=5,U0=-1;function z0(){return Hg?!0:!(ze.unstable_now()-U0<L0)}function zg(){if(Hg=!1,Wo){var t=ze.unstable_now();U0=t;var e=!0;try{e:{yc=!1,bc&&(bc=!1,$0(_c),_c=-1),qg=!0;var n=Dt;try{t:{for(Md(t),Bn=kr(ca);Bn!==null&&!(Bn.expirationTime>t&&z0());){var r=Bn.callback;if(typeof r=="function"){Bn.callback=null,Dt=Bn.priorityLevel;var a=r(Bn.expirationTime<=t);if(t=ze.unstable_now(),typeof a=="function"){Bn.callback=a,Md(t),e=!0;break t}Bn===kr(ca)&&$d(ca),Md(t)}else $d(ca);Bn=kr(ca)}if(Bn!==null)e=!0;else{var i=kr(si);i!==null&&Gg(Vg,i.startTime-t),e=!1}}break e}finally{Bn=null,Dt=n,qg=!1}e=void 0}}finally{e?Qo():Wo=!1}}}var Qo;typeof D0=="function"?Qo=function(){D0(zg)}:typeof MessageChannel!="undefined"?(Bg=new MessageChannel,j0=Bg.port2,Bg.port1.onmessage=zg,Qo=function(){j0.postMessage(null)}):Qo=function(){M0(zg,0)};var Bg,j0;function Gg(t,e){_c=M0(function(){t(ze.unstable_now())},e)}ze.unstable_IdlePriority=5;ze.unstable_ImmediatePriority=1;ze.unstable_LowPriority=4;ze.unstable_NormalPriority=3;ze.unstable_Profiling=null;ze.unstable_UserBlockingPriority=2;ze.unstable_cancelCallback=function(t){t.callback=null};ze.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L0=0<t?Math.floor(1e3/t):5};ze.unstable_getCurrentPriorityLevel=function(){return Dt};ze.unstable_next=function(t){switch(Dt){case 1:case 2:case 3:var e=3;break;default:e=Dt}var n=Dt;Dt=e;try{return t()}finally{Dt=n}};ze.unstable_requestPaint=function(){Hg=!0};ze.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=Dt;Dt=t;try{return e()}finally{Dt=n}};ze.unstable_scheduleCallback=function(t,e,n){var r=ze.unstable_now();switch(typeof n=="object"&&n!==null?(n=n.delay,n=typeof n=="number"&&0<n?r+n:r):n=r,t){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return a=n+a,t={id:sk++,callback:e,priorityLevel:t,startTime:n,expirationTime:a,sortIndex:-1},n>r?(t.sortIndex=n,Fg(si,t),kr(ca)===null&&t===kr(si)&&(bc?($0(_c),_c=-1):bc=!0,Gg(Vg,n-r))):(t.sortIndex=a,Fg(ca,t),yc||qg||(yc=!0,Wo||(Wo=!0,Qo()))),t};ze.unstable_shouldYield=z0;ze.unstable_wrapCallback=function(t){var e=Dt;return function(){var n=Dt;Dt=e;try{return t.apply(this,arguments)}finally{Dt=n}}}});var q0=P((iB,F0)=>{"use strict";F0.exports=B0()});var tS=P(le=>{"use strict";var Kg=Symbol.for("react.transitional.element"),ok=Symbol.for("react.portal"),uk=Symbol.for("react.fragment"),lk=Symbol.for("react.strict_mode"),ck=Symbol.for("react.profiler"),fk=Symbol.for("react.consumer"),dk=Symbol.for("react.context"),pk=Symbol.for("react.forward_ref"),hk=Symbol.for("react.suspense"),mk=Symbol.for("react.memo"),Y0=Symbol.for("react.lazy"),H0=Symbol.iterator;function gk(t){return t===null||typeof t!="object"?null:(t=H0&&t[H0]||t["@@iterator"],typeof t=="function"?t:null)}var J0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X0=Object.assign,Q0={};function tu(t,e,n){this.props=t,this.context=e,this.refs=Q0,this.updater=n||J0}tu.prototype.isReactComponent={};tu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};tu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function W0(){}W0.prototype=tu.prototype;function Yg(t,e,n){this.props=t,this.context=e,this.refs=Q0,this.updater=n||J0}var Jg=Yg.prototype=new W0;Jg.constructor=Yg;X0(Jg,tu.prototype);Jg.isPureReactComponent=!0;var V0=Array.isArray,Be={H:null,A:null,T:null,S:null,V:null},eS=Object.prototype.hasOwnProperty;function Xg(t,e,n,r,a,i){return n=i.ref,{$$typeof:Kg,type:t,key:e,ref:n!==void 0?n:null,props:i}}function yk(t,e){return Xg(t.type,e,void 0,void 0,void 0,t.props)}function Qg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Kg}function bk(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var G0=/\/+/g;function Zg(t,e){return typeof t=="object"&&t!==null&&t.key!=null?bk(""+t.key):e.toString(36)}function Z0(){}function _k(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Z0,Z0):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function eu(t,e,n,r,a){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(i){case"bigint":case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Kg:case ok:s=!0;break;case Y0:return s=t._init,eu(s(t._payload),e,n,r,a)}}if(s)return a=a(t),s=r===""?"."+Zg(t,0):r,V0(a)?(n="",s!=null&&(n=s.replace(G0,"$&/")+"/"),eu(a,e,n,"",function(l){return l})):a!=null&&(Qg(a)&&(a=yk(a,n+(a.key==null||t&&t.key===a.key?"":(""+a.key).replace(G0,"$&/")+"/")+s)),e.push(a)),1;s=0;var o=r===""?".":r+":";if(V0(t))for(var u=0;u<t.length;u++)r=t[u],i=o+Zg(r,u),s+=eu(r,e,n,i,a);else if(u=gk(t),typeof u=="function")for(t=u.call(t),u=0;!(r=t.next()).done;)r=r.value,i=o+Zg(r,u++),s+=eu(r,e,n,i,a);else if(i==="object"){if(typeof t.then=="function")return eu(_k(t),e,n,r,a);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return s}function Ld(t,e,n){if(t==null)return t;var r=[],a=0;return eu(t,r,"","",function(i){return e.call(n,i,a++)}),r}function wk(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var K0=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function vk(){}le.Children={map:Ld,forEach:function(t,e,n){Ld(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ld(t,function(){e++}),e},toArray:function(t){return Ld(t,function(e){return e})||[]},only:function(t){if(!Qg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};le.Component=tu;le.Fragment=uk;le.Profiler=ck;le.PureComponent=Yg;le.StrictMode=lk;le.Suspense=hk;le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Be;le.__COMPILER_RUNTIME={__proto__:null,c:function(t){return Be.H.useMemoCache(t)}};le.cache=function(t){return function(){return t.apply(null,arguments)}};le.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=X0({},t.props),a=t.key,i=void 0;if(e!=null)for(s in e.ref!==void 0&&(i=void 0),e.key!==void 0&&(a=""+e.key),e)!eS.call(e,s)||s==="key"||s==="__self"||s==="__source"||s==="ref"&&e.ref===void 0||(r[s]=e[s]);var s=arguments.length-2;if(s===1)r.children=n;else if(1<s){for(var o=Array(s),u=0;u<s;u++)o[u]=arguments[u+2];r.children=o}return Xg(t.type,a,void 0,void 0,i,r)};le.createContext=function(t){return t={$$typeof:dk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:fk,_context:t},t};le.createElement=function(t,e,n){var r,a={},i=null;if(e!=null)for(r in e.key!==void 0&&(i=""+e.key),e)eS.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(a[r]=e[r]);var s=arguments.length-2;if(s===1)a.children=n;else if(1<s){for(var o=Array(s),u=0;u<s;u++)o[u]=arguments[u+2];a.children=o}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)a[r]===void 0&&(a[r]=s[r]);return Xg(t,i,void 0,void 0,null,a)};le.createRef=function(){return{current:null}};le.forwardRef=function(t){return{$$typeof:pk,render:t}};le.isValidElement=Qg;le.lazy=function(t){return{$$typeof:Y0,_payload:{_status:-1,_result:t},_init:wk}};le.memo=function(t,e){return{$$typeof:mk,type:t,compare:e===void 0?null:e}};le.startTransition=function(t){var e=Be.T,n={};Be.T=n;try{var r=t(),a=Be.S;a!==null&&a(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(vk,K0)}catch(i){K0(i)}finally{Be.T=e}};le.unstable_useCacheRefresh=function(){return Be.H.useCacheRefresh()};le.use=function(t){return Be.H.use(t)};le.useActionState=function(t,e,n){return Be.H.useActionState(t,e,n)};le.useCallback=function(t,e){return Be.H.useCallback(t,e)};le.useContext=function(t){return Be.H.useContext(t)};le.useDebugValue=function(){};le.useDeferredValue=function(t,e){return Be.H.useDeferredValue(t,e)};le.useEffect=function(t,e,n){var r=Be.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)};le.useId=function(){return Be.H.useId()};le.useImperativeHandle=function(t,e,n){return Be.H.useImperativeHandle(t,e,n)};le.useInsertionEffect=function(t,e){return Be.H.useInsertionEffect(t,e)};le.useLayoutEffect=function(t,e){return Be.H.useLayoutEffect(t,e)};le.useMemo=function(t,e){return Be.H.useMemo(t,e)};le.useOptimistic=function(t,e){return Be.H.useOptimistic(t,e)};le.useReducer=function(t,e,n){return Be.H.useReducer(t,e,n)};le.useRef=function(t){return Be.H.useRef(t)};le.useState=function(t){return Be.H.useState(t)};le.useSyncExternalStore=function(t,e,n){return Be.H.useSyncExternalStore(t,e,n)};le.useTransition=function(){return Be.H.useTransition()};le.version="19.1.0"});var ur=P((oB,nS)=>{"use strict";nS.exports=tS()});var aS=P(Vt=>{"use strict";var Sk=ur();function rS(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function oi(){}var Ht={d:{f:oi,r:function(){throw Error(rS(522))},D:oi,C:oi,L:oi,m:oi,X:oi,S:oi,M:oi},p:0,findDOMNode:null},xk=Symbol.for("react.portal");function Ak(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xk,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}var wc=Sk.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Ud(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}Vt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ht;Vt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(rS(299));return Ak(t,e,null,n)};Vt.flushSync=function(t){var e=wc.T,n=Ht.p;try{if(wc.T=null,Ht.p=2,t)return t()}finally{wc.T=e,Ht.p=n,Ht.d.f()}};Vt.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Ht.d.C(t,e))};Vt.prefetchDNS=function(t){typeof t=="string"&&Ht.d.D(t)};Vt.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,r=Ud(n,e.crossOrigin),a=typeof e.integrity=="string"?e.integrity:void 0,i=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?Ht.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:r,integrity:a,fetchPriority:i}):n==="script"&&Ht.d.X(t,{crossOrigin:r,integrity:a,fetchPriority:i,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};Vt.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=Ud(e.as,e.crossOrigin);Ht.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Ht.d.M(t)};Vt.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,r=Ud(n,e.crossOrigin);Ht.d.L(t,n,{crossOrigin:r,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};Vt.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=Ud(e.as,e.crossOrigin);Ht.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Ht.d.m(t)};Vt.requestFormReset=function(t){Ht.d.r(t)};Vt.unstable_batchedUpdates=function(t,e){return t(e)};Vt.useFormState=function(t,e,n){return wc.H.useFormState(t,e,n)};Vt.useFormStatus=function(){return wc.H.useHostTransitionStatus()};Vt.version="19.1.0"});var oS=P((lB,sS)=>{"use strict";function iS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(iS)}catch(t){console.error(t)}}iS(),sS.exports=aS()});var lE=P(oh=>{"use strict";var pt=q0(),Cx=ur(),Tk=oS();function O(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ix(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function uf(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Px(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function uS(t){if(uf(t)!==t)throw Error(O(188))}function Ek(t){var e=t.alternate;if(!e){if(e=uf(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,r=e;;){var a=n.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return uS(a),t;if(i===r)return uS(a),e;i=i.sibling}throw Error(O(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,o=a.child;o;){if(o===n){s=!0,n=a,r=i;break}if(o===r){s=!0,r=a,n=i;break}o=o.sibling}if(!s){for(o=i.child;o;){if(o===n){s=!0,n=i,r=a;break}if(o===r){s=!0,r=i,n=a;break}o=o.sibling}if(!s)throw Error(O(189))}}if(n.alternate!==r)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function Nx(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=Nx(t),e!==null)return e;t=t.sibling}return null}var Me=Object.assign,Ok=Symbol.for("react.element"),zd=Symbol.for("react.transitional.element"),Cc=Symbol.for("react.portal"),uu=Symbol.for("react.fragment"),kx=Symbol.for("react.strict_mode"),Iy=Symbol.for("react.profiler"),Rk=Symbol.for("react.provider"),Dx=Symbol.for("react.consumer"),ma=Symbol.for("react.context"),Tb=Symbol.for("react.forward_ref"),Py=Symbol.for("react.suspense"),Ny=Symbol.for("react.suspense_list"),Eb=Symbol.for("react.memo"),ci=Symbol.for("react.lazy");Symbol.for("react.scope");var ky=Symbol.for("react.activity");Symbol.for("react.legacy_hidden");Symbol.for("react.tracing_marker");var Ck=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var lS=Symbol.iterator;function vc(t){return t===null||typeof t!="object"?null:(t=lS&&t[lS]||t["@@iterator"],typeof t=="function"?t:null)}var Ik=Symbol.for("react.client.reference");function Dy(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===Ik?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case uu:return"Fragment";case Iy:return"Profiler";case kx:return"StrictMode";case Py:return"Suspense";case Ny:return"SuspenseList";case ky:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case Cc:return"Portal";case ma:return(t.displayName||"Context")+".Provider";case Dx:return(t._context.displayName||"Context")+".Consumer";case Tb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Eb:return e=t.displayName||null,e!==null?e:Dy(t.type)||"Memo";case ci:e=t._payload,t=t._init;try{return Dy(t(e))}catch(n){}}return null}var Ic=Array.isArray,J=Cx.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,xe=Tk.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ss={pending:!1,data:null,method:null,action:null},jy=[],lu=-1;function zr(t){return{current:t}}function vt(t){0>lu||(t.current=jy[lu],jy[lu]=null,lu--)}function qe(t,e){lu++,jy[lu]=t.current,t.current=e}var $r=zr(null),Zc=zr(null),wi=zr(null),gp=zr(null);function yp(t,e){switch(qe(wi,e),qe(Zc,t),qe($r,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?mx(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=mx(e),t=XT(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}vt($r),qe($r,t)}function Ru(){vt($r),vt(Zc),vt(wi)}function My(t){t.memoizedState!==null&&qe(gp,t);var e=$r.current,n=XT(e,t.type);e!==n&&(qe(Zc,t),qe($r,n))}function bp(t){Zc.current===t&&(vt($r),vt(Zc)),gp.current===t&&(vt(gp),rf._currentValue=Ss)}var $y=Object.prototype.hasOwnProperty,Ob=pt.unstable_scheduleCallback,Wg=pt.unstable_cancelCallback,Pk=pt.unstable_shouldYield,Nk=pt.unstable_requestPaint,Lr=pt.unstable_now,kk=pt.unstable_getCurrentPriorityLevel,jx=pt.unstable_ImmediatePriority,Mx=pt.unstable_UserBlockingPriority,_p=pt.unstable_NormalPriority,Dk=pt.unstable_LowPriority,$x=pt.unstable_IdlePriority,jk=pt.log,Mk=pt.unstable_setDisableYieldValue,lf=null,An=null;function gi(t){if(typeof jk=="function"&&Mk(t),An&&typeof An.setStrictMode=="function")try{An.setStrictMode(lf,t)}catch(e){}}var Tn=Math.clz32?Math.clz32:Uk,$k=Math.log,Lk=Math.LN2;function Uk(t){return t>>>=0,t===0?32:31-($k(t)/Lk|0)|0}var Bd=256,Fd=4194304;function _s(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Gp(t,e,n){var r=t.pendingLanes;if(r===0)return 0;var a=0,i=t.suspendedLanes,s=t.pingedLanes;t=t.warmLanes;var o=r&134217727;return o!==0?(r=o&~i,r!==0?a=_s(r):(s&=o,s!==0?a=_s(s):n||(n=o&~t,n!==0&&(a=_s(n))))):(o=r&~i,o!==0?a=_s(o):s!==0?a=_s(s):n||(n=r&~t,n!==0&&(a=_s(n)))),a===0?0:e!==0&&e!==a&&(e&i)===0&&(i=a&-a,n=e&-e,i>=n||i===32&&(n&4194048)!==0)?e:a}function cf(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function zk(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lx(){var t=Bd;return Bd<<=1,(Bd&4194048)===0&&(Bd=256),t}function Ux(){var t=Fd;return Fd<<=1,(Fd&62914560)===0&&(Fd=4194304),t}function ey(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ff(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Bk(t,e,n,r,a,i){var s=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var o=t.entanglements,u=t.expirationTimes,l=t.hiddenUpdates;for(n=s&~n;0<n;){var c=31-Tn(n),f=1<<c;o[c]=0,u[c]=-1;var d=l[c];if(d!==null)for(l[c]=null,c=0;c<d.length;c++){var p=d[c];p!==null&&(p.lane&=-536870913)}n&=~f}r!==0&&zx(t,r,0),i!==0&&a===0&&t.tag!==0&&(t.suspendedLanes|=i&~(s&~e))}function zx(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var r=31-Tn(e);t.entangledLanes|=e,t.entanglements[r]=t.entanglements[r]|1073741824|n&4194090}function Bx(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Tn(n),a=1<<r;a&e|t[r]&e&&(t[r]|=e),n&=~a}}function Rb(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Cb(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Fx(){var t=xe.p;return t!==0?t:(t=window.event,t===void 0?32:oE(t.type))}function Fk(t,e){var n=xe.p;try{return xe.p=t,e()}finally{xe.p=n}}var Pi=Math.random().toString(36).slice(2),jt="__reactFiber$"+Pi,sn="__reactProps$"+Pi,Uu="__reactContainer$"+Pi,Ly="__reactEvents$"+Pi,qk="__reactListeners$"+Pi,Hk="__reactHandles$"+Pi,cS="__reactResources$"+Pi,df="__reactMarker$"+Pi;function Ib(t){delete t[jt],delete t[sn],delete t[Ly],delete t[qk],delete t[Hk]}function cu(t){var e=t[jt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Uu]||n[jt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=bx(t);t!==null;){if(n=t[jt])return n;t=bx(t)}return e}t=n,n=t.parentNode}return null}function zu(t){if(t=t[jt]||t[Uu]){var e=t.tag;if(e===5||e===6||e===13||e===26||e===27||e===3)return t}return null}function Pc(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(O(33))}function wu(t){var e=t[cS];return e||(e=t[cS]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function _t(t){t[df]=!0}var qx=new Set,Hx={};function ks(t,e){Cu(t,e),Cu(t+"Capture",e)}function Cu(t,e){for(Hx[t]=e,t=0;t<e.length;t++)qx.add(e[t])}var Vk=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fS={},dS={};function Gk(t){return $y.call(dS,t)?!0:$y.call(fS,t)?!1:Vk.test(t)?dS[t]=!0:(fS[t]=!0,!1)}function rp(t,e,n){if(Gk(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var r=e.toLowerCase().slice(0,5);if(r!=="data-"&&r!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function qd(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function fa(t,e,n,r){if(r===null)t.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+r)}}var ty,pS;function iu(t){if(ty===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ty=e&&e[1]||"",pS=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ty+t+pS}var ny=!1;function ry(t,e){if(!t||ny)return"";ny=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(e){var f=function(){throw Error()};if(Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(p){var d=p}Reflect.construct(t,[],f)}else{try{f.call()}catch(p){d=p}t.call(f.prototype)}}else{try{throw Error()}catch(p){d=p}(f=t())&&typeof f.catch=="function"&&f.catch(function(){})}}catch(p){if(p&&d&&typeof p.stack=="string")return[p.stack,d.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var i=r.DetermineComponentFrameRoot(),s=i[0],o=i[1];if(s&&o){var u=s.split(`
`),l=o.split(`
`);for(a=r=0;r<u.length&&!u[r].includes("DetermineComponentFrameRoot");)r++;for(;a<l.length&&!l[a].includes("DetermineComponentFrameRoot");)a++;if(r===u.length||a===l.length)for(r=u.length-1,a=l.length-1;1<=r&&0<=a&&u[r]!==l[a];)a--;for(;1<=r&&0<=a;r--,a--)if(u[r]!==l[a]){if(r!==1||a!==1)do if(r--,a--,0>a||u[r]!==l[a]){var c=`
`+u[r].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=r&&0<=a);break}}}finally{ny=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?iu(n):""}function Zk(t){switch(t.tag){case 26:case 27:case 5:return iu(t.type);case 16:return iu("Lazy");case 13:return iu("Suspense");case 19:return iu("SuspenseList");case 0:case 15:return ry(t.type,!1);case 11:return ry(t.type.render,!1);case 1:return ry(t.type,!0);case 31:return iu("Activity");default:return""}}function hS(t){try{var e="";do e+=Zk(t),t=t.return;while(t);return e}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}function qn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Vx(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Kk(t){var e=Vx(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function wp(t){t._valueTracker||(t._valueTracker=Kk(t))}function Gx(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Vx(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function vp(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch(e){return t.body}}var Yk=/[\n"\\]/g;function Gn(t){return t.replace(Yk,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Uy(t,e,n,r,a,i,s,o){t.name="",s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"?t.type=s:t.removeAttribute("type"),e!=null?s==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+qn(e)):t.value!==""+qn(e)&&(t.value=""+qn(e)):s!=="submit"&&s!=="reset"||t.removeAttribute("value"),e!=null?zy(t,s,qn(e)):n!=null?zy(t,s,qn(n)):r!=null&&t.removeAttribute("value"),a==null&&i!=null&&(t.defaultChecked=!!i),a!=null&&(t.checked=a&&typeof a!="function"&&typeof a!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?t.name=""+qn(o):t.removeAttribute("name")}function Zx(t,e,n,r,a,i,s,o){if(i!=null&&typeof i!="function"&&typeof i!="symbol"&&typeof i!="boolean"&&(t.type=i),e!=null||n!=null){if(!(i!=="submit"&&i!=="reset"||e!=null))return;n=n!=null?""+qn(n):"",e=e!=null?""+qn(e):n,o||e===t.value||(t.value=e),t.defaultValue=e}r=r!=null?r:a,r=typeof r!="function"&&typeof r!="symbol"&&!!r,t.checked=o?t.checked:!!r,t.defaultChecked=!!r,s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"&&(t.name=s)}function zy(t,e,n){e==="number"&&vp(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function vu(t,e,n,r){if(t=t.options,e){e={};for(var a=0;a<n.length;a++)e["$"+n[a]]=!0;for(n=0;n<t.length;n++)a=e.hasOwnProperty("$"+t[n].value),t[n].selected!==a&&(t[n].selected=a),a&&r&&(t[n].defaultSelected=!0)}else{for(n=""+qn(n),e=null,a=0;a<t.length;a++){if(t[a].value===n){t[a].selected=!0,r&&(t[a].defaultSelected=!0);return}e!==null||t[a].disabled||(e=t[a])}e!==null&&(e.selected=!0)}}function Kx(t,e,n){if(e!=null&&(e=""+qn(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+qn(n):""}function Yx(t,e,n,r){if(e==null){if(r!=null){if(n!=null)throw Error(O(92));if(Ic(r)){if(1<r.length)throw Error(O(93));r=r[0]}n=r}n==null&&(n=""),e=n}n=qn(e),t.defaultValue=n,r=t.textContent,r===n&&r!==""&&r!==null&&(t.value=r)}function Iu(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Jk=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function mS(t,e,n){var r=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?r?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":r?t.setProperty(e,n):typeof n!="number"||n===0||Jk.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function Jx(t,e,n){if(e!=null&&typeof e!="object")throw Error(O(62));if(t=t.style,n!=null){for(var r in n)!n.hasOwnProperty(r)||e!=null&&e.hasOwnProperty(r)||(r.indexOf("--")===0?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="");for(var a in e)r=e[a],e.hasOwnProperty(a)&&n[a]!==r&&mS(t,a,r)}else for(var i in e)e.hasOwnProperty(i)&&mS(t,i,e[i])}function Pb(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xk=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Qk=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ap(t){return Qk.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var By=null;function Nb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var fu=null,Su=null;function gS(t){var e=zu(t);if(e&&(t=e.stateNode)){var n=t[sn]||null;e:switch(t=e.stateNode,e.type){case"input":if(Uy(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Gn(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var a=r[sn]||null;if(!a)throw Error(O(90));Uy(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(e=0;e<n.length;e++)r=n[e],r.form===t.form&&Gx(r)}break e;case"textarea":Kx(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&vu(t,!!n.multiple,e,!1)}}}var ay=!1;function Xx(t,e,n){if(ay)return t(e,n);ay=!0;try{var r=t(e);return r}finally{if(ay=!1,(fu!==null||Su!==null)&&(nh(),fu&&(e=fu,t=Su,Su=fu=null,gS(e),t)))for(e=0;e<t.length;e++)gS(t[e])}}function Kc(t,e){var n=t.stateNode;if(n===null)return null;var r=n[sn]||null;if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var Sa=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Fy=!1;if(Sa)try{nu={},Object.defineProperty(nu,"passive",{get:function(){Fy=!0}}),window.addEventListener("test",nu,nu),window.removeEventListener("test",nu,nu)}catch(t){Fy=!1}var nu,yi=null,kb=null,ip=null;function Qx(){if(ip)return ip;var t,e=kb,n=e.length,r,a="value"in yi?yi.value:yi.textContent,i=a.length;for(t=0;t<n&&e[t]===a[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===a[i-r];r++);return ip=a.slice(t,1<r?1-r:void 0)}function sp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Hd(){return!0}function yS(){return!1}function on(t){function e(n,r,a,i,s){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Hd:yS,this.isPropagationStopped=yS,this}return Me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Hd)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Hd)},persist:function(){},isPersistent:Hd}),e}var Ds={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zp=on(Ds),pf=Me({},Ds,{view:0,detail:0}),Wk=on(pf),iy,sy,Sc,Kp=Me({},pf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Db,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Sc&&(Sc&&t.type==="mousemove"?(iy=t.screenX-Sc.screenX,sy=t.screenY-Sc.screenY):sy=iy=0,Sc=t),iy)},movementY:function(t){return"movementY"in t?t.movementY:sy}}),bS=on(Kp),e2=Me({},Kp,{dataTransfer:0}),t2=on(e2),n2=Me({},pf,{relatedTarget:0}),oy=on(n2),r2=Me({},Ds,{animationName:0,elapsedTime:0,pseudoElement:0}),a2=on(r2),i2=Me({},Ds,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),s2=on(i2),o2=Me({},Ds,{data:0}),_S=on(o2),u2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},l2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},c2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function f2(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=c2[t])?!!e[t]:!1}function Db(){return f2}var d2=Me({},pf,{key:function(t){if(t.key){var e=u2[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=sp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?l2[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Db,charCode:function(t){return t.type==="keypress"?sp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?sp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),p2=on(d2),h2=Me({},Kp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wS=on(h2),m2=Me({},pf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Db}),g2=on(m2),y2=Me({},Ds,{propertyName:0,elapsedTime:0,pseudoElement:0}),b2=on(y2),_2=Me({},Kp,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),w2=on(_2),v2=Me({},Ds,{newState:0,oldState:0}),S2=on(v2),x2=[9,13,27,32],jb=Sa&&"CompositionEvent"in window,kc=null;Sa&&"documentMode"in document&&(kc=document.documentMode);var A2=Sa&&"TextEvent"in window&&!kc,Wx=Sa&&(!jb||kc&&8<kc&&11>=kc),vS=" ",SS=!1;function eA(t,e){switch(t){case"keyup":return x2.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tA(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var du=!1;function T2(t,e){switch(t){case"compositionend":return tA(e);case"keypress":return e.which!==32?null:(SS=!0,vS);case"textInput":return t=e.data,t===vS&&SS?null:t;default:return null}}function E2(t,e){if(du)return t==="compositionend"||!jb&&eA(t,e)?(t=Qx(),ip=kb=yi=null,du=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Wx&&e.locale!=="ko"?null:e.data;default:return null}}var O2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xS(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!O2[t.type]:e==="textarea"}function nA(t,e,n,r){fu?Su?Su.push(r):Su=[r]:fu=r,e=Up(e,"onChange"),0<e.length&&(n=new Zp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Dc=null,Yc=null;function R2(t){KT(t,0)}function Yp(t){var e=Pc(t);if(Gx(e))return t}function AS(t,e){if(t==="change")return e}var rA=!1;Sa&&(Sa?(Gd="oninput"in document,Gd||(uy=document.createElement("div"),uy.setAttribute("oninput","return;"),Gd=typeof uy.oninput=="function"),Vd=Gd):Vd=!1,rA=Vd&&(!document.documentMode||9<document.documentMode));var Vd,Gd,uy;function TS(){Dc&&(Dc.detachEvent("onpropertychange",aA),Yc=Dc=null)}function aA(t){if(t.propertyName==="value"&&Yp(Yc)){var e=[];nA(e,Yc,t,Nb(t)),Xx(R2,e)}}function C2(t,e,n){t==="focusin"?(TS(),Dc=e,Yc=n,Dc.attachEvent("onpropertychange",aA)):t==="focusout"&&TS()}function I2(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Yp(Yc)}function P2(t,e){if(t==="click")return Yp(e)}function N2(t,e){if(t==="input"||t==="change")return Yp(e)}function k2(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Rn=typeof Object.is=="function"?Object.is:k2;function Jc(t,e){if(Rn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!$y.call(e,a)||!Rn(t[a],e[a]))return!1}return!0}function ES(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function OS(t,e){var n=ES(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ES(n)}}function iA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?iA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function sA(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=vp(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch(r){n=!1}if(n)t=e.contentWindow;else break;e=vp(t.document)}return e}function Mb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var D2=Sa&&"documentMode"in document&&11>=document.documentMode,pu=null,qy=null,jc=null,Hy=!1;function RS(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Hy||pu==null||pu!==vp(r)||(r=pu,"selectionStart"in r&&Mb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),jc&&Jc(jc,r)||(jc=r,r=Up(qy,"onSelect"),0<r.length&&(e=new Zp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=pu)))}function bs(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var hu={animationend:bs("Animation","AnimationEnd"),animationiteration:bs("Animation","AnimationIteration"),animationstart:bs("Animation","AnimationStart"),transitionrun:bs("Transition","TransitionRun"),transitionstart:bs("Transition","TransitionStart"),transitioncancel:bs("Transition","TransitionCancel"),transitionend:bs("Transition","TransitionEnd")},ly={},oA={};Sa&&(oA=document.createElement("div").style,"AnimationEvent"in window||(delete hu.animationend.animation,delete hu.animationiteration.animation,delete hu.animationstart.animation),"TransitionEvent"in window||delete hu.transitionend.transition);function js(t){if(ly[t])return ly[t];if(!hu[t])return t;var e=hu[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in oA)return ly[t]=e[n];return t}var uA=js("animationend"),lA=js("animationiteration"),cA=js("animationstart"),j2=js("transitionrun"),M2=js("transitionstart"),$2=js("transitioncancel"),fA=js("transitionend"),dA=new Map,Vy="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vy.push("scrollEnd");function fr(t,e){dA.set(t,e),ks(e,[t])}var CS=new WeakMap;function Zn(t,e){if(typeof t=="object"&&t!==null){var n=CS.get(t);return n!==void 0?n:(e={value:t,source:e,stack:hS(e)},CS.set(t,e),e)}return{value:t,source:e,stack:hS(e)}}var Fn=[],mu=0,$b=0;function Jp(){for(var t=mu,e=$b=mu=0;e<t;){var n=Fn[e];Fn[e++]=null;var r=Fn[e];Fn[e++]=null;var a=Fn[e];Fn[e++]=null;var i=Fn[e];if(Fn[e++]=null,r!==null&&a!==null){var s=r.pending;s===null?a.next=a:(a.next=s.next,s.next=a),r.pending=a}i!==0&&pA(n,a,i)}}function Xp(t,e,n,r){Fn[mu++]=t,Fn[mu++]=e,Fn[mu++]=n,Fn[mu++]=r,$b|=r,t.lanes|=r,t=t.alternate,t!==null&&(t.lanes|=r)}function Lb(t,e,n,r){return Xp(t,e,n,r),Sp(t)}function Bu(t,e){return Xp(t,null,null,e),Sp(t)}function pA(t,e,n){t.lanes|=n;var r=t.alternate;r!==null&&(r.lanes|=n);for(var a=!1,i=t.return;i!==null;)i.childLanes|=n,r=i.alternate,r!==null&&(r.childLanes|=n),i.tag===22&&(t=i.stateNode,t===null||t._visibility&1||(a=!0)),t=i,i=i.return;return t.tag===3?(i=t.stateNode,a&&e!==null&&(a=31-Tn(n),t=i.hiddenUpdates,r=t[a],r===null?t[a]=[e]:r.push(e),e.lane=n|536870912),i):null}function Sp(t){if(50<Vc)throw Vc=0,db=null,Error(O(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var gu={};function L2(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xn(t,e,n,r){return new L2(t,e,n,r)}function Ub(t){return t=t.prototype,!(!t||!t.isReactComponent)}function wa(t,e){var n=t.alternate;return n===null?(n=xn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&65011712,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function hA(t,e){t.flags&=65011714;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function op(t,e,n,r,a,i){var s=0;if(r=t,typeof t=="function")Ub(t)&&(s=1);else if(typeof t=="string")s=LD(t,n,$r.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case ky:return t=xn(31,n,e,a),t.elementType=ky,t.lanes=i,t;case uu:return xs(n.children,a,i,e);case kx:s=8,a|=24;break;case Iy:return t=xn(12,n,e,a|2),t.elementType=Iy,t.lanes=i,t;case Py:return t=xn(13,n,e,a),t.elementType=Py,t.lanes=i,t;case Ny:return t=xn(19,n,e,a),t.elementType=Ny,t.lanes=i,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Rk:case ma:s=10;break e;case Dx:s=9;break e;case Tb:s=11;break e;case Eb:s=14;break e;case ci:s=16,r=null;break e}s=29,n=Error(O(130,t===null?"null":typeof t,"")),r=null}return e=xn(s,n,e,a),e.elementType=t,e.type=r,e.lanes=i,e}function xs(t,e,n,r){return t=xn(7,t,r,e),t.lanes=n,t}function cy(t,e,n){return t=xn(6,t,null,e),t.lanes=n,t}function fy(t,e,n){return e=xn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var yu=[],bu=0,xp=null,Ap=0,Hn=[],Vn=0,As=null,ga=1,ya="";function ws(t,e){yu[bu++]=Ap,yu[bu++]=xp,xp=t,Ap=e}function mA(t,e,n){Hn[Vn++]=ga,Hn[Vn++]=ya,Hn[Vn++]=As,As=t;var r=ga;t=ya;var a=32-Tn(r)-1;r&=~(1<<a),n+=1;var i=32-Tn(e)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,ga=1<<32-Tn(e)+a|n<<a|r,ya=i+t}else ga=1<<i|n<<a|r,ya=t}function zb(t){t.return!==null&&(ws(t,1),mA(t,1,0))}function Bb(t){for(;t===xp;)xp=yu[--bu],yu[bu]=null,Ap=yu[--bu],yu[bu]=null;for(;t===As;)As=Hn[--Vn],Hn[Vn]=null,ya=Hn[--Vn],Hn[Vn]=null,ga=Hn[--Vn],Hn[Vn]=null}var Gt=null,Xe=null,Se=!1,Ts=null,jr=!1,Gy=Error(O(519));function Cs(t){var e=Error(O(418,""));throw Xc(Zn(e,t)),Gy}function IS(t){var e=t.stateNode,n=t.type,r=t.memoizedProps;switch(e[jt]=t,e[sn]=r,n){case"dialog":pe("cancel",e),pe("close",e);break;case"iframe":case"object":case"embed":pe("load",e);break;case"video":case"audio":for(n=0;n<ef.length;n++)pe(ef[n],e);break;case"source":pe("error",e);break;case"img":case"image":case"link":pe("error",e),pe("load",e);break;case"details":pe("toggle",e);break;case"input":pe("invalid",e),Zx(e,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),wp(e);break;case"select":pe("invalid",e);break;case"textarea":pe("invalid",e),Yx(e,r.value,r.defaultValue,r.children),wp(e)}n=r.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||r.suppressHydrationWarning===!0||JT(e.textContent,n)?(r.popover!=null&&(pe("beforetoggle",e),pe("toggle",e)),r.onScroll!=null&&pe("scroll",e),r.onScrollEnd!=null&&pe("scrollend",e),r.onClick!=null&&(e.onclick=ih),e=!0):e=!1,e||Cs(t)}function PS(t){for(Gt=t.return;Gt;)switch(Gt.tag){case 5:case 13:jr=!1;return;case 27:case 3:jr=!0;return;default:Gt=Gt.return}}function xc(t){if(t!==Gt)return!1;if(!Se)return PS(t),Se=!0,!1;var e=t.tag,n;if((n=e!==3&&e!==27)&&((n=e===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||bb(t.type,t.memoizedProps)),n=!n),n&&Xe&&Cs(t),PS(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8)if(n=t.data,n==="/$"){if(e===0){Xe=cr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++;t=t.nextSibling}Xe=null}}else e===27?(e=Xe,Ni(t.type)?(t=vb,vb=null,Xe=t):Xe=e):Xe=Gt?cr(t.stateNode.nextSibling):null;return!0}function hf(){Xe=Gt=null,Se=!1}function NS(){var t=Ts;return t!==null&&(an===null?an=t:an.push.apply(an,t),Ts=null),t}function Xc(t){Ts===null?Ts=[t]:Ts.push(t)}var Zy=zr(null),Ms=null,ba=null;function di(t,e,n){qe(Zy,e._currentValue),e._currentValue=n}function va(t){t._currentValue=Zy.current,vt(Zy)}function Ky(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Yy(t,e,n,r){var a=t.child;for(a!==null&&(a.return=t);a!==null;){var i=a.dependencies;if(i!==null){var s=a.child;i=i.firstContext;e:for(;i!==null;){var o=i;i=a;for(var u=0;u<e.length;u++)if(o.context===e[u]){i.lanes|=n,o=i.alternate,o!==null&&(o.lanes|=n),Ky(i.return,n,t),r||(s=null);break e}i=o.next}}else if(a.tag===18){if(s=a.return,s===null)throw Error(O(341));s.lanes|=n,i=s.alternate,i!==null&&(i.lanes|=n),Ky(s,n,t),s=null}else s=a.child;if(s!==null)s.return=a;else for(s=a;s!==null;){if(s===t){s=null;break}if(a=s.sibling,a!==null){a.return=s.return,s=a;break}s=s.return}a=s}}function mf(t,e,n,r){t=null;for(var a=e,i=!1;a!==null;){if(!i){if((a.flags&524288)!==0)i=!0;else if((a.flags&262144)!==0)break}if(a.tag===10){var s=a.alternate;if(s===null)throw Error(O(387));if(s=s.memoizedProps,s!==null){var o=a.type;Rn(a.pendingProps.value,s.value)||(t!==null?t.push(o):t=[o])}}else if(a===gp.current){if(s=a.alternate,s===null)throw Error(O(387));s.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(t!==null?t.push(rf):t=[rf])}a=a.return}t!==null&&Yy(e,t,n,r),e.flags|=262144}function Tp(t){for(t=t.firstContext;t!==null;){if(!Rn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Is(t){Ms=t,ba=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Mt(t){return gA(Ms,t)}function Zd(t,e){return Ms===null&&Is(t),gA(t,e)}function gA(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},ba===null){if(t===null)throw Error(O(308));ba=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else ba=ba.next=e;return n}var U2=typeof AbortController!="undefined"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,r){t.push(r)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},z2=pt.unstable_scheduleCallback,B2=pt.unstable_NormalPriority,ft={$$typeof:ma,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Fb(){return{controller:new U2,data:new Map,refCount:0}}function gf(t){t.refCount--,t.refCount===0&&z2(B2,function(){t.controller.abort()})}var Mc=null,Jy=0,Pu=0,xu=null;function F2(t,e){if(Mc===null){var n=Mc=[];Jy=0,Pu=f_(),xu={status:"pending",value:void 0,then:function(r){n.push(r)}}}return Jy++,e.then(kS,kS),e}function kS(){if(--Jy===0&&Mc!==null){xu!==null&&(xu.status="fulfilled");var t=Mc;Mc=null,Pu=0,xu=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function q2(t,e){var n=[],r={status:"pending",value:null,reason:null,then:function(a){n.push(a)}};return t.then(function(){r.status="fulfilled",r.value=e;for(var a=0;a<n.length;a++)(0,n[a])(e)},function(a){for(r.status="rejected",r.reason=a,a=0;a<n.length;a++)(0,n[a])(void 0)}),r}var DS=J.S;J.S=function(t,e){typeof e=="object"&&e!==null&&typeof e.then=="function"&&F2(t,e),DS!==null&&DS(t,e)};var Es=zr(null);function qb(){var t=Es.current;return t!==null?t:De.pooledCache}function up(t,e){e===null?qe(Es,Es.current):qe(Es,e.pool)}function yA(){var t=qb();return t===null?null:{parent:ft._currentValue,pool:t}}var yf=Error(O(460)),bA=Error(O(474)),Qp=Error(O(542)),Xy={then:function(){}};function jS(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Kd(){}function _A(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(Kd,Kd),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,$S(t),t;default:if(typeof e.status=="string")e.then(Kd,Kd);else{if(t=De,t!==null&&100<t.shellSuspendCounter)throw Error(O(482));t=e,t.status="pending",t.then(function(r){if(e.status==="pending"){var a=e;a.status="fulfilled",a.value=r}},function(r){if(e.status==="pending"){var a=e;a.status="rejected",a.reason=r}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,$S(t),t}throw $c=e,yf}}var $c=null;function MS(){if($c===null)throw Error(O(459));var t=$c;return $c=null,t}function $S(t){if(t===yf||t===Qp)throw Error(O(483))}var fi=!1;function Hb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qy(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function vi(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Si(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,(Ee&2)!==0){var a=r.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),r.pending=e,e=Sp(t),pA(t,null,n),e}return Xp(t,r,e,n),Sp(t)}function Lc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194048)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Bx(t,n)}}function dy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};i===null?a=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?a=i=e:i=i.next=e}else a=i=e;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,callbacks:r.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var Wy=!1;function Uc(){if(Wy){var t=xu;if(t!==null)throw t}}function zc(t,e,n,r){Wy=!1;var a=t.updateQueue;fi=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var u=o,l=u.next;u.next=null,s===null?i=l:s.next=l,s=u;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==s&&(o===null?c.firstBaseUpdate=l:o.next=l,c.lastBaseUpdate=u))}if(i!==null){var f=a.baseState;s=0,c=l=u=null,o=i;do{var d=o.lane&-536870913,p=d!==o.lane;if(p?(be&d)===d:(r&d)===d){d!==0&&d===Pu&&(Wy=!0),c!==null&&(c=c.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var g=t,b=o;d=e;var _=n;switch(b.tag){case 1:if(g=b.payload,typeof g=="function"){f=g.call(_,f,d);break e}f=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=b.payload,d=typeof g=="function"?g.call(_,f,d):g,d==null)break e;f=Me({},f,d);break e;case 2:fi=!0}}d=o.callback,d!==null&&(t.flags|=64,p&&(t.flags|=8192),p=a.callbacks,p===null?a.callbacks=[d]:p.push(d))}else p={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(l=c=p,u=f):c=c.next=p,s|=d;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;p=o,o=p.next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}while(!0);c===null&&(u=f),a.baseState=u,a.firstBaseUpdate=l,a.lastBaseUpdate=c,i===null&&(a.shared.lanes=0),Ii|=s,t.lanes=s,t.memoizedState=f}}function wA(t,e){if(typeof t!="function")throw Error(O(191,t));t.call(e)}function vA(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)wA(n[t],e)}var Nu=zr(null),Ep=zr(0);function LS(t,e){t=Ta,qe(Ep,t),qe(Nu,e),Ta=t|e.baseLanes}function eb(){qe(Ep,Ta),qe(Nu,Nu.current)}function Vb(){Ta=Ep.current,vt(Nu),vt(Ep)}var Ri=0,de=null,Ce=null,ot=null,Op=!1,Au=!1,Ps=!1,Rp=0,Qc=0,Tu=null,H2=0;function tt(){throw Error(O(321))}function Gb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Rn(t[n],e[n]))return!1;return!0}function Zb(t,e,n,r,a,i){return Ri=i,de=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,J.H=t===null||t.memoizedState===null?QA:WA,Ps=!1,i=n(r,a),Ps=!1,Au&&(i=xA(e,n,r,a)),SA(t),i}function SA(t){J.H=Cp;var e=Ce!==null&&Ce.next!==null;if(Ri=0,ot=Ce=de=null,Op=!1,Qc=0,Tu=null,e)throw Error(O(300));t===null||wt||(t=t.dependencies,t!==null&&Tp(t)&&(wt=!0))}function xA(t,e,n,r){de=t;var a=0;do{if(Au&&(Tu=null),Qc=0,Au=!1,25<=a)throw Error(O(301));if(a+=1,ot=Ce=null,t.updateQueue!=null){var i=t.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,i.memoCache!=null&&(i.memoCache.index=0)}J.H=X2,i=e(n,r)}while(Au);return i}function V2(){var t=J.H,e=t.useState()[0];return e=typeof e.then=="function"?bf(e):e,t=t.useState()[0],(Ce!==null?Ce.memoizedState:null)!==t&&(de.flags|=1024),e}function Kb(){var t=Rp!==0;return Rp=0,t}function Yb(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function Jb(t){if(Op){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}Op=!1}Ri=0,ot=Ce=de=null,Au=!1,Qc=Rp=0,Tu=null}function nn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ot===null?de.memoizedState=ot=t:ot=ot.next=t,ot}function ut(){if(Ce===null){var t=de.alternate;t=t!==null?t.memoizedState:null}else t=Ce.next;var e=ot===null?de.memoizedState:ot.next;if(e!==null)ot=e,Ce=t;else{if(t===null)throw de.alternate===null?Error(O(467)):Error(O(310));Ce=t,t={memoizedState:Ce.memoizedState,baseState:Ce.baseState,baseQueue:Ce.baseQueue,queue:Ce.queue,next:null},ot===null?de.memoizedState=ot=t:ot=ot.next=t}return ot}function Xb(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function bf(t){var e=Qc;return Qc+=1,Tu===null&&(Tu=[]),t=_A(Tu,t,e),e=de,(ot===null?e.memoizedState:ot.next)===null&&(e=e.alternate,J.H=e===null||e.memoizedState===null?QA:WA),t}function Wp(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return bf(t);if(t.$$typeof===ma)return Mt(t)}throw Error(O(438,String(t)))}function Qb(t){var e=null,n=de.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var r=de.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(e={data:r.data.map(function(a){return a.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=Xb(),de.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),r=0;r<t;r++)n[r]=Ck;return e.index++,n}function xa(t,e){return typeof e=="function"?e(t):e}function lp(t){var e=ut();return Wb(e,Ce,t)}function Wb(t,e,n){var r=t.queue;if(r===null)throw Error(O(311));r.lastRenderedReducer=n;var a=t.baseQueue,i=r.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}e.baseQueue=a=i,r.pending=null}if(i=t.baseState,a===null)t.memoizedState=i;else{e=a.next;var o=s=null,u=null,l=e,c=!1;do{var f=l.lane&-536870913;if(f!==l.lane?(be&f)===f:(Ri&f)===f){var d=l.revertLane;if(d===0)u!==null&&(u=u.next={lane:0,revertLane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),f===Pu&&(c=!0);else if((Ri&d)===d){l=l.next,d===Pu&&(c=!0);continue}else f={lane:0,revertLane:l.revertLane,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null},u===null?(o=u=f,s=i):u=u.next=f,de.lanes|=d,Ii|=d;f=l.action,Ps&&n(i,f),i=l.hasEagerState?l.eagerState:n(i,f)}else d={lane:f,revertLane:l.revertLane,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null},u===null?(o=u=d,s=i):u=u.next=d,de.lanes|=f,Ii|=f;l=l.next}while(l!==null&&l!==e);if(u===null?s=i:u.next=o,!Rn(i,t.memoizedState)&&(wt=!0,c&&(n=xu,n!==null)))throw n;t.memoizedState=i,t.baseState=s,t.baseQueue=u,r.lastRenderedState=i}return a===null&&(r.lanes=0),[t.memoizedState,r.dispatch]}function py(t){var e=ut(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var r=n.dispatch,a=n.pending,i=e.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do i=t(i,s.action),s=s.next;while(s!==a);Rn(i,e.memoizedState)||(wt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function AA(t,e,n){var r=de,a=ut(),i=Se;if(i){if(n===void 0)throw Error(O(407));n=n()}else n=e();var s=!Rn((Ce||a).memoizedState,n);s&&(a.memoizedState=n,wt=!0),a=a.queue;var o=OA.bind(null,r,a,t);if(_f(2048,8,o,[t]),a.getSnapshot!==e||s||ot!==null&&ot.memoizedState.tag&1){if(r.flags|=2048,ku(9,eh(),EA.bind(null,r,a,n,e),null),De===null)throw Error(O(349));i||(Ri&124)!==0||TA(r,e,n)}return n}function TA(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=de.updateQueue,e===null?(e=Xb(),de.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function EA(t,e,n,r){e.value=n,e.getSnapshot=r,RA(e)&&CA(t)}function OA(t,e,n){return n(function(){RA(e)&&CA(t)})}function RA(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Rn(t,n)}catch(r){return!0}}function CA(t){var e=Bu(t,2);e!==null&&On(e,t,2)}function tb(t){var e=nn();if(typeof t=="function"){var n=t;if(t=n(),Ps){gi(!0);try{n()}finally{gi(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:t},e}function IA(t,e,n,r){return t.baseState=n,Wb(t,Ce,typeof r=="function"?r:xa)}function G2(t,e,n,r,a){if(th(t))throw Error(O(485));if(t=e.action,t!==null){var i={payload:a,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(s){i.listeners.push(s)}};J.T!==null?n(!0):i.isTransition=!1,r(i),n=e.pending,n===null?(i.next=e.pending=i,PA(e,i)):(i.next=n.next,e.pending=n.next=i)}}function PA(t,e){var n=e.action,r=e.payload,a=t.state;if(e.isTransition){var i=J.T,s={};J.T=s;try{var o=n(a,r),u=J.S;u!==null&&u(s,o),US(t,e,o)}catch(l){nb(t,e,l)}finally{J.T=i}}else try{i=n(a,r),US(t,e,i)}catch(l){nb(t,e,l)}}function US(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(r){zS(t,e,r)},function(r){return nb(t,e,r)}):zS(t,e,n)}function zS(t,e,n){e.status="fulfilled",e.value=n,NA(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,PA(t,n)))}function nb(t,e,n){var r=t.pending;if(t.pending=null,r!==null){r=r.next;do e.status="rejected",e.reason=n,NA(e),e=e.next;while(e!==r)}t.action=null}function NA(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function kA(t,e){return e}function BS(t,e){if(Se){var n=De.formState;if(n!==null){e:{var r=de;if(Se){if(Xe){t:{for(var a=Xe,i=jr;a.nodeType!==8;){if(!i){a=null;break t}if(a=cr(a.nextSibling),a===null){a=null;break t}}i=a.data,a=i==="F!"||i==="F"?a:null}if(a){Xe=cr(a.nextSibling),r=a.data==="F!";break e}}Cs(r)}r=!1}r&&(e=n[0])}}return n=nn(),n.memoizedState=n.baseState=e,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kA,lastRenderedState:e},n.queue=r,n=YA.bind(null,de,r),r.dispatch=n,r=tb(!1),i=r_.bind(null,de,!1,r.queue),r=nn(),a={state:e,dispatch:null,action:t,pending:null},r.queue=a,n=G2.bind(null,de,a,i,n),a.dispatch=n,r.memoizedState=t,[e,n,!1]}function FS(t){var e=ut();return DA(e,Ce,t)}function DA(t,e,n){if(e=Wb(t,e,kA)[0],t=lp(xa)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var r=bf(e)}catch(s){throw s===yf?Qp:s}else r=e;e=ut();var a=e.queue,i=a.dispatch;return n!==e.memoizedState&&(de.flags|=2048,ku(9,eh(),Z2.bind(null,a,n),null)),[r,i,t]}function Z2(t,e){t.action=e}function qS(t){var e=ut(),n=Ce;if(n!==null)return DA(e,n,t);ut(),e=e.memoizedState,n=ut();var r=n.queue.dispatch;return n.memoizedState=t,[e,r,!1]}function ku(t,e,n,r){return t={tag:t,create:n,deps:r,inst:e,next:null},e=de.updateQueue,e===null&&(e=Xb(),de.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t),t}function eh(){return{destroy:void 0,resource:void 0}}function jA(){return ut().memoizedState}function cp(t,e,n,r){var a=nn();r=r===void 0?null:r,de.flags|=t,a.memoizedState=ku(1|e,eh(),n,r)}function _f(t,e,n,r){var a=ut();r=r===void 0?null:r;var i=a.memoizedState.inst;Ce!==null&&r!==null&&Gb(r,Ce.memoizedState.deps)?a.memoizedState=ku(e,i,n,r):(de.flags|=t,a.memoizedState=ku(1|e,i,n,r))}function HS(t,e){cp(8390656,8,t,e)}function MA(t,e){_f(2048,8,t,e)}function $A(t,e){return _f(4,2,t,e)}function LA(t,e){return _f(4,4,t,e)}function UA(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function zA(t,e,n){n=n!=null?n.concat([t]):null,_f(4,4,UA.bind(null,e,t),n)}function e_(){}function BA(t,e){var n=ut();e=e===void 0?null:e;var r=n.memoizedState;return e!==null&&Gb(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function FA(t,e){var n=ut();e=e===void 0?null:e;var r=n.memoizedState;if(e!==null&&Gb(e,r[1]))return r[0];if(r=t(),Ps){gi(!0);try{t()}finally{gi(!1)}}return n.memoizedState=[r,e],r}function t_(t,e,n){return n===void 0||(Ri&1073741824)!==0?t.memoizedState=e:(t.memoizedState=n,t=NT(),de.lanes|=t,Ii|=t,n)}function qA(t,e,n,r){return Rn(n,e)?n:Nu.current!==null?(t=t_(t,n,r),Rn(t,e)||(wt=!0),t):(Ri&42)===0?(wt=!0,t.memoizedState=n):(t=NT(),de.lanes|=t,Ii|=t,e)}function HA(t,e,n,r,a){var i=xe.p;xe.p=i!==0&&8>i?i:8;var s=J.T,o={};J.T=o,r_(t,!1,e,n);try{var u=a(),l=J.S;if(l!==null&&l(o,u),u!==null&&typeof u=="object"&&typeof u.then=="function"){var c=q2(u,r);Bc(t,e,c,En(t))}else Bc(t,e,r,En(t))}catch(f){Bc(t,e,{then:function(){},status:"rejected",reason:f},En())}finally{xe.p=i,J.T=s}}function K2(){}function rb(t,e,n,r){if(t.tag!==5)throw Error(O(476));var a=VA(t).queue;HA(t,a,e,Ss,n===null?K2:function(){return GA(t),n(r)})}function VA(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:Ss,baseState:Ss,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:Ss},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function GA(t){var e=VA(t).next.queue;Bc(t,e,{},En())}function n_(){return Mt(rf)}function ZA(){return ut().memoizedState}function KA(){return ut().memoizedState}function Y2(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=En();t=vi(n);var r=Si(e,t,n);r!==null&&(On(r,e,n),Lc(r,e,n)),e={cache:Fb()},t.payload=e;return}e=e.return}}function J2(t,e,n){var r=En();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},th(t)?JA(e,n):(n=Lb(t,e,n,r),n!==null&&(On(n,t,r),XA(n,e,r)))}function YA(t,e,n){var r=En();Bc(t,e,n,r)}function Bc(t,e,n,r){var a={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(th(t))JA(e,a);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var s=e.lastRenderedState,o=i(s,n);if(a.hasEagerState=!0,a.eagerState=o,Rn(o,s))return Xp(t,e,a,0),De===null&&Jp(),!1}catch(u){}finally{}if(n=Lb(t,e,a,r),n!==null)return On(n,t,r),XA(n,e,r),!0}return!1}function r_(t,e,n,r){if(r={lane:2,revertLane:f_(),action:r,hasEagerState:!1,eagerState:null,next:null},th(t)){if(e)throw Error(O(479))}else e=Lb(t,n,r,2),e!==null&&On(e,t,2)}function th(t){var e=t.alternate;return t===de||e!==null&&e===de}function JA(t,e){Au=Op=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function XA(t,e,n){if((n&4194048)!==0){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Bx(t,n)}}var Cp={readContext:Mt,use:Wp,useCallback:tt,useContext:tt,useEffect:tt,useImperativeHandle:tt,useLayoutEffect:tt,useInsertionEffect:tt,useMemo:tt,useReducer:tt,useRef:tt,useState:tt,useDebugValue:tt,useDeferredValue:tt,useTransition:tt,useSyncExternalStore:tt,useId:tt,useHostTransitionStatus:tt,useFormState:tt,useActionState:tt,useOptimistic:tt,useMemoCache:tt,useCacheRefresh:tt},QA={readContext:Mt,use:Wp,useCallback:function(t,e){return nn().memoizedState=[t,e===void 0?null:e],t},useContext:Mt,useEffect:HS,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,cp(4194308,4,UA.bind(null,e,t),n)},useLayoutEffect:function(t,e){return cp(4194308,4,t,e)},useInsertionEffect:function(t,e){cp(4,2,t,e)},useMemo:function(t,e){var n=nn();e=e===void 0?null:e;var r=t();if(Ps){gi(!0);try{t()}finally{gi(!1)}}return n.memoizedState=[r,e],r},useReducer:function(t,e,n){var r=nn();if(n!==void 0){var a=n(e);if(Ps){gi(!0);try{n(e)}finally{gi(!1)}}}else a=e;return r.memoizedState=r.baseState=a,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:a},r.queue=t,t=t.dispatch=J2.bind(null,de,t),[r.memoizedState,t]},useRef:function(t){var e=nn();return t={current:t},e.memoizedState=t},useState:function(t){t=tb(t);var e=t.queue,n=YA.bind(null,de,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:e_,useDeferredValue:function(t,e){var n=nn();return t_(n,t,e)},useTransition:function(){var t=tb(!1);return t=HA.bind(null,de,t.queue,!0,!1),nn().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var r=de,a=nn();if(Se){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),De===null)throw Error(O(349));(be&124)!==0||TA(r,e,n)}a.memoizedState=n;var i={value:n,getSnapshot:e};return a.queue=i,HS(OA.bind(null,r,i,t),[t]),r.flags|=2048,ku(9,eh(),EA.bind(null,r,i,n,e),null),n},useId:function(){var t=nn(),e=De.identifierPrefix;if(Se){var n=ya,r=ga;n=(r&~(1<<32-Tn(r)-1)).toString(32)+n,e="\xAB"+e+"R"+n,n=Rp++,0<n&&(e+="H"+n.toString(32)),e+="\xBB"}else n=H2++,e="\xAB"+e+"r"+n.toString(32)+"\xBB";return t.memoizedState=e},useHostTransitionStatus:n_,useFormState:BS,useActionState:BS,useOptimistic:function(t){var e=nn();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=r_.bind(null,de,!0,n),n.dispatch=e,[t,e]},useMemoCache:Qb,useCacheRefresh:function(){return nn().memoizedState=Y2.bind(null,de)}},WA={readContext:Mt,use:Wp,useCallback:BA,useContext:Mt,useEffect:MA,useImperativeHandle:zA,useInsertionEffect:$A,useLayoutEffect:LA,useMemo:FA,useReducer:lp,useRef:jA,useState:function(){return lp(xa)},useDebugValue:e_,useDeferredValue:function(t,e){var n=ut();return qA(n,Ce.memoizedState,t,e)},useTransition:function(){var t=lp(xa)[0],e=ut().memoizedState;return[typeof t=="boolean"?t:bf(t),e]},useSyncExternalStore:AA,useId:ZA,useHostTransitionStatus:n_,useFormState:FS,useActionState:FS,useOptimistic:function(t,e){var n=ut();return IA(n,Ce,t,e)},useMemoCache:Qb,useCacheRefresh:KA},X2={readContext:Mt,use:Wp,useCallback:BA,useContext:Mt,useEffect:MA,useImperativeHandle:zA,useInsertionEffect:$A,useLayoutEffect:LA,useMemo:FA,useReducer:py,useRef:jA,useState:function(){return py(xa)},useDebugValue:e_,useDeferredValue:function(t,e){var n=ut();return Ce===null?t_(n,t,e):qA(n,Ce.memoizedState,t,e)},useTransition:function(){var t=py(xa)[0],e=ut().memoizedState;return[typeof t=="boolean"?t:bf(t),e]},useSyncExternalStore:AA,useId:ZA,useHostTransitionStatus:n_,useFormState:qS,useActionState:qS,useOptimistic:function(t,e){var n=ut();return Ce!==null?IA(n,Ce,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:Qb,useCacheRefresh:KA},Eu=null,Wc=0;function Yd(t){var e=Wc;return Wc+=1,Eu===null&&(Eu=[]),_A(Eu,t,e)}function Ac(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function Jd(t,e){throw e.$$typeof===Ok?Error(O(525)):(t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function VS(t){var e=t._init;return e(t._payload)}function eT(t){function e(m,h){if(t){var y=m.deletions;y===null?(m.deletions=[h],m.flags|=16):y.push(h)}}function n(m,h){if(!t)return null;for(;h!==null;)e(m,h),h=h.sibling;return null}function r(m){for(var h=new Map;m!==null;)m.key!==null?h.set(m.key,m):h.set(m.index,m),m=m.sibling;return h}function a(m,h){return m=wa(m,h),m.index=0,m.sibling=null,m}function i(m,h,y){return m.index=y,t?(y=m.alternate,y!==null?(y=y.index,y<h?(m.flags|=67108866,h):y):(m.flags|=67108866,h)):(m.flags|=1048576,h)}function s(m){return t&&m.alternate===null&&(m.flags|=67108866),m}function o(m,h,y,v){return h===null||h.tag!==6?(h=cy(y,m.mode,v),h.return=m,h):(h=a(h,y),h.return=m,h)}function u(m,h,y,v){var S=y.type;return S===uu?c(m,h,y.props.children,v,y.key):h!==null&&(h.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ci&&VS(S)===h.type)?(h=a(h,y.props),Ac(h,y),h.return=m,h):(h=op(y.type,y.key,y.props,null,m.mode,v),Ac(h,y),h.return=m,h)}function l(m,h,y,v){return h===null||h.tag!==4||h.stateNode.containerInfo!==y.containerInfo||h.stateNode.implementation!==y.implementation?(h=fy(y,m.mode,v),h.return=m,h):(h=a(h,y.children||[]),h.return=m,h)}function c(m,h,y,v,S){return h===null||h.tag!==7?(h=xs(y,m.mode,v,S),h.return=m,h):(h=a(h,y),h.return=m,h)}function f(m,h,y){if(typeof h=="string"&&h!==""||typeof h=="number"||typeof h=="bigint")return h=cy(""+h,m.mode,y),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case zd:return y=op(h.type,h.key,h.props,null,m.mode,y),Ac(y,h),y.return=m,y;case Cc:return h=fy(h,m.mode,y),h.return=m,h;case ci:var v=h._init;return h=v(h._payload),f(m,h,y)}if(Ic(h)||vc(h))return h=xs(h,m.mode,y,null),h.return=m,h;if(typeof h.then=="function")return f(m,Yd(h),y);if(h.$$typeof===ma)return f(m,Zd(m,h),y);Jd(m,h)}return null}function d(m,h,y,v){var S=h!==null?h.key:null;if(typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint")return S!==null?null:o(m,h,""+y,v);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case zd:return y.key===S?u(m,h,y,v):null;case Cc:return y.key===S?l(m,h,y,v):null;case ci:return S=y._init,y=S(y._payload),d(m,h,y,v)}if(Ic(y)||vc(y))return S!==null?null:c(m,h,y,v,null);if(typeof y.then=="function")return d(m,h,Yd(y),v);if(y.$$typeof===ma)return d(m,h,Zd(m,y),v);Jd(m,y)}return null}function p(m,h,y,v,S){if(typeof v=="string"&&v!==""||typeof v=="number"||typeof v=="bigint")return m=m.get(y)||null,o(h,m,""+v,S);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case zd:return m=m.get(v.key===null?y:v.key)||null,u(h,m,v,S);case Cc:return m=m.get(v.key===null?y:v.key)||null,l(h,m,v,S);case ci:var A=v._init;return v=A(v._payload),p(m,h,y,v,S)}if(Ic(v)||vc(v))return m=m.get(y)||null,c(h,m,v,S,null);if(typeof v.then=="function")return p(m,h,y,Yd(v),S);if(v.$$typeof===ma)return p(m,h,y,Zd(h,v),S);Jd(h,v)}return null}function g(m,h,y,v){for(var S=null,A=null,T=h,x=h=0,C=null;T!==null&&x<y.length;x++){T.index>x?(C=T,T=null):C=T.sibling;var R=d(m,T,y[x],v);if(R===null){T===null&&(T=C);break}t&&T&&R.alternate===null&&e(m,T),h=i(R,h,x),A===null?S=R:A.sibling=R,A=R,T=C}if(x===y.length)return n(m,T),Se&&ws(m,x),S;if(T===null){for(;x<y.length;x++)T=f(m,y[x],v),T!==null&&(h=i(T,h,x),A===null?S=T:A.sibling=T,A=T);return Se&&ws(m,x),S}for(T=r(T);x<y.length;x++)C=p(T,m,x,y[x],v),C!==null&&(t&&C.alternate!==null&&T.delete(C.key===null?x:C.key),h=i(C,h,x),A===null?S=C:A.sibling=C,A=C);return t&&T.forEach(function(B){return e(m,B)}),Se&&ws(m,x),S}function b(m,h,y,v){if(y==null)throw Error(O(151));for(var S=null,A=null,T=h,x=h=0,C=null,R=y.next();T!==null&&!R.done;x++,R=y.next()){T.index>x?(C=T,T=null):C=T.sibling;var B=d(m,T,R.value,v);if(B===null){T===null&&(T=C);break}t&&T&&B.alternate===null&&e(m,T),h=i(B,h,x),A===null?S=B:A.sibling=B,A=B,T=C}if(R.done)return n(m,T),Se&&ws(m,x),S;if(T===null){for(;!R.done;x++,R=y.next())R=f(m,R.value,v),R!==null&&(h=i(R,h,x),A===null?S=R:A.sibling=R,A=R);return Se&&ws(m,x),S}for(T=r(T);!R.done;x++,R=y.next())R=p(T,m,x,R.value,v),R!==null&&(t&&R.alternate!==null&&T.delete(R.key===null?x:R.key),h=i(R,h,x),A===null?S=R:A.sibling=R,A=R);return t&&T.forEach(function(te){return e(m,te)}),Se&&ws(m,x),S}function _(m,h,y,v){if(typeof y=="object"&&y!==null&&y.type===uu&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case zd:e:{for(var S=y.key;h!==null;){if(h.key===S){if(S=y.type,S===uu){if(h.tag===7){n(m,h.sibling),v=a(h,y.props.children),v.return=m,m=v;break e}}else if(h.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ci&&VS(S)===h.type){n(m,h.sibling),v=a(h,y.props),Ac(v,y),v.return=m,m=v;break e}n(m,h);break}else e(m,h);h=h.sibling}y.type===uu?(v=xs(y.props.children,m.mode,v,y.key),v.return=m,m=v):(v=op(y.type,y.key,y.props,null,m.mode,v),Ac(v,y),v.return=m,m=v)}return s(m);case Cc:e:{for(S=y.key;h!==null;){if(h.key===S)if(h.tag===4&&h.stateNode.containerInfo===y.containerInfo&&h.stateNode.implementation===y.implementation){n(m,h.sibling),v=a(h,y.children||[]),v.return=m,m=v;break e}else{n(m,h);break}else e(m,h);h=h.sibling}v=fy(y,m.mode,v),v.return=m,m=v}return s(m);case ci:return S=y._init,y=S(y._payload),_(m,h,y,v)}if(Ic(y))return g(m,h,y,v);if(vc(y)){if(S=vc(y),typeof S!="function")throw Error(O(150));return y=S.call(y),b(m,h,y,v)}if(typeof y.then=="function")return _(m,h,Yd(y),v);if(y.$$typeof===ma)return _(m,h,Zd(m,y),v);Jd(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint"?(y=""+y,h!==null&&h.tag===6?(n(m,h.sibling),v=a(h,y),v.return=m,m=v):(n(m,h),v=cy(y,m.mode,v),v.return=m,m=v),s(m)):n(m,h)}return function(m,h,y,v){try{Wc=0;var S=_(m,h,y,v);return Eu=null,S}catch(T){if(T===yf||T===Qp)throw T;var A=xn(29,T,null,m.mode);return A.lanes=v,A.return=m,A}finally{}}}var Du=eT(!0),tT=eT(!1),Yn=zr(null),Ur=null;function pi(t){var e=t.alternate;qe(dt,dt.current&1),qe(Yn,t),Ur===null&&(e===null||Nu.current!==null||e.memoizedState!==null)&&(Ur=t)}function nT(t){if(t.tag===22){if(qe(dt,dt.current),qe(Yn,t),Ur===null){var e=t.alternate;e!==null&&e.memoizedState!==null&&(Ur=t)}}else hi(t)}function hi(){qe(dt,dt.current),qe(Yn,Yn.current)}function _a(t){vt(Yn),Ur===t&&(Ur=null),vt(dt)}var dt=zr(0);function Ip(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||wb(n)))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function hy(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Me({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ab={enqueueSetState:function(t,e,n){t=t._reactInternals;var r=En(),a=vi(r);a.payload=e,n!=null&&(a.callback=n),e=Si(t,a,r),e!==null&&(On(e,t,r),Lc(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=En(),a=vi(r);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=Si(t,a,r),e!==null&&(On(e,t,r),Lc(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=En(),r=vi(n);r.tag=2,e!=null&&(r.callback=e),e=Si(t,r,n),e!==null&&(On(e,t,n),Lc(e,t,n))}};function GS(t,e,n,r,a,i,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,s):e.prototype&&e.prototype.isPureReactComponent?!Jc(n,r)||!Jc(a,i):!0}function ZS(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&ab.enqueueReplaceState(e,e.state,null)}function Ns(t,e){var n=e;if("ref"in e){n={};for(var r in e)r!=="ref"&&(n[r]=e[r])}if(t=t.defaultProps){n===e&&(n=Me({},n));for(var a in t)n[a]===void 0&&(n[a]=t[a])}return n}var Pp=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function rT(t){Pp(t)}function aT(t){console.error(t)}function iT(t){Pp(t)}function Np(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(r){setTimeout(function(){throw r})}}function KS(t,e,n){try{var r=t.onCaughtError;r(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function ib(t,e,n){return n=vi(n),n.tag=3,n.payload={element:null},n.callback=function(){Np(t,e)},n}function sT(t){return t=vi(t),t.tag=3,t}function oT(t,e,n,r){var a=n.type.getDerivedStateFromError;if(typeof a=="function"){var i=r.value;t.payload=function(){return a(i)},t.callback=function(){KS(e,n,r)}}var s=n.stateNode;s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){KS(e,n,r),typeof a!="function"&&(xi===null?xi=new Set([this]):xi.add(this));var o=r.stack;this.componentDidCatch(r.value,{componentStack:o!==null?o:""})})}function Q2(t,e,n,r,a){if(n.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){if(e=n.alternate,e!==null&&mf(e,n,a,!0),n=Yn.current,n!==null){switch(n.tag){case 13:return Ur===null?pb():n.alternate===null&&Qe===0&&(Qe=3),n.flags&=-257,n.flags|=65536,n.lanes=a,r===Xy?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([r]):e.add(r),Ty(t,r,a)),!1;case 22:return n.flags|=65536,r===Xy?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([r]):n.add(r)),Ty(t,r,a)),!1}throw Error(O(435,n.tag))}return Ty(t,r,a),pb(),!1}if(Se)return e=Yn.current,e!==null?((e.flags&65536)===0&&(e.flags|=256),e.flags|=65536,e.lanes=a,r!==Gy&&(t=Error(O(422),{cause:r}),Xc(Zn(t,n)))):(r!==Gy&&(e=Error(O(423),{cause:r}),Xc(Zn(e,n))),t=t.current.alternate,t.flags|=65536,a&=-a,t.lanes|=a,r=Zn(r,n),a=ib(t.stateNode,r,a),dy(t,a),Qe!==4&&(Qe=2)),!1;var i=Error(O(520),{cause:r});if(i=Zn(i,n),Hc===null?Hc=[i]:Hc.push(i),Qe!==4&&(Qe=2),e===null)return!0;r=Zn(r,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=a&-a,n.lanes|=t,t=ib(n.stateNode,r,t),dy(n,t),!1;case 1:if(e=n.type,i=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||i!==null&&typeof i.componentDidCatch=="function"&&(xi===null||!xi.has(i))))return n.flags|=65536,a&=-a,n.lanes|=a,a=sT(a),oT(a,t,n,r),dy(n,a),!1}n=n.return}while(n!==null);return!1}var uT=Error(O(461)),wt=!1;function Et(t,e,n,r){e.child=t===null?tT(e,null,n,r):Du(e,t.child,n,r)}function YS(t,e,n,r,a){n=n.render;var i=e.ref;if("ref"in r){var s={};for(var o in r)o!=="ref"&&(s[o]=r[o])}else s=r;return Is(e),r=Zb(t,e,n,s,i,a),o=Kb(),t!==null&&!wt?(Yb(t,e,a),Aa(t,e,a)):(Se&&o&&zb(e),e.flags|=1,Et(t,e,r,a),e.child)}function JS(t,e,n,r,a){if(t===null){var i=n.type;return typeof i=="function"&&!Ub(i)&&i.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=i,lT(t,e,i,r,a)):(t=op(n.type,null,r,e,e.mode,a),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!a_(t,a)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:Jc,n(s,r)&&t.ref===e.ref)return Aa(t,e,a)}return e.flags|=1,t=wa(i,r),t.ref=e.ref,t.return=e,e.child=t}function lT(t,e,n,r,a){if(t!==null){var i=t.memoizedProps;if(Jc(i,r)&&t.ref===e.ref)if(wt=!1,e.pendingProps=r=i,a_(t,a))(t.flags&131072)!==0&&(wt=!0);else return e.lanes=t.lanes,Aa(t,e,a)}return sb(t,e,n,r,a)}function cT(t,e,n){var r=e.pendingProps,a=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden"){if((e.flags&128)!==0){if(r=i!==null?i.baseLanes|n:n,t!==null){for(a=e.child=t.child,i=0;a!==null;)i=i|a.lanes|a.childLanes,a=a.sibling;e.childLanes=i&~r}else e.childLanes=0,e.child=null;return XS(t,e,r,n)}if((n&536870912)!==0)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&up(e,i!==null?i.cachePool:null),i!==null?LS(e,i):eb(),nT(e);else return e.lanes=e.childLanes=536870912,XS(t,e,i!==null?i.baseLanes|n:n,n)}else i!==null?(up(e,i.cachePool),LS(e,i),hi(e),e.memoizedState=null):(t!==null&&up(e,null),eb(),hi(e));return Et(t,e,a,n),e.child}function XS(t,e,n,r){var a=qb();return a=a===null?null:{parent:ft._currentValue,pool:a},e.memoizedState={baseLanes:n,cachePool:a},t!==null&&up(e,null),eb(),nT(e),t!==null&&mf(t,e,r,!0),null}function fp(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(O(284));(t===null||t.ref!==n)&&(e.flags|=4194816)}}function sb(t,e,n,r,a){return Is(e),n=Zb(t,e,n,r,void 0,a),r=Kb(),t!==null&&!wt?(Yb(t,e,a),Aa(t,e,a)):(Se&&r&&zb(e),e.flags|=1,Et(t,e,n,a),e.child)}function QS(t,e,n,r,a,i){return Is(e),e.updateQueue=null,n=xA(e,r,n,a),SA(t),r=Kb(),t!==null&&!wt?(Yb(t,e,i),Aa(t,e,i)):(Se&&r&&zb(e),e.flags|=1,Et(t,e,n,i),e.child)}function WS(t,e,n,r,a){if(Is(e),e.stateNode===null){var i=gu,s=n.contextType;typeof s=="object"&&s!==null&&(i=Mt(s)),i=new n(r,i),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=ab,e.stateNode=i,i._reactInternals=e,i=e.stateNode,i.props=r,i.state=e.memoizedState,i.refs={},Hb(e),s=n.contextType,i.context=typeof s=="object"&&s!==null?Mt(s):gu,i.state=e.memoizedState,s=n.getDerivedStateFromProps,typeof s=="function"&&(hy(e,n,s,r),i.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(s=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),s!==i.state&&ab.enqueueReplaceState(i,i.state,null),zc(e,r,i,a),Uc(),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308),r=!0}else if(t===null){i=e.stateNode;var o=e.memoizedProps,u=Ns(n,o);i.props=u;var l=i.context,c=n.contextType;s=gu,typeof c=="object"&&c!==null&&(s=Mt(c));var f=n.getDerivedStateFromProps;c=typeof f=="function"||typeof i.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,c||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(o||l!==s)&&ZS(e,i,r,s),fi=!1;var d=e.memoizedState;i.state=d,zc(e,r,i,a),Uc(),l=e.memoizedState,o||d!==l||fi?(typeof f=="function"&&(hy(e,n,f,r),l=e.memoizedState),(u=fi||GS(e,n,u,r,d,l,s))?(c||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),i.props=r,i.state=l,i.context=s,r=u):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{i=e.stateNode,Qy(t,e),s=e.memoizedProps,c=Ns(n,s),i.props=c,f=e.pendingProps,d=i.context,l=n.contextType,u=gu,typeof l=="object"&&l!==null&&(u=Mt(l)),o=n.getDerivedStateFromProps,(l=typeof o=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(s!==f||d!==u)&&ZS(e,i,r,u),fi=!1,d=e.memoizedState,i.state=d,zc(e,r,i,a),Uc();var p=e.memoizedState;s!==f||d!==p||fi||t!==null&&t.dependencies!==null&&Tp(t.dependencies)?(typeof o=="function"&&(hy(e,n,o,r),p=e.memoizedState),(c=fi||GS(e,n,c,r,d,p,u)||t!==null&&t.dependencies!==null&&Tp(t.dependencies))?(l||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,p,u),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,p,u)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),i.props=r,i.state=p,i.context=u,r=c):(typeof i.componentDidUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return i=r,fp(t,e),r=(e.flags&128)!==0,i||r?(i=e.stateNode,n=r&&typeof n.getDerivedStateFromError!="function"?null:i.render(),e.flags|=1,t!==null&&r?(e.child=Du(e,t.child,null,a),e.child=Du(e,null,n,a)):Et(t,e,n,a),e.memoizedState=i.state,t=e.child):t=Aa(t,e,a),t}function ex(t,e,n,r){return hf(),e.flags|=256,Et(t,e,n,r),e.child}var my={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function gy(t){return{baseLanes:t,cachePool:yA()}}function yy(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=Kn),t}function fT(t,e,n){var r=e.pendingProps,a=!1,i=(e.flags&128)!==0,s;if((s=i)||(s=t!==null&&t.memoizedState===null?!1:(dt.current&2)!==0),s&&(a=!0,e.flags&=-129),s=(e.flags&32)!==0,e.flags&=-33,t===null){if(Se){if(a?pi(e):hi(e),Se){var o=Xe,u;if(u=o){e:{for(u=o,o=jr;u.nodeType!==8;){if(!o){o=null;break e}if(u=cr(u.nextSibling),u===null){o=null;break e}}o=u}o!==null?(e.memoizedState={dehydrated:o,treeContext:As!==null?{id:ga,overflow:ya}:null,retryLane:536870912,hydrationErrors:null},u=xn(18,null,null,0),u.stateNode=o,u.return=e,e.child=u,Gt=e,Xe=null,u=!0):u=!1}u||Cs(e)}if(o=e.memoizedState,o!==null&&(o=o.dehydrated,o!==null))return wb(o)?e.lanes=32:e.lanes=536870912,null;_a(e)}return o=r.children,r=r.fallback,a?(hi(e),a=e.mode,o=kp({mode:"hidden",children:o},a),r=xs(r,a,n,null),o.return=e,r.return=e,o.sibling=r,e.child=o,a=e.child,a.memoizedState=gy(n),a.childLanes=yy(t,s,n),e.memoizedState=my,r):(pi(e),ob(e,o))}if(u=t.memoizedState,u!==null&&(o=u.dehydrated,o!==null)){if(i)e.flags&256?(pi(e),e.flags&=-257,e=by(t,e,n)):e.memoizedState!==null?(hi(e),e.child=t.child,e.flags|=128,e=null):(hi(e),a=r.fallback,o=e.mode,r=kp({mode:"visible",children:r.children},o),a=xs(a,o,n,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,Du(e,t.child,null,n),r=e.child,r.memoizedState=gy(n),r.childLanes=yy(t,s,n),e.memoizedState=my,e=a);else if(pi(e),wb(o)){if(s=o.nextSibling&&o.nextSibling.dataset,s)var l=s.dgst;s=l,r=Error(O(419)),r.stack="",r.digest=s,Xc({value:r,source:null,stack:null}),e=by(t,e,n)}else if(wt||mf(t,e,n,!1),s=(n&t.childLanes)!==0,wt||s){if(s=De,s!==null&&(r=n&-n,r=(r&42)!==0?1:Rb(r),r=(r&(s.suspendedLanes|n))!==0?0:r,r!==0&&r!==u.retryLane))throw u.retryLane=r,Bu(t,r),On(s,t,r),uT;o.data==="$?"||pb(),e=by(t,e,n)}else o.data==="$?"?(e.flags|=192,e.child=t.child,e=null):(t=u.treeContext,Xe=cr(o.nextSibling),Gt=e,Se=!0,Ts=null,jr=!1,t!==null&&(Hn[Vn++]=ga,Hn[Vn++]=ya,Hn[Vn++]=As,ga=t.id,ya=t.overflow,As=e),e=ob(e,r.children),e.flags|=4096);return e}return a?(hi(e),a=r.fallback,o=e.mode,u=t.child,l=u.sibling,r=wa(u,{mode:"hidden",children:r.children}),r.subtreeFlags=u.subtreeFlags&65011712,l!==null?a=wa(l,a):(a=xs(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o===null?o=gy(n):(u=o.cachePool,u!==null?(l=ft._currentValue,u=u.parent!==l?{parent:l,pool:l}:u):u=yA(),o={baseLanes:o.baseLanes|n,cachePool:u}),a.memoizedState=o,a.childLanes=yy(t,s,n),e.memoizedState=my,r):(pi(e),n=t.child,t=n.sibling,n=wa(n,{mode:"visible",children:r.children}),n.return=e,n.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=n,e.memoizedState=null,n)}function ob(t,e){return e=kp({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function kp(t,e){return t=xn(22,t,null,e),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function by(t,e,n){return Du(e,t.child,null,n),t=ob(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function tx(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ky(t.return,e,n)}function _y(t,e,n,r,a){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function dT(t,e,n){var r=e.pendingProps,a=r.revealOrder,i=r.tail;if(Et(t,e,r.children,n),r=dt.current,(r&2)!==0)r=r&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&tx(t,n,e);else if(t.tag===19)tx(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}switch(qe(dt,r),a){case"forwards":for(n=e.child,a=null;n!==null;)t=n.alternate,t!==null&&Ip(t)===null&&(a=n),n=n.sibling;n=a,n===null?(a=e.child,e.child=null):(a=n.sibling,n.sibling=null),_y(e,!1,a,n,i);break;case"backwards":for(n=null,a=e.child,e.child=null;a!==null;){if(t=a.alternate,t!==null&&Ip(t)===null){e.child=a;break}t=a.sibling,a.sibling=n,n=a,a=t}_y(e,!0,n,null,i);break;case"together":_y(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Aa(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ii|=e.lanes,(n&e.childLanes)===0)if(t!==null){if(mf(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=wa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=wa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function a_(t,e){return(t.lanes&e)!==0?!0:(t=t.dependencies,!!(t!==null&&Tp(t)))}function W2(t,e,n){switch(e.tag){case 3:yp(e,e.stateNode.containerInfo),di(e,ft,t.memoizedState.cache),hf();break;case 27:case 5:My(e);break;case 4:yp(e,e.stateNode.containerInfo);break;case 10:di(e,e.type,e.memoizedProps.value);break;case 13:var r=e.memoizedState;if(r!==null)return r.dehydrated!==null?(pi(e),e.flags|=128,null):(n&e.child.childLanes)!==0?fT(t,e,n):(pi(e),t=Aa(t,e,n),t!==null?t.sibling:null);pi(e);break;case 19:var a=(t.flags&128)!==0;if(r=(n&e.childLanes)!==0,r||(mf(t,e,n,!1),r=(n&e.childLanes)!==0),a){if(r)return dT(t,e,n);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),qe(dt,dt.current),r)break;return null;case 22:case 23:return e.lanes=0,cT(t,e,n);case 24:di(e,ft,t.memoizedState.cache)}return Aa(t,e,n)}function pT(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)wt=!0;else{if(!a_(t,n)&&(e.flags&128)===0)return wt=!1,W2(t,e,n);wt=(t.flags&131072)!==0}else wt=!1,Se&&(e.flags&1048576)!==0&&mA(e,Ap,e.index);switch(e.lanes=0,e.tag){case 16:e:{t=e.pendingProps;var r=e.elementType,a=r._init;if(r=a(r._payload),e.type=r,typeof r=="function")Ub(r)?(t=Ns(r,t),e.tag=1,e=WS(null,e,r,t,n)):(e.tag=0,e=sb(null,e,r,t,n));else{if(r!=null){if(a=r.$$typeof,a===Tb){e.tag=11,e=YS(null,e,r,t,n);break e}else if(a===Eb){e.tag=14,e=JS(null,e,r,t,n);break e}}throw e=Dy(r)||r,Error(O(306,e,""))}}return e;case 0:return sb(t,e,e.type,e.pendingProps,n);case 1:return r=e.type,a=Ns(r,e.pendingProps),WS(t,e,r,a,n);case 3:e:{if(yp(e,e.stateNode.containerInfo),t===null)throw Error(O(387));r=e.pendingProps;var i=e.memoizedState;a=i.element,Qy(t,e),zc(e,r,null,n);var s=e.memoizedState;if(r=s.cache,di(e,ft,r),r!==i.cache&&Yy(e,[ft],n,!0),Uc(),r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){e=ex(t,e,r,n);break e}else if(r!==a){a=Zn(Error(O(424)),e),Xc(a),e=ex(t,e,r,n);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Xe=cr(t.firstChild),Gt=e,Se=!0,Ts=null,jr=!0,n=tT(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(hf(),r===a){e=Aa(t,e,n);break e}Et(t,e,r,n)}e=e.child}return e;case 26:return fp(t,e),t===null?(n=wx(e.type,null,e.pendingProps,null))?e.memoizedState=n:Se||(n=e.type,t=e.pendingProps,r=zp(wi.current).createElement(n),r[jt]=e,r[sn]=t,Rt(r,n,t),_t(r),e.stateNode=r):e.memoizedState=wx(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return My(e),t===null&&Se&&(r=e.stateNode=WT(e.type,e.pendingProps,wi.current),Gt=e,jr=!0,a=Xe,Ni(e.type)?(vb=a,Xe=cr(r.firstChild)):Xe=a),Et(t,e,e.pendingProps.children,n),fp(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&Se&&((a=r=Xe)&&(r=TD(r,e.type,e.pendingProps,jr),r!==null?(e.stateNode=r,Gt=e,Xe=cr(r.firstChild),jr=!1,a=!0):a=!1),a||Cs(e)),My(e),a=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,r=i.children,bb(a,i)?r=null:s!==null&&bb(a,s)&&(e.flags|=32),e.memoizedState!==null&&(a=Zb(t,e,V2,null,null,n),rf._currentValue=a),fp(t,e),Et(t,e,r,n),e.child;case 6:return t===null&&Se&&((t=n=Xe)&&(n=ED(n,e.pendingProps,jr),n!==null?(e.stateNode=n,Gt=e,Xe=null,t=!0):t=!1),t||Cs(e)),null;case 13:return fT(t,e,n);case 4:return yp(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Du(e,null,r,n):Et(t,e,r,n),e.child;case 11:return YS(t,e,e.type,e.pendingProps,n);case 7:return Et(t,e,e.pendingProps,n),e.child;case 8:return Et(t,e,e.pendingProps.children,n),e.child;case 12:return Et(t,e,e.pendingProps.children,n),e.child;case 10:return r=e.pendingProps,di(e,e.type,r.value),Et(t,e,r.children,n),e.child;case 9:return a=e.type._context,r=e.pendingProps.children,Is(e),a=Mt(a),r=r(a),e.flags|=1,Et(t,e,r,n),e.child;case 14:return JS(t,e,e.type,e.pendingProps,n);case 15:return lT(t,e,e.type,e.pendingProps,n);case 19:return dT(t,e,n);case 31:return r=e.pendingProps,n=e.mode,r={mode:r.mode,children:r.children},t===null?(n=kp(r,n),n.ref=e.ref,e.child=n,n.return=e,e=n):(n=wa(t.child,r),n.ref=e.ref,e.child=n,n.return=e,e=n),e;case 22:return cT(t,e,n);case 24:return Is(e),r=Mt(ft),t===null?(a=qb(),a===null&&(a=De,i=Fb(),a.pooledCache=i,i.refCount++,i!==null&&(a.pooledCacheLanes|=n),a=i),e.memoizedState={parent:r,cache:a},Hb(e),di(e,ft,a)):((t.lanes&n)!==0&&(Qy(t,e),zc(e,null,null,n),Uc()),a=t.memoizedState,i=e.memoizedState,a.parent!==r?(a={parent:r,cache:r},e.memoizedState=a,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=a),di(e,ft,r)):(r=i.cache,di(e,ft,r),r!==a.cache&&Yy(e,[ft],n,!0))),Et(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(O(156,e.tag))}function da(t){t.flags|=4}function nx(t,e){if(e.type!=="stylesheet"||(e.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!nE(e)){if(e=Yn.current,e!==null&&((be&4194048)===be?Ur!==null:(be&62914560)!==be&&(be&536870912)===0||e!==Ur))throw $c=Xy,bA;t.flags|=8192}}function Xd(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?Ux():536870912,t.lanes|=e,ju|=e)}function Tc(t,e){if(!Se)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ze(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var a=t.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&65011712,r|=a.flags&65011712,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function eD(t,e,n){var r=e.pendingProps;switch(Bb(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(e),null;case 1:return Ze(e),null;case 3:return n=e.stateNode,r=null,t!==null&&(r=t.memoizedState.cache),e.memoizedState.cache!==r&&(e.flags|=2048),va(ft),Ru(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(xc(e)?da(e):t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,NS())),Ze(e),null;case 26:return n=e.memoizedState,t===null?(da(e),n!==null?(Ze(e),nx(e,n)):(Ze(e),e.flags&=-16777217)):n?n!==t.memoizedState?(da(e),Ze(e),nx(e,n)):(Ze(e),e.flags&=-16777217):(t.memoizedProps!==r&&da(e),Ze(e),e.flags&=-16777217),null;case 27:bp(e),n=wi.current;var a=e.type;if(t!==null&&e.stateNode!=null)t.memoizedProps!==r&&da(e);else{if(!r){if(e.stateNode===null)throw Error(O(166));return Ze(e),null}t=$r.current,xc(e)?IS(e,t):(t=WT(a,r,n),e.stateNode=t,da(e))}return Ze(e),null;case 5:if(bp(e),n=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==r&&da(e);else{if(!r){if(e.stateNode===null)throw Error(O(166));return Ze(e),null}if(t=$r.current,xc(e))IS(e,t);else{switch(a=zp(wi.current),t){case 1:t=a.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:t=a.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":t=a.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":t=a.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof r.is=="string"?a.createElement("select",{is:r.is}):a.createElement("select"),r.multiple?t.multiple=!0:r.size&&(t.size=r.size);break;default:t=typeof r.is=="string"?a.createElement(n,{is:r.is}):a.createElement(n)}}t[jt]=e,t[sn]=r;e:for(a=e.child;a!==null;){if(a.tag===5||a.tag===6)t.appendChild(a.stateNode);else if(a.tag!==4&&a.tag!==27&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}e.stateNode=t;e:switch(Rt(t,n,r),n){case"button":case"input":case"select":case"textarea":t=!!r.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&da(e)}}return Ze(e),e.flags&=-16777217,null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==r&&da(e);else{if(typeof r!="string"&&e.stateNode===null)throw Error(O(166));if(t=wi.current,xc(e)){if(t=e.stateNode,n=e.memoizedProps,r=null,a=Gt,a!==null)switch(a.tag){case 27:case 5:r=a.memoizedProps}t[jt]=e,t=!!(t.nodeValue===n||r!==null&&r.suppressHydrationWarning===!0||JT(t.nodeValue,n)),t||Cs(e)}else t=zp(t).createTextNode(r),t[jt]=e,e.stateNode=t}return Ze(e),null;case 13:if(r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(a=xc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(O(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(O(317));a[jt]=e}else hf(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Ze(e),a=!1}else a=NS(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=a),a=!0;if(!a)return e.flags&256?(_a(e),e):(_a(e),null)}if(_a(e),(e.flags&128)!==0)return e.lanes=n,e;if(n=r!==null,t=t!==null&&t.memoizedState!==null,n){r=e.child,a=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(a=r.alternate.memoizedState.cachePool.pool);var i=null;r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(i=r.memoizedState.cachePool.pool),i!==a&&(r.flags|=2048)}return n!==t&&n&&(e.child.flags|=8192),Xd(e,e.updateQueue),Ze(e),null;case 4:return Ru(),t===null&&d_(e.stateNode.containerInfo),Ze(e),null;case 10:return va(e.type),Ze(e),null;case 19:if(vt(dt),a=e.memoizedState,a===null)return Ze(e),null;if(r=(e.flags&128)!==0,i=a.rendering,i===null)if(r)Tc(a,!1);else{if(Qe!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(i=Ip(t),i!==null){for(e.flags|=128,Tc(a,!1),t=i.updateQueue,e.updateQueue=t,Xd(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)hA(n,t),n=n.sibling;return qe(dt,dt.current&1|2),e.child}t=t.sibling}a.tail!==null&&Lr()>jp&&(e.flags|=128,r=!0,Tc(a,!1),e.lanes=4194304)}else{if(!r)if(t=Ip(i),t!==null){if(e.flags|=128,r=!0,t=t.updateQueue,e.updateQueue=t,Xd(e,t),Tc(a,!0),a.tail===null&&a.tailMode==="hidden"&&!i.alternate&&!Se)return Ze(e),null}else 2*Lr()-a.renderingStartTime>jp&&n!==536870912&&(e.flags|=128,r=!0,Tc(a,!1),e.lanes=4194304);a.isBackwards?(i.sibling=e.child,e.child=i):(t=a.last,t!==null?t.sibling=i:e.child=i,a.last=i)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Lr(),e.sibling=null,t=dt.current,qe(dt,r?t&1|2:t&1),e):(Ze(e),null);case 22:case 23:return _a(e),Vb(),r=e.memoizedState!==null,t!==null?t.memoizedState!==null!==r&&(e.flags|=8192):r&&(e.flags|=8192),r?(n&536870912)!==0&&(e.flags&128)===0&&(Ze(e),e.subtreeFlags&6&&(e.flags|=8192)):Ze(e),n=e.updateQueue,n!==null&&Xd(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),r=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),r!==n&&(e.flags|=2048),t!==null&&vt(Es),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),va(ft),Ze(e),null;case 25:return null;case 30:return null}throw Error(O(156,e.tag))}function tD(t,e){switch(Bb(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return va(ft),Ru(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return bp(e),null;case 13:if(_a(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));hf()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return vt(dt),null;case 4:return Ru(),null;case 10:return va(e.type),null;case 22:case 23:return _a(e),Vb(),t!==null&&vt(Es),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return va(ft),null;case 25:return null;default:return null}}function hT(t,e){switch(Bb(e),e.tag){case 3:va(ft),Ru();break;case 26:case 27:case 5:bp(e);break;case 4:Ru();break;case 13:_a(e);break;case 19:vt(dt);break;case 10:va(e.type);break;case 22:case 23:_a(e),Vb(),t!==null&&vt(Es);break;case 24:va(ft)}}function wf(t,e){try{var n=e.updateQueue,r=n!==null?n.lastEffect:null;if(r!==null){var a=r.next;n=a;do{if((n.tag&t)===t){r=void 0;var i=n.create,s=n.inst;r=i(),s.destroy=r}n=n.next}while(n!==a)}}catch(o){Ne(e,e.return,o)}}function Ci(t,e,n){try{var r=e.updateQueue,a=r!==null?r.lastEffect:null;if(a!==null){var i=a.next;r=i;do{if((r.tag&t)===t){var s=r.inst,o=s.destroy;if(o!==void 0){s.destroy=void 0,a=e;var u=n,l=o;try{l()}catch(c){Ne(a,u,c)}}}r=r.next}while(r!==i)}}catch(c){Ne(e,e.return,c)}}function mT(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{vA(e,n)}catch(r){Ne(t,t.return,r)}}}function gT(t,e,n){n.props=Ns(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(r){Ne(t,e,r)}}function Fc(t,e){try{var n=t.ref;if(n!==null){switch(t.tag){case 26:case 27:case 5:var r=t.stateNode;break;case 30:r=t.stateNode;break;default:r=t.stateNode}typeof n=="function"?t.refCleanup=n(r):n.current=r}}catch(a){Ne(t,e,a)}}function Mr(t,e){var n=t.ref,r=t.refCleanup;if(n!==null)if(typeof r=="function")try{r()}catch(a){Ne(t,e,a)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(a){Ne(t,e,a)}else n.current=null}function yT(t){var e=t.type,n=t.memoizedProps,r=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(a){Ne(t,t.return,a)}}function wy(t,e,n){try{var r=t.stateNode;wD(r,t.type,n,e),r[sn]=e}catch(a){Ne(t,t.return,a)}}function bT(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ni(t.type)||t.tag===4}function vy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ni(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ub(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(t,e):(e=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,e.appendChild(t),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ih));else if(r!==4&&(r===27&&Ni(t.type)&&(n=t.stateNode,e=null),t=t.child,t!==null))for(ub(t,e,n),t=t.sibling;t!==null;)ub(t,e,n),t=t.sibling}function Dp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(r===27&&Ni(t.type)&&(n=t.stateNode),t=t.child,t!==null))for(Dp(t,e,n),t=t.sibling;t!==null;)Dp(t,e,n),t=t.sibling}function _T(t){var e=t.stateNode,n=t.memoizedProps;try{for(var r=t.type,a=e.attributes;a.length;)e.removeAttributeNode(a[0]);Rt(e,r,n),e[jt]=t,e[sn]=n}catch(i){Ne(t,t.return,i)}}var ha=!1,nt=!1,Sy=!1,rx=typeof WeakSet=="function"?WeakSet:Set,bt=null;function nD(t,e){if(t=t.containerInfo,gb=Hp,t=sA(t),Mb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(b){n=null;break e}var s=0,o=-1,u=-1,l=0,c=0,f=t,d=null;t:for(;;){for(var p;f!==n||a!==0&&f.nodeType!==3||(o=s+a),f!==i||r!==0&&f.nodeType!==3||(u=s+r),f.nodeType===3&&(s+=f.nodeValue.length),(p=f.firstChild)!==null;)d=f,f=p;for(;;){if(f===t)break t;if(d===n&&++l===a&&(o=s),d===i&&++c===r&&(u=s),(p=f.nextSibling)!==null)break;f=d,d=f.parentNode}f=p}n=o===-1||u===-1?null:{start:o,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(yb={focusedElem:t,selectionRange:n},Hp=!1,bt=e;bt!==null;)if(e=bt,t=e.child,(e.subtreeFlags&1024)!==0&&t!==null)t.return=e,bt=t;else for(;bt!==null;){switch(e=bt,i=e.alternate,t=e.flags,e.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&i!==null){t=void 0,n=e,a=i.memoizedProps,i=i.memoizedState,r=n.stateNode;try{var g=Ns(n.type,a,n.elementType===n.type);t=r.getSnapshotBeforeUpdate(g,i),r.__reactInternalSnapshotBeforeUpdate=t}catch(b){Ne(n,n.return,b)}}break;case 3:if((t&1024)!==0){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)_b(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":_b(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(O(163))}if(t=e.sibling,t!==null){t.return=e.return,bt=t;break}bt=e.return}}function wT(t,e,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:ui(t,n),r&4&&wf(5,n);break;case 1:if(ui(t,n),r&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(s){Ne(n,n.return,s)}else{var a=Ns(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(a,e,t.__reactInternalSnapshotBeforeUpdate)}catch(s){Ne(n,n.return,s)}}r&64&&mT(n),r&512&&Fc(n,n.return);break;case 3:if(ui(t,n),r&64&&(t=n.updateQueue,t!==null)){if(e=null,n.child!==null)switch(n.child.tag){case 27:case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}try{vA(t,e)}catch(s){Ne(n,n.return,s)}}break;case 27:e===null&&r&4&&_T(n);case 26:case 5:ui(t,n),e===null&&r&4&&yT(n),r&512&&Fc(n,n.return);break;case 12:ui(t,n);break;case 13:ui(t,n),r&4&&xT(t,n),r&64&&(t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(n=fD.bind(null,n),OD(t,n))));break;case 22:if(r=n.memoizedState!==null||ha,!r){e=e!==null&&e.memoizedState!==null||nt,a=ha;var i=nt;ha=r,(nt=e)&&!i?li(t,n,(n.subtreeFlags&8772)!==0):ui(t,n),ha=a,nt=i}break;case 30:break;default:ui(t,n)}}function vT(t){var e=t.alternate;e!==null&&(t.alternate=null,vT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&Ib(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Fe=null,rn=!1;function pa(t,e,n){for(n=n.child;n!==null;)ST(t,e,n),n=n.sibling}function ST(t,e,n){if(An&&typeof An.onCommitFiberUnmount=="function")try{An.onCommitFiberUnmount(lf,n)}catch(i){}switch(n.tag){case 26:nt||Mr(n,e),pa(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:nt||Mr(n,e);var r=Fe,a=rn;Ni(n.type)&&(Fe=n.stateNode,rn=!1),pa(t,e,n),Gc(n.stateNode),Fe=r,rn=a;break;case 5:nt||Mr(n,e);case 6:if(r=Fe,a=rn,Fe=null,pa(t,e,n),Fe=r,rn=a,Fe!==null)if(rn)try{(Fe.nodeType===9?Fe.body:Fe.nodeName==="HTML"?Fe.ownerDocument.body:Fe).removeChild(n.stateNode)}catch(i){Ne(n,e,i)}else try{Fe.removeChild(n.stateNode)}catch(i){Ne(n,e,i)}break;case 18:Fe!==null&&(rn?(t=Fe,yx(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,n.stateNode),of(t)):yx(Fe,n.stateNode));break;case 4:r=Fe,a=rn,Fe=n.stateNode.containerInfo,rn=!0,pa(t,e,n),Fe=r,rn=a;break;case 0:case 11:case 14:case 15:nt||Ci(2,n,e),nt||Ci(4,n,e),pa(t,e,n);break;case 1:nt||(Mr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"&&gT(n,e,r)),pa(t,e,n);break;case 21:pa(t,e,n);break;case 22:nt=(r=nt)||n.memoizedState!==null,pa(t,e,n),nt=r;break;default:pa(t,e,n)}}function xT(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{of(t)}catch(n){Ne(e,e.return,n)}}function rD(t){switch(t.tag){case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new rx),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new rx),e;default:throw Error(O(435,t.tag))}}function xy(t,e){var n=rD(t);e.forEach(function(r){var a=dD.bind(null,t,r);n.has(r)||(n.add(r),r.then(a,a))})}function wn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r],i=t,s=e,o=s;e:for(;o!==null;){switch(o.tag){case 27:if(Ni(o.type)){Fe=o.stateNode,rn=!1;break e}break;case 5:Fe=o.stateNode,rn=!1;break e;case 3:case 4:Fe=o.stateNode.containerInfo,rn=!0;break e}o=o.return}if(Fe===null)throw Error(O(160));ST(i,s,a),Fe=null,rn=!1,i=a.alternate,i!==null&&(i.return=null),a.return=null}if(e.subtreeFlags&13878)for(e=e.child;e!==null;)AT(e,t),e=e.sibling}var lr=null;function AT(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:wn(e,t),vn(t),r&4&&(Ci(3,t,t.return),wf(3,t),Ci(5,t,t.return));break;case 1:wn(e,t),vn(t),r&512&&(nt||n===null||Mr(n,n.return)),r&64&&ha&&(t=t.updateQueue,t!==null&&(r=t.callbacks,r!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?r:n.concat(r))));break;case 26:var a=lr;if(wn(e,t),vn(t),r&512&&(nt||n===null||Mr(n,n.return)),r&4){var i=n!==null?n.memoizedState:null;if(r=t.memoizedState,n===null)if(r===null)if(t.stateNode===null){e:{r=t.type,n=t.memoizedProps,a=a.ownerDocument||a;t:switch(r){case"title":i=a.getElementsByTagName("title")[0],(!i||i[df]||i[jt]||i.namespaceURI==="http://www.w3.org/2000/svg"||i.hasAttribute("itemprop"))&&(i=a.createElement(r),a.head.insertBefore(i,a.querySelector("head > title"))),Rt(i,r,n),i[jt]=t,_t(i),r=i;break e;case"link":var s=Sx("link","href",a).get(r+(n.href||""));if(s){for(var o=0;o<s.length;o++)if(i=s[o],i.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&i.getAttribute("rel")===(n.rel==null?null:n.rel)&&i.getAttribute("title")===(n.title==null?null:n.title)&&i.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){s.splice(o,1);break t}}i=a.createElement(r),Rt(i,r,n),a.head.appendChild(i);break;case"meta":if(s=Sx("meta","content",a).get(r+(n.content||""))){for(o=0;o<s.length;o++)if(i=s[o],i.getAttribute("content")===(n.content==null?null:""+n.content)&&i.getAttribute("name")===(n.name==null?null:n.name)&&i.getAttribute("property")===(n.property==null?null:n.property)&&i.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&i.getAttribute("charset")===(n.charSet==null?null:n.charSet)){s.splice(o,1);break t}}i=a.createElement(r),Rt(i,r,n),a.head.appendChild(i);break;default:throw Error(O(468,r))}i[jt]=t,_t(i),r=i}t.stateNode=r}else xx(a,t.type,t.stateNode);else t.stateNode=vx(a,r,t.memoizedProps);else i!==r?(i===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):i.count--,r===null?xx(a,t.type,t.stateNode):vx(a,r,t.memoizedProps)):r===null&&t.stateNode!==null&&wy(t,t.memoizedProps,n.memoizedProps)}break;case 27:wn(e,t),vn(t),r&512&&(nt||n===null||Mr(n,n.return)),n!==null&&r&4&&wy(t,t.memoizedProps,n.memoizedProps);break;case 5:if(wn(e,t),vn(t),r&512&&(nt||n===null||Mr(n,n.return)),t.flags&32){a=t.stateNode;try{Iu(a,"")}catch(p){Ne(t,t.return,p)}}r&4&&t.stateNode!=null&&(a=t.memoizedProps,wy(t,a,n!==null?n.memoizedProps:a)),r&1024&&(Sy=!0);break;case 6:if(wn(e,t),vn(t),r&4){if(t.stateNode===null)throw Error(O(162));r=t.memoizedProps,n=t.stateNode;try{n.nodeValue=r}catch(p){Ne(t,t.return,p)}}break;case 3:if(hp=null,a=lr,lr=Bp(e.containerInfo),wn(e,t),lr=a,vn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{of(e.containerInfo)}catch(p){Ne(t,t.return,p)}Sy&&(Sy=!1,TT(t));break;case 4:r=lr,lr=Bp(t.stateNode.containerInfo),wn(e,t),vn(t),lr=r;break;case 12:wn(e,t),vn(t);break;case 13:wn(e,t),vn(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(l_=Lr()),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,xy(t,r)));break;case 22:a=t.memoizedState!==null;var u=n!==null&&n.memoizedState!==null,l=ha,c=nt;if(ha=l||a,nt=c||u,wn(e,t),nt=c,ha=l,vn(t),r&8192)e:for(e=t.stateNode,e._visibility=a?e._visibility&-2:e._visibility|1,a&&(n===null||u||ha||nt||vs(t)),n=null,e=t;;){if(e.tag===5||e.tag===26){if(n===null){u=n=e;try{if(i=u.stateNode,a)s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none";else{o=u.stateNode;var f=u.memoizedProps.style,d=f!=null&&f.hasOwnProperty("display")?f.display:null;o.style.display=d==null||typeof d=="boolean"?"":(""+d).trim()}}catch(p){Ne(u,u.return,p)}}}else if(e.tag===6){if(n===null){u=e;try{u.stateNode.nodeValue=a?"":u.memoizedProps}catch(p){Ne(u,u.return,p)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}r&4&&(r=t.updateQueue,r!==null&&(n=r.retryQueue,n!==null&&(r.retryQueue=null,xy(t,n))));break;case 19:wn(e,t),vn(t),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,xy(t,r)));break;case 30:break;case 21:break;default:wn(e,t),vn(t)}}function vn(t){var e=t.flags;if(e&2){try{for(var n,r=t.return;r!==null;){if(bT(r)){n=r;break}r=r.return}if(n==null)throw Error(O(160));switch(n.tag){case 27:var a=n.stateNode,i=vy(t);Dp(t,i,a);break;case 5:var s=n.stateNode;n.flags&32&&(Iu(s,""),n.flags&=-33);var o=vy(t);Dp(t,o,s);break;case 3:case 4:var u=n.stateNode.containerInfo,l=vy(t);ub(t,l,u);break;default:throw Error(O(161))}}catch(c){Ne(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function TT(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;TT(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function ui(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)wT(t,e.alternate,e),e=e.sibling}function vs(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:Ci(4,e,e.return),vs(e);break;case 1:Mr(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&gT(e,e.return,n),vs(e);break;case 27:Gc(e.stateNode);case 26:case 5:Mr(e,e.return),vs(e);break;case 22:e.memoizedState===null&&vs(e);break;case 30:vs(e);break;default:vs(e)}t=t.sibling}}function li(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var r=e.alternate,a=t,i=e,s=i.flags;switch(i.tag){case 0:case 11:case 15:li(a,i,n),wf(4,i);break;case 1:if(li(a,i,n),r=i,a=r.stateNode,typeof a.componentDidMount=="function")try{a.componentDidMount()}catch(l){Ne(r,r.return,l)}if(r=i,a=r.updateQueue,a!==null){var o=r.stateNode;try{var u=a.shared.hiddenCallbacks;if(u!==null)for(a.shared.hiddenCallbacks=null,a=0;a<u.length;a++)wA(u[a],o)}catch(l){Ne(r,r.return,l)}}n&&s&64&&mT(i),Fc(i,i.return);break;case 27:_T(i);case 26:case 5:li(a,i,n),n&&r===null&&s&4&&yT(i),Fc(i,i.return);break;case 12:li(a,i,n);break;case 13:li(a,i,n),n&&s&4&&xT(a,i);break;case 22:i.memoizedState===null&&li(a,i,n),Fc(i,i.return);break;case 30:break;default:li(a,i,n)}e=e.sibling}}function i_(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&gf(n))}function s_(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&gf(t))}function Dr(t,e,n,r){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)ET(t,e,n,r),e=e.sibling}function ET(t,e,n,r){var a=e.flags;switch(e.tag){case 0:case 11:case 15:Dr(t,e,n,r),a&2048&&wf(9,e);break;case 1:Dr(t,e,n,r);break;case 3:Dr(t,e,n,r),a&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&gf(t)));break;case 12:if(a&2048){Dr(t,e,n,r),t=e.stateNode;try{var i=e.memoizedProps,s=i.id,o=i.onPostCommit;typeof o=="function"&&o(s,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(u){Ne(e,e.return,u)}}else Dr(t,e,n,r);break;case 13:Dr(t,e,n,r);break;case 23:break;case 22:i=e.stateNode,s=e.alternate,e.memoizedState!==null?i._visibility&2?Dr(t,e,n,r):qc(t,e):i._visibility&2?Dr(t,e,n,r):(i._visibility|=2,su(t,e,n,r,(e.subtreeFlags&10256)!==0)),a&2048&&i_(s,e);break;case 24:Dr(t,e,n,r),a&2048&&s_(e.alternate,e);break;default:Dr(t,e,n,r)}}function su(t,e,n,r,a){for(a=a&&(e.subtreeFlags&10256)!==0,e=e.child;e!==null;){var i=t,s=e,o=n,u=r,l=s.flags;switch(s.tag){case 0:case 11:case 15:su(i,s,o,u,a),wf(8,s);break;case 23:break;case 22:var c=s.stateNode;s.memoizedState!==null?c._visibility&2?su(i,s,o,u,a):qc(i,s):(c._visibility|=2,su(i,s,o,u,a)),a&&l&2048&&i_(s.alternate,s);break;case 24:su(i,s,o,u,a),a&&l&2048&&s_(s.alternate,s);break;default:su(i,s,o,u,a)}e=e.sibling}}function qc(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,r=e,a=r.flags;switch(r.tag){case 22:qc(n,r),a&2048&&i_(r.alternate,r);break;case 24:qc(n,r),a&2048&&s_(r.alternate,r);break;default:qc(n,r)}e=e.sibling}}var Nc=8192;function ru(t){if(t.subtreeFlags&Nc)for(t=t.child;t!==null;)OT(t),t=t.sibling}function OT(t){switch(t.tag){case 26:ru(t),t.flags&Nc&&t.memoizedState!==null&&zD(lr,t.memoizedState,t.memoizedProps);break;case 5:ru(t);break;case 3:case 4:var e=lr;lr=Bp(t.stateNode.containerInfo),ru(t),lr=e;break;case 22:t.memoizedState===null&&(e=t.alternate,e!==null&&e.memoizedState!==null?(e=Nc,Nc=16777216,ru(t),Nc=e):ru(t));break;default:ru(t)}}function RT(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function Ec(t){var e=t.deletions;if((t.flags&16)!==0){if(e!==null)for(var n=0;n<e.length;n++){var r=e[n];bt=r,IT(r,t)}RT(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)CT(t),t=t.sibling}function CT(t){switch(t.tag){case 0:case 11:case 15:Ec(t),t.flags&2048&&Ci(9,t,t.return);break;case 3:Ec(t);break;case 12:Ec(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,dp(t)):Ec(t);break;default:Ec(t)}}function dp(t){var e=t.deletions;if((t.flags&16)!==0){if(e!==null)for(var n=0;n<e.length;n++){var r=e[n];bt=r,IT(r,t)}RT(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:Ci(8,e,e.return),dp(e);break;case 22:n=e.stateNode,n._visibility&2&&(n._visibility&=-3,dp(e));break;default:dp(e)}t=t.sibling}}function IT(t,e){for(;bt!==null;){var n=bt;switch(n.tag){case 0:case 11:case 15:Ci(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var r=n.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:gf(n.memoizedState.cache)}if(r=n.child,r!==null)r.return=n,bt=r;else e:for(n=t;bt!==null;){r=bt;var a=r.sibling,i=r.return;if(vT(r),r===n){bt=null;break e}if(a!==null){a.return=i,bt=a;break e}bt=i}}}var aD={getCacheForType:function(t){var e=Mt(ft),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n}},iD=typeof WeakMap=="function"?WeakMap:Map,Ee=0,De=null,he=null,be=0,Te=0,Sn=null,bi=!1,Fu=!1,o_=!1,Ta=0,Qe=0,Ii=0,Os=0,u_=0,Kn=0,ju=0,Hc=null,an=null,lb=!1,l_=0,jp=1/0,Mp=null,xi=null,Ot=0,Ai=null,Mu=null,Ou=0,cb=0,fb=null,PT=null,Vc=0,db=null;function En(){if((Ee&2)!==0&&be!==0)return be&-be;if(J.T!==null){var t=Pu;return t!==0?t:f_()}return Fx()}function NT(){Kn===0&&(Kn=(be&536870912)===0||Se?Lx():536870912);var t=Yn.current;return t!==null&&(t.flags|=32),Kn}function On(t,e,n){(t===De&&(Te===2||Te===9)||t.cancelPendingCommit!==null)&&($u(t,0),_i(t,be,Kn,!1)),ff(t,n),((Ee&2)===0||t!==De)&&(t===De&&((Ee&2)===0&&(Os|=n),Qe===4&&_i(t,be,Kn,!1)),Br(t))}function kT(t,e,n){if((Ee&6)!==0)throw Error(O(327));var r=!n&&(e&124)===0&&(e&t.expiredLanes)===0||cf(t,e),a=r?uD(t,e):Ay(t,e,!0),i=r;do{if(a===0){Fu&&!r&&_i(t,e,0,!1);break}else{if(n=t.current.alternate,i&&!sD(n)){a=Ay(t,e,!1),i=!1;continue}if(a===2){if(i=e,t.errorRecoveryDisabledLanes&i)var s=0;else s=t.pendingLanes&-536870913,s=s!==0?s:s&536870912?536870912:0;if(s!==0){e=s;e:{var o=t;a=Hc;var u=o.current.memoizedState.isDehydrated;if(u&&($u(o,s).flags|=256),s=Ay(o,s,!1),s!==2){if(o_&&!u){o.errorRecoveryDisabledLanes|=i,Os|=i,a=4;break e}i=an,an=a,i!==null&&(an===null?an=i:an.push.apply(an,i))}a=s}if(i=!1,a!==2)continue}}if(a===1){$u(t,0),_i(t,e,0,!0);break}e:{switch(r=t,i=a,i){case 0:case 1:throw Error(O(345));case 4:if((e&4194048)!==e)break;case 6:_i(r,e,Kn,!bi);break e;case 2:an=null;break;case 3:case 5:break;default:throw Error(O(329))}if((e&62914560)===e&&(a=l_+300-Lr(),10<a)){if(_i(r,e,Kn,!bi),Gp(r,0,!0)!==0)break e;r.timeoutHandle=QT(ax.bind(null,r,n,an,Mp,lb,e,Kn,Os,ju,bi,i,2,-0,0),a);break e}ax(r,n,an,Mp,lb,e,Kn,Os,ju,bi,i,0,-0,0)}}break}while(!0);Br(t)}function ax(t,e,n,r,a,i,s,o,u,l,c,f,d,p){if(t.timeoutHandle=-1,f=e.subtreeFlags,(f&8192||(f&16785408)===16785408)&&(nf={stylesheets:null,count:0,unsuspend:UD},OT(e),f=BD(),f!==null)){t.cancelPendingCommit=f(sx.bind(null,t,e,i,n,r,a,s,o,u,c,1,d,p)),_i(t,i,s,!l);return}sx(t,e,i,n,r,a,s,o,u)}function sD(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!Rn(i(),a))return!1}catch(s){return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _i(t,e,n,r){e&=~u_,e&=~Os,t.suspendedLanes|=e,t.pingedLanes&=~e,r&&(t.warmLanes|=e),r=t.expirationTimes;for(var a=e;0<a;){var i=31-Tn(a),s=1<<i;r[i]=-1,a&=~s}n!==0&&zx(t,n,e)}function nh(){return(Ee&6)===0?(vf(0,!1),!1):!0}function c_(){if(he!==null){if(Te===0)var t=he.return;else t=he,ba=Ms=null,Jb(t),Eu=null,Wc=0,t=he;for(;t!==null;)hT(t.alternate,t),t=t.return;he=null}}function $u(t,e){var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,SD(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),c_(),De=t,he=n=wa(t.current,null),be=e,Te=0,Sn=null,bi=!1,Fu=cf(t,e),o_=!1,ju=Kn=u_=Os=Ii=Qe=0,an=Hc=null,lb=!1,(e&8)!==0&&(e|=e&32);var r=t.entangledLanes;if(r!==0)for(t=t.entanglements,r&=e;0<r;){var a=31-Tn(r),i=1<<a;e|=t[a],r&=~i}return Ta=e,Jp(),n}function DT(t,e){de=null,J.H=Cp,e===yf||e===Qp?(e=MS(),Te=3):e===bA?(e=MS(),Te=4):Te=e===uT?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,Sn=e,he===null&&(Qe=1,Np(t,Zn(e,t.current)))}function jT(){var t=J.H;return J.H=Cp,t===null?Cp:t}function MT(){var t=J.A;return J.A=aD,t}function pb(){Qe=4,bi||(be&4194048)!==be&&Yn.current!==null||(Fu=!0),(Ii&134217727)===0&&(Os&134217727)===0||De===null||_i(De,be,Kn,!1)}function Ay(t,e,n){var r=Ee;Ee|=2;var a=jT(),i=MT();(De!==t||be!==e)&&(Mp=null,$u(t,e)),e=!1;var s=Qe;e:do try{if(Te!==0&&he!==null){var o=he,u=Sn;switch(Te){case 8:c_(),s=6;break e;case 3:case 2:case 9:case 6:Yn.current===null&&(e=!0);var l=Te;if(Te=0,Sn=null,_u(t,o,u,l),n&&Fu){s=0;break e}break;default:l=Te,Te=0,Sn=null,_u(t,o,u,l)}}oD(),s=Qe;break}catch(c){DT(t,c)}while(!0);return e&&t.shellSuspendCounter++,ba=Ms=null,Ee=r,J.H=a,J.A=i,he===null&&(De=null,be=0,Jp()),s}function oD(){for(;he!==null;)$T(he)}function uD(t,e){var n=Ee;Ee|=2;var r=jT(),a=MT();De!==t||be!==e?(Mp=null,jp=Lr()+500,$u(t,e)):Fu=cf(t,e);e:do try{if(Te!==0&&he!==null){e=he;var i=Sn;t:switch(Te){case 1:Te=0,Sn=null,_u(t,e,i,1);break;case 2:case 9:if(jS(i)){Te=0,Sn=null,ix(e);break}e=function(){Te!==2&&Te!==9||De!==t||(Te=7),Br(t)},i.then(e,e);break e;case 3:Te=7;break e;case 4:Te=5;break e;case 7:jS(i)?(Te=0,Sn=null,ix(e)):(Te=0,Sn=null,_u(t,e,i,7));break;case 5:var s=null;switch(he.tag){case 26:s=he.memoizedState;case 5:case 27:var o=he;if(!s||nE(s)){Te=0,Sn=null;var u=o.sibling;if(u!==null)he=u;else{var l=o.return;l!==null?(he=l,rh(l)):he=null}break t}}Te=0,Sn=null,_u(t,e,i,5);break;case 6:Te=0,Sn=null,_u(t,e,i,6);break;case 8:c_(),Qe=6;break e;default:throw Error(O(462))}}lD();break}catch(c){DT(t,c)}while(!0);return ba=Ms=null,J.H=r,J.A=a,Ee=n,he!==null?0:(De=null,be=0,Jp(),Qe)}function lD(){for(;he!==null&&!Pk();)$T(he)}function $T(t){var e=pT(t.alternate,t,Ta);t.memoizedProps=t.pendingProps,e===null?rh(t):he=e}function ix(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=QS(n,e,e.pendingProps,e.type,void 0,be);break;case 11:e=QS(n,e,e.pendingProps,e.type.render,e.ref,be);break;case 5:Jb(e);default:hT(n,e),e=he=hA(e,Ta),e=pT(n,e,Ta)}t.memoizedProps=t.pendingProps,e===null?rh(t):he=e}function _u(t,e,n,r){ba=Ms=null,Jb(e),Eu=null,Wc=0;var a=e.return;try{if(Q2(t,a,e,n,be)){Qe=1,Np(t,Zn(n,t.current)),he=null;return}}catch(i){if(a!==null)throw he=a,i;Qe=1,Np(t,Zn(n,t.current)),he=null;return}e.flags&32768?(Se||r===1?t=!0:Fu||(be&536870912)!==0?t=!1:(bi=t=!0,(r===2||r===9||r===3||r===6)&&(r=Yn.current,r!==null&&r.tag===13&&(r.flags|=16384))),LT(e,t)):rh(e)}function rh(t){var e=t;do{if((e.flags&32768)!==0){LT(e,bi);return}t=e.return;var n=eD(e.alternate,e,Ta);if(n!==null){he=n;return}if(e=e.sibling,e!==null){he=e;return}he=e=t}while(e!==null);Qe===0&&(Qe=5)}function LT(t,e){do{var n=tD(t.alternate,t);if(n!==null){n.flags&=32767,he=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){he=t;return}he=t=n}while(t!==null);Qe=6,he=null}function sx(t,e,n,r,a,i,s,o,u){t.cancelPendingCommit=null;do ah();while(Ot!==0);if((Ee&6)!==0)throw Error(O(327));if(e!==null){if(e===t.current)throw Error(O(177));if(i=e.lanes|e.childLanes,i|=$b,Bk(t,n,i,s,o,u),t===De&&(he=De=null,be=0),Mu=e,Ai=t,Ou=n,cb=i,fb=a,PT=r,(e.subtreeFlags&10256)!==0||(e.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,pD(_p,function(){return qT(!0),null})):(t.callbackNode=null,t.callbackPriority=0),r=(e.flags&13878)!==0,(e.subtreeFlags&13878)!==0||r){r=J.T,J.T=null,a=xe.p,xe.p=2,s=Ee,Ee|=4;try{nD(t,e,n)}finally{Ee=s,xe.p=a,J.T=r}}Ot=1,UT(),zT(),BT()}}function UT(){if(Ot===1){Ot=0;var t=Ai,e=Mu,n=(e.flags&13878)!==0;if((e.subtreeFlags&13878)!==0||n){n=J.T,J.T=null;var r=xe.p;xe.p=2;var a=Ee;Ee|=4;try{AT(e,t);var i=yb,s=sA(t.containerInfo),o=i.focusedElem,u=i.selectionRange;if(s!==o&&o&&o.ownerDocument&&iA(o.ownerDocument.documentElement,o)){if(u!==null&&Mb(o)){var l=u.start,c=u.end;if(c===void 0&&(c=l),"selectionStart"in o)o.selectionStart=l,o.selectionEnd=Math.min(c,o.value.length);else{var f=o.ownerDocument||document,d=f&&f.defaultView||window;if(d.getSelection){var p=d.getSelection(),g=o.textContent.length,b=Math.min(u.start,g),_=u.end===void 0?b:Math.min(u.end,g);!p.extend&&b>_&&(s=_,_=b,b=s);var m=OS(o,b),h=OS(o,_);if(m&&h&&(p.rangeCount!==1||p.anchorNode!==m.node||p.anchorOffset!==m.offset||p.focusNode!==h.node||p.focusOffset!==h.offset)){var y=f.createRange();y.setStart(m.node,m.offset),p.removeAllRanges(),b>_?(p.addRange(y),p.extend(h.node,h.offset)):(y.setEnd(h.node,h.offset),p.addRange(y))}}}}for(f=[],p=o;p=p.parentNode;)p.nodeType===1&&f.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<f.length;o++){var v=f[o];v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}Hp=!!gb,yb=gb=null}finally{Ee=a,xe.p=r,J.T=n}}t.current=e,Ot=2}}function zT(){if(Ot===2){Ot=0;var t=Ai,e=Mu,n=(e.flags&8772)!==0;if((e.subtreeFlags&8772)!==0||n){n=J.T,J.T=null;var r=xe.p;xe.p=2;var a=Ee;Ee|=4;try{wT(t,e.alternate,e)}finally{Ee=a,xe.p=r,J.T=n}}Ot=3}}function BT(){if(Ot===4||Ot===3){Ot=0,Nk();var t=Ai,e=Mu,n=Ou,r=PT;(e.subtreeFlags&10256)!==0||(e.flags&10256)!==0?Ot=5:(Ot=0,Mu=Ai=null,FT(t,t.pendingLanes));var a=t.pendingLanes;if(a===0&&(xi=null),Cb(n),e=e.stateNode,An&&typeof An.onCommitFiberRoot=="function")try{An.onCommitFiberRoot(lf,e,void 0,(e.current.flags&128)===128)}catch(u){}if(r!==null){e=J.T,a=xe.p,xe.p=2,J.T=null;try{for(var i=t.onRecoverableError,s=0;s<r.length;s++){var o=r[s];i(o.value,{componentStack:o.stack})}}finally{J.T=e,xe.p=a}}(Ou&3)!==0&&ah(),Br(t),a=t.pendingLanes,(n&4194090)!==0&&(a&42)!==0?t===db?Vc++:(Vc=0,db=t):Vc=0,vf(0,!1)}}function FT(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,gf(e)))}function ah(t){return UT(),zT(),BT(),qT(t)}function qT(){if(Ot!==5)return!1;var t=Ai,e=cb;cb=0;var n=Cb(Ou),r=J.T,a=xe.p;try{xe.p=32>n?32:n,J.T=null,n=fb,fb=null;var i=Ai,s=Ou;if(Ot=0,Mu=Ai=null,Ou=0,(Ee&6)!==0)throw Error(O(331));var o=Ee;if(Ee|=4,CT(i.current),ET(i,i.current,s,n),Ee=o,vf(0,!1),An&&typeof An.onPostCommitFiberRoot=="function")try{An.onPostCommitFiberRoot(lf,i)}catch(u){}return!0}finally{xe.p=a,J.T=r,FT(t,e)}}function ox(t,e,n){e=Zn(n,e),e=ib(t.stateNode,e,2),t=Si(t,e,2),t!==null&&(ff(t,2),Br(t))}function Ne(t,e,n){if(t.tag===3)ox(t,t,n);else for(;e!==null;){if(e.tag===3){ox(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xi===null||!xi.has(r))){t=Zn(n,t),n=sT(2),r=Si(e,n,2),r!==null&&(oT(n,r,e,t),ff(r,2),Br(r));break}}e=e.return}}function Ty(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new iD;var a=new Set;r.set(e,a)}else a=r.get(e),a===void 0&&(a=new Set,r.set(e,a));a.has(n)||(o_=!0,a.add(n),t=cD.bind(null,t,e,n),e.then(t,t))}function cD(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,De===t&&(be&n)===n&&(Qe===4||Qe===3&&(be&62914560)===be&&300>Lr()-l_?(Ee&2)===0&&$u(t,0):u_|=n,ju===be&&(ju=0)),Br(t)}function HT(t,e){e===0&&(e=Ux()),t=Bu(t,e),t!==null&&(ff(t,e),Br(t))}function fD(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),HT(t,n)}function dD(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,a=t.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=t.stateNode;break;case 22:r=t.stateNode._retryCache;break;default:throw Error(O(314))}r!==null&&r.delete(e),HT(t,n)}function pD(t,e){return Ob(t,e)}var $p=null,ou=null,hb=!1,Lp=!1,Ey=!1,Rs=0;function Br(t){t!==ou&&t.next===null&&(ou===null?$p=ou=t:ou=ou.next=t),Lp=!0,hb||(hb=!0,mD())}function vf(t,e){if(!Ey&&Lp){Ey=!0;do for(var n=!1,r=$p;r!==null;){if(!e)if(t!==0){var a=r.pendingLanes;if(a===0)var i=0;else{var s=r.suspendedLanes,o=r.pingedLanes;i=(1<<31-Tn(42|t)+1)-1,i&=a&~(s&~o),i=i&201326741?i&201326741|1:i?i|2:0}i!==0&&(n=!0,ux(r,i))}else i=be,i=Gp(r,r===De?i:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),(i&3)===0||cf(r,i)||(n=!0,ux(r,i));r=r.next}while(n);Ey=!1}}function hD(){VT()}function VT(){Lp=hb=!1;var t=0;Rs!==0&&(vD()&&(t=Rs),Rs=0);for(var e=Lr(),n=null,r=$p;r!==null;){var a=r.next,i=GT(r,e);i===0?(r.next=null,n===null?$p=a:n.next=a,a===null&&(ou=n)):(n=r,(t!==0||(i&3)!==0)&&(Lp=!0)),r=a}vf(t,!1)}function GT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,a=t.expirationTimes,i=t.pendingLanes&-62914561;0<i;){var s=31-Tn(i),o=1<<s,u=a[s];u===-1?((o&n)===0||(o&r)!==0)&&(a[s]=zk(o,e)):u<=e&&(t.expiredLanes|=o),i&=~o}if(e=De,n=be,n=Gp(t,t===e?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),r=t.callbackNode,n===0||t===e&&(Te===2||Te===9)||t.cancelPendingCommit!==null)return r!==null&&r!==null&&Wg(r),t.callbackNode=null,t.callbackPriority=0;if((n&3)===0||cf(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(r!==null&&Wg(r),Cb(n)){case 2:case 8:n=Mx;break;case 32:n=_p;break;case 268435456:n=$x;break;default:n=_p}return r=ZT.bind(null,t),n=Ob(n,r),t.callbackPriority=e,t.callbackNode=n,e}return r!==null&&r!==null&&Wg(r),t.callbackPriority=2,t.callbackNode=null,2}function ZT(t,e){if(Ot!==0&&Ot!==5)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(ah(!0)&&t.callbackNode!==n)return null;var r=be;return r=Gp(t,t===De?r:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),r===0?null:(kT(t,r,e),GT(t,Lr()),t.callbackNode!=null&&t.callbackNode===n?ZT.bind(null,t):null)}function ux(t,e){if(ah())return null;kT(t,e,!0)}function mD(){xD(function(){(Ee&6)!==0?Ob(jx,hD):VT()})}function f_(){return Rs===0&&(Rs=Lx()),Rs}function lx(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:ap(""+t)}function cx(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function gD(t,e,n,r,a){if(e==="submit"&&n&&n.stateNode===a){var i=lx((a[sn]||null).action),s=r.submitter;s&&(e=(e=s[sn]||null)?lx(e.formAction):s.getAttribute("formAction"),e!==null&&(i=e,s=null));var o=new Zp("action","action",null,r,a);t.push({event:o,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(Rs!==0){var u=s?cx(a,s):new FormData(a);rb(n,{pending:!0,data:u,method:a.method,action:i},null,u)}}else typeof i=="function"&&(o.preventDefault(),u=s?cx(a,s):new FormData(a),rb(n,{pending:!0,data:u,method:a.method,action:i},i,u))},currentTarget:a}]})}}for(Qd=0;Qd<Vy.length;Qd++)Wd=Vy[Qd],fx=Wd.toLowerCase(),dx=Wd[0].toUpperCase()+Wd.slice(1),fr(fx,"on"+dx);var Wd,fx,dx,Qd;fr(uA,"onAnimationEnd");fr(lA,"onAnimationIteration");fr(cA,"onAnimationStart");fr("dblclick","onDoubleClick");fr("focusin","onFocus");fr("focusout","onBlur");fr(j2,"onTransitionRun");fr(M2,"onTransitionStart");fr($2,"onTransitionCancel");fr(fA,"onTransitionEnd");Cu("onMouseEnter",["mouseout","mouseover"]);Cu("onMouseLeave",["mouseout","mouseover"]);Cu("onPointerEnter",["pointerout","pointerover"]);Cu("onPointerLeave",["pointerout","pointerover"]);ks("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ks("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ks("onBeforeInput",["compositionend","keypress","textInput","paste"]);ks("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ks("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ks("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ef="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yD=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ef));function KT(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],a=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var s=r.length-1;0<=s;s--){var o=r[s],u=o.instance,l=o.currentTarget;if(o=o.listener,u!==i&&a.isPropagationStopped())break e;i=o,a.currentTarget=l;try{i(a)}catch(c){Pp(c)}a.currentTarget=null,i=u}else for(s=0;s<r.length;s++){if(o=r[s],u=o.instance,l=o.currentTarget,o=o.listener,u!==i&&a.isPropagationStopped())break e;i=o,a.currentTarget=l;try{i(a)}catch(c){Pp(c)}a.currentTarget=null,i=u}}}}function pe(t,e){var n=e[Ly];n===void 0&&(n=e[Ly]=new Set);var r=t+"__bubble";n.has(r)||(YT(e,t,2,!1),n.add(r))}function Oy(t,e,n){var r=0;e&&(r|=4),YT(n,t,r,e)}var ep="_reactListening"+Math.random().toString(36).slice(2);function d_(t){if(!t[ep]){t[ep]=!0,qx.forEach(function(n){n!=="selectionchange"&&(yD.has(n)||Oy(n,!1,t),Oy(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ep]||(e[ep]=!0,Oy("selectionchange",!1,e))}}function YT(t,e,n,r){switch(oE(e)){case 2:var a=HD;break;case 8:a=VD;break;default:a=g_}n=a.bind(null,e,n,t),a=void 0,!Fy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),r?a!==void 0?t.addEventListener(e,n,{capture:!0,passive:a}):t.addEventListener(e,n,!0):a!==void 0?t.addEventListener(e,n,{passive:a}):t.addEventListener(e,n,!1)}function Ry(t,e,n,r,a){var i=r;if((e&1)===0&&(e&2)===0&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var o=r.stateNode.containerInfo;if(o===a)break;if(s===4)for(s=r.return;s!==null;){var u=s.tag;if((u===3||u===4)&&s.stateNode.containerInfo===a)return;s=s.return}for(;o!==null;){if(s=cu(o),s===null)return;if(u=s.tag,u===5||u===6||u===26||u===27){r=i=s;continue e}o=o.parentNode}}r=r.return}Xx(function(){var l=i,c=Nb(n),f=[];e:{var d=dA.get(t);if(d!==void 0){var p=Zp,g=t;switch(t){case"keypress":if(sp(n)===0)break e;case"keydown":case"keyup":p=p2;break;case"focusin":g="focus",p=oy;break;case"focusout":g="blur",p=oy;break;case"beforeblur":case"afterblur":p=oy;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=bS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=t2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=g2;break;case uA:case lA:case cA:p=a2;break;case fA:p=b2;break;case"scroll":case"scrollend":p=Wk;break;case"wheel":p=w2;break;case"copy":case"cut":case"paste":p=s2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=wS;break;case"toggle":case"beforetoggle":p=S2}var b=(e&4)!==0,_=!b&&(t==="scroll"||t==="scrollend"),m=b?d!==null?d+"Capture":null:d;b=[];for(var h=l,y;h!==null;){var v=h;if(y=v.stateNode,v=v.tag,v!==5&&v!==26&&v!==27||y===null||m===null||(v=Kc(h,m),v!=null&&b.push(tf(h,v,y))),_)break;h=h.return}0<b.length&&(d=new p(d,g,null,n,c),f.push({event:d,listeners:b}))}}if((e&7)===0){e:{if(d=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",d&&n!==By&&(g=n.relatedTarget||n.fromElement)&&(cu(g)||g[Uu]))break e;if((p||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,p?(g=n.relatedTarget||n.toElement,p=l,g=g?cu(g):null,g!==null&&(_=uf(g),b=g.tag,g!==_||b!==5&&b!==27&&b!==6)&&(g=null)):(p=null,g=l),p!==g)){if(b=bS,v="onMouseLeave",m="onMouseEnter",h="mouse",(t==="pointerout"||t==="pointerover")&&(b=wS,v="onPointerLeave",m="onPointerEnter",h="pointer"),_=p==null?d:Pc(p),y=g==null?d:Pc(g),d=new b(v,h+"leave",p,n,c),d.target=_,d.relatedTarget=y,v=null,cu(c)===l&&(b=new b(m,h+"enter",g,n,c),b.target=y,b.relatedTarget=_,v=b),_=v,p&&g)t:{for(b=p,m=g,h=0,y=b;y;y=au(y))h++;for(y=0,v=m;v;v=au(v))y++;for(;0<h-y;)b=au(b),h--;for(;0<y-h;)m=au(m),y--;for(;h--;){if(b===m||m!==null&&b===m.alternate)break t;b=au(b),m=au(m)}b=null}else b=null;p!==null&&px(f,d,p,b,!1),g!==null&&_!==null&&px(f,_,g,b,!0)}}e:{if(d=l?Pc(l):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var S=AS;else if(xS(d))if(rA)S=N2;else{S=I2;var A=C2}else p=d.nodeName,!p||p.toLowerCase()!=="input"||d.type!=="checkbox"&&d.type!=="radio"?l&&Pb(l.elementType)&&(S=AS):S=P2;if(S&&(S=S(t,l))){nA(f,S,n,c);break e}A&&A(t,d,l),t==="focusout"&&l&&d.type==="number"&&l.memoizedProps.value!=null&&zy(d,"number",d.value)}switch(A=l?Pc(l):window,t){case"focusin":(xS(A)||A.contentEditable==="true")&&(pu=A,qy=l,jc=null);break;case"focusout":jc=qy=pu=null;break;case"mousedown":Hy=!0;break;case"contextmenu":case"mouseup":case"dragend":Hy=!1,RS(f,n,c);break;case"selectionchange":if(D2)break;case"keydown":case"keyup":RS(f,n,c)}var T;if(jb)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else du?eA(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(Wx&&n.locale!=="ko"&&(du||x!=="onCompositionStart"?x==="onCompositionEnd"&&du&&(T=Qx()):(yi=c,kb="value"in yi?yi.value:yi.textContent,du=!0)),A=Up(l,x),0<A.length&&(x=new _S(x,t,null,n,c),f.push({event:x,listeners:A}),T?x.data=T:(T=tA(n),T!==null&&(x.data=T)))),(T=A2?T2(t,n):E2(t,n))&&(x=Up(l,"onBeforeInput"),0<x.length&&(A=new _S("onBeforeInput","beforeinput",null,n,c),f.push({event:A,listeners:x}),A.data=T)),gD(f,t,l,n,c)}KT(f,e)})}function tf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Up(t,e){for(var n=e+"Capture",r=[];t!==null;){var a=t,i=a.stateNode;if(a=a.tag,a!==5&&a!==26&&a!==27||i===null||(a=Kc(t,n),a!=null&&r.unshift(tf(t,a,i)),a=Kc(t,e),a!=null&&r.push(tf(t,a,i))),t.tag===3)return r;t=t.return}return[]}function au(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function px(t,e,n,r,a){for(var i=e._reactName,s=[];n!==null&&n!==r;){var o=n,u=o.alternate,l=o.stateNode;if(o=o.tag,u!==null&&u===r)break;o!==5&&o!==26&&o!==27||l===null||(u=l,a?(l=Kc(n,i),l!=null&&s.unshift(tf(n,l,u))):a||(l=Kc(n,i),l!=null&&s.push(tf(n,l,u)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var bD=/\r\n?/g,_D=/\u0000|\uFFFD/g;function hx(t){return(typeof t=="string"?t:""+t).replace(bD,`
`).replace(_D,"")}function JT(t,e){return e=hx(e),hx(t)===e}function ih(){}function Re(t,e,n,r,a,i){switch(n){case"children":typeof r=="string"?e==="body"||e==="textarea"&&r===""||Iu(t,r):(typeof r=="number"||typeof r=="bigint")&&e!=="body"&&Iu(t,""+r);break;case"className":qd(t,"class",r);break;case"tabIndex":qd(t,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":qd(t,n,r);break;case"style":Jx(t,r,i);break;case"data":if(e!=="object"){qd(t,"data",r);break}case"src":case"href":if(r===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(r==null||typeof r=="function"||typeof r=="symbol"||typeof r=="boolean"){t.removeAttribute(n);break}r=ap(""+r),t.setAttribute(n,r);break;case"action":case"formAction":if(typeof r=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof i=="function"&&(n==="formAction"?(e!=="input"&&Re(t,e,"name",a.name,a,null),Re(t,e,"formEncType",a.formEncType,a,null),Re(t,e,"formMethod",a.formMethod,a,null),Re(t,e,"formTarget",a.formTarget,a,null)):(Re(t,e,"encType",a.encType,a,null),Re(t,e,"method",a.method,a,null),Re(t,e,"target",a.target,a,null)));if(r==null||typeof r=="symbol"||typeof r=="boolean"){t.removeAttribute(n);break}r=ap(""+r),t.setAttribute(n,r);break;case"onClick":r!=null&&(t.onclick=ih);break;case"onScroll":r!=null&&pe("scroll",t);break;case"onScrollEnd":r!=null&&pe("scrollend",t);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(O(61));if(n=r.__html,n!=null){if(a.children!=null)throw Error(O(60));t.innerHTML=n}}break;case"multiple":t.multiple=r&&typeof r!="function"&&typeof r!="symbol";break;case"muted":t.muted=r&&typeof r!="function"&&typeof r!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(r==null||typeof r=="function"||typeof r=="boolean"||typeof r=="symbol"){t.removeAttribute("xlink:href");break}n=ap(""+r),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":r!=null&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(n,""+r):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":r===!0?t.setAttribute(n,""):r!==!1&&r!=null&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(n,r):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":r!=null&&typeof r!="function"&&typeof r!="symbol"&&!isNaN(r)&&1<=r?t.setAttribute(n,r):t.removeAttribute(n);break;case"rowSpan":case"start":r==null||typeof r=="function"||typeof r=="symbol"||isNaN(r)?t.removeAttribute(n):t.setAttribute(n,r);break;case"popover":pe("beforetoggle",t),pe("toggle",t),rp(t,"popover",r);break;case"xlinkActuate":fa(t,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":fa(t,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":fa(t,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":fa(t,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":fa(t,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":fa(t,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":fa(t,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":fa(t,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":fa(t,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":rp(t,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=Xk.get(n)||n,rp(t,n,r))}}function mb(t,e,n,r,a,i){switch(n){case"style":Jx(t,r,i);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(O(61));if(n=r.__html,n!=null){if(a.children!=null)throw Error(O(60));t.innerHTML=n}}break;case"children":typeof r=="string"?Iu(t,r):(typeof r=="number"||typeof r=="bigint")&&Iu(t,""+r);break;case"onScroll":r!=null&&pe("scroll",t);break;case"onScrollEnd":r!=null&&pe("scrollend",t);break;case"onClick":r!=null&&(t.onclick=ih);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hx.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(a=n.endsWith("Capture"),e=n.slice(2,a?n.length-7:void 0),i=t[sn]||null,i=i!=null?i[n]:null,typeof i=="function"&&t.removeEventListener(e,i,a),typeof r=="function")){typeof i!="function"&&i!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,r,a);break e}n in t?t[n]=r:r===!0?t.setAttribute(n,""):rp(t,n,r)}}}function Rt(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pe("error",t),pe("load",t);var r=!1,a=!1,i;for(i in n)if(n.hasOwnProperty(i)){var s=n[i];if(s!=null)switch(i){case"src":r=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(O(137,e));default:Re(t,e,i,s,n,null)}}a&&Re(t,e,"srcSet",n.srcSet,n,null),r&&Re(t,e,"src",n.src,n,null);return;case"input":pe("invalid",t);var o=i=s=a=null,u=null,l=null;for(r in n)if(n.hasOwnProperty(r)){var c=n[r];if(c!=null)switch(r){case"name":a=c;break;case"type":s=c;break;case"checked":u=c;break;case"defaultChecked":l=c;break;case"value":i=c;break;case"defaultValue":o=c;break;case"children":case"dangerouslySetInnerHTML":if(c!=null)throw Error(O(137,e));break;default:Re(t,e,r,c,n,null)}}Zx(t,i,o,u,l,s,a,!1),wp(t);return;case"select":pe("invalid",t),r=s=i=null;for(a in n)if(n.hasOwnProperty(a)&&(o=n[a],o!=null))switch(a){case"value":i=o;break;case"defaultValue":s=o;break;case"multiple":r=o;default:Re(t,e,a,o,n,null)}e=i,n=s,t.multiple=!!r,e!=null?vu(t,!!r,e,!1):n!=null&&vu(t,!!r,n,!0);return;case"textarea":pe("invalid",t),i=a=r=null;for(s in n)if(n.hasOwnProperty(s)&&(o=n[s],o!=null))switch(s){case"value":r=o;break;case"defaultValue":a=o;break;case"children":i=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(O(91));break;default:Re(t,e,s,o,n,null)}Yx(t,r,a,i),wp(t);return;case"option":for(u in n)if(n.hasOwnProperty(u)&&(r=n[u],r!=null))switch(u){case"selected":t.selected=r&&typeof r!="function"&&typeof r!="symbol";break;default:Re(t,e,u,r,n,null)}return;case"dialog":pe("beforetoggle",t),pe("toggle",t),pe("cancel",t),pe("close",t);break;case"iframe":case"object":pe("load",t);break;case"video":case"audio":for(r=0;r<ef.length;r++)pe(ef[r],t);break;case"image":pe("error",t),pe("load",t);break;case"details":pe("toggle",t);break;case"embed":case"source":case"link":pe("error",t),pe("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(l in n)if(n.hasOwnProperty(l)&&(r=n[l],r!=null))switch(l){case"children":case"dangerouslySetInnerHTML":throw Error(O(137,e));default:Re(t,e,l,r,n,null)}return;default:if(Pb(e)){for(c in n)n.hasOwnProperty(c)&&(r=n[c],r!==void 0&&mb(t,e,c,r,n,void 0));return}}for(o in n)n.hasOwnProperty(o)&&(r=n[o],r!=null&&Re(t,e,o,r,n,null))}function wD(t,e,n,r){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,i=null,s=null,o=null,u=null,l=null,c=null;for(p in n){var f=n[p];if(n.hasOwnProperty(p)&&f!=null)switch(p){case"checked":break;case"value":break;case"defaultValue":u=f;default:r.hasOwnProperty(p)||Re(t,e,p,null,r,f)}}for(var d in r){var p=r[d];if(f=n[d],r.hasOwnProperty(d)&&(p!=null||f!=null))switch(d){case"type":i=p;break;case"name":a=p;break;case"checked":l=p;break;case"defaultChecked":c=p;break;case"value":s=p;break;case"defaultValue":o=p;break;case"children":case"dangerouslySetInnerHTML":if(p!=null)throw Error(O(137,e));break;default:p!==f&&Re(t,e,d,p,r,f)}}Uy(t,s,o,u,l,c,i,a);return;case"select":p=s=o=d=null;for(i in n)if(u=n[i],n.hasOwnProperty(i)&&u!=null)switch(i){case"value":break;case"multiple":p=u;default:r.hasOwnProperty(i)||Re(t,e,i,null,r,u)}for(a in r)if(i=r[a],u=n[a],r.hasOwnProperty(a)&&(i!=null||u!=null))switch(a){case"value":d=i;break;case"defaultValue":o=i;break;case"multiple":s=i;default:i!==u&&Re(t,e,a,i,r,u)}e=o,n=s,r=p,d!=null?vu(t,!!n,d,!1):!!r!=!!n&&(e!=null?vu(t,!!n,e,!0):vu(t,!!n,n?[]:"",!1));return;case"textarea":p=d=null;for(o in n)if(a=n[o],n.hasOwnProperty(o)&&a!=null&&!r.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:Re(t,e,o,null,r,a)}for(s in r)if(a=r[s],i=n[s],r.hasOwnProperty(s)&&(a!=null||i!=null))switch(s){case"value":d=a;break;case"defaultValue":p=a;break;case"children":break;case"dangerouslySetInnerHTML":if(a!=null)throw Error(O(91));break;default:a!==i&&Re(t,e,s,a,r,i)}Kx(t,d,p);return;case"option":for(var g in n)if(d=n[g],n.hasOwnProperty(g)&&d!=null&&!r.hasOwnProperty(g))switch(g){case"selected":t.selected=!1;break;default:Re(t,e,g,null,r,d)}for(u in r)if(d=r[u],p=n[u],r.hasOwnProperty(u)&&d!==p&&(d!=null||p!=null))switch(u){case"selected":t.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Re(t,e,u,d,r,p)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var b in n)d=n[b],n.hasOwnProperty(b)&&d!=null&&!r.hasOwnProperty(b)&&Re(t,e,b,null,r,d);for(l in r)if(d=r[l],p=n[l],r.hasOwnProperty(l)&&d!==p&&(d!=null||p!=null))switch(l){case"children":case"dangerouslySetInnerHTML":if(d!=null)throw Error(O(137,e));break;default:Re(t,e,l,d,r,p)}return;default:if(Pb(e)){for(var _ in n)d=n[_],n.hasOwnProperty(_)&&d!==void 0&&!r.hasOwnProperty(_)&&mb(t,e,_,void 0,r,d);for(c in r)d=r[c],p=n[c],!r.hasOwnProperty(c)||d===p||d===void 0&&p===void 0||mb(t,e,c,d,r,p);return}}for(var m in n)d=n[m],n.hasOwnProperty(m)&&d!=null&&!r.hasOwnProperty(m)&&Re(t,e,m,null,r,d);for(f in r)d=r[f],p=n[f],!r.hasOwnProperty(f)||d===p||d==null&&p==null||Re(t,e,f,d,r,p)}var gb=null,yb=null;function zp(t){return t.nodeType===9?t:t.ownerDocument}function mx(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function XT(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function bb(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cy=null;function vD(){var t=window.event;return t&&t.type==="popstate"?t===Cy?!1:(Cy=t,!0):(Cy=null,!1)}var QT=typeof setTimeout=="function"?setTimeout:void 0,SD=typeof clearTimeout=="function"?clearTimeout:void 0,gx=typeof Promise=="function"?Promise:void 0,xD=typeof queueMicrotask=="function"?queueMicrotask:typeof gx!="undefined"?function(t){return gx.resolve(null).then(t).catch(AD)}:QT;function AD(t){setTimeout(function(){throw t})}function Ni(t){return t==="head"}function yx(t,e){var n=e,r=0,a=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(0<r&&8>r){n=r;var s=t.ownerDocument;if(n&1&&Gc(s.documentElement),n&2&&Gc(s.body),n&4)for(n=s.head,Gc(n),s=n.firstChild;s;){var o=s.nextSibling,u=s.nodeName;s[df]||u==="SCRIPT"||u==="STYLE"||u==="LINK"&&s.rel.toLowerCase()==="stylesheet"||n.removeChild(s),s=o}}if(a===0){t.removeChild(i),of(e);return}a--}else n==="$"||n==="$?"||n==="$!"?a++:r=n.charCodeAt(0)-48;else r=0;n=i}while(n);of(e)}function _b(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":_b(n),Ib(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function TD(t,e,n,r){for(;t.nodeType===1;){var a=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!r&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(r){if(!t[df])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(i=t.getAttribute("rel"),i==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(i!==a.rel||t.getAttribute("href")!==(a.href==null||a.href===""?null:a.href)||t.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin)||t.getAttribute("title")!==(a.title==null?null:a.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(i=t.getAttribute("src"),(i!==(a.src==null?null:a.src)||t.getAttribute("type")!==(a.type==null?null:a.type)||t.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin))&&i&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var i=a.name==null?null:""+a.name;if(a.type==="hidden"&&t.getAttribute("name")===i)return t}else return t;if(t=cr(t.nextSibling),t===null)break}return null}function ED(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=cr(t.nextSibling),t===null))return null;return t}function wb(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function OD(t,e){var n=t.ownerDocument;if(t.data!=="$?"||n.readyState==="complete")e();else{var r=function(){e(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),t._reactRetry=r}}function cr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="F!"||e==="F")break;if(e==="/$")return null}}return t}var vb=null;function bx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}function WT(t,e,n){switch(e=zp(n),t){case"html":if(t=e.documentElement,!t)throw Error(O(452));return t;case"head":if(t=e.head,!t)throw Error(O(453));return t;case"body":if(t=e.body,!t)throw Error(O(454));return t;default:throw Error(O(451))}}function Gc(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Ib(t)}var Jn=new Map,_x=new Set;function Bp(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Ea=xe.d;xe.d={f:RD,r:CD,D:ID,C:PD,L:ND,m:kD,X:jD,S:DD,M:MD};function RD(){var t=Ea.f(),e=nh();return t||e}function CD(t){var e=zu(t);e!==null&&e.tag===5&&e.type==="form"?GA(e):Ea.r(t)}var qu=typeof document=="undefined"?null:document;function eE(t,e,n){var r=qu;if(r&&typeof e=="string"&&e){var a=Gn(e);a='link[rel="'+t+'"][href="'+a+'"]',typeof n=="string"&&(a+='[crossorigin="'+n+'"]'),_x.has(a)||(_x.add(a),t={rel:t,crossOrigin:n,href:e},r.querySelector(a)===null&&(e=r.createElement("link"),Rt(e,"link",t),_t(e),r.head.appendChild(e)))}}function ID(t){Ea.D(t),eE("dns-prefetch",t,null)}function PD(t,e){Ea.C(t,e),eE("preconnect",t,e)}function ND(t,e,n){Ea.L(t,e,n);var r=qu;if(r&&t&&e){var a='link[rel="preload"][as="'+Gn(e)+'"]';e==="image"&&n&&n.imageSrcSet?(a+='[imagesrcset="'+Gn(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(a+='[imagesizes="'+Gn(n.imageSizes)+'"]')):a+='[href="'+Gn(t)+'"]';var i=a;switch(e){case"style":i=Lu(t);break;case"script":i=Hu(t)}Jn.has(i)||(t=Me({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),Jn.set(i,t),r.querySelector(a)!==null||e==="style"&&r.querySelector(Sf(i))||e==="script"&&r.querySelector(xf(i))||(e=r.createElement("link"),Rt(e,"link",t),_t(e),r.head.appendChild(e)))}}function kD(t,e){Ea.m(t,e);var n=qu;if(n&&t){var r=e&&typeof e.as=="string"?e.as:"script",a='link[rel="modulepreload"][as="'+Gn(r)+'"][href="'+Gn(t)+'"]',i=a;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=Hu(t)}if(!Jn.has(i)&&(t=Me({rel:"modulepreload",href:t},e),Jn.set(i,t),n.querySelector(a)===null)){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(xf(i)))return}r=n.createElement("link"),Rt(r,"link",t),_t(r),n.head.appendChild(r)}}}function DD(t,e,n){Ea.S(t,e,n);var r=qu;if(r&&t){var a=wu(r).hoistableStyles,i=Lu(t);e=e||"default";var s=a.get(i);if(!s){var o={loading:0,preload:null};if(s=r.querySelector(Sf(i)))o.loading=5;else{t=Me({rel:"stylesheet",href:t,"data-precedence":e},n),(n=Jn.get(i))&&p_(t,n);var u=s=r.createElement("link");_t(u),Rt(u,"link",t),u._p=new Promise(function(l,c){u.onload=l,u.onerror=c}),u.addEventListener("load",function(){o.loading|=1}),u.addEventListener("error",function(){o.loading|=2}),o.loading|=4,pp(s,e,r)}s={type:"stylesheet",instance:s,count:1,state:o},a.set(i,s)}}}function jD(t,e){Ea.X(t,e);var n=qu;if(n&&t){var r=wu(n).hoistableScripts,a=Hu(t),i=r.get(a);i||(i=n.querySelector(xf(a)),i||(t=Me({src:t,async:!0},e),(e=Jn.get(a))&&h_(t,e),i=n.createElement("script"),_t(i),Rt(i,"link",t),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},r.set(a,i))}}function MD(t,e){Ea.M(t,e);var n=qu;if(n&&t){var r=wu(n).hoistableScripts,a=Hu(t),i=r.get(a);i||(i=n.querySelector(xf(a)),i||(t=Me({src:t,async:!0,type:"module"},e),(e=Jn.get(a))&&h_(t,e),i=n.createElement("script"),_t(i),Rt(i,"link",t),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},r.set(a,i))}}function wx(t,e,n,r){var a=(a=wi.current)?Bp(a):null;if(!a)throw Error(O(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=Lu(n.href),n=wu(a).hoistableStyles,r=n.get(e),r||(r={type:"style",instance:null,count:0,state:null},n.set(e,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=Lu(n.href);var i=wu(a).hoistableStyles,s=i.get(t);if(s||(a=a.ownerDocument||a,s={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},i.set(t,s),(i=a.querySelector(Sf(t)))&&!i._p&&(s.instance=i,s.state.loading=5),Jn.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Jn.set(t,n),i||$D(a,t,n,s.state))),e&&r===null)throw Error(O(528,""));return s}if(e&&r!==null)throw Error(O(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=Hu(n),n=wu(a).hoistableScripts,r=n.get(e),r||(r={type:"script",instance:null,count:0,state:null},n.set(e,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(O(444,t))}}function Lu(t){return'href="'+Gn(t)+'"'}function Sf(t){return'link[rel="stylesheet"]['+t+"]"}function tE(t){return Me({},t,{"data-precedence":t.precedence,precedence:null})}function $D(t,e,n,r){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?r.loading=1:(e=t.createElement("link"),r.preload=e,e.addEventListener("load",function(){return r.loading|=1}),e.addEventListener("error",function(){return r.loading|=2}),Rt(e,"link",n),_t(e),t.head.appendChild(e))}function Hu(t){return'[src="'+Gn(t)+'"]'}function xf(t){return"script[async]"+t}function vx(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var r=t.querySelector('style[data-href~="'+Gn(n.href)+'"]');if(r)return e.instance=r,_t(r),r;var a=Me({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return r=(t.ownerDocument||t).createElement("style"),_t(r),Rt(r,"style",a),pp(r,n.precedence,t),e.instance=r;case"stylesheet":a=Lu(n.href);var i=t.querySelector(Sf(a));if(i)return e.state.loading|=4,e.instance=i,_t(i),i;r=tE(n),(a=Jn.get(a))&&p_(r,a),i=(t.ownerDocument||t).createElement("link"),_t(i);var s=i;return s._p=new Promise(function(o,u){s.onload=o,s.onerror=u}),Rt(i,"link",r),e.state.loading|=4,pp(i,n.precedence,t),e.instance=i;case"script":return i=Hu(n.src),(a=t.querySelector(xf(i)))?(e.instance=a,_t(a),a):(r=n,(a=Jn.get(i))&&(r=Me({},n),h_(r,a)),t=t.ownerDocument||t,a=t.createElement("script"),_t(a),Rt(a,"link",r),t.head.appendChild(a),e.instance=a);case"void":return null;default:throw Error(O(443,e.type))}else e.type==="stylesheet"&&(e.state.loading&4)===0&&(r=e.instance,e.state.loading|=4,pp(r,n.precedence,t));return e.instance}function pp(t,e,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=r.length?r[r.length-1]:null,i=a,s=0;s<r.length;s++){var o=r[s];if(o.dataset.precedence===e)i=o;else if(i!==a)break}i?i.parentNode.insertBefore(t,i.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function p_(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function h_(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var hp=null;function Sx(t,e,n){if(hp===null){var r=new Map,a=hp=new Map;a.set(n,r)}else a=hp,r=a.get(n),r||(r=new Map,a.set(n,r));if(r.has(t))return r;for(r.set(t,null),n=n.getElementsByTagName(t),a=0;a<n.length;a++){var i=n[a];if(!(i[df]||i[jt]||t==="link"&&i.getAttribute("rel")==="stylesheet")&&i.namespaceURI!=="http://www.w3.org/2000/svg"){var s=i.getAttribute(e)||"";s=t+s;var o=r.get(s);o?o.push(i):r.set(s,[i])}}return r}function xx(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function LD(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function nE(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var nf=null;function UD(){}function zD(t,e,n){if(nf===null)throw Error(O(475));var r=nf;if(e.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(e.state.loading&4)===0){if(e.instance===null){var a=Lu(n.href),i=t.querySelector(Sf(a));if(i){t=i._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(r.count++,r=Fp.bind(r),t.then(r,r)),e.state.loading|=4,e.instance=i,_t(i);return}i=t.ownerDocument||t,n=tE(n),(a=Jn.get(a))&&p_(n,a),i=i.createElement("link"),_t(i);var s=i;s._p=new Promise(function(o,u){s.onload=o,s.onerror=u}),Rt(i,"link",n),e.instance=i}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(e,t),(t=e.state.preload)&&(e.state.loading&3)===0&&(r.count++,e=Fp.bind(r),t.addEventListener("load",e),t.addEventListener("error",e))}}function BD(){if(nf===null)throw Error(O(475));var t=nf;return t.stylesheets&&t.count===0&&Sb(t,t.stylesheets),0<t.count?function(e){var n=setTimeout(function(){if(t.stylesheets&&Sb(t,t.stylesheets),t.unsuspend){var r=t.unsuspend;t.unsuspend=null,r()}},6e4);return t.unsuspend=e,function(){t.unsuspend=null,clearTimeout(n)}}:null}function Fp(){if(this.count--,this.count===0){if(this.stylesheets)Sb(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var qp=null;function Sb(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,qp=new Map,e.forEach(FD,t),qp=null,Fp.call(t))}function FD(t,e){if(!(e.state.loading&4)){var n=qp.get(t);if(n)var r=n.get(null);else{n=new Map,qp.set(t,n);for(var a=t.querySelectorAll("link[data-precedence],style[data-precedence]"),i=0;i<a.length;i++){var s=a[i];(s.nodeName==="LINK"||s.getAttribute("media")!=="not all")&&(n.set(s.dataset.precedence,s),r=s)}r&&n.set(null,r)}a=e.instance,s=a.getAttribute("data-precedence"),i=n.get(s)||r,i===r&&n.set(null,a),n.set(s,a),this.count++,r=Fp.bind(this),a.addEventListener("load",r),a.addEventListener("error",r),i?i.parentNode.insertBefore(a,i.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(a,t.firstChild)),e.state.loading|=4}}var rf={$$typeof:ma,Provider:null,Consumer:null,_currentValue:Ss,_currentValue2:Ss,_threadCount:0};function qD(t,e,n,r,a,i,s,o){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ey(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ey(0),this.hiddenUpdates=ey(null),this.identifierPrefix=r,this.onUncaughtError=a,this.onCaughtError=i,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function rE(t,e,n,r,a,i,s,o,u,l,c,f){return t=new qD(t,e,n,s,o,u,l,f),e=1,i===!0&&(e|=24),i=xn(3,null,null,e),t.current=i,i.stateNode=t,e=Fb(),e.refCount++,t.pooledCache=e,e.refCount++,i.memoizedState={element:r,isDehydrated:n,cache:e},Hb(i),t}function aE(t){return t?(t=gu,t):gu}function iE(t,e,n,r,a,i){a=aE(a),r.context===null?r.context=a:r.pendingContext=a,r=vi(e),r.payload={element:n},i=i===void 0?null:i,i!==null&&(r.callback=i),n=Si(t,r,e),n!==null&&(On(n,t,e),Lc(n,t,e))}function Ax(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function m_(t,e){Ax(t,e),(t=t.alternate)&&Ax(t,e)}function sE(t){if(t.tag===13){var e=Bu(t,67108864);e!==null&&On(e,t,67108864),m_(t,67108864)}}var Hp=!0;function HD(t,e,n,r){var a=J.T;J.T=null;var i=xe.p;try{xe.p=2,g_(t,e,n,r)}finally{xe.p=i,J.T=a}}function VD(t,e,n,r){var a=J.T;J.T=null;var i=xe.p;try{xe.p=8,g_(t,e,n,r)}finally{xe.p=i,J.T=a}}function g_(t,e,n,r){if(Hp){var a=xb(r);if(a===null)Ry(t,e,r,Vp,n),Tx(t,r);else if(ZD(a,t,e,n,r))r.stopPropagation();else if(Tx(t,r),e&4&&-1<GD.indexOf(t)){for(;a!==null;){var i=zu(a);if(i!==null)switch(i.tag){case 3:if(i=i.stateNode,i.current.memoizedState.isDehydrated){var s=_s(i.pendingLanes);if(s!==0){var o=i;for(o.pendingLanes|=2,o.entangledLanes|=2;s;){var u=1<<31-Tn(s);o.entanglements[1]|=u,s&=~u}Br(i),(Ee&6)===0&&(jp=Lr()+500,vf(0,!1))}}break;case 13:o=Bu(i,2),o!==null&&On(o,i,2),nh(),m_(i,2)}if(i=xb(r),i===null&&Ry(t,e,r,Vp,n),i===a)break;a=i}a!==null&&r.stopPropagation()}else Ry(t,e,r,null,n)}}function xb(t){return t=Nb(t),y_(t)}var Vp=null;function y_(t){if(Vp=null,t=cu(t),t!==null){var e=uf(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=Px(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return Vp=t,null}function oE(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kk()){case jx:return 2;case Mx:return 8;case _p:case Dk:return 32;case $x:return 268435456;default:return 32}default:return 32}}var Ab=!1,Ti=null,Ei=null,Oi=null,af=new Map,sf=new Map,mi=[],GD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Tx(t,e){switch(t){case"focusin":case"focusout":Ti=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":Oi=null;break;case"pointerover":case"pointerout":af.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":sf.delete(e.pointerId)}}function Oc(t,e,n,r,a,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},e!==null&&(e=zu(e),e!==null&&sE(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),t)}function ZD(t,e,n,r,a){switch(e){case"focusin":return Ti=Oc(Ti,t,e,n,r,a),!0;case"dragenter":return Ei=Oc(Ei,t,e,n,r,a),!0;case"mouseover":return Oi=Oc(Oi,t,e,n,r,a),!0;case"pointerover":var i=a.pointerId;return af.set(i,Oc(af.get(i)||null,t,e,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,sf.set(i,Oc(sf.get(i)||null,t,e,n,r,a)),!0}return!1}function uE(t){var e=cu(t.target);if(e!==null){var n=uf(e);if(n!==null){if(e=n.tag,e===13){if(e=Px(n),e!==null){t.blockedOn=e,Fk(t.priority,function(){if(n.tag===13){var r=En();r=Rb(r);var a=Bu(n,r);a!==null&&On(a,n,r),m_(n,r)}});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function mp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xb(t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);By=r,n.target.dispatchEvent(r),By=null}else return e=zu(n),e!==null&&sE(e),t.blockedOn=n,!1;e.shift()}return!0}function Ex(t,e,n){mp(t)&&n.delete(e)}function KD(){Ab=!1,Ti!==null&&mp(Ti)&&(Ti=null),Ei!==null&&mp(Ei)&&(Ei=null),Oi!==null&&mp(Oi)&&(Oi=null),af.forEach(Ex),sf.forEach(Ex)}function tp(t,e){t.blockedOn===e&&(t.blockedOn=null,Ab||(Ab=!0,pt.unstable_scheduleCallback(pt.unstable_NormalPriority,KD)))}var np=null;function Ox(t){np!==t&&(np=t,pt.unstable_scheduleCallback(pt.unstable_NormalPriority,function(){np===t&&(np=null);for(var e=0;e<t.length;e+=3){var n=t[e],r=t[e+1],a=t[e+2];if(typeof r!="function"){if(y_(r||n)===null)continue;break}var i=zu(n);i!==null&&(t.splice(e,3),e-=3,rb(i,{pending:!0,data:a,method:n.method,action:r},r,a))}}))}function of(t){function e(u){return tp(u,t)}Ti!==null&&tp(Ti,t),Ei!==null&&tp(Ei,t),Oi!==null&&tp(Oi,t),af.forEach(e),sf.forEach(e);for(var n=0;n<mi.length;n++){var r=mi[n];r.blockedOn===t&&(r.blockedOn=null)}for(;0<mi.length&&(n=mi[0],n.blockedOn===null);)uE(n),n.blockedOn===null&&mi.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(r=0;r<n.length;r+=3){var a=n[r],i=n[r+1],s=a[sn]||null;if(typeof i=="function")s||Ox(n);else if(s){var o=null;if(i&&i.hasAttribute("formAction")){if(a=i,s=i[sn]||null)o=s.formAction;else if(y_(a)!==null)continue}else o=s.action;typeof o=="function"?n[r+1]=o:(n.splice(r,3),r-=3),Ox(n)}}}function b_(t){this._internalRoot=t}sh.prototype.render=b_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));var n=e.current,r=En();iE(n,r,t,e,null,null)};sh.prototype.unmount=b_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;iE(t.current,2,null,t,null,null),nh(),e[Uu]=null}};function sh(t){this._internalRoot=t}sh.prototype.unstable_scheduleHydration=function(t){if(t){var e=Fx();t={blockedOn:null,target:t,priority:e};for(var n=0;n<mi.length&&e!==0&&e<mi[n].priority;n++);mi.splice(n,0,t),n===0&&uE(t)}};var Rx=Cx.version;if(Rx!=="19.1.0")throw Error(O(527,Rx,"19.1.0"));xe.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=Ek(e),t=t!==null?Nx(t):null,t=t===null?null:t.stateNode,t};var YD={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:J,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"&&(Rc=__REACT_DEVTOOLS_GLOBAL_HOOK__,!Rc.isDisabled&&Rc.supportsFiber))try{lf=Rc.inject(YD),An=Rc}catch(t){}var Rc;oh.createRoot=function(t,e){if(!Ix(t))throw Error(O(299));var n=!1,r="",a=rT,i=aT,s=iT,o=null;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onUncaughtError!==void 0&&(a=e.onUncaughtError),e.onCaughtError!==void 0&&(i=e.onCaughtError),e.onRecoverableError!==void 0&&(s=e.onRecoverableError),e.unstable_transitionCallbacks!==void 0&&(o=e.unstable_transitionCallbacks)),e=rE(t,1,!1,null,null,n,r,a,i,s,o,null),t[Uu]=e.current,d_(t),new b_(e)};oh.hydrateRoot=function(t,e,n){if(!Ix(t))throw Error(O(299));var r=!1,a="",i=rT,s=aT,o=iT,u=null,l=null;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onUncaughtError!==void 0&&(i=n.onUncaughtError),n.onCaughtError!==void 0&&(s=n.onCaughtError),n.onRecoverableError!==void 0&&(o=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(u=n.unstable_transitionCallbacks),n.formState!==void 0&&(l=n.formState)),e=rE(t,1,!0,e,n!=null?n:null,r,a,i,s,o,u,l),e.context=aE(null),n=e.current,r=En(),r=Rb(r),a=vi(r),a.callback=null,Si(n,a,r),n=r,e.current.lanes=n,ff(e,n),Br(e),t[Uu]=e.current,d_(t),new sh(e)};oh.version="19.1.0"});var __=P((fB,fE)=>{"use strict";function cE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cE)}catch(t){console.error(t)}}cE(),fE.exports=lE()});var oO=P((G5,sO)=>{"use strict";sO.exports=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e=="undefined"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var hO=P((Z5,uw)=>{"use strict";var gM=/[\p{Lu}]/u,yM=/[\p{Ll}]/u,uO=/^[\p{Lu}](?![\p{Lu}])/gu,fO=/([\p{Alpha}\p{N}_]|$)/u,dO=/[_.\- ]+/,bM=new RegExp("^"+dO.source),lO=new RegExp(dO.source+fO.source,"gu"),cO=new RegExp("\\d+"+fO.source,"gu"),_M=(t,e,n)=>{let r=!1,a=!1,i=!1;for(let s=0;s<t.length;s++){let o=t[s];r&&gM.test(o)?(t=t.slice(0,s)+"-"+t.slice(s),r=!1,i=a,a=!0,s++):a&&i&&yM.test(o)?(t=t.slice(0,s-1)+"-"+t.slice(s-1),i=a,a=!1,r=!0):(r=e(o)===o&&n(o)!==o,i=a,a=n(o)===o&&e(o)!==o)}return t},wM=(t,e)=>(uO.lastIndex=0,t.replace(uO,n=>e(n))),vM=(t,e)=>(lO.lastIndex=0,cO.lastIndex=0,t.replace(lO,(n,r)=>e(r)).replace(cO,n=>e(n))),pO=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(i=>i.trim()).filter(i=>i.length).join("-"):t=t.trim(),t.length===0)return"";let n=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?r(t):n(t):(t!==n(t)&&(t=_M(t,n,r)),t=t.replace(bM,""),e.preserveConsecutiveUppercase?t=wM(t,n):t=n(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),vM(t,r))};uw.exports=pO;uw.exports.default=pO});var BO=P((Rq,zO)=>{function er(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}zO.exports=er;er.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};er.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};er.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0};er.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};er.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};er.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};er.prototype.start=er.prototype.try;er.prototype.errors=function(){return this._errors};er.prototype.attempts=function(){return this._attempts};er.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var a=this._errors[r],i=a.message,s=(t[i]||0)+1;t[i]=s,s>=n&&(e=a,n=s)}return e}});var FO=P(Ro=>{var M$=BO();Ro.operation=function(t){var e=Ro.timeouts(t);return new M$(e,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})};Ro.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var n in t)e[n]=t[n];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],a=0;a<e.retries;a++)r.push(this.createTimeout(a,e));return t&&t.forever&&!r.length&&r.push(this.createTimeout(a,e)),r.sort(function(i,s){return i-s}),r};Ro.createTimeout=function(t,e){var n=e.randomize?Math.random()+1:1,r=Math.round(n*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return r=Math.min(r,e.maxTimeout),r};Ro.wrap=function(t,e,n){if(e instanceof Array&&(n=e,e=null),!n){n=[];for(var r in t)typeof t[r]=="function"&&n.push(r)}for(var a=0;a<n.length;a++){var i=n[a],s=t[i];t[i]=function(u){var l=Ro.operation(e),c=Array.prototype.slice.call(arguments,1),f=c.pop();c.push(function(d){l.retry(d)||(d&&(arguments[0]=l.mainError()),f.apply(this,arguments))}),l.attempt(function(){u.apply(t,c)})}.bind(t,s),t[i].options=e}}});var HO=P((Iq,qO)=>{qO.exports=FO()});var Zh=P((Pq,Gh)=>{"use strict";var $$=HO(),L$=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Vh=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},U$=(t,e,n)=>{let r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},z$=t=>L$.includes(t),VO=(t,e)=>new Promise((n,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};let a=$$.operation(e);a.attempt(async i=>{try{n(await t(i))}catch(s){if(!(s instanceof Error)){r(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof Vh)a.stop(),r(s.originalError);else if(s instanceof TypeError&&!z$(s.message))a.stop(),r(s);else{U$(s,i,e);try{await e.onFailedAttempt(s)}catch(o){r(o);return}a.retry(s)||r(a.mainError())}}})});Gh.exports=VO;Gh.exports.default=VO;Gh.exports.AbortError=Vh});var YO=P((Hq,Aw)=>{"use strict";var V$=Object.prototype.hasOwnProperty,Yt="~";function Kf(){}Object.create&&(Kf.prototype=Object.create(null),new Kf().__proto__||(Yt=!1));function G$(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function KO(t,e,n,r,a){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new G$(n,r||t,a),s=Yt?Yt+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],i]:t._events[s].push(i):(t._events[s]=i,t._eventsCount++),t}function Xh(t,e){--t._eventsCount===0?t._events=new Kf:delete t._events[e]}function Ut(){this._events=new Kf,this._eventsCount=0}Ut.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)V$.call(n,r)&&e.push(Yt?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};Ut.prototype.listeners=function(e){var n=Yt?Yt+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,i=r.length,s=new Array(i);a<i;a++)s[a]=r[a].fn;return s};Ut.prototype.listenerCount=function(e){var n=Yt?Yt+e:e,r=this._events[n];return r?r.fn?1:r.length:0};Ut.prototype.emit=function(e,n,r,a,i,s){var o=Yt?Yt+e:e;if(!this._events[o])return!1;var u=this._events[o],l=arguments.length,c,f;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,n),!0;case 3:return u.fn.call(u.context,n,r),!0;case 4:return u.fn.call(u.context,n,r,a),!0;case 5:return u.fn.call(u.context,n,r,a,i),!0;case 6:return u.fn.call(u.context,n,r,a,i,s),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];u.fn.apply(u.context,c)}else{var d=u.length,p;for(f=0;f<d;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),l){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,n);break;case 3:u[f].fn.call(u[f].context,n,r);break;case 4:u[f].fn.call(u[f].context,n,r,a);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];u[f].fn.apply(u[f].context,c)}}return!0};Ut.prototype.on=function(e,n,r){return KO(this,e,n,r,!1)};Ut.prototype.once=function(e,n,r){return KO(this,e,n,r,!0)};Ut.prototype.removeListener=function(e,n,r,a){var i=Yt?Yt+e:e;if(!this._events[i])return this;if(!n)return Xh(this,i),this;var s=this._events[i];if(s.fn)s.fn===n&&(!a||s.once)&&(!r||s.context===r)&&Xh(this,i);else{for(var o=0,u=[],l=s.length;o<l;o++)(s[o].fn!==n||a&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[i]=u.length===1?u[0]:u:Xh(this,i)}return this};Ut.prototype.removeAllListeners=function(e){var n;return e?(n=Yt?Yt+e:e,this._events[n]&&Xh(this,n)):(this._events=new Kf,this._eventsCount=0),this};Ut.prototype.off=Ut.prototype.removeListener;Ut.prototype.addListener=Ut.prototype.on;Ut.prefixed=Yt;Ut.EventEmitter=Ut;typeof Aw!="undefined"&&(Aw.exports=Ut)});var XO=P((Vq,JO)=>{"use strict";JO.exports=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(r=>{r(e())}).then(()=>n),n=>new Promise(r=>{r(e())}).then(()=>{throw n})))});var WO=P((Gq,Wh)=>{"use strict";var Z$=XO(),Qh=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},QO=(t,e,n)=>new Promise((r,a)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(t);return}let i=setTimeout(()=>{if(typeof n=="function"){try{r(n())}catch(u){a(u)}return}let s=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,o=n instanceof Error?n:new Qh(s);typeof t.cancel=="function"&&t.cancel(),a(o)},e);Z$(t.then(r,a),()=>{clearTimeout(i)})});Wh.exports=QO;Wh.exports.default=QO;Wh.exports.TimeoutError=Qh});var e1=P(Tw=>{"use strict";Object.defineProperty(Tw,"__esModule",{value:!0});function K$(t,e,n){let r=0,a=t.length;for(;a>0;){let i=a/2|0,s=r+i;n(t[s],e)<=0?(r=++s,a-=i+1):a=i}return r}Tw.default=K$});var t1=P(Ow=>{"use strict";Object.defineProperty(Ow,"__esModule",{value:!0});var Y$=e1(),Ew=class{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);let r={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(r);return}let a=Y$.default(this._queue,r,(i,s)=>s.priority-i.priority);this._queue.splice(a,0,r)}dequeue(){let e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}};Ow.default=Ew});var tm=P(Cw=>{"use strict";Object.defineProperty(Cw,"__esModule",{value:!0});var J$=YO(),n1=WO(),X$=t1(),em=()=>{},Q$=new n1.TimeoutError,Rw=class extends J${constructor(e){var n,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=em,this._resolveIdle=em,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:X$.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(a=e.interval)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=em,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=em,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((r,a)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let s=this._timeout===void 0&&n.timeout===void 0?e():n1.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&a(Q$)});r(await s)}catch(s){a(s)}this._next()};this._queue.enqueue(i,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async r=>this.add(r,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Cw.default=Rw});var Jf=P((rH,i1)=>{var rL="2.0.0",aL=Number.MAX_SAFE_INTEGER||9007199254740991,iL=16,sL=250,oL=["major","premajor","minor","preminor","patch","prepatch","prerelease"];i1.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:iL,MAX_SAFE_BUILD_LENGTH:sL,MAX_SAFE_INTEGER:aL,RELEASE_TYPES:oL,SEMVER_SPEC_VERSION:rL,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Xf=P((aH,s1)=>{var uL=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};s1.exports=uL});var ql=P((ta,o1)=>{var{MAX_SAFE_COMPONENT_LENGTH:Nw,MAX_SAFE_BUILD_LENGTH:lL,MAX_LENGTH:cL}=Jf(),fL=Xf();ta=o1.exports={};var dL=ta.re=[],pL=ta.safeRe=[],$=ta.src=[],hL=ta.safeSrc=[],L=ta.t={},mL=0,kw="[a-zA-Z0-9-]",gL=[["\\s",1],["\\d",cL],[kw,lL]],yL=t=>{for(let[e,n]of gL)t=t.split(`${e}*`).join(`${e}{0,${n}}`).split(`${e}+`).join(`${e}{1,${n}}`);return t},ae=(t,e,n)=>{let r=yL(e),a=mL++;fL(t,a,e),L[t]=a,$[a]=e,hL[a]=r,dL[a]=new RegExp(e,n?"g":void 0),pL[a]=new RegExp(r,n?"g":void 0)};ae("NUMERICIDENTIFIER","0|[1-9]\\d*");ae("NUMERICIDENTIFIERLOOSE","\\d+");ae("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${kw}*`);ae("MAINVERSION",`(${$[L.NUMERICIDENTIFIER]})\\.(${$[L.NUMERICIDENTIFIER]})\\.(${$[L.NUMERICIDENTIFIER]})`);ae("MAINVERSIONLOOSE",`(${$[L.NUMERICIDENTIFIERLOOSE]})\\.(${$[L.NUMERICIDENTIFIERLOOSE]})\\.(${$[L.NUMERICIDENTIFIERLOOSE]})`);ae("PRERELEASEIDENTIFIER",`(?:${$[L.NUMERICIDENTIFIER]}|${$[L.NONNUMERICIDENTIFIER]})`);ae("PRERELEASEIDENTIFIERLOOSE",`(?:${$[L.NUMERICIDENTIFIERLOOSE]}|${$[L.NONNUMERICIDENTIFIER]})`);ae("PRERELEASE",`(?:-(${$[L.PRERELEASEIDENTIFIER]}(?:\\.${$[L.PRERELEASEIDENTIFIER]})*))`);ae("PRERELEASELOOSE",`(?:-?(${$[L.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${$[L.PRERELEASEIDENTIFIERLOOSE]})*))`);ae("BUILDIDENTIFIER",`${kw}+`);ae("BUILD",`(?:\\+(${$[L.BUILDIDENTIFIER]}(?:\\.${$[L.BUILDIDENTIFIER]})*))`);ae("FULLPLAIN",`v?${$[L.MAINVERSION]}${$[L.PRERELEASE]}?${$[L.BUILD]}?`);ae("FULL",`^${$[L.FULLPLAIN]}$`);ae("LOOSEPLAIN",`[v=\\s]*${$[L.MAINVERSIONLOOSE]}${$[L.PRERELEASELOOSE]}?${$[L.BUILD]}?`);ae("LOOSE",`^${$[L.LOOSEPLAIN]}$`);ae("GTLT","((?:<|>)?=?)");ae("XRANGEIDENTIFIERLOOSE",`${$[L.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);ae("XRANGEIDENTIFIER",`${$[L.NUMERICIDENTIFIER]}|x|X|\\*`);ae("XRANGEPLAIN",`[v=\\s]*(${$[L.XRANGEIDENTIFIER]})(?:\\.(${$[L.XRANGEIDENTIFIER]})(?:\\.(${$[L.XRANGEIDENTIFIER]})(?:${$[L.PRERELEASE]})?${$[L.BUILD]}?)?)?`);ae("XRANGEPLAINLOOSE",`[v=\\s]*(${$[L.XRANGEIDENTIFIERLOOSE]})(?:\\.(${$[L.XRANGEIDENTIFIERLOOSE]})(?:\\.(${$[L.XRANGEIDENTIFIERLOOSE]})(?:${$[L.PRERELEASELOOSE]})?${$[L.BUILD]}?)?)?`);ae("XRANGE",`^${$[L.GTLT]}\\s*${$[L.XRANGEPLAIN]}$`);ae("XRANGELOOSE",`^${$[L.GTLT]}\\s*${$[L.XRANGEPLAINLOOSE]}$`);ae("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Nw}})(?:\\.(\\d{1,${Nw}}))?(?:\\.(\\d{1,${Nw}}))?`);ae("COERCE",`${$[L.COERCEPLAIN]}(?:$|[^\\d])`);ae("COERCEFULL",$[L.COERCEPLAIN]+`(?:${$[L.PRERELEASE]})?(?:${$[L.BUILD]})?(?:$|[^\\d])`);ae("COERCERTL",$[L.COERCE],!0);ae("COERCERTLFULL",$[L.COERCEFULL],!0);ae("LONETILDE","(?:~>?)");ae("TILDETRIM",`(\\s*)${$[L.LONETILDE]}\\s+`,!0);ta.tildeTrimReplace="$1~";ae("TILDE",`^${$[L.LONETILDE]}${$[L.XRANGEPLAIN]}$`);ae("TILDELOOSE",`^${$[L.LONETILDE]}${$[L.XRANGEPLAINLOOSE]}$`);ae("LONECARET","(?:\\^)");ae("CARETTRIM",`(\\s*)${$[L.LONECARET]}\\s+`,!0);ta.caretTrimReplace="$1^";ae("CARET",`^${$[L.LONECARET]}${$[L.XRANGEPLAIN]}$`);ae("CARETLOOSE",`^${$[L.LONECARET]}${$[L.XRANGEPLAINLOOSE]}$`);ae("COMPARATORLOOSE",`^${$[L.GTLT]}\\s*(${$[L.LOOSEPLAIN]})$|^$`);ae("COMPARATOR",`^${$[L.GTLT]}\\s*(${$[L.FULLPLAIN]})$|^$`);ae("COMPARATORTRIM",`(\\s*)${$[L.GTLT]}\\s*(${$[L.LOOSEPLAIN]}|${$[L.XRANGEPLAIN]})`,!0);ta.comparatorTrimReplace="$1$2$3";ae("HYPHENRANGE",`^\\s*(${$[L.XRANGEPLAIN]})\\s+-\\s+(${$[L.XRANGEPLAIN]})\\s*$`);ae("HYPHENRANGELOOSE",`^\\s*(${$[L.XRANGEPLAINLOOSE]})\\s+-\\s+(${$[L.XRANGEPLAINLOOSE]})\\s*$`);ae("STAR","(<|>)?=?\\s*\\*");ae("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");ae("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var am=P((iH,u1)=>{var bL=Object.freeze({loose:!0}),_L=Object.freeze({}),wL=t=>t?typeof t!="object"?bL:t:_L;u1.exports=wL});var Dw=P((sH,f1)=>{var l1=/^[0-9]+$/,c1=(t,e)=>{let n=l1.test(t),r=l1.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1},vL=(t,e)=>c1(e,t);f1.exports={compareIdentifiers:c1,rcompareIdentifiers:vL}});var zt=P((oH,m1)=>{var im=Xf(),{MAX_LENGTH:d1,MAX_SAFE_INTEGER:sm}=Jf(),{safeRe:p1,safeSrc:h1,t:om}=ql(),SL=am(),{compareIdentifiers:Hl}=Dw(),jw=class t{constructor(e,n){if(n=SL(n),e instanceof t){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>d1)throw new TypeError(`version is longer than ${d1} characters`);im("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;let r=e.trim().match(n.loose?p1[om.LOOSE]:p1[om.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>sm||this.major<0)throw new TypeError("Invalid major version");if(this.minor>sm||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>sm||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(a=>{if(/^[0-9]+$/.test(a)){let i=+a;if(i>=0&&i<sm)return i}return a}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(im("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),Hl(this.major,e.major)||Hl(this.minor,e.minor)||Hl(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{let r=this.prerelease[n],a=e.prerelease[n];if(im("prerelease compare",n,r,a),r===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(r===void 0)return-1;if(r===a)continue;return Hl(r,a)}while(++n)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let n=0;do{let r=this.build[n],a=e.build[n];if(im("build compare",n,r,a),r===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(r===void 0)return-1;if(r===a)continue;return Hl(r,a)}while(++n)}inc(e,n,r){if(e.startsWith("pre")){if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(n){let a=new RegExp(`^${this.options.loose?h1[om.PRERELEASELOOSE]:h1[om.PRERELEASE]}$`),i=`-${n}`.match(a);if(!i||i[1]!==n)throw new Error(`invalid identifier: ${n}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let a=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[a];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(a)}}if(n){let i=[n,a];r===!1&&(i=[n]),Hl(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};m1.exports=jw});var Co=P((uH,y1)=>{var g1=zt(),xL=(t,e,n=!1)=>{if(t instanceof g1)return t;try{return new g1(t,e)}catch(r){if(!n)return null;throw r}};y1.exports=xL});var _1=P((lH,b1)=>{var AL=Co(),TL=(t,e)=>{let n=AL(t,e);return n?n.version:null};b1.exports=TL});var v1=P((cH,w1)=>{var EL=Co(),OL=(t,e)=>{let n=EL(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};w1.exports=OL});var A1=P((fH,x1)=>{var S1=zt(),RL=(t,e,n,r,a)=>{typeof n=="string"&&(a=r,r=n,n=void 0);try{return new S1(t instanceof S1?t.version:t,n).inc(e,r,a).version}catch(i){return null}};x1.exports=RL});var O1=P((dH,E1)=>{var T1=Co(),CL=(t,e)=>{let n=T1(t,null,!0),r=T1(e,null,!0),a=n.compare(r);if(a===0)return null;let i=a>0,s=i?n:r,o=i?r:n,u=!!s.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(s)===0)return o.minor&&!o.patch?"minor":"patch"}let c=u?"pre":"";return n.major!==r.major?c+"major":n.minor!==r.minor?c+"minor":n.patch!==r.patch?c+"patch":"prerelease"};E1.exports=CL});var C1=P((pH,R1)=>{var IL=zt(),PL=(t,e)=>new IL(t,e).major;R1.exports=PL});var P1=P((hH,I1)=>{var NL=zt(),kL=(t,e)=>new NL(t,e).minor;I1.exports=kL});var k1=P((mH,N1)=>{var DL=zt(),jL=(t,e)=>new DL(t,e).patch;N1.exports=jL});var j1=P((gH,D1)=>{var ML=Co(),$L=(t,e)=>{let n=ML(t,e);return n&&n.prerelease.length?n.prerelease:null};D1.exports=$L});var tr=P((yH,$1)=>{var M1=zt(),LL=(t,e,n)=>new M1(t,n).compare(new M1(e,n));$1.exports=LL});var U1=P((bH,L1)=>{var UL=tr(),zL=(t,e,n)=>UL(e,t,n);L1.exports=zL});var B1=P((_H,z1)=>{var BL=tr(),FL=(t,e)=>BL(t,e,!0);z1.exports=FL});var um=P((wH,q1)=>{var F1=zt(),qL=(t,e,n)=>{let r=new F1(t,n),a=new F1(e,n);return r.compare(a)||r.compareBuild(a)};q1.exports=qL});var V1=P((vH,H1)=>{var HL=um(),VL=(t,e)=>t.sort((n,r)=>HL(n,r,e));H1.exports=VL});var Z1=P((SH,G1)=>{var GL=um(),ZL=(t,e)=>t.sort((n,r)=>GL(r,n,e));G1.exports=ZL});var Qf=P((xH,K1)=>{var KL=tr(),YL=(t,e,n)=>KL(t,e,n)>0;K1.exports=YL});var lm=P((AH,Y1)=>{var JL=tr(),XL=(t,e,n)=>JL(t,e,n)<0;Y1.exports=XL});var Mw=P((TH,J1)=>{var QL=tr(),WL=(t,e,n)=>QL(t,e,n)===0;J1.exports=WL});var $w=P((EH,X1)=>{var e4=tr(),t4=(t,e,n)=>e4(t,e,n)!==0;X1.exports=t4});var cm=P((OH,Q1)=>{var n4=tr(),r4=(t,e,n)=>n4(t,e,n)>=0;Q1.exports=r4});var fm=P((RH,W1)=>{var a4=tr(),i4=(t,e,n)=>a4(t,e,n)<=0;W1.exports=i4});var Lw=P((CH,eR)=>{var s4=Mw(),o4=$w(),u4=Qf(),l4=cm(),c4=lm(),f4=fm(),d4=(t,e,n,r)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return s4(t,n,r);case"!=":return o4(t,n,r);case">":return u4(t,n,r);case">=":return l4(t,n,r);case"<":return c4(t,n,r);case"<=":return f4(t,n,r);default:throw new TypeError(`Invalid operator: ${e}`)}};eR.exports=d4});var nR=P((IH,tR)=>{var p4=zt(),h4=Co(),{safeRe:dm,t:pm}=ql(),m4=(t,e)=>{if(t instanceof p4)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let n=null;if(!e.rtl)n=t.match(e.includePrerelease?dm[pm.COERCEFULL]:dm[pm.COERCE]);else{let u=e.includePrerelease?dm[pm.COERCERTLFULL]:dm[pm.COERCERTL],l;for(;(l=u.exec(t))&&(!n||n.index+n[0].length!==t.length);)(!n||l.index+l[0].length!==n.index+n[0].length)&&(n=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(n===null)return null;let r=n[2],a=n[3]||"0",i=n[4]||"0",s=e.includePrerelease&&n[5]?`-${n[5]}`:"",o=e.includePrerelease&&n[6]?`+${n[6]}`:"";return h4(`${r}.${a}.${i}${s}${o}`,e)};tR.exports=m4});var aR=P((PH,rR)=>{var Uw=class{constructor(){this.max=1e3,this.map=new Map}get(e){let n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){let a=this.map.keys().next().value;this.delete(a)}this.map.set(e,n)}return this}};rR.exports=Uw});var nr=P((NH,uR)=>{var g4=/\s+/g,zw=class t{constructor(e,n){if(n=b4(n),e instanceof t)return e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease?e:new t(e.raw,n);if(e instanceof Bw)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=e.trim().replace(g4," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(a=>!sR(a[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let a of this.set)if(a.length===1&&T4(a[0])){this.set=[a];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let n=this.set[e];for(let r=0;r<n.length;r++)r>0&&(this.formatted+=" "),this.formatted+=n[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&x4)|(this.options.loose&&A4))+":"+e,a=iR.get(r);if(a)return a;let i=this.options.loose,s=i?pn[Jt.HYPHENRANGELOOSE]:pn[Jt.HYPHENRANGE];e=e.replace(s,j4(this.options.includePrerelease)),$e("hyphen replace",e),e=e.replace(pn[Jt.COMPARATORTRIM],w4),$e("comparator trim",e),e=e.replace(pn[Jt.TILDETRIM],v4),$e("tilde trim",e),e=e.replace(pn[Jt.CARETTRIM],S4),$e("caret trim",e);let o=e.split(" ").map(f=>E4(f,this.options)).join(" ").split(/\s+/).map(f=>D4(f,this.options));i&&(o=o.filter(f=>($e("loose invalid filter",f,this.options),!!f.match(pn[Jt.COMPARATORLOOSE])))),$e("range list",o);let u=new Map,l=o.map(f=>new Bw(f,this.options));for(let f of l){if(sR(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");let c=[...u.values()];return iR.set(r,c),c}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(r=>oR(r,n)&&e.set.some(a=>oR(a,n)&&r.every(i=>a.every(s=>i.intersects(s,n)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new _4(e,this.options)}catch(n){return!1}for(let n=0;n<this.set.length;n++)if(M4(this.set[n],e,this.options))return!0;return!1}};uR.exports=zw;var y4=aR(),iR=new y4,b4=am(),Bw=Wf(),$e=Xf(),_4=zt(),{safeRe:pn,t:Jt,comparatorTrimReplace:w4,tildeTrimReplace:v4,caretTrimReplace:S4}=ql(),{FLAG_INCLUDE_PRERELEASE:x4,FLAG_LOOSE:A4}=Jf(),sR=t=>t.value==="<0.0.0-0",T4=t=>t.value==="",oR=(t,e)=>{let n=!0,r=t.slice(),a=r.pop();for(;n&&r.length;)n=r.every(i=>a.intersects(i,e)),a=r.pop();return n},E4=(t,e)=>($e("comp",t,e),t=C4(t,e),$e("caret",t),t=O4(t,e),$e("tildes",t),t=P4(t,e),$e("xrange",t),t=k4(t,e),$e("stars",t),t),Xt=t=>!t||t.toLowerCase()==="x"||t==="*",O4=(t,e)=>t.trim().split(/\s+/).map(n=>R4(n,e)).join(" "),R4=(t,e)=>{let n=e.loose?pn[Jt.TILDELOOSE]:pn[Jt.TILDE];return t.replace(n,(r,a,i,s,o)=>{$e("tilde",t,r,a,i,s,o);let u;return Xt(a)?u="":Xt(i)?u=`>=${a}.0.0 <${+a+1}.0.0-0`:Xt(s)?u=`>=${a}.${i}.0 <${a}.${+i+1}.0-0`:o?($e("replaceTilde pr",o),u=`>=${a}.${i}.${s}-${o} <${a}.${+i+1}.0-0`):u=`>=${a}.${i}.${s} <${a}.${+i+1}.0-0`,$e("tilde return",u),u})},C4=(t,e)=>t.trim().split(/\s+/).map(n=>I4(n,e)).join(" "),I4=(t,e)=>{$e("caret",t,e);let n=e.loose?pn[Jt.CARETLOOSE]:pn[Jt.CARET],r=e.includePrerelease?"-0":"";return t.replace(n,(a,i,s,o,u)=>{$e("caret",t,a,i,s,o,u);let l;return Xt(i)?l="":Xt(s)?l=`>=${i}.0.0${r} <${+i+1}.0.0-0`:Xt(o)?i==="0"?l=`>=${i}.${s}.0${r} <${i}.${+s+1}.0-0`:l=`>=${i}.${s}.0${r} <${+i+1}.0.0-0`:u?($e("replaceCaret pr",u),i==="0"?s==="0"?l=`>=${i}.${s}.${o}-${u} <${i}.${s}.${+o+1}-0`:l=`>=${i}.${s}.${o}-${u} <${i}.${+s+1}.0-0`:l=`>=${i}.${s}.${o}-${u} <${+i+1}.0.0-0`):($e("no pr"),i==="0"?s==="0"?l=`>=${i}.${s}.${o}${r} <${i}.${s}.${+o+1}-0`:l=`>=${i}.${s}.${o}${r} <${i}.${+s+1}.0-0`:l=`>=${i}.${s}.${o} <${+i+1}.0.0-0`),$e("caret return",l),l})},P4=(t,e)=>($e("replaceXRanges",t,e),t.split(/\s+/).map(n=>N4(n,e)).join(" ")),N4=(t,e)=>{t=t.trim();let n=e.loose?pn[Jt.XRANGELOOSE]:pn[Jt.XRANGE];return t.replace(n,(r,a,i,s,o,u)=>{$e("xRange",t,r,a,i,s,o,u);let l=Xt(i),c=l||Xt(s),f=c||Xt(o),d=f;return a==="="&&d&&(a=""),u=e.includePrerelease?"-0":"",l?a===">"||a==="<"?r="<0.0.0-0":r="*":a&&d?(c&&(s=0),o=0,a===">"?(a=">=",c?(i=+i+1,s=0,o=0):(s=+s+1,o=0)):a==="<="&&(a="<",c?i=+i+1:s=+s+1),a==="<"&&(u="-0"),r=`${a+i}.${s}.${o}${u}`):c?r=`>=${i}.0.0${u} <${+i+1}.0.0-0`:f&&(r=`>=${i}.${s}.0${u} <${i}.${+s+1}.0-0`),$e("xRange return",r),r})},k4=(t,e)=>($e("replaceStars",t,e),t.trim().replace(pn[Jt.STAR],"")),D4=(t,e)=>($e("replaceGTE0",t,e),t.trim().replace(pn[e.includePrerelease?Jt.GTE0PRE:Jt.GTE0],"")),j4=t=>(e,n,r,a,i,s,o,u,l,c,f,d)=>(Xt(r)?n="":Xt(a)?n=`>=${r}.0.0${t?"-0":""}`:Xt(i)?n=`>=${r}.${a}.0${t?"-0":""}`:s?n=`>=${n}`:n=`>=${n}${t?"-0":""}`,Xt(l)?u="":Xt(c)?u=`<${+l+1}.0.0-0`:Xt(f)?u=`<${l}.${+c+1}.0-0`:d?u=`<=${l}.${c}.${f}-${d}`:t?u=`<${l}.${c}.${+f+1}-0`:u=`<=${u}`,`${n} ${u}`.trim()),M4=(t,e,n)=>{for(let r=0;r<t.length;r++)if(!t[r].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let r=0;r<t.length;r++)if($e(t[r].semver),t[r].semver!==Bw.ANY&&t[r].semver.prerelease.length>0){let a=t[r].semver;if(a.major===e.major&&a.minor===e.minor&&a.patch===e.patch)return!0}return!1}return!0}});var Wf=P((kH,hR)=>{var ed=Symbol("SemVer ANY"),Hw=class t{static get ANY(){return ed}constructor(e,n){if(n=lR(n),e instanceof t){if(e.loose===!!n.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),qw("comparator",e,n),this.options=n,this.loose=!!n.loose,this.parse(e),this.semver===ed?this.value="":this.value=this.operator+this.semver.version,qw("comp",this)}parse(e){let n=this.options.loose?cR[fR.COMPARATORLOOSE]:cR[fR.COMPARATOR],r=e.match(n);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new dR(r[2],this.options.loose):this.semver=ed}toString(){return this.value}test(e){if(qw("Comparator.test",e,this.options.loose),this.semver===ed||e===ed)return!0;if(typeof e=="string")try{e=new dR(e,this.options)}catch(n){return!1}return Fw(e,this.operator,this.semver,this.options)}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new pR(e.value,n).test(this.value):e.operator===""?e.value===""?!0:new pR(this.value,n).test(e.semver):(n=lR(n),n.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!n.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Fw(this.semver,"<",e.semver,n)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Fw(this.semver,">",e.semver,n)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};hR.exports=Hw;var lR=am(),{safeRe:cR,t:fR}=ql(),Fw=Lw(),qw=Xf(),dR=zt(),pR=nr()});var td=P((DH,mR)=>{var $4=nr(),L4=(t,e,n)=>{try{e=new $4(e,n)}catch(r){return!1}return e.test(t)};mR.exports=L4});var yR=P((jH,gR)=>{var U4=nr(),z4=(t,e)=>new U4(t,e).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));gR.exports=z4});var _R=P((MH,bR)=>{var B4=zt(),F4=nr(),q4=(t,e,n)=>{let r=null,a=null,i=null;try{i=new F4(e,n)}catch(s){return null}return t.forEach(s=>{i.test(s)&&(!r||a.compare(s)===-1)&&(r=s,a=new B4(r,n))}),r};bR.exports=q4});var vR=P(($H,wR)=>{var H4=zt(),V4=nr(),G4=(t,e,n)=>{let r=null,a=null,i=null;try{i=new V4(e,n)}catch(s){return null}return t.forEach(s=>{i.test(s)&&(!r||a.compare(s)===1)&&(r=s,a=new H4(r,n))}),r};wR.exports=G4});var AR=P((LH,xR)=>{var Vw=zt(),Z4=nr(),SR=Qf(),K4=(t,e)=>{t=new Z4(t,e);let n=new Vw("0.0.0");if(t.test(n)||(n=new Vw("0.0.0-0"),t.test(n)))return n;n=null;for(let r=0;r<t.set.length;++r){let a=t.set[r],i=null;a.forEach(s=>{let o=new Vw(s.semver.version);switch(s.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||SR(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${s.operator}`)}}),i&&(!n||SR(n,i))&&(n=i)}return n&&t.test(n)?n:null};xR.exports=K4});var ER=P((UH,TR)=>{var Y4=nr(),J4=(t,e)=>{try{return new Y4(t,e).range||"*"}catch(n){return null}};TR.exports=J4});var hm=P((zH,IR)=>{var X4=zt(),CR=Wf(),{ANY:Q4}=CR,W4=nr(),eU=td(),OR=Qf(),RR=lm(),tU=fm(),nU=cm(),rU=(t,e,n,r)=>{t=new X4(t,r),e=new W4(e,r);let a,i,s,o,u;switch(n){case">":a=OR,i=tU,s=RR,o=">",u=">=";break;case"<":a=RR,i=nU,s=OR,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(eU(t,e,r))return!1;for(let l=0;l<e.set.length;++l){let c=e.set[l],f=null,d=null;if(c.forEach(p=>{p.semver===Q4&&(p=new CR(">=0.0.0")),f=f||p,d=d||p,a(p.semver,f.semver,r)?f=p:s(p.semver,d.semver,r)&&(d=p)}),f.operator===o||f.operator===u||(!d.operator||d.operator===o)&&i(t,d.semver))return!1;if(d.operator===u&&s(t,d.semver))return!1}return!0};IR.exports=rU});var NR=P((BH,PR)=>{var aU=hm(),iU=(t,e,n)=>aU(t,e,">",n);PR.exports=iU});var DR=P((FH,kR)=>{var sU=hm(),oU=(t,e,n)=>sU(t,e,"<",n);kR.exports=oU});var $R=P((qH,MR)=>{var jR=nr(),uU=(t,e,n)=>(t=new jR(t,n),e=new jR(e,n),t.intersects(e,n));MR.exports=uU});var UR=P((HH,LR)=>{var lU=td(),cU=tr();LR.exports=(t,e,n)=>{let r=[],a=null,i=null,s=t.sort((c,f)=>cU(c,f,n));for(let c of s)lU(c,e,n)?(i=c,a||(a=c)):(i&&r.push([a,i]),i=null,a=null);a&&r.push([a,null]);let o=[];for(let[c,f]of r)c===f?o.push(c):!f&&c===s[0]?o.push("*"):f?c===s[0]?o.push(`<=${f}`):o.push(`${c} - ${f}`):o.push(`>=${c}`);let u=o.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return u.length<l.length?u:e}});var VR=P((VH,HR)=>{var zR=nr(),Zw=Wf(),{ANY:Gw}=Zw,nd=td(),Kw=tr(),fU=(t,e,n={})=>{if(t===e)return!0;t=new zR(t,n),e=new zR(e,n);let r=!1;e:for(let a of t.set){for(let i of e.set){let s=pU(a,i,n);if(r=r||s!==null,s)continue e}if(r)return!1}return!0},dU=[new Zw(">=0.0.0-0")],BR=[new Zw(">=0.0.0")],pU=(t,e,n)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Gw){if(e.length===1&&e[0].semver===Gw)return!0;n.includePrerelease?t=dU:t=BR}if(e.length===1&&e[0].semver===Gw){if(n.includePrerelease)return!0;e=BR}let r=new Set,a,i;for(let p of t)p.operator===">"||p.operator===">="?a=FR(a,p,n):p.operator==="<"||p.operator==="<="?i=qR(i,p,n):r.add(p.semver);if(r.size>1)return null;let s;if(a&&i){if(s=Kw(a.semver,i.semver,n),s>0)return null;if(s===0&&(a.operator!==">="||i.operator!=="<="))return null}for(let p of r){if(a&&!nd(p,String(a),n)||i&&!nd(p,String(i),n))return null;for(let g of e)if(!nd(p,String(g),n))return!1;return!0}let o,u,l,c,f=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1,d=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:!1;f&&f.prerelease.length===1&&i.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(let p of e){if(c=c||p.operator===">"||p.operator===">=",l=l||p.operator==="<"||p.operator==="<=",a){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator===">"||p.operator===">="){if(o=FR(a,p,n),o===p&&o!==a)return!1}else if(a.operator===">="&&!nd(a.semver,String(p),n))return!1}if(i){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator==="<"||p.operator==="<="){if(u=qR(i,p,n),u===p&&u!==i)return!1}else if(i.operator==="<="&&!nd(i.semver,String(p),n))return!1}if(!p.operator&&(i||a)&&s!==0)return!1}return!(a&&l&&!i&&s!==0||i&&c&&!a&&s!==0||d||f)},FR=(t,e,n)=>{if(!t)return e;let r=Kw(t.semver,e.semver,n);return r>0?t:r<0||e.operator===">"&&t.operator===">="?e:t},qR=(t,e,n)=>{if(!t)return e;let r=Kw(t.semver,e.semver,n);return r<0?t:r>0||e.operator==="<"&&t.operator==="<="?e:t};HR.exports=fU});var YR=P((GH,KR)=>{var Yw=ql(),GR=Jf(),hU=zt(),ZR=Dw(),mU=Co(),gU=_1(),yU=v1(),bU=A1(),_U=O1(),wU=C1(),vU=P1(),SU=k1(),xU=j1(),AU=tr(),TU=U1(),EU=B1(),OU=um(),RU=V1(),CU=Z1(),IU=Qf(),PU=lm(),NU=Mw(),kU=$w(),DU=cm(),jU=fm(),MU=Lw(),$U=nR(),LU=Wf(),UU=nr(),zU=td(),BU=yR(),FU=_R(),qU=vR(),HU=AR(),VU=ER(),GU=hm(),ZU=NR(),KU=DR(),YU=$R(),JU=UR(),XU=VR();KR.exports={parse:mU,valid:gU,clean:yU,inc:bU,diff:_U,major:wU,minor:vU,patch:SU,prerelease:xU,compare:AU,rcompare:TU,compareLoose:EU,compareBuild:OU,sort:RU,rsort:CU,gt:IU,lt:PU,eq:NU,neq:kU,gte:DU,lte:jU,cmp:MU,coerce:$U,Comparator:LU,Range:UU,satisfies:zU,toComparators:BU,maxSatisfying:FU,minSatisfying:qU,minVersion:HU,validRange:VU,outside:GU,gtr:ZU,ltr:KU,intersects:YU,simplifyRange:JU,subset:XU,SemVer:hU,re:Yw.re,src:Yw.src,tokens:Yw.t,SEMVER_SPEC_VERSION:GR.SEMVER_SPEC_VERSION,RELEASE_TYPES:GR.RELEASE_TYPES,compareIdentifiers:ZR.compareIdentifiers,rcompareIdentifiers:ZR.rcompareIdentifiers}});var mC=P((V7,hC)=>{"use strict";var dC=(t=0)=>e=>`\x1B[${38+t};5;${e}m`,pC=(t=0)=>(e,n,r)=>`\x1B[${38+t};2;${e};${n};${r}m`;function N3(){let t=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[n,r]of Object.entries(e)){for(let[a,i]of Object.entries(r))e[a]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},r[a]=e[a],t.set(i[0],i[1]);Object.defineProperty(e,n,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:t,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=dC(),e.color.ansi16m=pC(),e.bgColor.ansi256=dC(10),e.bgColor.ansi16m=pC(10),Object.defineProperties(e,{rgbToAnsi256:{value:(n,r,a)=>n===r&&r===a?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(r/255*5)+Math.round(a/255*5),enumerable:!1},hexToRgb:{value:n=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(n.toString(16));if(!r)return[0,0,0];let{colorString:a}=r.groups;a.length===3&&(a=a.split("").map(s=>s+s).join(""));let i=Number.parseInt(a,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:n=>e.rgbToAnsi256(...e.hexToRgb(n)),enumerable:!1}}),e}Object.defineProperty(hC,"exports",{enumerable:!0,get:N3})});var bI=P(Wm=>{"use strict";Wm.byteLength=s9;Wm.toByteArray=u9;Wm.fromByteArray=f9;var sa=[],sr=[],i9=typeof Uint8Array!="undefined"?Uint8Array:Array,Nv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(jo=0,gI=Nv.length;jo<gI;++jo)sa[jo]=Nv[jo],sr[Nv.charCodeAt(jo)]=jo;var jo,gI;sr[45]=62;sr[95]=63;function yI(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function s9(t){var e=yI(t),n=e[0],r=e[1];return(n+r)*3/4-r}function o9(t,e,n){return(e+n)*3/4-n}function u9(t){var e,n=yI(t),r=n[0],a=n[1],i=new i9(o9(t,r,a)),s=0,o=a>0?r-4:r,u;for(u=0;u<o;u+=4)e=sr[t.charCodeAt(u)]<<18|sr[t.charCodeAt(u+1)]<<12|sr[t.charCodeAt(u+2)]<<6|sr[t.charCodeAt(u+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=e&255;return a===2&&(e=sr[t.charCodeAt(u)]<<2|sr[t.charCodeAt(u+1)]>>4,i[s++]=e&255),a===1&&(e=sr[t.charCodeAt(u)]<<10|sr[t.charCodeAt(u+1)]<<4|sr[t.charCodeAt(u+2)]>>2,i[s++]=e>>8&255,i[s++]=e&255),i}function l9(t){return sa[t>>18&63]+sa[t>>12&63]+sa[t>>6&63]+sa[t&63]}function c9(t,e,n){for(var r,a=[],i=e;i<n;i+=3)r=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(t[i+2]&255),a.push(l9(r));return a.join("")}function f9(t){for(var e,n=t.length,r=n%3,a=[],i=16383,s=0,o=n-r;s<o;s+=i)a.push(c9(t,s,s+i>o?o:s+i));return r===1?(e=t[n-1],a.push(sa[e>>2]+sa[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],a.push(sa[e>>10]+sa[e>>4&63]+sa[e<<2&63]+"=")),a.join("")}});var EP=P(fg=>{"use strict";var gz=Symbol.for("react.transitional.element"),yz=Symbol.for("react.fragment");function TP(t,e,n){var r=null;if(n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),"key"in e){n={};for(var a in e)a!=="key"&&(n[a]=e[a])}else n=e;return e=n.ref,{$$typeof:gz,type:t,key:r,ref:e!==void 0?e:null,props:n}}fg.Fragment=yz;fg.jsx=TP;fg.jsxs=TP});var Oe=P((mre,OP)=>{"use strict";OP.exports=EP()});var Od={};Lg(Od,{__addDisposableResource:()=>_N,__assign:()=>mg,__asyncDelegator:()=>fN,__asyncGenerator:()=>cN,__asyncValues:()=>dN,__await:()=>oc,__awaiter:()=>aN,__classPrivateFieldGet:()=>gN,__classPrivateFieldIn:()=>bN,__classPrivateFieldSet:()=>yN,__createBinding:()=>yg,__decorate:()=>XP,__disposeResources:()=>wN,__esDecorate:()=>WP,__exportStar:()=>sN,__extends:()=>YP,__generator:()=>iN,__importDefault:()=>mN,__importStar:()=>hN,__makeTemplateObject:()=>pN,__metadata:()=>rN,__param:()=>QP,__propKey:()=>tN,__read:()=>a0,__rest:()=>JP,__rewriteRelativeImportExtension:()=>vN,__runInitializers:()=>eN,__setFunctionName:()=>nN,__spread:()=>oN,__spreadArray:()=>lN,__spreadArrays:()=>uN,__values:()=>gg,default:()=>Ez});function YP(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n0(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function JP(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function XP(t,e,n,r){var a=arguments.length,i=a<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(i=(a<3?s(i):a>3?s(e,n,i):s(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i}function QP(t,e){return function(n,r){e(n,r,t)}}function WP(t,e,n,r,a,i){function s(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&t?r.static?t:t.prototype:null,c=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),f,d=!1,p=n.length-1;p>=0;p--){var g={};for(var b in r)g[b]=b==="access"?{}:r[b];for(var b in r.access)g.access[b]=r.access[b];g.addInitializer=function(m){if(d)throw new TypeError("Cannot add initializers after decoration has completed");i.push(s(m||null))};var _=(0,n[p])(o==="accessor"?{get:c.get,set:c.set}:c[u],g);if(o==="accessor"){if(_===void 0)continue;if(_===null||typeof _!="object")throw new TypeError("Object expected");(f=s(_.get))&&(c.get=f),(f=s(_.set))&&(c.set=f),(f=s(_.init))&&a.unshift(f)}else(f=s(_))&&(o==="field"?a.unshift(f):c[u]=f)}l&&Object.defineProperty(l,r.name,c),d=!0}function eN(t,e,n){for(var r=arguments.length>2,a=0;a<e.length;a++)n=r?e[a].call(t,n):e[a].call(t);return r?n:void 0}function tN(t){return typeof t=="symbol"?t:"".concat(t)}function nN(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function rN(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function aN(t,e,n,r){function a(i){return i instanceof n?i:new n(function(s){s(i)})}return new(n||(n=Promise))(function(i,s){function o(c){try{l(r.next(c))}catch(f){s(f)}}function u(c){try{l(r.throw(c))}catch(f){s(f)}}function l(c){c.done?i(c.value):a(c.value).then(o,u)}l((r=r.apply(t,e||[])).next())})}function iN(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(n=0)),n;)try{if(r=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,a=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1],i=l;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(l);break}i[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(c){l=[6,c],a=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function sN(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&yg(e,t,n)}function gg(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function a0(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),a,i=[],s;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(o){s={error:o}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return i}function oN(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a0(arguments[e]));return t}function uN(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),a=0,e=0;e<n;e++)for(var i=arguments[e],s=0,o=i.length;s<o;s++,a++)r[a]=i[s];return r}function lN(t,e,n){if(n||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function oc(t){return this instanceof oc?(this.v=t,this):new oc(t)}function cN(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(p){return function(g){return Promise.resolve(g).then(p,f)}}function o(p,g){r[p]&&(a[p]=function(b){return new Promise(function(_,m){i.push([p,b,_,m])>1||u(p,b)})},g&&(a[p]=g(a[p])))}function u(p,g){try{l(r[p](g))}catch(b){d(i[0][3],b)}}function l(p){p.value instanceof oc?Promise.resolve(p.value.v).then(c,f):d(i[0][2],p)}function c(p){u("next",p)}function f(p){u("throw",p)}function d(p,g){p(g),i.shift(),i.length&&u(i[0][0],i[0][1])}}function fN(t){var e,n;return e={},r("next"),r("throw",function(a){throw a}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(a,i){e[a]=t[a]?function(s){return(n=!n)?{value:oc(t[a](s)),done:!1}:i?i(s):s}:i}}function dN(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof gg=="function"?gg(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(o,u){s=t[i](s),a(o,u,s.done,s.value)})}}function a(i,s,o,u){Promise.resolve(u).then(function(l){i({value:l,done:o})},s)}}function pN(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function hN(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=r0(t),r=0;r<n.length;r++)n[r]!=="default"&&yg(e,t,n[r]);return Az(e,t),e}function mN(t){return t&&t.__esModule?t:{default:t}}function gN(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function yN(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n}function bN(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function _N(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(a=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}function wN(t){function e(i){t.error=t.hasError?new Tz(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var n,r=0;function a(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(a);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(i).then(a,function(s){return e(s),a()})}else r|=1}catch(s){e(s)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}function vN(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,a,i,s){return r?e?".jsx":".js":a&&(!i||!s)?n:a+i+"."+s.toLowerCase()+"js"}):t}var n0,mg,yg,Az,r0,Tz,Ez,Rd=ik(()=>{n0=function(t,e){return n0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},n0(t,e)};mg=function(){return mg=Object.assign||function(e){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},mg.apply(this,arguments)};yg=Object.create?function(t,e,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};Az=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},r0=function(t){return r0=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},r0(t)};Tz=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};Ez={__extends:YP,__assign:mg,__rest:JP,__decorate:XP,__param:QP,__esDecorate:WP,__runInitializers:eN,__propKey:tN,__setFunctionName:nN,__metadata:rN,__awaiter:aN,__generator:iN,__createBinding:yg,__exportStar:sN,__values:gg,__read:a0,__spread:oN,__spreadArrays:uN,__spreadArray:lN,__await:oc,__asyncGenerator:cN,__asyncDelegator:fN,__asyncValues:dN,__makeTemplateObject:pN,__importStar:hN,__importDefault:mN,__classPrivateFieldGet:gN,__classPrivateFieldSet:yN,__classPrivateFieldIn:bN,__addDisposableResource:_N,__disposeResources:wN,__rewriteRelativeImportExtension:vN}});var uc=P(bg=>{"use strict";Object.defineProperty(bg,"__esModule",{value:!0});bg.WebmBase=void 0;var i0=class{constructor(e="Unknown",n=0){this.name=e,this.start=n}getType(){return"Unknown"}updateBySource(){}setSource(e){this.source=e,this.updateBySource()}updateByData(){}setData(e){this.data=e,this.updateByData()}getValue(){return this.data}setValue(e){this.setData(e)}};bg.WebmBase=i0});var wg=P(_g=>{"use strict";Object.defineProperty(_g,"__esModule",{value:!0});_g.SectionType=void 0;var SN;(function(t){t.Container="Container",t.Uint="Uint",t.Int="Int",t.Float="Float",t.String="String",t.Date="Date",t.Binary="Binary"})(SN||(_g.SectionType=SN={}))});var s0=P(vg=>{"use strict";Object.defineProperty(vg,"__esModule",{value:!0});vg.sections=void 0;var w=wg();vg.sections={172351395:{name:"EBML",type:w.SectionType.Container},646:{name:"EBMLVersion",type:w.SectionType.Uint},759:{name:"EBMLReadVersion",type:w.SectionType.Uint},754:{name:"EBMLMaxIDLength",type:w.SectionType.Uint},755:{name:"EBMLMaxSizeLength",type:w.SectionType.Uint},642:{name:"DocType",type:w.SectionType.String},647:{name:"DocTypeVersion",type:w.SectionType.Uint},645:{name:"DocTypeReadVersion",type:w.SectionType.Uint},108:{name:"Void",type:w.SectionType.Binary},63:{name:"CRC-32",type:w.SectionType.Binary},190023271:{name:"SignatureSlot",type:w.SectionType.Container},16010:{name:"SignatureAlgo",type:w.SectionType.Uint},16026:{name:"SignatureHash",type:w.SectionType.Uint},16037:{name:"SignaturePublicKey",type:w.SectionType.Binary},16053:{name:"Signature",type:w.SectionType.Binary},15963:{name:"SignatureElements",type:w.SectionType.Container},15995:{name:"SignatureElementList",type:w.SectionType.Container},9522:{name:"SignedElement",type:w.SectionType.Binary},139690087:{name:"Segment",type:w.SectionType.Container},21863284:{name:"SeekHead",type:w.SectionType.Container},3515:{name:"Seek",type:w.SectionType.Container},5035:{name:"SeekID",type:w.SectionType.Binary},5036:{name:"SeekPosition",type:w.SectionType.Uint},88713574:{name:"Info",type:w.SectionType.Container},13220:{name:"SegmentUID",type:w.SectionType.Binary},13188:{name:"SegmentFilename",type:w.SectionType.String},1882403:{name:"PrevUID",type:w.SectionType.Binary},1868715:{name:"PrevFilename",type:w.SectionType.String},2013475:{name:"NextUID",type:w.SectionType.Binary},1999803:{name:"NextFilename",type:w.SectionType.String},1092:{name:"SegmentFamily",type:w.SectionType.Binary},10532:{name:"ChapterTranslate",type:w.SectionType.Container},10748:{name:"ChapterTranslateEditionUID",type:w.SectionType.Uint},10687:{name:"ChapterTranslateCodec",type:w.SectionType.Uint},10661:{name:"ChapterTranslateID",type:w.SectionType.Binary},710577:{name:"TimecodeScale",type:w.SectionType.Uint},1161:{name:"Duration",type:w.SectionType.Float},1121:{name:"DateUTC",type:w.SectionType.Date},15273:{name:"Title",type:w.SectionType.String},3456:{name:"MuxingApp",type:w.SectionType.String},5953:{name:"WritingApp",type:w.SectionType.String},103:{name:"Timecode",type:w.SectionType.Uint},6228:{name:"SilentTracks",type:w.SectionType.Container},6359:{name:"SilentTrackNumber",type:w.SectionType.Uint},39:{name:"Position",type:w.SectionType.Uint},43:{name:"PrevSize",type:w.SectionType.Uint},35:{name:"SimpleBlock",type:w.SectionType.Binary},32:{name:"BlockGroup",type:w.SectionType.Container},33:{name:"Block",type:w.SectionType.Binary},34:{name:"BlockVirtual",type:w.SectionType.Binary},13729:{name:"BlockAdditions",type:w.SectionType.Container},38:{name:"BlockMore",type:w.SectionType.Container},110:{name:"BlockAddID",type:w.SectionType.Uint},37:{name:"BlockAdditional",type:w.SectionType.Binary},27:{name:"BlockDuration",type:w.SectionType.Uint},122:{name:"ReferencePriority",type:w.SectionType.Uint},123:{name:"ReferenceBlock",type:w.SectionType.Int},125:{name:"ReferenceVirtual",type:w.SectionType.Int},36:{name:"CodecState",type:w.SectionType.Binary},13730:{name:"DiscardPadding",type:w.SectionType.Int},14:{name:"Slices",type:w.SectionType.Container},104:{name:"TimeSlice",type:w.SectionType.Container},76:{name:"LaceNumber",type:w.SectionType.Uint},77:{name:"FrameNumber",type:w.SectionType.Uint},75:{name:"BlockAdditionID",type:w.SectionType.Uint},78:{name:"Delay",type:w.SectionType.Uint},79:{name:"SliceDuration",type:w.SectionType.Uint},72:{name:"ReferenceFrame",type:w.SectionType.Container},73:{name:"ReferenceOffset",type:w.SectionType.Uint},74:{name:"ReferenceTimeCode",type:w.SectionType.Uint},47:{name:"EncryptedBlock",type:w.SectionType.Binary},106212971:{name:"Tracks",type:w.SectionType.Container},46:{name:"TrackEntry",type:w.SectionType.Container},87:{name:"TrackNumber",type:w.SectionType.Uint},13253:{name:"TrackUID",type:w.SectionType.Uint},3:{name:"TrackType",type:w.SectionType.Uint},57:{name:"FlagEnabled",type:w.SectionType.Uint},8:{name:"FlagDefault",type:w.SectionType.Uint},5546:{name:"FlagForced",type:w.SectionType.Uint},28:{name:"FlagLacing",type:w.SectionType.Uint},11751:{name:"MinCache",type:w.SectionType.Uint},11768:{name:"MaxCache",type:w.SectionType.Uint},254851:{name:"DefaultDuration",type:w.SectionType.Uint},216698:{name:"DefaultDecodedFieldDuration",type:w.SectionType.Uint},209231:{name:"TrackTimecodeScale",type:w.SectionType.Float},4991:{name:"TrackOffset",type:w.SectionType.Int},5614:{name:"MaxBlockAdditionID",type:w.SectionType.Uint},4974:{name:"Name",type:w.SectionType.String},177564:{name:"Language",type:w.SectionType.String},6:{name:"CodecID",type:w.SectionType.String},9122:{name:"CodecPrivate",type:w.SectionType.Binary},362120:{name:"CodecName",type:w.SectionType.String},13382:{name:"AttachmentLink",type:w.SectionType.Uint},1742487:{name:"CodecSettings",type:w.SectionType.String},1785920:{name:"CodecInfoURL",type:w.SectionType.String},438848:{name:"CodecDownloadURL",type:w.SectionType.String},42:{name:"CodecDecodeAll",type:w.SectionType.Uint},12203:{name:"TrackOverlay",type:w.SectionType.Uint},5802:{name:"CodecDelay",type:w.SectionType.Uint},5819:{name:"SeekPreRoll",type:w.SectionType.Uint},9764:{name:"TrackTranslate",type:w.SectionType.Container},9980:{name:"TrackTranslateEditionUID",type:w.SectionType.Uint},9919:{name:"TrackTranslateCodec",type:w.SectionType.Uint},9893:{name:"TrackTranslateTrackID",type:w.SectionType.Binary},96:{name:"Video",type:w.SectionType.Container},26:{name:"FlagInterlaced",type:w.SectionType.Uint},5048:{name:"StereoMode",type:w.SectionType.Uint},5056:{name:"AlphaMode",type:w.SectionType.Uint},5049:{name:"OldStereoMode",type:w.SectionType.Uint},48:{name:"PixelWidth",type:w.SectionType.Uint},58:{name:"PixelHeight",type:w.SectionType.Uint},5290:{name:"PixelCropBottom",type:w.SectionType.Uint},5307:{name:"PixelCropTop",type:w.SectionType.Uint},5324:{name:"PixelCropLeft",type:w.SectionType.Uint},5341:{name:"PixelCropRight",type:w.SectionType.Uint},5296:{name:"DisplayWidth",type:w.SectionType.Uint},5306:{name:"DisplayHeight",type:w.SectionType.Uint},5298:{name:"DisplayUnit",type:w.SectionType.Uint},5299:{name:"AspectRatioType",type:w.SectionType.Uint},963876:{name:"ColourSpace",type:w.SectionType.Binary},1029411:{name:"GammaValue",type:w.SectionType.Float},230371:{name:"FrameRate",type:w.SectionType.Float},97:{name:"Audio",type:w.SectionType.Container},53:{name:"SamplingFrequency",type:w.SectionType.Float},14517:{name:"OutputSamplingFrequency",type:w.SectionType.Float},31:{name:"Channels",type:w.SectionType.Uint},15739:{name:"ChannelPositions",type:w.SectionType.Binary},8804:{name:"BitDepth",type:w.SectionType.Uint},98:{name:"TrackOperation",type:w.SectionType.Container},99:{name:"TrackCombinePlanes",type:w.SectionType.Container},100:{name:"TrackPlane",type:w.SectionType.Container},101:{name:"TrackPlaneUID",type:w.SectionType.Uint},102:{name:"TrackPlaneType",type:w.SectionType.Uint},105:{name:"TrackJoinBlocks",type:w.SectionType.Container},109:{name:"TrackJoinUID",type:w.SectionType.Uint},64:{name:"TrickTrackUID",type:w.SectionType.Uint},65:{name:"TrickTrackSegmentUID",type:w.SectionType.Binary},70:{name:"TrickTrackFlag",type:w.SectionType.Uint},71:{name:"TrickMasterTrackUID",type:w.SectionType.Uint},68:{name:"TrickMasterTrackSegmentUID",type:w.SectionType.Binary},11648:{name:"ContentEncodings",type:w.SectionType.Container},8768:{name:"ContentEncoding",type:w.SectionType.Container},4145:{name:"ContentEncodingOrder",type:w.SectionType.Uint},4146:{name:"ContentEncodingScope",type:w.SectionType.Uint},4147:{name:"ContentEncodingType",type:w.SectionType.Uint},4148:{name:"ContentCompression",type:w.SectionType.Container},596:{name:"ContentCompAlgo",type:w.SectionType.Uint},597:{name:"ContentCompSettings",type:w.SectionType.Binary},4149:{name:"ContentEncryption",type:w.SectionType.Container},2017:{name:"ContentEncAlgo",type:w.SectionType.Uint},2018:{name:"ContentEncKeyID",type:w.SectionType.Binary},2019:{name:"ContentSignature",type:w.SectionType.Binary},2020:{name:"ContentSigKeyID",type:w.SectionType.Binary},2021:{name:"ContentSigAlgo",type:w.SectionType.Uint},2022:{name:"ContentSigHashAlgo",type:w.SectionType.Uint},206814059:{name:"Cues",type:w.SectionType.Container},59:{name:"CuePoint",type:w.SectionType.Container},51:{name:"CueTime",type:w.SectionType.Uint},55:{name:"CueTrackPositions",type:w.SectionType.Container},119:{name:"CueTrack",type:w.SectionType.Uint},113:{name:"CueClusterPosition",type:w.SectionType.Uint},112:{name:"CueRelativePosition",type:w.SectionType.Uint},50:{name:"CueDuration",type:w.SectionType.Uint},4984:{name:"CueBlockNumber",type:w.SectionType.Uint},106:{name:"CueCodecState",type:w.SectionType.Uint},91:{name:"CueReference",type:w.SectionType.Container},22:{name:"CueRefTime",type:w.SectionType.Uint},23:{name:"CueRefCluster",type:w.SectionType.Uint},4959:{name:"CueRefNumber",type:w.SectionType.Uint},107:{name:"CueRefCodecState",type:w.SectionType.Uint},155296873:{name:"Attachments",type:w.SectionType.Container},8615:{name:"AttachedFile",type:w.SectionType.Container},1662:{name:"FileDescription",type:w.SectionType.String},1646:{name:"FileName",type:w.SectionType.String},1632:{name:"FileMimeType",type:w.SectionType.String},1628:{name:"FileData",type:w.SectionType.Binary},1710:{name:"FileUID",type:w.SectionType.Uint},1653:{name:"FileReferral",type:w.SectionType.Binary},1633:{name:"FileUsedStartTime",type:w.SectionType.Uint},1634:{name:"FileUsedEndTime",type:w.SectionType.Uint},4433776:{name:"Chapters",type:w.SectionType.Container},1465:{name:"EditionEntry",type:w.SectionType.Container},1468:{name:"EditionUID",type:w.SectionType.Uint},1469:{name:"EditionFlagHidden",type:w.SectionType.Uint},1499:{name:"EditionFlagDefault",type:w.SectionType.Uint},1501:{name:"EditionFlagOrdered",type:w.SectionType.Uint},54:{name:"ChapterAtom",type:w.SectionType.Container},13252:{name:"ChapterUID",type:w.SectionType.Uint},5716:{name:"ChapterStringUID",type:w.SectionType.String},17:{name:"ChapterTimeStart",type:w.SectionType.Uint},18:{name:"ChapterTimeEnd",type:w.SectionType.Uint},24:{name:"ChapterFlagHidden",type:w.SectionType.Uint},1432:{name:"ChapterFlagEnabled",type:w.SectionType.Uint},11879:{name:"ChapterSegmentUID",type:w.SectionType.Binary},11964:{name:"ChapterSegmentEditionUID",type:w.SectionType.Uint},9155:{name:"ChapterPhysicalEquiv",type:w.SectionType.Uint},15:{name:"ChapterTrack",type:w.SectionType.Container},9:{name:"ChapterTrackNumber",type:w.SectionType.Uint},0:{name:"ChapterDisplay",type:w.SectionType.Container},5:{name:"ChapString",type:w.SectionType.String},892:{name:"ChapLanguage",type:w.SectionType.String},894:{name:"ChapCountry",type:w.SectionType.String},10564:{name:"ChapProcess",type:w.SectionType.Container},10581:{name:"ChapProcessCodecID",type:w.SectionType.Uint},1293:{name:"ChapProcessPrivate",type:w.SectionType.Binary},10513:{name:"ChapProcessCommand",type:w.SectionType.Container},10530:{name:"ChapProcessTime",type:w.SectionType.Uint},10547:{name:"ChapProcessData",type:w.SectionType.Binary},39109479:{name:"Tags",type:w.SectionType.Container},13171:{name:"Tag",type:w.SectionType.Container},9152:{name:"Targets",type:w.SectionType.Container},10442:{name:"TargetTypeValue",type:w.SectionType.Uint},9162:{name:"TargetType",type:w.SectionType.String},9157:{name:"TagTrackUID",type:w.SectionType.Uint},9161:{name:"TagEditionUID",type:w.SectionType.Uint},9156:{name:"TagChapterUID",type:w.SectionType.Uint},9158:{name:"TagAttachmentUID",type:w.SectionType.Uint},10184:{name:"SimpleTag",type:w.SectionType.Container},1443:{name:"TagName",type:w.SectionType.String},1146:{name:"TagLanguage",type:w.SectionType.String},1156:{name:"TagDefault",type:w.SectionType.Uint},1159:{name:"TagString",type:w.SectionType.String},1157:{name:"TagBinary",type:w.SectionType.Binary},5552:{name:"Colour",type:w.SectionType.Container},5553:{name:"MatrixCoefficients",type:w.SectionType.Uint},5554:{name:"BitsPerChannel",type:w.SectionType.Uint},5555:{name:"ChromaSubsamplingHorz",type:w.SectionType.Uint},5556:{name:"ChromaSubsamplingVert",type:w.SectionType.Uint},5557:{name:"CbSubsamplingHorz",type:w.SectionType.Uint},5558:{name:"CbSubsamplingVert",type:w.SectionType.Uint},5559:{name:"ChromaSitingHorz",type:w.SectionType.Uint},5560:{name:"ChromaSitingVert",type:w.SectionType.Uint},5561:{name:"Range",type:w.SectionType.Uint},5562:{name:"TransferCharacteristics",type:w.SectionType.Uint},5563:{name:"Primaries",type:w.SectionType.Uint},5564:{name:"MaxCLL",type:w.SectionType.Uint},5565:{name:"MaxFALL",type:w.SectionType.Uint}}});var u0=P(Sg=>{"use strict";Object.defineProperty(Sg,"__esModule",{value:!0});Sg.WebmUint=void 0;var Oz=uc();function xN(t){return t.length%2===1?"0"+t:t}var o0=class extends Oz.WebmBase{constructor(e,n=0){super(e,n)}getType(){return"Uint"}updateBySource(){this.data="";for(let e=0;e<this.source.length;e++){let n=this.source[e].toString(16);this.data+=xN(n)}}updateByData(){let e=this.data.length/2;this.source=new Uint8Array(e);for(let n=0;n<e;n++){let r=this.data.substring(n*2,n*2+2);this.source[n]=parseInt(r,16)}}getValue(){return parseInt(this.data,16)}setValue(e){this.setData(xN(e.toString(16)))}};Sg.WebmUint=o0});var c0=P(xg=>{"use strict";Object.defineProperty(xg,"__esModule",{value:!0});xg.WebmFloat=void 0;var Rz=uc(),l0=class extends Rz.WebmBase{constructor(e,n=0){super(e,n)}getType(){return"Float"}getFloatArrayType(){return this.source&&this.source.length===4?Float32Array:Float64Array}updateBySource(){let e=this.source.reverse(),n=this.getFloatArrayType(),r=new n(e.buffer);this.data=r[0]}updateByData(){let e=this.getFloatArrayType(),n=new e([this.data]),r=new Uint8Array(n.buffer);this.source=r.reverse()}};xg.WebmFloat=l0});var d0=P(Ag=>{"use strict";Object.defineProperty(Ag,"__esModule",{value:!0});Ag.WebmString=void 0;var Cz=uc(),f0=class extends Cz.WebmBase{constructor(e,n=0){super(e,n)}getType(){return"String"}updateBySource(){this.data=this.source}updateByData(){this.source=this.data}getValue(){let e="";return this.source.forEach(n=>{e+=String.fromCharCode(n)}),e}};Ag.WebmString=f0});var h0=P(Eg=>{"use strict";Object.defineProperty(Eg,"__esModule",{value:!0});Eg.WebmContainer=void 0;var AN=uc(),Iz=s0(),Tg=wg(),Pz=u0(),Nz=c0(),kz=d0(),p0=class t extends AN.WebmBase{constructor(e,n=!1,r=0){super(e,r),this.isInfinite=n,this.offset=0}getType(){return"Container"}readByte(){return this.source[this.offset++]}readUint(){let e=this.readByte(),n=8-e.toString(2).length,r=e-(1<<7-n);for(let a=0;a<n;a++)r<<=8,r|=this.readByte();return r}updateBySource(){var e;this.data=[];let n;for(this.offset=0;this.offset<this.source.length;this.offset=n){let r=this.offset,a=this.readUint(),{name:i,type:s}=(e=Iz.sections[a])!==null&&e!==void 0?e:{},o=this.readUint();n=this.source.length,o>=0&&(n=Math.min(this.offset+o,n));let u=this.source.slice(this.offset,n),l;switch(s){case Tg.SectionType.Container:l=new t(i,o<0,r);break;case Tg.SectionType.Uint:l=new Pz.WebmUint(i,r);break;case Tg.SectionType.Float:l=new Nz.WebmFloat(i,r);break;case Tg.SectionType.String:l=new kz.WebmString(i,r);break;default:l=new AN.WebmBase(i,r);break}l.setSource(u),this.data.push({id:a,idHex:a.toString(16),data:l})}}writeUint(e,n=!1){let r;for(r=1;(e<0||e>=1<<7*r)&&r<8;r++);if(!n){for(let a=0;a<r;a++)this.source[this.offset+a]=e>>8*(r-1-a)&255;this.source[this.offset]&=(1<<8-r)-1,this.source[this.offset]|=1<<8-r}this.offset+=r}writeSections(e=!1){this.offset=0;for(let n=0;n<this.data.length;n++){let r=this.data[n],a=r.data.source,i=a.length;this.writeUint(r.id,e),this.writeUint(r.data instanceof t&&r.data.isInfinite?-1:i,e),e||this.source.set(a,this.offset),this.offset+=i}return this.offset}updateByData(){let e=this.writeSections(!0);this.source=new Uint8Array(e),this.writeSections()}getSectionById(e){for(let n=0;n<this.data.length;n++){let r=this.data[n];if(r.id===e)return r.data}return null}};Eg.WebmContainer=p0});var TN=P(Og=>{"use strict";Object.defineProperty(Og,"__esModule",{value:!0});Og.WebmFile=void 0;var Dz=(Rd(),mc(Od)),jz=h0(),m0=class t extends jz.WebmContainer{constructor(e){super("File"),this.setSource(e)}getType(){return"File"}toBlob(e="video/webm"){return new Blob([this.source.buffer],{type:e})}static blobToArray(e){return new Promise((n,r)=>{try{let a=new FileReader;a.onloadend=()=>{try{n(new Uint8Array(a.result))}catch(i){r(i)}},a.readAsArrayBuffer(e)}catch(a){r(a)}})}static fromBlob(e){return Dz.__awaiter(this,void 0,void 0,function*(){let n=yield t.blobToArray(e);return new t(n)})}};Og.WebmFile=m0});var ON=P(EN=>{"use strict";Object.defineProperty(EN,"__esModule",{value:!0})});var g0=P(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});var ei=(Rd(),mc(Od));ei.__exportStar(uc(),Ir);ei.__exportStar(h0(),Ir);ei.__exportStar(TN(),Ir);ei.__exportStar(c0(),Ir);ei.__exportStar(d0(),Ir);ei.__exportStar(u0(),Ir);ei.__exportStar(wg(),Ir);ei.__exportStar(ON(),Ir);ei.__exportStar(s0(),Ir)});var y0=P(Rg=>{"use strict";Object.defineProperty(Rg,"__esModule",{value:!0});Rg.fixParsedWebmDuration=void 0;var Mz=g0(),$z=(t,e,n={})=>{let r=n.logger;r===void 0?r=u=>console.debug(u):r||(r=()=>{});let a=t.getSectionById(139690087);if(!a)return r("[fix-webm-duration] Segment section is missing"),!1;let i=a.getSectionById(88713574);if(!i)return r("[fix-webm-duration] Info section is missing"),!1;let s=i.getSectionById(710577);if(!s)return r("[fix-webm-duration] TimecodeScale section is missing"),!1;let o=i.getSectionById(1161);if(o)if(o.getValue()<=0)r(`[fix-webm-duration] Duration section is present, but the value is ${o.getValue()}`),o.setValue(e);else return r(`[fix-webm-duration] Duration section is present, and the value is ${o.getValue()}`),!1;else r("[fix-webm-duration] Duration section is missing"),o=new Mz.WebmFloat("Duration"),o.setValue(e),i.data.push({id:1161,data:o});return s.setValue(1e6),i.updateByData(),a.updateByData(),t.updateByData(),!0};Rg.fixParsedWebmDuration=$z});var RN=P(Cg=>{"use strict";Object.defineProperty(Cg,"__esModule",{value:!0});Cg.fixWebmDuration=void 0;var Lz=(Rd(),mc(Od)),Uz=g0(),zz=y0(),Bz=(t,e,n)=>Lz.__awaiter(void 0,void 0,void 0,function*(){try{let r=yield Uz.WebmFile.fromBlob(t);if((0,zz.fixParsedWebmDuration)(r,e,n))return r.toBlob(t.type)}catch(r){}return t});Cg.fixWebmDuration=Bz});var IN=P(Ig=>{"use strict";Object.defineProperty(Ig,"__esModule",{value:!0});var CN=(Rd(),mc(Od));CN.__exportStar(RN(),Ig);CN.__exportStar(y0(),Ig)});var nB={};Lg(nB,{default:()=>tB});module.exports=mc(nB);var Ve=require("obsidian");var Ln=require("obsidian"),NP=Z(__());var dE=function(t,e){var n;return function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];return clearTimeout(n),n=setTimeout(function(){return t.apply(void 0,r)},e)}};var Vu=Z(ur()),pE=(t,e)=>{let n=(0,Vu.useRef)(void 0);return(0,Vu.useEffect)(()=>{n.current=t},[t]),(0,Vu.useMemo)(()=>dE(()=>{var i;(i=n.current)==null||i.call(n)},e),[e])};var uh="RFC3986",lh={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},hE="RFC1738";var JD=Array.isArray,Fr=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();var w_=1024,mE=(t,e,n,r,a)=>{if(t.length===0)return t;let i=t;if(typeof t=="symbol"?i=Symbol.prototype.toString.call(t):typeof t!="string"&&(i=String(t)),n==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let s="";for(let o=0;o<i.length;o+=w_){let u=i.length>=w_?i.slice(o,o+w_):i,l=[];for(let c=0;c<u.length;++c){let f=u.charCodeAt(c);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||a===hE&&(f===40||f===41)){l[l.length]=u.charAt(c);continue}if(f<128){l[l.length]=Fr[f];continue}if(f<2048){l[l.length]=Fr[192|f>>6]+Fr[128|f&63];continue}if(f<55296||f>=57344){l[l.length]=Fr[224|f>>12]+Fr[128|f>>6&63]+Fr[128|f&63];continue}c+=1,f=65536+((f&1023)<<10|u.charCodeAt(c)&1023),l[l.length]=Fr[240|f>>18]+Fr[128|f>>12&63]+Fr[128|f>>6&63]+Fr[128|f&63]}s+=l.join("")}return s};function gE(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function v_(t,e){if(JD(t)){let n=[];for(let r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)}var XD=Object.prototype.hasOwnProperty,yE={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},qr=Array.isArray,QD=Array.prototype.push,bE=function(t,e){QD.apply(t,qr(e)?e:[e])},WD=Date.prototype.toISOString,ht={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:mE,encodeValuesOnly:!1,format:uh,formatter:lh[uh],indices:!1,serializeDate(t){return WD.call(t)},skipNulls:!1,strictNullHandling:!1};function ej(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var S_={};function _E(t,e,n,r,a,i,s,o,u,l,c,f,d,p,g,b,_,m){let h=t,y=m,v=0,S=!1;for(;(y=y.get(S_))!==void 0&&!S;){let R=y.get(t);if(v+=1,typeof R!="undefined"){if(R===v)throw new RangeError("Cyclic object value");S=!0}typeof y.get(S_)=="undefined"&&(v=0)}if(typeof l=="function"?h=l(e,h):h instanceof Date?h=d==null?void 0:d(h):n==="comma"&&qr(h)&&(h=v_(h,function(R){return R instanceof Date?d==null?void 0:d(R):R})),h===null){if(i)return u&&!b?u(e,ht.encoder,_,"key",p):e;h=""}if(ej(h)||gE(h)){if(u){let R=b?e:u(e,ht.encoder,_,"key",p);return[(g==null?void 0:g(R))+"="+(g==null?void 0:g(u(h,ht.encoder,_,"value",p)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(h)))]}let A=[];if(typeof h=="undefined")return A;let T;if(n==="comma"&&qr(h))b&&u&&(h=v_(h,u)),T=[{value:h.length>0?h.join(",")||null:void 0}];else if(qr(l))T=l;else{let R=Object.keys(h);T=c?R.sort(c):R}let x=o?String(e).replace(/\./g,"%2E"):String(e),C=r&&qr(h)&&h.length===1?x+"[]":x;if(a&&qr(h)&&h.length===0)return C+"[]";for(let R=0;R<T.length;++R){let B=T[R],te=typeof B=="object"&&typeof B.value!="undefined"?B.value:h[B];if(s&&te===null)continue;let je=f&&o?B.replace(/\./g,"%2E"):B,Ge=qr(h)?typeof n=="function"?n(C,je):C:C+(f?"."+je:"["+je+"]");m.set(t,v);let st=new WeakMap;st.set(S_,m),bE(A,_E(te,Ge,n,r,a,i,s,o,n==="comma"&&b&&qr(h)?null:u,l,c,f,d,p,g,b,_,st))}return A}function tj(t=ht){if(typeof t.allowEmptyArrays!="undefined"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys!="undefined"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder!="undefined"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||ht.charset;if(typeof t.charset!="undefined"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=uh;if(typeof t.format!="undefined"){if(!XD.call(lh,t.format))throw new TypeError("Unknown format option provided.");n=t.format}let r=lh[n],a=ht.filter;(typeof t.filter=="function"||qr(t.filter))&&(a=t.filter);let i;if(t.arrayFormat&&t.arrayFormat in yE?i=t.arrayFormat:"indices"in t?i=t.indices?"indices":"repeat":i=ht.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let s=typeof t.allowDots=="undefined"?t.encodeDotInKeys?!0:ht.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:ht.addQueryPrefix,allowDots:s,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:ht.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ht.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter=="undefined"?ht.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:ht.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:ht.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:ht.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:ht.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:ht.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:ht.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ht.strictNullHandling}}function x_(t,e={}){let n=t,r=tj(e),a,i;typeof r.filter=="function"?(i=r.filter,n=i("",n)):qr(r.filter)&&(i=r.filter,a=i);let s=[];if(typeof n!="object"||n===null)return"";let o=yE[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;a||(a=Object.keys(n)),r.sort&&a.sort(r.sort);let l=new WeakMap;for(let d=0;d<a.length;++d){let p=a[d];r.skipNulls&&n[p]===null||bE(s,_E(n[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=s.join(r.delimiter),f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),c.length>0?f+c:""}var $s="4.97.0";var wE=!1,Ls,A_,rj,aj,ij,T_,sj,ch,E_,O_,R_,Af,C_;function vE(t,e={auto:!1}){if(wE)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Ls)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Ls}'\``);wE=e.auto,Ls=t.kind,A_=t.fetch,rj=t.Request,aj=t.Response,ij=t.Headers,T_=t.FormData,sj=t.Blob,ch=t.File,E_=t.ReadableStream,O_=t.getMultipartRequestOptions,R_=t.getDefaultAgent,Af=t.fileFromPath,C_=t.isFsReadStream}var fh=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function SE({manuallyImported:t}={}){let e=t?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",n,r,a,i;try{n=fetch,r=Request,a=Response,i=Headers}catch(s){throw new Error(`this environment is missing the following Web Fetch API type: ${s.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:a,Headers:i,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(s,o)=>({...o,body:new fh(s)}),getDefaultAgent:s=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:s=>!1}}var I_=()=>{Ls||vE(SE(),{auto:!0})};I_();var z=class extends Error{},lt=class t extends z{constructor(e,n,r,a){super(`${t.makeMessage(e,n,r)}`),this.status=e,this.headers=a,this.request_id=a==null?void 0:a["x-request-id"],this.error=n;let i=n;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,n,r){let a=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,n,r,a){if(!e||!a)return new Oa({message:r,cause:dh(n)});let i=n==null?void 0:n.error;return e===400?new Gu(e,i,r,a):e===401?new Zu(e,i,r,a):e===403?new Ku(e,i,r,a):e===404?new Yu(e,i,r,a):e===409?new Ju(e,i,r,a):e===422?new Xu(e,i,r,a):e===429?new Qu(e,i,r,a):e>=500?new Wu(e,i,r,a):new t(e,i,r,a)}},Ke=class extends lt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Oa=class extends lt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}},dr=class extends Oa{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Gu=class extends lt{},Zu=class extends lt{},Ku=class extends lt{},Yu=class extends lt{},Ju=class extends lt{},Xu=class extends lt{},Qu=class extends lt{},Wu=class extends lt{},el=class extends z{constructor(){super("Could not parse response content as the length limit was reached")}},tl=class extends z{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var ph=function(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n},Us=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Cn,zs=class{constructor(){Cn.set(this,void 0),this.buffer=new Uint8Array,ph(this,Cn,null,"f")}decode(e){if(e==null)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+n.length);r.set(this.buffer),r.set(n,this.buffer.length),this.buffer=r;let a=[],i;for(;(i=lj(this.buffer,Us(this,Cn,"f")))!=null;){if(i.carriage&&Us(this,Cn,"f")==null){ph(this,Cn,i.index,"f");continue}if(Us(this,Cn,"f")!=null&&(i.index!==Us(this,Cn,"f")+1||i.carriage)){a.push(this.decodeText(this.buffer.slice(0,Us(this,Cn,"f")-1))),this.buffer=this.buffer.slice(Us(this,Cn,"f")),ph(this,Cn,null,"f");continue}let s=Us(this,Cn,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,s));a.push(o),this.buffer=this.buffer.slice(i.index),ph(this,Cn,null,"f")}return a}decodeText(e){var n;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new z(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(n=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new z(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new z("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};Cn=new WeakMap;zs.NEWLINE_CHARS=new Set([`
`,"\r"]);zs.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function lj(t,e){for(let a=e!=null?e:0;a<t.length;a++){if(t[a]===10)return{preceding:a,index:a+1,carriage:!1};if(t[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function xE(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}function P_(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){let n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Hr=class t{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let s of cj(e,n))if(!i){if(s.data.startsWith("[DONE]")){i=!0;continue}if(s.event===null||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let o;try{o=JSON.parse(s.data)}catch(u){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),u}if(o&&o.error)throw new lt(void 0,o.error,void 0,k_(e.headers));yield o}else{let o;try{o=JSON.parse(s.data)}catch(u){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),u}if(s.event=="error")throw new lt(void 0,o.error,o.message,void 0);yield{event:s.event,data:o}}}i=!0}catch(s){if(s instanceof Error&&s.name==="AbortError")return;throw s}finally{i||n.abort()}}return new t(a,n)}static fromReadableStream(e,n){let r=!1;async function*a(){let s=new zs,o=P_(e);for await(let u of o)for(let l of s.decode(u))yield l;for(let u of s.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let o of a())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{s||n.abort()}}return new t(i,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],n=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){let s=r.next();e.push(s),n.push(s)}return i.shift()}});return[new t(()=>a(e),this.controller),new t(()=>a(n),this.controller)]}toReadableStream(){let e=this,n,r=new TextEncoder;return new E_({async start(){n=e[Symbol.asyncIterator]()},async pull(a){try{let{value:i,done:s}=await n.next();if(s)return a.close();let o=r.encode(JSON.stringify(i)+`
`);a.enqueue(o)}catch(i){a.error(i)}},async cancel(){var a;await((a=n.return)==null?void 0:a.call(n))}})}};async function*cj(t,e){if(!t.body)throw e.abort(),new z("Attempted to iterate over a response with no body");let n=new N_,r=new zs,a=P_(t.body);for await(let i of fj(a))for(let s of r.decode(i)){let o=n.decode(s);o&&(yield o)}for(let i of r.flush()){let s=n.decode(i);s&&(yield s)}}async function*fj(t){let e=new Uint8Array;for await(let n of t){if(n==null)continue;let r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n,a=new Uint8Array(e.length+r.length);a.set(e),a.set(r,e.length),e=a;let i;for(;(i=xE(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var N_=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,a]=dj(e,":");return a.startsWith(" ")&&(a=a.substring(1)),n==="event"?this.event=a:n==="data"&&this.data.push(a),null}};function dj(t,e){let n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}var AE=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",TE=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Tf(t),Tf=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",pj=t=>TE(t)||AE(t)||C_(t);async function nl(t,e,n){var a,i,s;if(t=await t,TE(t))return t;if(AE(t)){let o=await t.blob();e||(e=(a=new URL(t.url).pathname.split(/[\\/]/).pop())!=null?a:"unknown_file");let u=Tf(o)?[await o.arrayBuffer()]:[o];return new ch(u,e,n)}let r=await hj(t);if(e||(e=(i=gj(t))!=null?i:"unknown_file"),!(n!=null&&n.type)){let o=(s=r[0])==null?void 0:s.type;typeof o=="string"&&(n={...n,type:o})}return new ch(r,e,n)}async function hj(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Tf(t))e.push(await t.arrayBuffer());else if(yj(t))for await(let r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${mj(t)}`);return e}function mj(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function gj(t){var e;return D_(t.name)||D_(t.filename)||((e=D_(t.path))==null?void 0:e.split(/[\\/]/).pop())}var D_=t=>{if(typeof t=="string")return t;if(typeof Buffer!="undefined"&&t instanceof Buffer)return String(t)},yj=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",M_=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody";var Xn=async t=>{let e=await EE(t.body);return O_(e,t)},EE=async t=>{let e=new T_;return await Promise.all(Object.entries(t||{}).map(([n,r])=>j_(e,n,r))),e};var j_=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(pj(n)){let r=await nl(n);t.append(e,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>j_(t,e+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,a])=>j_(t,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var _j=function(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n},wj=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},hh;I_();async function PE(t){var s;let{response:e}=t;if(t.options.stream)return Ra("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):Hr.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let n=e.headers.get("content-type"),r=(s=n==null?void 0:n.split(";")[0])==null?void 0:s.trim();if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.endsWith("+json"))){let o=await e.json();return Ra("response",e.status,e.url,e.headers,o),NE(o,e)}let i=await e.text();return Ra("response",e.status,e.url,e.headers,i),i}function NE(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var yh=class t extends Promise{constructor(e,n=PE){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new t(this.responsePromise,async n=>NE(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},bh=class{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=$_("maxRetries",n),this.timeout=$_("timeout",r),this.httpAgent=a,this.fetch=i!=null?i:A_}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Aj(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${Rj()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async a=>{let i=a&&Tf(a==null?void 0:a.body)?new DataView(await a.body.arrayBuffer()):(a==null?void 0:a.body)instanceof DataView?a.body:(a==null?void 0:a.body)instanceof ArrayBuffer?new DataView(a.body):a&&ArrayBuffer.isView(a==null?void 0:a.body)?new DataView(a.body.buffer):a==null?void 0:a.body;return{method:e,path:n,...a,body:i}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var b,_,m,h,y,v;let r={...e},{method:a,path:i,query:s,headers:o={}}=r,u=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:M_(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,l=this.calculateContentLength(u),c=this.buildURL(i,s);"timeout"in r&&$_("timeout",r.timeout),r.timeout=(b=r.timeout)!=null?b:this.timeout;let f=(m=(_=r.httpAgent)!=null?_:this.httpAgent)!=null?m:R_(c),d=r.timeout+1e3;typeof((h=f==null?void 0:f.options)==null?void 0:h.timeout)=="number"&&d>((y=f.options.timeout)!=null?y:0)&&(f.options.timeout=d),this.idempotencyHeader&&a!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:r,headers:o,contentLength:l,retryCount:n});return{req:{method:a,...u&&{body:u},headers:p,...f&&{agent:f},signal:(v=r.signal)!=null?v:null},url:c,timeout:r.timeout}}buildHeaders({options:e,headers:n,contentLength:r,retryCount:a}){let i={};r&&(i["content-length"]=r);let s=this.defaultHeaders(e);return CE(i,s),CE(i,n),M_(e.body)&&Ls!=="node"&&delete i["content-type"],gh(s,"x-stainless-retry-count")===void 0&&gh(n,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(a)),gh(s,"x-stainless-timeout")===void 0&&gh(n,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,n),i}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,a){return lt.generate(e,n,r,a)}request(e,n=null){return new yh(this.makeRequest(e,n))}async makeRequest(e,n){var f,d,p;let r=await e,a=(f=r.maxRetries)!=null?f:this.maxRetries;n==null&&(n=a),await this.prepareOptions(r);let{req:i,url:s,timeout:o}=this.buildRequest(r,{retryCount:a-n});if(await this.prepareRequest(i,{url:s,options:r}),Ra("request",s,r,i.headers),(d=r.signal)!=null&&d.aborted)throw new Ke;let u=new AbortController,l=await this.fetchWithTimeout(s,i,o,u).catch(dh);if(l instanceof Error){if((p=r.signal)!=null&&p.aborted)throw new Ke;if(n)return this.retryRequest(r,n);throw l.name==="AbortError"?new dr:new Oa({cause:l})}let c=k_(l.headers);if(!l.ok){if(n&&this.shouldRetry(l)){let y=`retrying, ${n} attempts remaining`;return Ra(`response (error; ${y})`,l.status,s,c),this.retryRequest(r,n,c)}let g=await l.text().catch(y=>dh(y).message),b=Tj(g),_=b?void 0:g;throw Ra(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,l.status,s,c,_),this.makeStatusError(l.status,b,_,c)}return{response:l,options:r,controller:u}}requestAPIList(e,n){let r=this.makeRequest(n,null);return new L_(this,r,e)}buildURL(e,n){let r=Oj(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return kE(a)||(n={...a,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r!="undefined").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new z(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,a){let{signal:i,...s}=n||{};i&&i.addEventListener("abort",()=>a.abort());let o=setTimeout(()=>a.abort(),r),u={signal:a.signal,...s};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){let n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){var o;let a,i=r==null?void 0:r["retry-after-ms"];if(i){let u=parseFloat(i);Number.isNaN(u)||(a=u)}let s=r==null?void 0:r["retry-after"];if(s&&!a){let u=parseFloat(s);Number.isNaN(u)?a=Date.parse(s)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){let u=(o=e.maxRetries)!=null?o:this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(n,u)}return await Ca(a),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){let i=n-e,s=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return s*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${$s}`}},Ef=class{constructor(e,n,r,a){hh.set(this,void 0),_j(this,hh,e,"f"),this.options=a,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new z("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){let r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(let[a,i]of r)e.url.searchParams.set(a,i);n.query=void 0,n.path=e.url.toString()}return await wj(this,hh,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(hh=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let n of e.getPaginatedItems())yield n}},L_=class extends yh{constructor(e,n,r){super(n,async a=>new r(e,a.response,await PE(a),a.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let n of e)yield n}},k_=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){let r=n.toString();return e[r.toLowerCase()]||e[r]}}),vj={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ie=t=>typeof t=="object"&&t!==null&&!kE(t)&&Object.keys(t).every(e=>DE(vj,e)),Sj=()=>{var e,n;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":$s,"X-Stainless-OS":RE(Deno.build.os),"X-Stainless-Arch":OE(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(n=(e=Deno.version)==null?void 0:e.deno)!=null?n:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":$s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":$s,"X-Stainless-OS":RE(process.platform),"X-Stainless-Arch":OE(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let t=xj();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":$s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":$s,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function xj(){if(typeof navigator=="undefined"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:n}of t){let r=n.exec(navigator.userAgent);if(r){let a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${a}.${i}.${s}`}}}return null}var OE=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",RE=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),mh,Aj=()=>mh!=null?mh:mh=Sj(),Tj=t=>{try{return JSON.parse(t)}catch(e){return}},Ej=/^[a-z][a-z0-9+.-]*:/i,Oj=t=>Ej.test(t),Ca=t=>new Promise(e=>setTimeout(e,t)),$_=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new z(`${t} must be an integer`);if(e<0)throw new z(`${t} must be a positive integer`);return e},dh=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch(e){}return new Error(t)};var Of=t=>{var e,n,r,a,i,s;if(typeof process!="undefined")return(r=(n=(e=process.env)==null?void 0:e[t])==null?void 0:n.trim())!=null?r:void 0;if(typeof Deno!="undefined")return(s=(i=(a=Deno.env)==null?void 0:a.get)==null?void 0:i.call(a,t))==null?void 0:s.trim()};function kE(t){if(!t)return!0;for(let e in t)return!1;return!0}function DE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function CE(t,e){for(let n in e){if(!DE(e,n))continue;let r=n.toLowerCase();if(!r)continue;let a=e[n];a===null?delete t[r]:a!==void 0&&(t[r]=a)}}var IE=new Set(["authorization","api-key"]);function Ra(t,...e){var n;if(typeof process!="undefined"&&((n=process==null?void 0:process.env)==null?void 0:n.DEBUG)==="true"){let r=e.map(a=>{if(!a)return a;if(a.headers){let s={...a,headers:{...a.headers}};for(let o in a.headers)IE.has(o.toLowerCase())&&(s.headers[o]="REDACTED");return s}let i=null;for(let s in a)IE.has(s.toLowerCase())&&(i!=null||(i={...a}),i[s]="REDACTED");return i!=null?i:a});console.log(`OpenAI:DEBUG:${t}`,...r)}}var Rj=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),jE=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",Cj=t=>typeof(t==null?void 0:t.get)=="function";var gh=(t,e)=>{var r;let n=e.toLowerCase();if(Cj(t)){let a=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,s,o)=>s+o.toUpperCase());for(let i of[e,n,e.toUpperCase(),a]){let s=t.get(i);if(s)return s}}for(let[a,i]of Object.entries(t))if(a.toLowerCase()===n)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};var ME=t=>{if(typeof Buffer!="undefined"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),n=e.length,r=new Uint8Array(n);for(let a=0;a<n;a++)r[a]=e.charCodeAt(a);return Array.from(new Float32Array(r.buffer))}};function Rf(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}var Vr=class extends Ef{constructor(e,n,r,a){super(e,n,r,a),this.data=r.data||[],this.object=r.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},_e=class extends Ef{constructor(e,n,r,a){super(e,n,r,a),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;let e=this.getPaginatedItems();if(!e.length)return null;let n=(r=e[e.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}};var N=class{constructor(e){this._client=e}};var rl=class extends N{list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,_h,{query:n,...r})}};var Di=class extends N{constructor(){super(...arguments),this.messages=new rl(this._client)}create(e,n){var r;return this._client.post("/chat/completions",{body:e,...n,stream:(r=e.stream)!=null?r:!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,r){return this._client.post(`/chat/completions/${e}`,{body:n,...r})}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/chat/completions",ji,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}},ji=class extends _e{},_h=class extends _e{};Di.ChatCompletionsPage=ji;Di.Messages=rl;var Ia=class extends N{constructor(){super(...arguments),this.completions=new Di(this._client)}};Ia.Completions=Di;Ia.ChatCompletionsPage=ji;var al=class extends N{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}};var il=class extends N{create(e,n){var r;return this._client.post("/audio/transcriptions",Xn({body:e,...n,stream:(r=e.stream)!=null?r:!1,__metadata:{model:e.model}}))}};var sl=class extends N{create(e,n){return this._client.post("/audio/translations",Xn({body:e,...n,__metadata:{model:e.model}}))}};var Gr=class extends N{constructor(){super(...arguments),this.transcriptions=new il(this._client),this.translations=new sl(this._client),this.speech=new al(this._client)}};Gr.Transcriptions=il;Gr.Translations=sl;Gr.Speech=al;var Mi=class extends N{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/batches",Bs,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}},Bs=class extends _e{};Mi.BatchesPage=Bs;var pr=function(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n},Ye=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},U_,wh,vh,Cf,If,Sh,Pf,Pa,Nf,xh,Ah,ol,$E,$i=class{constructor(){U_.add(this),this.controller=new AbortController,wh.set(this,void 0),vh.set(this,()=>{}),Cf.set(this,()=>{}),If.set(this,void 0),Sh.set(this,()=>{}),Pf.set(this,()=>{}),Pa.set(this,{}),Nf.set(this,!1),xh.set(this,!1),Ah.set(this,!1),ol.set(this,!1),pr(this,wh,new Promise((e,n)=>{pr(this,vh,e,"f"),pr(this,Cf,n,"f")}),"f"),pr(this,If,new Promise((e,n)=>{pr(this,Sh,e,"f"),pr(this,Pf,n,"f")}),"f"),Ye(this,wh,"f").catch(()=>{}),Ye(this,If,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Ye(this,U_,"m",$E).bind(this))},0)}_connected(){this.ended||(Ye(this,vh,"f").call(this),this._emit("connect"))}get ended(){return Ye(this,Nf,"f")}get errored(){return Ye(this,xh,"f")}get aborted(){return Ye(this,Ah,"f")}abort(){this.controller.abort()}on(e,n){return(Ye(this,Pa,"f")[e]||(Ye(this,Pa,"f")[e]=[])).push({listener:n}),this}off(e,n){let r=Ye(this,Pa,"f")[e];if(!r)return this;let a=r.findIndex(i=>i.listener===n);return a>=0&&r.splice(a,1),this}once(e,n){return(Ye(this,Pa,"f")[e]||(Ye(this,Pa,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{pr(this,ol,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){pr(this,ol,!0,"f"),await Ye(this,If,"f")}_emit(e,...n){if(Ye(this,Nf,"f"))return;e==="end"&&(pr(this,Nf,!0,"f"),Ye(this,Sh,"f").call(this));let r=Ye(this,Pa,"f")[e];if(r&&(Ye(this,Pa,"f")[e]=r.filter(a=>!a.once),r.forEach(({listener:a})=>a(...n))),e==="abort"){let a=n[0];!Ye(this,ol,"f")&&!(r!=null&&r.length)&&Promise.reject(a),Ye(this,Cf,"f").call(this,a),Ye(this,Pf,"f").call(this,a),this._emit("end");return}if(e==="error"){let a=n[0];!Ye(this,ol,"f")&&!(r!=null&&r.length)&&Promise.reject(a),Ye(this,Cf,"f").call(this,a),Ye(this,Pf,"f").call(this,a),this._emit("end")}}_emitFinal(){}};wh=new WeakMap,vh=new WeakMap,Cf=new WeakMap,If=new WeakMap,Sh=new WeakMap,Pf=new WeakMap,Pa=new WeakMap,Nf=new WeakMap,xh=new WeakMap,Ah=new WeakMap,ol=new WeakMap,U_=new WeakSet,$E=function(e){if(pr(this,xh,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Ke),e instanceof Ke)return pr(this,Ah,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){let n=new z(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new z(String(e)))};var V=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},In=function(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n},Ct,z_,Zr,Th,hr,qs,ul,Fs,Rh,Pn,Eh,Oh,jf,kf,Df,LE,UE,zE,BE,FE,qE,HE,Kr=class t extends $i{constructor(){super(...arguments),Ct.add(this),z_.set(this,[]),Zr.set(this,{}),Th.set(this,{}),hr.set(this,void 0),qs.set(this,void 0),ul.set(this,void 0),Fs.set(this,void 0),Rh.set(this,void 0),Pn.set(this,void 0),Eh.set(this,void 0),Oh.set(this,void 0),jf.set(this,void 0)}[(z_=new WeakMap,Zr=new WeakMap,Th=new WeakMap,hr=new WeakMap,qs=new WeakMap,ul=new WeakMap,Fs=new WeakMap,Rh=new WeakMap,Pn=new WeakMap,Eh=new WeakMap,Oh=new WeakMap,jf=new WeakMap,Ct=new WeakSet,Symbol.asyncIterator)](){let e=[],n=[],r=!1;return this.on("event",a=>{let i=n.shift();i?i.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(let a of n)a.resolve(void 0);n.length=0}),this.on("abort",a=>{r=!0;for(let i of n)i.reject(a);n.length=0}),this.on("error",a=>{r=!0;for(let i of n)i.reject(a);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,s)=>n.push({resolve:i,reject:s})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let n=new t;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var i;let r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let a=Hr.fromReadableStream(e,this.controller);for await(let s of a)V(this,Ct,"m",kf).call(this,s);if((i=a.controller.signal)!=null&&i.aborted)throw new Ke;return this._addRun(V(this,Ct,"m",Df).call(this))}toReadableStream(){return new Hr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,r,a,i){let s=new t;return s._run(()=>s._runToolAssistantStream(e,n,r,a,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,n,r,a,i){var l;let s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o={...a,stream:!0},u=await e.submitToolOutputs(n,r,o,{...i,signal:this.controller.signal});this._connected();for await(let c of u)V(this,Ct,"m",kf).call(this,c);if((l=u.controller.signal)!=null&&l.aborted)throw new Ke;return this._addRun(V(this,Ct,"m",Df).call(this))}static createThreadAssistantStream(e,n,r){let a=new t;return a._run(()=>a._threadAssistantStream(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,n,r,a){let i=new t;return i._run(()=>i._runAssistantStream(e,n,r,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return V(this,Eh,"f")}currentRun(){return V(this,Oh,"f")}currentMessageSnapshot(){return V(this,hr,"f")}currentRunStepSnapshot(){return V(this,jf,"f")}async finalRunSteps(){return await this.done(),Object.values(V(this,Zr,"f"))}async finalMessages(){return await this.done(),Object.values(V(this,Th,"f"))}async finalRun(){if(await this.done(),!V(this,qs,"f"))throw Error("Final run was not received.");return V(this,qs,"f")}async _createThreadAssistantStream(e,n,r){var o;let a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},s=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(let u of s)V(this,Ct,"m",kf).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new Ke;return this._addRun(V(this,Ct,"m",Df).call(this))}async _createAssistantStream(e,n,r,a){var u;let i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},o=await e.create(n,s,{...a,signal:this.controller.signal});this._connected();for await(let l of o)V(this,Ct,"m",kf).call(this,l);if((u=o.controller.signal)!=null&&u.aborted)throw new Ke;return this._addRun(V(this,Ct,"m",Df).call(this))}static accumulateDelta(e,n){for(let[r,a]of Object.entries(n)){if(!e.hasOwnProperty(r)){e[r]=a;continue}let i=e[r];if(i==null){e[r]=a;continue}if(r==="index"||r==="type"){e[r]=a;continue}if(typeof i=="string"&&typeof a=="string")i+=a;else if(typeof i=="number"&&typeof a=="number")i+=a;else if(Rf(i)&&Rf(a))i=this.accumulateDelta(i,a);else if(Array.isArray(i)&&Array.isArray(a)){if(i.every(s=>typeof s=="string"||typeof s=="number")){i.push(...a);continue}for(let s of a){if(!Rf(s))throw new Error(`Expected array delta entry to be an object but got: ${s}`);let o=s.index;if(o==null)throw console.error(s),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=i[o];u==null?i.push(s):i[o]=this.accumulateDelta(u,s)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${a}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,n,r){return await this._createThreadAssistantStream(n,e,r)}async _runAssistantStream(e,n,r,a){return await this._createAssistantStream(n,e,r,a)}async _runToolAssistantStream(e,n,r,a,i){return await this._createToolAssistantStream(r,e,n,a,i)}};kf=function(e){if(!this.ended)switch(In(this,Eh,e,"f"),V(this,Ct,"m",zE).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":V(this,Ct,"m",HE).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":V(this,Ct,"m",UE).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":V(this,Ct,"m",LE).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Df=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");if(!V(this,qs,"f"))throw Error("Final run has not been received");return V(this,qs,"f")},LE=function(e){let[n,r]=V(this,Ct,"m",FE).call(this,e,V(this,hr,"f"));In(this,hr,n,"f"),V(this,Th,"f")[n.id]=n;for(let a of r){let i=n.content[a.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(let a of e.data.delta.content){if(a.type=="text"&&a.text){let i=a.text,s=n.content[a.index];if(s&&s.type=="text")this._emit("textDelta",i,s.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=V(this,ul,"f")){if(V(this,Fs,"f"))switch(V(this,Fs,"f").type){case"text":this._emit("textDone",V(this,Fs,"f").text,V(this,hr,"f"));break;case"image_file":this._emit("imageFileDone",V(this,Fs,"f").image_file,V(this,hr,"f"));break}In(this,ul,a.index,"f")}In(this,Fs,n.content[a.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(V(this,ul,"f")!==void 0){let a=e.data.content[V(this,ul,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,V(this,hr,"f"));break;case"text":this._emit("textDone",a.text,V(this,hr,"f"));break}}V(this,hr,"f")&&this._emit("messageDone",e.data),In(this,hr,void 0,"f")}},UE=function(e){let n=V(this,Ct,"m",BE).call(this,e);switch(In(this,jf,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(let i of r.step_details.tool_calls)i.index==V(this,Rh,"f")?this._emit("toolCallDelta",i,n.step_details.tool_calls[i.index]):(V(this,Pn,"f")&&this._emit("toolCallDone",V(this,Pn,"f")),In(this,Rh,i.index,"f"),In(this,Pn,n.step_details.tool_calls[i.index],"f"),V(this,Pn,"f")&&this._emit("toolCallCreated",V(this,Pn,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":In(this,jf,void 0,"f"),e.data.step_details.type=="tool_calls"&&V(this,Pn,"f")&&(this._emit("toolCallDone",V(this,Pn,"f")),In(this,Pn,void 0,"f")),this._emit("runStepDone",e.data,n);break;case"thread.run.step.in_progress":break}},zE=function(e){V(this,z_,"f").push(e),this._emit("event",e)},BE=function(e){switch(e.event){case"thread.run.step.created":return V(this,Zr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=V(this,Zr,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let a=Kr.accumulateDelta(n,r.delta);V(this,Zr,"f")[e.data.id]=a}return V(this,Zr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":V(this,Zr,"f")[e.data.id]=e.data;break}if(V(this,Zr,"f")[e.data.id])return V(this,Zr,"f")[e.data.id];throw new Error("No snapshot available")},FE=function(e,n){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(let i of a.delta.content)if(i.index in n.content){let s=n.content[i.index];n.content[i.index]=V(this,Ct,"m",qE).call(this,i,s)}else n.content[i.index]=i,r.push(i);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},qE=function(e,n){return Kr.accumulateDelta(n,e)},HE=function(e){switch(In(this,Oh,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":In(this,qs,e.data,"f"),V(this,Pn,"f")&&(this._emit("toolCallDone",V(this,Pn,"f")),In(this,Pn,void 0,"f"));break;case"thread.run.cancelling":break}};var Hs=class extends N{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/assistants/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/assistants",ll,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},ll=class extends _e{};Hs.AssistantsPage=ll;function B_(t){return typeof t.parse=="function"}var Li=t=>(t==null?void 0:t.role)==="assistant",F_=t=>(t==null?void 0:t.role)==="function",q_=t=>(t==null?void 0:t.role)==="tool";function VE(t,e){let n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),n}function Mf(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Vs(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function GE(t,e){return!e||!H_(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:$f(t,e)}function $f(t,e){let n=t.choices.map(r=>{var a,i;if(r.finish_reason==="length")throw new el;if(r.finish_reason==="content_filter")throw new tl;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:(i=(a=r.message.tool_calls)==null?void 0:a.map(s=>$j(e,s)))!=null?i:void 0}:void 0,parsed:r.message.content&&!r.message.refusal?Mj(e,r.message.content):null}}});return{...t,choices:n}}function Mj(t,e){var n,r;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=t.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function $j(t,e){var r;let n=(r=t.tools)==null?void 0:r.find(a=>{var i;return((i=a.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Vs(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function ZE(t,e){var r;if(!t)return!1;let n=(r=t.tools)==null?void 0:r.find(a=>{var i;return((i=a.function)==null?void 0:i.name)===e.function.name});return Vs(n)||(n==null?void 0:n.function.strict)||!1}function H_(t){var e,n;return Mf(t.response_format)?!0:(n=(e=t.tools)==null?void 0:e.some(r=>Vs(r)||r.type==="function"&&r.function.strict===!0))!=null?n:!1}function KE(t){for(let e of t!=null?t:[]){if(e.type!=="function")throw new z(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new z(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var un=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},$t,V_,Ch,G_,Z_,K_,JE,Y_,YE=10,cl=class extends $i{constructor(){super(...arguments),$t.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);let n=(r=e.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(F_(e)||q_(e))&&e.content)this._emit("functionCallResult",e.content);else if(Li(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Li(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new z("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),un(this,$t,"m",V_).call(this)}async finalMessage(){return await this.done(),un(this,$t,"m",Ch).call(this)}async finalFunctionCall(){return await this.done(),un(this,$t,"m",G_).call(this)}async finalFunctionCallResult(){return await this.done(),un(this,$t,"m",Z_).call(this)}async totalUsage(){return await this.done(),un(this,$t,"m",K_).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let n=un(this,$t,"m",Ch).call(this);n&&this._emit("finalMessage",n);let r=un(this,$t,"m",V_).call(this);r&&this._emit("finalContent",r);let a=un(this,$t,"m",G_).call(this);a&&this._emit("finalFunctionCall",a);let i=un(this,$t,"m",Z_).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(s=>s.usage)&&this._emit("totalUsage",un(this,$t,"m",K_).call(this))}async _createChatCompletion(e,n,r){let a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),un(this,$t,"m",JE).call(this,n);let i=await e.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion($f(i,n))}async _runChatCompletion(e,n,r){for(let a of n.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,n,r)}async _runFunctions(e,n,r){var d;let a="function",{function_call:i="auto",stream:s,...o}=n,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=YE}=r||{},c={};for(let p of n.functions)c[p.name||p.function.name]=p;let f=n.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of n.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let b=(d=(await this._createChatCompletion(e,{...o,function_call:i,functions:f,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!b)throw new z("missing message in ChatCompletion response");if(!b.function_call)return;let{name:_,arguments:m}=b.function_call,h=c[_];if(h){if(u&&u!==_){let A=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,name:_,content:A});continue}}else{let A=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${f.map(T=>JSON.stringify(T.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:_,content:A});continue}let y;try{y=B_(h)?await h.parse(m):m}catch(A){this._addMessage({role:a,name:_,content:A instanceof Error?A.message:String(A)});continue}let v=await h.function(y,this),S=un(this,$t,"m",Y_).call(this,v);if(this._addMessage({role:a,name:_,content:S}),u)return}}async _runTools(e,n,r){var p,g,b;let a="tool",{tool_choice:i="auto",stream:s,...o}=n,u=typeof i!="string"&&((p=i==null?void 0:i.function)==null?void 0:p.name),{maxChatCompletions:l=YE}=r||{},c=n.tools.map(_=>{if(Vs(_)){if(!_.$callback)throw new z("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),f={};for(let _ of c)_.type==="function"&&(f[_.function.name||_.function.function.name]=_.function);let d="tools"in n?c.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(let _ of n.messages)this._addMessage(_,!1);for(let _=0;_<l;++_){let h=(g=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:g.message;if(!h)throw new z("missing message in ChatCompletion response");if(!((b=h.tool_calls)!=null&&b.length))return;for(let y of h.tool_calls){if(y.type!=="function")continue;let v=y.id,{name:S,arguments:A}=y.function,T=f[S];if(T){if(u&&u!==S){let B=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,tool_call_id:v,content:B});continue}}else{let B=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(f).map(te=>JSON.stringify(te)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:v,content:B});continue}let x;try{x=B_(T)?await T.parse(A):A}catch(B){let te=B instanceof Error?B.message:String(B);this._addMessage({role:a,tool_call_id:v,content:te});continue}let C=await T.function(x,this),R=un(this,$t,"m",Y_).call(this,C);if(this._addMessage({role:a,tool_call_id:v,content:R}),u)return}}}};$t=new WeakSet,V_=function(){var e;return(e=un(this,$t,"m",Ch).call(this).content)!=null?e:null},Ch=function(){var n,r;let e=this.messages.length;for(;e-- >0;){let a=this.messages[e];if(Li(a)){let{function_call:i,...s}=a,o={...s,content:(n=a.content)!=null?n:null,refusal:(r=a.refusal)!=null?r:null};return i&&(o.function_call=i),o}}throw new z("stream ended without producing a ChatCompletionMessage with role=assistant")},G_=function(){var e,n;for(let r=this.messages.length-1;r>=0;r--){let a=this.messages[r];if(Li(a)&&(a!=null&&a.function_call))return a.function_call;if(Li(a)&&((e=a==null?void 0:a.tool_calls)!=null&&e.length))return(n=a.tool_calls.at(-1))==null?void 0:n.function}},Z_=function(){for(let e=this.messages.length-1;e>=0;e--){let n=this.messages[e];if(F_(n)&&n.content!=null||q_(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var a;return r.role==="assistant"&&((a=r.tool_calls)==null?void 0:a.some(i=>i.type==="function"&&i.id===n.tool_call_id))}))return n.content}},K_=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},JE=function(e){if(e.n!=null&&e.n>1)throw new z("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Y_=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Lf=class t extends cl{static runFunctions(e,n,r){let a=new t,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,n,i)),a}static runTools(e,n,r){let a=new t,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,n,i)),a}_addMessage(e,n=!0){super._addMessage(e,n),Li(e)&&e.content&&this._emit("content",e.content)}};var St={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},J_=class extends Error{},X_=class extends Error{};function Lj(t,e=St.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return Uj(t.trim(),e)}var Uj=(t,e)=>{let n=t.length,r=0,a=d=>{throw new J_(`${d} at position ${r}`)},i=d=>{throw new X_(`${d} at position ${r}`)},s=()=>(f(),r>=n&&a("Unexpected end of input"),t[r]==='"'?o():t[r]==="{"?u():t[r]==="["?l():t.substring(r,r+4)==="null"||St.NULL&e&&n-r<4&&"null".startsWith(t.substring(r))?(r+=4,null):t.substring(r,r+4)==="true"||St.BOOL&e&&n-r<4&&"true".startsWith(t.substring(r))?(r+=4,!0):t.substring(r,r+5)==="false"||St.BOOL&e&&n-r<5&&"false".startsWith(t.substring(r))?(r+=5,!1):t.substring(r,r+8)==="Infinity"||St.INFINITY&e&&n-r<8&&"Infinity".startsWith(t.substring(r))?(r+=8,1/0):t.substring(r,r+9)==="-Infinity"||St.MINUS_INFINITY&e&&1<n-r&&n-r<9&&"-Infinity".startsWith(t.substring(r))?(r+=9,-1/0):t.substring(r,r+3)==="NaN"||St.NAN&e&&n-r<3&&"NaN".startsWith(t.substring(r))?(r+=3,NaN):c()),o=()=>{let d=r,p=!1;for(r++;r<n&&(t[r]!=='"'||p&&t[r-1]==="\\");)p=t[r]==="\\"?!p:!1,r++;if(t.charAt(r)=='"')try{return JSON.parse(t.substring(d,++r-Number(p)))}catch(g){i(String(g))}else if(St.STR&e)try{return JSON.parse(t.substring(d,r-Number(p))+'"')}catch(g){return JSON.parse(t.substring(d,t.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},u=()=>{r++,f();let d={};try{for(;t[r]!=="}";){if(f(),r>=n&&St.OBJ&e)return d;let p=o();f(),r++;try{let g=s();Object.defineProperty(d,p,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(St.OBJ&e)return d;throw g}f(),t[r]===","&&r++}}catch(p){if(St.OBJ&e)return d;a("Expected '}' at end of object")}return r++,d},l=()=>{r++;let d=[];try{for(;t[r]!=="]";)d.push(s()),f(),t[r]===","&&r++}catch(p){if(St.ARR&e)return d;a("Expected ']' at end of array")}return r++,d},c=()=>{if(r===0){t==="-"&&St.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(t)}catch(p){if(St.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch(g){}i(String(p))}}let d=r;for(t[r]==="-"&&r++;t[r]&&!",]}".includes(t[r]);)r++;r==n&&!(St.NUM&e)&&a("Unterminated number literal");try{return JSON.parse(t.substring(d,r))}catch(p){t.substring(d,r)==="-"&&St.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(t.substring(d,t.lastIndexOf("e")))}catch(g){i(String(g))}}},f=()=>{for(;r<n&&` 
\r	`.includes(t[r]);)r++};return s()},Q_=t=>Lj(t,St.ALL^St.NUM);var fl=function(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n},Ie=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},mt,Na,dl,Ui,W_,Ih,ew,tw,nw,Ph,rw,XE,pl=class t extends cl{constructor(e){super(),mt.add(this),Na.set(this,void 0),dl.set(this,void 0),Ui.set(this,void 0),fl(this,Na,e,"f"),fl(this,dl,[],"f")}get currentChatCompletionSnapshot(){return Ie(this,Ui,"f")}static fromReadableStream(e){let n=new t(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,r){let a=new t(n);return a._run(()=>a._runChatCompletion(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,n,r){var s;super._createChatCompletion;let a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Ie(this,mt,"m",W_).call(this);let i=await e.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of i)Ie(this,mt,"m",ew).call(this,o);if((s=i.controller.signal)!=null&&s.aborted)throw new Ke;return this._addChatCompletion(Ie(this,mt,"m",Ph).call(this))}async _fromReadableStream(e,n){var s;let r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ie(this,mt,"m",W_).call(this),this._connected();let a=Hr.fromReadableStream(e,this.controller),i;for await(let o of a)i&&i!==o.id&&this._addChatCompletion(Ie(this,mt,"m",Ph).call(this)),Ie(this,mt,"m",ew).call(this,o),i=o.id;if((s=a.controller.signal)!=null&&s.aborted)throw new Ke;return this._addChatCompletion(Ie(this,mt,"m",Ph).call(this))}[(Na=new WeakMap,dl=new WeakMap,Ui=new WeakMap,mt=new WeakSet,W_=function(){this.ended||fl(this,Ui,void 0,"f")},Ih=function(n){let r=Ie(this,dl,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ie(this,dl,"f")[n.index]=r,r)},ew=function(n){var a,i,s,o,u,l,c,f,d,p,g,b,_,m,h,y,v,S,A,T;if(this.ended)return;let r=Ie(this,mt,"m",XE).call(this,n);this._emit("chunk",n,r);for(let x of n.choices){let C=r.choices[x.index];x.delta.content!=null&&((a=C.message)==null?void 0:a.role)==="assistant"&&((i=C.message)!=null&&i.content)&&(this._emit("content",x.delta.content,C.message.content),this._emit("content.delta",{delta:x.delta.content,snapshot:C.message.content,parsed:C.message.parsed})),x.delta.refusal!=null&&((s=C.message)==null?void 0:s.role)==="assistant"&&((o=C.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:x.delta.refusal,snapshot:C.message.refusal}),((u=x.logprobs)==null?void 0:u.content)!=null&&((l=C.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=x.logprobs)==null?void 0:c.content,snapshot:(d=(f=C.logprobs)==null?void 0:f.content)!=null?d:[]}),((p=x.logprobs)==null?void 0:p.refusal)!=null&&((g=C.message)==null?void 0:g.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(b=x.logprobs)==null?void 0:b.refusal,snapshot:(m=(_=C.logprobs)==null?void 0:_.refusal)!=null?m:[]});let R=Ie(this,mt,"m",Ih).call(this,C);C.finish_reason&&(Ie(this,mt,"m",nw).call(this,C),R.current_tool_call_index!=null&&Ie(this,mt,"m",tw).call(this,C,R.current_tool_call_index));for(let B of(h=x.delta.tool_calls)!=null?h:[])R.current_tool_call_index!==B.index&&(Ie(this,mt,"m",nw).call(this,C),R.current_tool_call_index!=null&&Ie(this,mt,"m",tw).call(this,C,R.current_tool_call_index)),R.current_tool_call_index=B.index;for(let B of(y=x.delta.tool_calls)!=null?y:[]){let te=(v=C.message.tool_calls)==null?void 0:v[B.index];te!=null&&te.type&&((te==null?void 0:te.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(S=te.function)==null?void 0:S.name,index:B.index,arguments:te.function.arguments,parsed_arguments:te.function.parsed_arguments,arguments_delta:(T=(A=B.function)==null?void 0:A.arguments)!=null?T:""}):(te==null||te.type,void 0))}}},tw=function(n,r){var s,o,u;if(Ie(this,mt,"m",Ih).call(this,n).done_tool_calls.has(r))return;let i=(s=n.message.tool_calls)==null?void 0:s[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let l=(u=(o=Ie(this,Na,"f"))==null?void 0:o.tools)==null?void 0:u.find(c=>c.type==="function"&&c.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:Vs(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},nw=function(n){var a,i;let r=Ie(this,mt,"m",Ih).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;let s=Ie(this,mt,"m",rw).call(this);this._emit("content.done",{content:n.message.content,parsed:s?s.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(a=n.logprobs)!=null&&a.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(i=n.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},Ph=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");let n=Ie(this,Ui,"f");if(!n)throw new z("request ended without sending any chunks");return fl(this,Ui,void 0,"f"),fl(this,dl,[],"f"),zj(n,Ie(this,Na,"f"))},rw=function(){var r;let n=(r=Ie(this,Na,"f"))==null?void 0:r.response_format;return Mf(n)?n:null},XE=function(n){var c,f,d,p,g,b;var r,a,i,s;let o=Ie(this,Ui,"f"),{choices:u,...l}=n;o?Object.assign(o,l):o=fl(this,Ui,{...l,choices:[]},"f");for(let{delta:_,finish_reason:m,index:h,logprobs:y=null,...v}of n.choices){let S=o.choices[h];if(S||(S=o.choices[h]={finish_reason:m,index:h,message:{},logprobs:y,...v}),y)if(!S.logprobs)S.logprobs=Object.assign({},y);else{let{content:te,refusal:je,...Ge}=y;Object.assign(S.logprobs,Ge),te&&((c=(r=S.logprobs).content)!=null||(r.content=[]),S.logprobs.content.push(...te)),je&&((f=(a=S.logprobs).refusal)!=null||(a.refusal=[]),S.logprobs.refusal.push(...je))}if(m&&(S.finish_reason=m,Ie(this,Na,"f")&&H_(Ie(this,Na,"f")))){if(m==="length")throw new el;if(m==="content_filter")throw new tl}if(Object.assign(S,v),!_)continue;let{content:A,refusal:T,function_call:x,role:C,tool_calls:R,...B}=_;if(Object.assign(S.message,B),T&&(S.message.refusal=(S.message.refusal||"")+T),C&&(S.message.role=C),x&&(S.message.function_call?(x.name&&(S.message.function_call.name=x.name),x.arguments&&((d=(i=S.message.function_call).arguments)!=null||(i.arguments=""),S.message.function_call.arguments+=x.arguments)):S.message.function_call=x),A&&(S.message.content=(S.message.content||"")+A,!S.message.refusal&&Ie(this,mt,"m",rw).call(this)&&(S.message.parsed=Q_(S.message.content))),R){S.message.tool_calls||(S.message.tool_calls=[]);for(let{index:te,id:je,type:Ge,function:st,...fs}of R){let Tt=(p=(s=S.message.tool_calls)[te])!=null?p:s[te]={};Object.assign(Tt,fs),je&&(Tt.id=je),Ge&&(Tt.type=Ge),st&&((b=Tt.function)!=null||(Tt.function={name:(g=st.name)!=null?g:"",arguments:""})),st!=null&&st.name&&(Tt.function.name=st.name),st!=null&&st.arguments&&(Tt.function.arguments+=st.arguments,ZE(Ie(this,Na,"f"),Tt)&&(Tt.function.parsed_arguments=Q_(Tt.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],n=[],r=!1;return this.on("chunk",a=>{let i=n.shift();i?i.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(let a of n)a.resolve(void 0);n.length=0}),this.on("abort",a=>{r=!0;for(let i of n)i.reject(a);n.length=0}),this.on("error",a=>{r=!0;for(let i of n)i.reject(a);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,s)=>n.push({resolve:i,reject:s})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Hr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function zj(t,e){let{id:n,choices:r,created:a,model:i,system_fingerprint:s,...o}=t,u={...o,id:n,choices:r.map(({message:l,finish_reason:c,index:f,logprobs:d,...p})=>{var y,v,S;if(!c)throw new z(`missing finish_reason for choice ${f}`);let{content:g=null,function_call:b,tool_calls:_,...m}=l,h=l.role;if(!h)throw new z(`missing role for choice ${f}`);if(b){let{arguments:A,name:T}=b;if(A==null)throw new z(`missing function_call.arguments for choice ${f}`);if(!T)throw new z(`missing function_call.name for choice ${f}`);return{...p,message:{content:g,function_call:{arguments:A,name:T},role:h,refusal:(y=l.refusal)!=null?y:null},finish_reason:c,index:f,logprobs:d}}return _?{...p,index:f,finish_reason:c,logprobs:d,message:{...m,role:h,content:g,refusal:(v=l.refusal)!=null?v:null,tool_calls:_.map((A,T)=>{let{function:x,type:C,id:R,...B}=A,{arguments:te,name:je,...Ge}=x||{};if(R==null)throw new z(`missing choices[${f}].tool_calls[${T}].id
${Nh(t)}`);if(C==null)throw new z(`missing choices[${f}].tool_calls[${T}].type
${Nh(t)}`);if(je==null)throw new z(`missing choices[${f}].tool_calls[${T}].function.name
${Nh(t)}`);if(te==null)throw new z(`missing choices[${f}].tool_calls[${T}].function.arguments
${Nh(t)}`);return{...B,id:R,type:C,function:{...Ge,name:je,arguments:te}}})}}:{...p,message:{...m,content:g,role:h,refusal:(S=l.refusal)!=null?S:null},finish_reason:c,index:f,logprobs:d}}),created:a,model:i,object:"chat.completion",...s?{system_fingerprint:s}:{}};return GE(u,e)}function Nh(t){return JSON.stringify(t)}var Uf=class t extends pl{static fromReadableStream(e){let n=new t(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,r){let a=new t(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,n,i)),a}static runTools(e,n,r){let a=new t(n),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,n,i)),a}};var zf=class extends N{parse(e,n){return KE(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>$f(r,e))}runFunctions(e,n){return e.stream?Uf.runFunctions(this._client,e,n):Lf.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?Uf.runTools(this._client,e,n):Lf.runTools(this._client,e,n)}stream(e,n){return pl.createChatCompletion(this._client,e,n)}};var hl=class extends N{constructor(){super(...arguments),this.completions=new zf(this._client)}};(function(t){t.Completions=zf})(hl||(hl={}));var ml=class extends N{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}};var gl=class extends N{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}};var zi=class extends N{constructor(){super(...arguments),this.sessions=new ml(this._client),this.transcriptionSessions=new gl(this._client)}};zi.Sessions=ml;zi.TranscriptionSessions=gl;var Gs=class extends N{create(e,n,r){return this._client.post(`/threads/${e}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,a){return this._client.post(`/threads/${e}/messages/${n}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,yl,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},yl=class extends _e{};Gs.MessagesPage=yl;var Zs=class extends N{retrieve(e,n,r,a={},i){return ie(a)?this.retrieve(e,n,r,{},a):this._client.get(`/threads/${e}/runs/${n}/steps/${r}`,{query:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,n,r={},a){return ie(r)?this.list(e,n,{},r):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,bl,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}},bl=class extends _e{};Zs.RunStepsPage=bl;var ka=class extends N{constructor(){super(...arguments),this.steps=new Zs(this._client)}create(e,n,r){var s;let{include:a,...i}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:a},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:(s=n.stream)!=null?s:!1})}retrieve(e,n,r){return this._client.get(`/threads/${e}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,a){return this._client.post(`/threads/${e}/runs/${n}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,_l,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){let a=await this.create(e,n,r);return await this.poll(e,a.id,r)}createAndStream(e,n,r){return Kr.createAssistantStream(e,this._client.beta.threads.runs,n,r)}async poll(e,n,r){let a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:i,response:s}=await this.retrieve(e,n,{...r,headers:{...r==null?void 0:r.headers,...a}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let u=s.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await Ca(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,n,r){return Kr.createAssistantStream(e,this._client.beta.threads.runs,n,r)}submitToolOutputs(e,n,r,a){var i;return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers},stream:(i=r.stream)!=null?i:!1})}async submitToolOutputsAndPoll(e,n,r,a){let i=await this.submitToolOutputs(e,n,r,a);return await this.poll(e,i.id,a)}submitToolOutputsStream(e,n,r,a){return Kr.createToolAssistantStream(e,n,this._client.beta.threads.runs,r,a)}},_l=class extends _e{};ka.RunsPage=_l;ka.Steps=Zs;ka.RunStepsPage=bl;var Yr=class extends N{constructor(){super(...arguments),this.runs=new ka(this._client),this.messages=new Gs(this._client)}create(e={},n){return ie(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/threads/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){var r;return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:(r=e.stream)!=null?r:!1})}async createAndRunPoll(e,n){let r=await this.createAndRun(e,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(e,n){return Kr.createThreadAssistantStream(e,this._client.beta.threads,n)}};Yr.Runs=ka;Yr.RunsPage=_l;Yr.Messages=Gs;Yr.MessagesPage=yl;var mr=class extends N{constructor(){super(...arguments),this.realtime=new zi(this._client),this.chat=new hl(this._client),this.assistants=new Hs(this._client),this.threads=new Yr(this._client)}};mr.Realtime=zi;mr.Assistants=Hs;mr.AssistantsPage=ll;mr.Threads=Yr;var Ks=class extends N{create(e,n){var r;return this._client.post("/completions",{body:e,...n,stream:(r=e.stream)!=null?r:!1})}};var Ys=class extends N{create(e,n){let r=!!e.encoding_format,a=r?e.encoding_format:"base64";r&&Ra("Request","User defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:a},...n});return r?i:(Ra("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(s=>(s&&s.data&&s.data.forEach(o=>{let u=o.embedding;o.embedding=ME(u)}),s)))}};var Js=class extends N{retrieve(e,n,r,a){return this._client.get(`/evals/${e}/runs/${n}/output_items/${r}`,a)}list(e,n,r={},a){return ie(r)?this.list(e,n,{},r):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,wl,{query:r,...a})}},wl=class extends _e{};Js.OutputItemListResponsesPage=wl;var Da=class extends N{constructor(){super(...arguments),this.outputItems=new Js(this._client)}create(e,n,r){return this._client.post(`/evals/${e}/runs`,{body:n,...r})}retrieve(e,n,r){return this._client.get(`/evals/${e}/runs/${n}`,r)}list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,vl,{query:n,...r})}del(e,n,r){return this._client.delete(`/evals/${e}/runs/${n}`,r)}cancel(e,n,r){return this._client.post(`/evals/${e}/runs/${n}`,r)}},vl=class extends _e{};Da.RunListResponsesPage=vl;Da.OutputItems=Js;Da.OutputItemListResponsesPage=wl;var Jr=class extends N{constructor(){super(...arguments),this.runs=new Da(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,r){return this._client.post(`/evals/${e}`,{body:n,...r})}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/evals",Xs,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}},Xs=class extends _e{};Jr.EvalListResponsesPage=Xs;Jr.Runs=Da;Jr.RunListResponsesPage=vl;var Bi=class extends N{create(e,n){return this._client.post("/files",Xn({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/files",Qs,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){let a=new Set(["processed","error","deleted"]),i=Date.now(),s=await this.retrieve(e);for(;!s.status||!a.has(s.status);)if(await Ca(n),s=await this.retrieve(e),Date.now()-i>r)throw new dr({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}},Qs=class extends _e{};Bi.FileObjectsPage=Qs;var Ws=class extends N{create(e,n,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Sl,{body:n,method:"post",...r})}retrieve(e,n={},r){return ie(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...r})}del(e,n,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${n}`,r)}},Sl=class extends Vr{};Ws.PermissionCreateResponsesPage=Sl;var Fi=class extends N{constructor(){super(...arguments),this.permissions=new Ws(this._client)}};Fi.Permissions=Ws;Fi.PermissionCreateResponsesPage=Sl;var eo=class extends N{list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,xl,{query:n,...r})}},xl=class extends _e{};eo.FineTuningJobCheckpointsPage=xl;var Xr=class extends N{constructor(){super(...arguments),this.checkpoints=new eo(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Al,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},r){return ie(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Tl,{query:n,...r})}},Al=class extends _e{},Tl=class extends _e{};Xr.FineTuningJobsPage=Al;Xr.FineTuningJobEventsPage=Tl;Xr.Checkpoints=eo;Xr.FineTuningJobCheckpointsPage=xl;var gr=class extends N{constructor(){super(...arguments),this.jobs=new Xr(this._client),this.checkpoints=new Fi(this._client)}};gr.Jobs=Xr;gr.FineTuningJobsPage=Al;gr.FineTuningJobEventsPage=Tl;gr.Checkpoints=Fi;var to=class extends N{createVariation(e,n){return this._client.post("/images/variations",Xn({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",Xn({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}};var qi=class extends N{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",no,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}},no=class extends Vr{};qi.ModelsPage=no;var ro=class extends N{create(e,n){return this._client.post("/moderations",{body:e,...n})}};function QE(t,e){return!e||!rM(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:aw(t,e)}function aw(t,e){let n=t.output.map(a=>{if(a.type==="function_call")return{...a,parsed_arguments:sM(e,a)};if(a.type==="message"){let i=a.content.map(s=>s.type==="output_text"?{...s,parsed:nM(e,s.text)}:s);return{...a,content:i}}return a}),r=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||iw(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let a of r.output)if(a.type==="message"){for(let i of a.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function nM(t,e){var n,r,a,i;return((r=(n=t.text)==null?void 0:n.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((a=t.text)==null?void 0:a.format)?((i=t.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function rM(t){var e;return!!Mf((e=t.text)==null?void 0:e.format)}function aM(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function iM(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function sM(t,e){var r;let n=iM((r=t.tools)!=null?r:[],e.name);return{...e,...e,parsed_arguments:aM(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function iw(t){let e=[];for(let n of t.output)if(n.type==="message")for(let r of n.content)r.type==="output_text"&&e.push(r.text);t.output_text=e.join("")}var El=class extends N{list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,kh,{query:n,...r})}};var Ol=function(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n},Hi=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Rl,Dh,Vi,jh,WE,eO,tO,nO,Mh=class t extends $i{constructor(e){super(),Rl.add(this),Dh.set(this,void 0),Vi.set(this,void 0),jh.set(this,void 0),Ol(this,Dh,e,"f")}static createResponse(e,n,r){let a=new t(n);return a._run(()=>a._createResponse(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createResponse(e,n,r){var s;let a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Hi(this,Rl,"m",WE).call(this);let i=await e.responses.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of i)Hi(this,Rl,"m",eO).call(this,o);if((s=i.controller.signal)!=null&&s.aborted)throw new Ke;return Hi(this,Rl,"m",tO).call(this)}[(Dh=new WeakMap,Vi=new WeakMap,jh=new WeakMap,Rl=new WeakSet,WE=function(){this.ended||Ol(this,Vi,void 0,"f")},eO=function(n){if(this.ended)return;let r=Hi(this,Rl,"m",nO).call(this,n);switch(this._emit("event",n),n.type){case"response.output_text.delta":{let a=r.output[n.output_index];if(!a)throw new z(`missing output at index ${n.output_index}`);if(a.type==="message"){let i=a.content[n.content_index];if(!i)throw new z(`missing content at index ${n.content_index}`);if(i.type!=="output_text")throw new z(`expected content to be 'output_text', got ${i.type}`);this._emit("response.output_text.delta",{...n,snapshot:i.text})}break}case"response.function_call_arguments.delta":{let a=r.output[n.output_index];if(!a)throw new z(`missing output at index ${n.output_index}`);a.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...n,snapshot:a.arguments});break}default:this._emit(n.type,n);break}},tO=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");let n=Hi(this,Vi,"f");if(!n)throw new z("request ended without sending any events");Ol(this,Vi,void 0,"f");let r=uM(n,Hi(this,Dh,"f"));return Ol(this,jh,r,"f"),r},nO=function(n){let r=Hi(this,Vi,"f");if(!r){if(n.type!=="response.created")throw new z(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=Ol(this,Vi,n.response,"f"),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{let a=r.output[n.output_index];if(!a)throw new z(`missing output at index ${n.output_index}`);a.type==="message"&&a.content.push(n.part);break}case"response.output_text.delta":{let a=r.output[n.output_index];if(!a)throw new z(`missing output at index ${n.output_index}`);if(a.type==="message"){let i=a.content[n.content_index];if(!i)throw new z(`missing content at index ${n.content_index}`);if(i.type!=="output_text")throw new z(`expected content to be 'output_text', got ${i.type}`);i.text+=n.delta}break}case"response.function_call_arguments.delta":{let a=r.output[n.output_index];if(!a)throw new z(`missing output at index ${n.output_index}`);a.type==="function_call"&&(a.arguments+=n.delta);break}case"response.completed":{Ol(this,Vi,n.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],n=[],r=!1;return this.on("event",a=>{let i=n.shift();i?i.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(let a of n)a.resolve(void 0);n.length=0}),this.on("abort",a=>{r=!0;for(let i of n)i.reject(a);n.length=0}),this.on("error",a=>{r=!0;for(let i of n)i.reject(a);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,s)=>n.push({resolve:i,reject:s})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=Hi(this,jh,"f");if(!e)throw new z("stream ended without producing a ChatCompletion");return e}};function uM(t,e){return QE(t,e)}var Gi=class extends N{constructor(){super(...arguments),this.inputItems=new El(this._client)}create(e,n){var r;return this._client.post("/responses",{body:e,...n,stream:(r=e.stream)!=null?r:!1})._thenUnwrap(a=>("object"in a&&a.object==="response"&&iw(a),a))}retrieve(e,n={},r){return ie(n)?this.retrieve(e,{},n):this._client.get(`/responses/${e}`,{query:n,...r})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(r=>aw(r,e))}stream(e,n){return Mh.createResponse(this._client,e,n)}},kh=class extends _e{};Gi.InputItems=El;var Cl=class extends N{create(e,n,r){return this._client.post(`/uploads/${e}/parts`,Xn({body:n,...r}))}};var Zi=class extends N{constructor(){super(...arguments),this.parts=new Cl(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,r){return this._client.post(`/uploads/${e}/complete`,{body:n,...r})}};Zi.Parts=Cl;var rO=async t=>{let e=await Promise.allSettled(t),n=e.filter(a=>a.status==="rejected");if(n.length){for(let a of n)console.error(a.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}let r=[];for(let a of e)a.status==="fulfilled"&&r.push(a.value);return r};var Ki=class extends N{create(e,n,r){return this._client.post(`/vector_stores/${e}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,a){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,n={},r){return ie(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,Yi,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){let a=await this.create(e,n,r);return await this.poll(e,a.id,r)}async poll(e,n,r){let a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let i=await this.retrieve(e,n,{...r,headers:a}).withResponse(),s=i.data;switch(s.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let u=i.response.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await Ca(o);break;case"failed":case"completed":return s}}}async upload(e,n,r){let a=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(e,{file_id:a.id},r)}async uploadAndPoll(e,n,r){let a=await this.upload(e,n,r);return await this.poll(e,a.id,r)}content(e,n,r){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,Il,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},Yi=class extends _e{},Il=class extends Vr{};Ki.VectorStoreFilesPage=Yi;Ki.FileContentResponsesPage=Il;var Pl=class extends N{create(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){let a=await this.create(e,n);return await this.poll(e,a.id,r)}listFiles(e,n,r={},a){return ie(r)?this.listFiles(e,n,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,Yi,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async poll(e,n,r){let a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:i,response:s}=await this.retrieve(e,n,{...r,headers:a}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let u=s.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await Ca(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:n,fileIds:r=[]},a){var d;if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=(d=a==null?void 0:a.maxConcurrency)!=null?d:5,s=Math.min(i,n.length),o=this._client,u=n.values(),l=[...r];async function c(p){for(let g of p){let b=await o.files.create({file:g,purpose:"assistants"},a);l.push(b.id)}}let f=Array(s).fill(u).map(c);return await rO(f),await this.createAndPoll(e,{file_ids:l})}};var Nn=class extends N{constructor(){super(...arguments),this.files=new Ki(this._client),this.fileBatches=new Pl(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/vector_stores/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return ie(e)?this.list({},e):this._client.getAPIList("/vector_stores",ao,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,r){return this._client.getAPIList(`/vector_stores/${e}/search`,io,{body:n,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},ao=class extends _e{},io=class extends Vr{};Nn.VectorStoresPage=ao;Nn.VectorStoreSearchResponsesPage=io;Nn.Files=Ki;Nn.VectorStoreFilesPage=Yi;Nn.FileContentResponsesPage=Il;Nn.FileBatches=Pl;var aO,ee=class extends bh{constructor({baseURL:e=Of("OPENAI_BASE_URL"),apiKey:n=Of("OPENAI_API_KEY"),organization:r=(s=>(s=Of("OPENAI_ORG_ID"))!=null?s:null)(),project:a=(o=>(o=Of("OPENAI_PROJECT_ID"))!=null?o:null)(),...i}={}){var l;if(n===void 0)throw new z("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let u={apiKey:n,organization:r,project:a,...i,baseURL:e||"https://api.openai.com/v1"};if(!u.dangerouslyAllowBrowser&&jE())throw new z(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:u.baseURL,timeout:(l=u.timeout)!=null?l:6e5,httpAgent:u.httpAgent,maxRetries:u.maxRetries,fetch:u.fetch}),this.completions=new Ks(this),this.chat=new Ia(this),this.embeddings=new Ys(this),this.files=new Bi(this),this.images=new to(this),this.audio=new Gr(this),this.moderations=new ro(this),this.models=new qi(this),this.fineTuning=new gr(this),this.vectorStores=new Nn(this),this.beta=new mr(this),this.batches=new Mi(this),this.uploads=new Zi(this),this.responses=new Gi(this),this.evals=new Jr(this),this._options=u,this.apiKey=n,this.organization=r,this.project=a}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return x_(e,{arrayFormat:"brackets"})}};aO=ee;ee.OpenAI=aO;ee.DEFAULT_TIMEOUT=6e5;ee.OpenAIError=z;ee.APIError=lt;ee.APIConnectionError=Oa;ee.APIConnectionTimeoutError=dr;ee.APIUserAbortError=Ke;ee.NotFoundError=Yu;ee.ConflictError=Ju;ee.RateLimitError=Qu;ee.BadRequestError=Gu;ee.AuthenticationError=Zu;ee.InternalServerError=Wu;ee.PermissionDeniedError=Ku;ee.UnprocessableEntityError=Xu;ee.toFile=nl;ee.fileFromPath=Af;ee.Completions=Ks;ee.Chat=Ia;ee.ChatCompletionsPage=ji;ee.Embeddings=Ys;ee.Files=Bi;ee.FileObjectsPage=Qs;ee.Images=to;ee.Audio=Gr;ee.Moderations=ro;ee.Models=qi;ee.ModelsPage=no;ee.FineTuning=gr;ee.VectorStores=Nn;ee.VectorStoresPage=ao;ee.VectorStoreSearchResponsesPage=io;ee.Beta=mr;ee.Batches=Mi;ee.BatchesPage=Bs;ee.Uploads=Zi;ee.Responses=Gi;ee.Evals=Jr;ee.EvalListResponsesPage=Xs;var iO=ee;async function sw(t,e){let n=new window.AudioContext,r=await n.decodeAudioData(t),a=pM(n,r),i=Math.floor(e/4),s=Math.ceil(a.length/i),o=[];for(let u=0;u<s;u++){let l=u*i,c=Math.min((u+1)*i,a.length),f=n.createBuffer(1,c-l,a.sampleRate),d=f.getChannelData(0),p=a.getChannelData(0);d.set(p.slice(l,c));let g=hM(f),b=await nl(g,mM(u,"wav"));o.push(b)}return o}function pM(t,e){let n=e.numberOfChannels;if(n===1)return e;let r=e.length,a=e.sampleRate,i=t.createBuffer(1,r,a),s=i.getChannelData(0);for(let o=0;o<r;o++){let u=0;for(let l=0;l<n;l++)u+=e.getChannelData(l)[o];s[o]=u/n}return i}function hM(t){let e=t.numberOfChannels,n=t.sampleRate,r=t.length*e*2,a=new ArrayBuffer(44+r),i=new DataView(a);$h(i,0,"RIFF"),i.setUint32(4,36+r,!0),$h(i,8,"WAVE"),$h(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,e,!0),i.setUint32(24,n,!0),i.setUint32(28,n*e*2,!0),i.setUint16(32,e*2,!0),i.setUint16(34,16,!0),$h(i,36,"data"),i.setUint32(40,r,!0);let s=44;for(let o=0;o<t.length;o++)for(let u=0;u<e;u++){let l=t.getChannelData(u)[o]*32767;i.setInt16(s,(l<0,l),!0),s+=2}return a}function $h(t,e,n){for(let r=0;r<n.length;r++)t.setUint8(e+r,n.charCodeAt(r))}function mM(t,e){return`audio_${t.toString().padStart(3,"0")}.${e}`}function ow(t,e=Nl){t=t.trim();let n=t.indexOf("```");if(n===-1)return e(t);let r=t.substring(n+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));let a=r.indexOf("```"),i=r;return a!==-1&&(i=r.substring(0,a)),e(i.trim())}function Nl(t){if(typeof t=="undefined")return null;try{return JSON.parse(t)}catch(i){}let e="",n=[],r=!1,a=!1;for(let i of t){if(r)i==='"'&&!a?r=!1:i===`
`&&!a?i="\\n":i==="\\"?a=!a:a=!1;else if(i==='"')r=!0,a=!1;else if(i==="{")n.push("}");else if(i==="[")n.push("]");else if(i==="}"||i==="]")if(n&&n[n.length-1]===i)n.pop();else return null;e+=i}r&&(e+='"');for(let i=n.length-1;i>=0;i-=1)e+=n[i];try{return JSON.parse(e)}catch(i){return null}}var mO=Z(oO(),1),SM=Z(hO(),1);function gO(t,e){return(e==null?void 0:e[t])||(0,mO.default)(t)}function yO(t,e,n){let r={};for(let a in t)Object.hasOwn(t,a)&&(r[e(a,n)]=t[a]);return r}function bO(t){return Array.isArray(t)?[...t]:{...t}}function xM(t,e){let n=bO(t);for(let[r,a]of Object.entries(e)){let[i,...s]=r.split(".").reverse(),o=n;for(let u of s.reverse()){if(o[u]===void 0)break;o[u]=bO(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[a]})}return n}function lw(t){let e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}var yr=class t{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,lw(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...n){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>{var a;return(a=this.lc_serializable_keys)==null?void 0:a.includes(r)})):this.lc_kwargs=e!=null?e:{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof t||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},n={},r=Object.keys(this.lc_kwargs).reduce((a,i)=>(a[i]=i in this?this[i]:this.lc_kwargs[i],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(n,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(n).forEach(a=>{let i=this,s=r,[o,...u]=a.split(".").reverse();for(let l of u.reverse()){if(!(l in i)||i[l]===void 0)return;(!(l in s)||s[l]===void 0)&&(typeof i[l]=="object"&&i[l]!=null?s[l]={}:Array.isArray(i[l])&&(s[l]=[])),i=i[l],s=s[l]}o in i&&i[o]!==void 0&&(s[o]=s[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:yO(Object.keys(n).length?xM(r,n):r,gO,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function ja(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")}function _O(t){return ja(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"}function wO(t){return ja(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"}function vO(t){if(ja(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function cw(t){let e=t.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${t}" - does not match type/subtype format.`);let n=e[0].trim(),r=e[1].trim();if(n===""||r==="")throw new Error(`Invalid mime type: "${t}" - type or subtype is empty.`);let a={};for(let i of t.split(";").slice(1)){let s=i.split("=");if(s.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${t}".`);let o=s[0].trim(),u=s[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${t}".`);a[o]=u}return{type:n,subtype:r,parameters:a}}function fw({dataUrl:t,asTypedArray:e=!1}){let n=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/),r;if(n){r=n[1].toLowerCase();let a=e?Uint8Array.from(atob(n[2]),i=>i.charCodeAt(0)):n[2];return{mime_type:r,data:a}}}function dw(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)}function Qn(t,e){var n;return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.some(r=>ja(r))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?(n=Bf(t,e))!=null?n:[...t,...e]:e===""?t:Array.isArray(t)&&t.some(r=>ja(r))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function SO(t,e){return t==="error"||e==="error"?"error":"success"}function AM(t,e){function n(r,a){if(typeof r!="object"||r===null||r===void 0)return r;if(a>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(s=>n(s,a+1));let i={};for(let s of Object.keys(r))i[s]=n(r[s],a+1);return i}return JSON.stringify(n(t,0),null,2)}var Zt=class extends yr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,n){typeof e=="string"&&(e={content:e,additional_kwargs:n,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let n=AM(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${n}`}};function rt(t,e){let n={...t};for(let[r,a]of Object.entries(e))if(n[r]==null)n[r]=a;else{if(a==null)continue;if(typeof n[r]!=typeof a||Array.isArray(n[r])!==Array.isArray(a))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof n[r]=="string"){if(r==="type")continue;n[r]+=a}else if(typeof n[r]=="object"&&!Array.isArray(n[r]))n[r]=rt(n[r],a);else if(Array.isArray(n[r]))n[r]=Bf(n[r],a);else{if(n[r]===a)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return n}function Bf(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{let n=[...t];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let a=n.findIndex(i=>i.index===r.index);a!==-1?n[a]=rt(n[a],r):n.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;n.push(r)}return n}}}function xO(t,e){if(!t&&!e)throw new Error("Cannot merge two undefined objects.");if(!t||!e)return t||e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return Bf(t,e);if(typeof t=="object"&&typeof e=="object")return rt(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}var ln=class extends Zt{};function AO(t){return typeof t.role=="string"}function Ji(t){return typeof(t==null?void 0:t._getType)=="function"}function pw(t){return Ji(t)&&typeof t.concat=="function"}function TO(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0}var Ma=class extends Zt{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,n,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:n}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},kl=class t extends ln{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){var n;return new t({content:Qn(this.content,e.content),additional_kwargs:rt(this.additional_kwargs,e.additional_kwargs),response_metadata:rt(this.response_metadata,e.response_metadata),artifact:xO(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:(n=this.id)!=null?n:e.id,status:SO(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function EO(t){let e=[],n=[];for(let r of t)if(r.function){let a=r.function.name;try{let i=JSON.parse(r.function.arguments),s={name:a||"",args:i||{},id:r.id};e.push(s)}catch(i){n.push({name:a,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,n]}var kn=class extends Zt{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,n){var a,i,s,o,u;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:n!=null?n:{}};else{r=e;let l=(a=r.additional_kwargs)==null?void 0:a.tool_calls,c=r.tool_calls;l!=null&&l.length>0&&(c===void 0||c.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(l!=null&&c===void 0){let[f,d]=EO(l);r.tool_calls=f!=null?f:[],r.invalid_tool_calls=d!=null?d:[]}else r.tool_calls=(i=r.tool_calls)!=null?i:[],r.invalid_tool_calls=(s=r.invalid_tool_calls)!=null?s:[]}catch(f){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=(o=r.tool_calls)!=null?o:this.tool_calls,this.invalid_tool_calls=(u=r.invalid_tool_calls)!=null?u:this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};function br(t){return t._getType()==="ai"}function hw(t){return t._getType()==="ai"}var Dn=class t extends ln{constructor(e){var r,a,i,s,o;let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)n={...e,tool_calls:(r=e.tool_calls)!=null?r:[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{let u=[],l=[];for(let c of e.tool_call_chunks){let f={};try{if(f=Nl(c.args||"{}"),f===null||typeof f!="object"||Array.isArray(f))throw new Error("Malformed tool call chunk args.");u.push({name:(a=c.name)!=null?a:"",args:f,id:c.id,type:"tool_call"})}catch(d){l.push({name:c.name,args:c.args,id:c.id,error:"Malformed args.",type:"invalid_tool_call"})}}n={...e,tool_calls:u,invalid_tool_calls:l,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=(i=n.tool_call_chunks)!=null?i:this.tool_call_chunks,this.tool_calls=(s=n.tool_calls)!=null?s:this.tool_calls,this.invalid_tool_calls=(o=n.invalid_tool_calls)!=null?o:this.invalid_tool_calls,this.usage_metadata=n.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,a,i,s,o,u,l,c,f,d,p,g,b,_,m,h,y,v,S,A,T,x,C,R,B,te,je,Ge,st,fs,Tt,Zo,Ko,Yo,ni,cc,fc,dc,zn,ds,Jo,Xo,kd,Pr,Nr,ri,ai,ps,hs,ms,pc,gs,Dd;let n={content:Qn(this.content,e.content),additional_kwargs:rt(this.additional_kwargs,e.additional_kwargs),response_metadata:rt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:(r=this.id)!=null?r:e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let D=Bf(this.tool_call_chunks,e.tool_call_chunks);D!==void 0&&D.length>0&&(n.tool_call_chunks=D)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let D={...(((i=(a=this.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:i.audio)!==void 0||((o=(s=e.usage_metadata)==null?void 0:s.input_token_details)==null?void 0:o.audio)!==void 0)&&{audio:((c=(l=(u=this.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:l.audio)!=null?c:0)+((p=(d=(f=e.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:d.audio)!=null?p:0)},...(((b=(g=this.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:b.cache_read)!==void 0||((m=(_=e.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:m.cache_read)!==void 0)&&{cache_read:((v=(y=(h=this.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:y.cache_read)!=null?v:0)+((T=(A=(S=e.usage_metadata)==null?void 0:S.input_token_details)==null?void 0:A.cache_read)!=null?T:0)},...(((C=(x=this.usage_metadata)==null?void 0:x.input_token_details)==null?void 0:C.cache_creation)!==void 0||((B=(R=e.usage_metadata)==null?void 0:R.input_token_details)==null?void 0:B.cache_creation)!==void 0)&&{cache_creation:((Ge=(je=(te=this.usage_metadata)==null?void 0:te.input_token_details)==null?void 0:je.cache_creation)!=null?Ge:0)+((Tt=(fs=(st=e.usage_metadata)==null?void 0:st.input_token_details)==null?void 0:fs.cache_creation)!=null?Tt:0)}},ys={...(((Ko=(Zo=this.usage_metadata)==null?void 0:Zo.output_token_details)==null?void 0:Ko.audio)!==void 0||((ni=(Yo=e.usage_metadata)==null?void 0:Yo.output_token_details)==null?void 0:ni.audio)!==void 0)&&{audio:((dc=(fc=(cc=this.usage_metadata)==null?void 0:cc.output_token_details)==null?void 0:fc.audio)!=null?dc:0)+((Jo=(ds=(zn=e.usage_metadata)==null?void 0:zn.output_token_details)==null?void 0:ds.audio)!=null?Jo:0)},...(((kd=(Xo=this.usage_metadata)==null?void 0:Xo.output_token_details)==null?void 0:kd.reasoning)!==void 0||((Nr=(Pr=e.usage_metadata)==null?void 0:Pr.output_token_details)==null?void 0:Nr.reasoning)!==void 0)&&{reasoning:((ps=(ai=(ri=this.usage_metadata)==null?void 0:ri.output_token_details)==null?void 0:ai.reasoning)!=null?ps:0)+((pc=(ms=(hs=e.usage_metadata)==null?void 0:hs.output_token_details)==null?void 0:ms.reasoning)!=null?pc:0)}},G=(gs=this.usage_metadata)!=null?gs:{input_tokens:0,output_tokens:0,total_tokens:0},q=(Dd=e.usage_metadata)!=null?Dd:{input_tokens:0,output_tokens:0,total_tokens:0},Q={input_tokens:G.input_tokens+q.input_tokens,output_tokens:G.output_tokens+q.output_tokens,total_tokens:G.total_tokens+q.total_tokens,...Object.keys(D).length>0&&{input_token_details:D},...Object.keys(ys).length>0&&{output_token_details:ys}};n.usage_metadata=Q}return new t(n)}};var Xi=class t extends Zt{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return t}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},so=class t extends ln{static lc_name(){return"ChatMessageChunk"}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){var n;return new t({content:Qn(this.content,e.content),additional_kwargs:rt(this.additional_kwargs,e.additional_kwargs),response_metadata:rt(this.response_metadata,e.response_metadata),role:this.role,id:(n=this.id)!=null?n:e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}};var oo=class t extends ln{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){var n,r;return new t({content:Qn(this.content,e.content),additional_kwargs:rt(this.additional_kwargs,e.additional_kwargs),response_metadata:rt(this.response_metadata,e.response_metadata),name:(n=this.name)!=null?n:"",id:(r=this.id)!=null?r:e.id})}};var _r=class extends Zt{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,n){super(e,n)}},uo=class t extends ln{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,n){super(e,n)}concat(e){var n;return new t({content:Qn(this.content,e.content),additional_kwargs:rt(this.additional_kwargs,e.additional_kwargs),response_metadata:rt(this.response_metadata,e.response_metadata),id:(n=this.id)!=null?n:e.id})}};var Qr=class extends Zt{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,n){super(e,n)}},Qi=class t extends ln{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,n){super(e,n)}concat(e){var n;return new t({content:Qn(this.content,e.content),additional_kwargs:rt(this.additional_kwargs,e.additional_kwargs),response_metadata:rt(this.response_metadata,e.response_metadata),id:(n=this.id)!=null?n:e.id})}};function Lh(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function Dl(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}var lo=class extends Error{constructor(e,n){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=n}};function EM(t){return Dl(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function OM(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function mw(t){let e,n;if(OM(t)){let r=t.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",n=t.kwargs}else{let{type:r,...a}=t;e=r,n=a}if(e==="human"||e==="user")return new _r(n);if(e==="ai"||e==="assistant"){let{tool_calls:r,...a}=n;if(!Array.isArray(r))return new kn(n);let i=r.map(EM);return new kn({...a,tool_calls:i})}else{if(e==="system")return new Qr(n);if(e==="developer")return new Qr({...n,additional_kwargs:{...n.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in n)return new Ma({...n,content:n.content,tool_call_id:n.tool_call_id,name:n.name});throw Lh(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function co(t){if(typeof t=="string")return new _r(t);if(Ji(t))return t;if(Array.isArray(t)){let[e,n]=t;return mw({type:e,content:n})}else if(AO(t)){let{role:e,...n}=t;return mw({...n,type:e})}else return mw(t)}function Ff(t,e="Human",n="AI"){let r=[];for(let a of t){let i;if(a._getType()==="human")i=e;else if(a._getType()==="ai")i=n;else if(a._getType()==="system")i="System";else if(a._getType()==="function")i="Function";else if(a._getType()==="tool")i="Tool";else if(a._getType()==="generic")i=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);let s=a.name?`${a.name}, `:"",o=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);r.push(`${i}: ${s}${o}`)}return r.join(`
`)}function gw(t){var n;let e=t._getType();if(e==="human")return new uo({...t});if(e==="ai"){let r={...t};return"tool_calls"in r&&(r={...r,tool_call_chunks:(n=r.tool_calls)==null?void 0:n.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new Dn({...r})}else{if(e==="system")return new Qi({...t});if(e==="function")return new oo({...t});if(Xi.isInstance(t))return new so({...t});throw new Error("Unknown message type.")}}var we;(function(t){t.assertEqual=a=>a;function e(a){}t.assertIs=e;function n(a){throw new Error}t.assertNever=n,t.arrayToEnum=a=>{let i={};for(let s of a)i[s]=s;return i},t.getValidEnumValues=a=>{let i=t.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),s={};for(let o of i)s[o]=a[o];return t.objectValues(s)},t.objectValues=a=>t.objectKeys(a).map(function(i){return a[i]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let i=[];for(let s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},t.find=(a,i)=>{for(let s of a)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=r,t.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(we||(we={}));var bw;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(bw||(bw={}));var M=we.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),La=t=>{switch(typeof t){case"undefined":return M.undefined;case"string":return M.string;case"number":return isNaN(t)?M.nan:M.number;case"boolean":return M.boolean;case"function":return M.function;case"bigint":return M.bigint;case"symbol":return M.symbol;case"object":return Array.isArray(t)?M.array:t===null?M.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?M.promise:typeof Map!="undefined"&&t instanceof Map?M.map:typeof Set!="undefined"&&t instanceof Set?M.set:typeof Date!="undefined"&&t instanceof Date?M.date:M.object;default:return M.unknown}},I=we.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),RM=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),jn=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(i){return i.message},r={_errors:[]},a=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)r._errors.push(n(s));else{let o=r,u=0;for(;u<s.path.length;){let l=s.path[u];u===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(n(s))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return a(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,we.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},r=[];for(let a of this.issues)a.path.length>0?(n[a.path[0]]=n[a.path[0]]||[],n[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};jn.create=t=>new jn(t);var $l=(t,e)=>{let n;switch(t.code){case I.invalid_type:t.received===M.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case I.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,we.jsonStringifyReplacer)}`;break;case I.unrecognized_keys:n=`Unrecognized key(s) in object: ${we.joinValues(t.keys,", ")}`;break;case I.invalid_union:n="Invalid input";break;case I.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${we.joinValues(t.options)}`;break;case I.invalid_enum_value:n=`Invalid enum value. Expected ${we.joinValues(t.options)}, received '${t.received}'`;break;case I.invalid_arguments:n="Invalid function arguments";break;case I.invalid_return_type:n="Invalid function return type";break;case I.invalid_date:n="Invalid date";break;case I.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:we.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case I.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case I.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case I.custom:n="Invalid input";break;case I.invalid_intersection_types:n="Intersection results could not be merged";break;case I.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case I.not_finite:n="Number must be finite";break;default:n=e.defaultError,we.assertNever(t)}return{message:n}},IO=$l;function CM(t){IO=t}function Uh(){return IO}var zh=t=>{let{data:e,path:n,errorMaps:r,issueData:a}=t,i=[...n,...a.path||[]],s={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let o="",u=r.filter(l=>!!l).slice().reverse();for(let l of u)o=l(s,{data:e,defaultError:o}).message;return{...a,path:i,message:o}},IM=[];function k(t,e){let n=Uh(),r=zh({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===$l?void 0:$l].filter(a=>!!a)});t.common.issues.push(r)}var Lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let r=[];for(let a of n){if(a.status==="aborted")return X;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){let r=[];for(let a of n){let i=await a.key,s=await a.value;r.push({key:i,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,n){let r={};for(let a of n){let{key:i,value:s}=a;if(i.status==="aborted"||s.status==="aborted")return X;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value!="undefined"||a.alwaysSet)&&(r[i.value]=s.value)}return{status:e.value,value:r}}},X=Object.freeze({status:"aborted"}),Ml=t=>({status:"dirty",value:t}),Kt=t=>({status:"valid",value:t}),_w=t=>t.status==="aborted",ww=t=>t.status==="dirty",fo=t=>t.status==="valid",Vf=t=>typeof Promise!="undefined"&&t instanceof Promise;function Bh(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function PO(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n}var F;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(F||(F={}));var qf,Hf,Wn=class{constructor(e,n,r,a){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},OO=(t,e)=>{if(fo(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new jn(t.common.issues);return this._error=n,this._error}}};function se(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:a}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(s,o)=>{var u,l;let{message:c}=t;return s.code==="invalid_enum_value"?{message:c!=null?c:o.defaultError}:typeof o.data=="undefined"?{message:(u=c!=null?c:r)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c!=null?c:n)!==null&&l!==void 0?l:o.defaultError}},description:a}}var oe=class{get description(){return this._def.description}_getType(e){return La(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:La(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Lt,ctx:{common:e.parent.common,data:e.data,parsedType:La(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(Vf(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;let a={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:La(e)},i=this._parseSync({data:e,path:a.path,parent:a});return OO(a,i)}"~validate"(e){var n,r;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:La(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:a});return fo(i)?{value:i.value}:{issues:a.common.issues}}catch(i){!((r=(n=i==null?void 0:i.message)===null||n===void 0?void 0:n.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(i=>fo(i)?{value:i.value}:{issues:a.common.issues})}async parseAsync(e,n){let r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){let r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:La(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await(Vf(a)?a:Promise.resolve(a));return OO(r,i)}refine(e,n){let r=a=>typeof n=="string"||typeof n=="undefined"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,i)=>{let s=e(a),o=()=>i.addIssue({code:I.custom,...r(a)});return typeof Promise!="undefined"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(e){return new Mn({schema:this,typeName:E.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return cn.create(this,this._def)}nullable(){return ea.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return za.create(this)}promise(){return ts.create(this,this._def)}or(e){return _o.create([this,e],this._def)}and(e){return wo.create(this,e,this._def)}transform(e){return new Mn({...se(this._def),schema:this,typeName:E.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new To({...se(this._def),innerType:this,defaultValue:n,typeName:E.ZodDefault})}brand(){return new Gf({typeName:E.ZodBranded,type:this,...se(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new Eo({...se(this._def),innerType:this,catchValue:n,typeName:E.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Zf.create(this,e)}readonly(){return Oo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},PM=/^c[^\s-]{8,}$/i,NM=/^[0-9a-z]+$/,kM=/^[0-9A-HJKMNP-TV-Z]{26}$/i,DM=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,jM=/^[a-z0-9_-]{21}$/i,MM=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,$M=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,LM=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,UM="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",yw,zM=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,BM=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,FM=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qM=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,HM=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,VM=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,NO="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",GM=new RegExp(`^${NO}$`);function kO(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function ZM(t){return new RegExp(`^${kO(t)}$`)}function DO(t){let e=`${NO}T${kO(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function KM(t,e){return!!((e==="v4"||!e)&&zM.test(t)||(e==="v6"||!e)&&FM.test(t))}function YM(t,e){if(!MM.test(t))return!1;try{let[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||!a.typ||!a.alg||e&&a.alg!==e)}catch(n){return!1}}function JM(t,e){return!!((e==="v4"||!e)&&BM.test(t)||(e==="v6"||!e)&&qM.test(t))}var Wi=class t extends oe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==M.string){let i=this._getOrReturnCtx(e);return k(i,{code:I.invalid_type,expected:M.string,received:i.parsedType}),X}let r=new Lt,a;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:I.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:I.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,o=e.data.length<i.value;(s||o)&&(a=this._getOrReturnCtx(e,a),s?k(a,{code:I.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&k(a,{code:I.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")LM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"email",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")yw||(yw=new RegExp(UM,"u")),yw.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"emoji",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")DM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"uuid",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")jM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"nanoid",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")PM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"cuid",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")NM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"cuid2",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")kM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"ulid",code:I.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch(s){a=this._getOrReturnCtx(e,a),k(a,{validation:"url",code:I.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"regex",code:I.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),k(a,{code:I.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),k(a,{code:I.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),k(a,{code:I.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?DO(i).test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:I.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?GM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:I.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?ZM(i).test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:I.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?$M.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"duration",code:I.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?KM(e.data,i.version)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"ip",code:I.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?YM(e.data,i.alg)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"jwt",code:I.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?JM(e.data,i.version)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"cidr",code:I.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?HM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"base64",code:I.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?VM.test(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{validation:"base64url",code:I.invalid_string,message:i.message}),r.dirty()):we.assertNever(i);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(a=>e.test(a),{validation:n,code:I.invalid_string,...F.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...F.errToObj(e)})}url(e){return this._addCheck({kind:"url",...F.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...F.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...F.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...F.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...F.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...F.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...F.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...F.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...F.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...F.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...F.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...F.errToObj(e)})}datetime(e){var n,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)=="undefined"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...F.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)=="undefined"?null:e==null?void 0:e.precision,...F.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...F.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...F.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...F.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...F.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...F.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...F.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...F.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...F.errToObj(n)})}nonempty(e){return this.min(1,F.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};Wi.create=t=>{var e;return new Wi({checks:[],typeName:E.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...se(t)})};function XM(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=n>r?n:r,i=parseInt(t.toFixed(a).replace(".","")),s=parseInt(e.toFixed(a).replace(".",""));return i%s/Math.pow(10,a)}var po=class t extends oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==M.number){let i=this._getOrReturnCtx(e);return k(i,{code:I.invalid_type,expected:M.number,received:i.parsedType}),X}let r,a=new Lt;for(let i of this._def.checks)i.kind==="int"?we.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{code:I.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),k(r,{code:I.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),k(r,{code:I.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?XM(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),k(r,{code:I.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),k(r,{code:I.not_finite,message:i.message}),a.dirty()):we.assertNever(i);return{status:a.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,F.toString(n))}gt(e,n){return this.setLimit("min",e,!1,F.toString(n))}lte(e,n){return this.setLimit("max",e,!0,F.toString(n))}lt(e,n){return this.setLimit("max",e,!1,F.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:F.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:F.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:F.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:F.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:F.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:F.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:F.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:F.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:F.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:F.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&we.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};po.create=t=>new po({checks:[],typeName:E.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...se(t)});var ho=class t extends oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(i){return this._getInvalidInput(e)}if(this._getType(e)!==M.bigint)return this._getInvalidInput(e);let r,a=new Lt;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),k(r,{code:I.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),k(r,{code:I.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),k(r,{code:I.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):we.assertNever(i);return{status:a.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return k(n,{code:I.invalid_type,expected:M.bigint,received:n.parsedType}),X}gte(e,n){return this.setLimit("min",e,!0,F.toString(n))}gt(e,n){return this.setLimit("min",e,!1,F.toString(n))}lte(e,n){return this.setLimit("max",e,!0,F.toString(n))}lt(e,n){return this.setLimit("max",e,!1,F.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:F.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:F.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:F.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:F.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:F.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:F.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};ho.create=t=>{var e;return new ho({checks:[],typeName:E.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...se(t)})};var mo=class extends oe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==M.boolean){let r=this._getOrReturnCtx(e);return k(r,{code:I.invalid_type,expected:M.boolean,received:r.parsedType}),X}return Kt(e.data)}};mo.create=t=>new mo({typeName:E.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...se(t)});var go=class t extends oe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==M.date){let i=this._getOrReturnCtx(e);return k(i,{code:I.invalid_type,expected:M.date,received:i.parsedType}),X}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return k(i,{code:I.invalid_date}),X}let r=new Lt,a;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:I.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),k(a,{code:I.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):we.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:F.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:F.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};go.create=t=>new go({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:E.ZodDate,...se(t)});var Ll=class extends oe{_parse(e){if(this._getType(e)!==M.symbol){let r=this._getOrReturnCtx(e);return k(r,{code:I.invalid_type,expected:M.symbol,received:r.parsedType}),X}return Kt(e.data)}};Ll.create=t=>new Ll({typeName:E.ZodSymbol,...se(t)});var yo=class extends oe{_parse(e){if(this._getType(e)!==M.undefined){let r=this._getOrReturnCtx(e);return k(r,{code:I.invalid_type,expected:M.undefined,received:r.parsedType}),X}return Kt(e.data)}};yo.create=t=>new yo({typeName:E.ZodUndefined,...se(t)});var bo=class extends oe{_parse(e){if(this._getType(e)!==M.null){let r=this._getOrReturnCtx(e);return k(r,{code:I.invalid_type,expected:M.null,received:r.parsedType}),X}return Kt(e.data)}};bo.create=t=>new bo({typeName:E.ZodNull,...se(t)});var es=class extends oe{constructor(){super(...arguments),this._any=!0}_parse(e){return Kt(e.data)}};es.create=t=>new es({typeName:E.ZodAny,...se(t)});var Ua=class extends oe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Kt(e.data)}};Ua.create=t=>new Ua({typeName:E.ZodUnknown,...se(t)});var wr=class extends oe{_parse(e){let n=this._getOrReturnCtx(e);return k(n,{code:I.invalid_type,expected:M.never,received:n.parsedType}),X}};wr.create=t=>new wr({typeName:E.ZodNever,...se(t)});var Ul=class extends oe{_parse(e){if(this._getType(e)!==M.undefined){let r=this._getOrReturnCtx(e);return k(r,{code:I.invalid_type,expected:M.void,received:r.parsedType}),X}return Kt(e.data)}};Ul.create=t=>new Ul({typeName:E.ZodVoid,...se(t)});var za=class t extends oe{_parse(e){let{ctx:n,status:r}=this._processInputParams(e),a=this._def;if(n.parsedType!==M.array)return k(n,{code:I.invalid_type,expected:M.array,received:n.parsedType}),X;if(a.exactLength!==null){let s=n.data.length>a.exactLength.value,o=n.data.length<a.exactLength.value;(s||o)&&(k(n,{code:s?I.too_big:I.too_small,minimum:o?a.exactLength.value:void 0,maximum:s?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(k(n,{code:I.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(k(n,{code:I.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((s,o)=>a.type._parseAsync(new Wn(n,s,n.path,o)))).then(s=>Lt.mergeArray(r,s));let i=[...n.data].map((s,o)=>a.type._parseSync(new Wn(n,s,n.path,o)));return Lt.mergeArray(r,i)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:F.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:F.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:F.toString(n)}})}nonempty(e){return this.min(1,e)}};za.create=(t,e)=>new za({type:t,minLength:null,maxLength:null,exactLength:null,typeName:E.ZodArray,...se(e)});function jl(t){if(t instanceof fn){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=cn.create(jl(r))}return new fn({...t._def,shape:()=>e})}else return t instanceof za?new za({...t._def,type:jl(t.element)}):t instanceof cn?cn.create(jl(t.unwrap())):t instanceof ea?ea.create(jl(t.unwrap())):t instanceof Wr?Wr.create(t.items.map(e=>jl(e))):t}var fn=class t extends oe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=we.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==M.object){let l=this._getOrReturnCtx(e);return k(l,{code:I.invalid_type,expected:M.object,received:l.parsedType}),X}let{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof wr&&this._def.unknownKeys==="strip"))for(let l in a.data)s.includes(l)||o.push(l);let u=[];for(let l of s){let c=i[l],f=a.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new Wn(a,f,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof wr){let l=this._def.unknownKeys;if(l==="passthrough")for(let c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:a.data[c]}});else if(l==="strict")o.length>0&&(k(a,{code:I.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let c of o){let f=a.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new Wn(a,f,a.path,c)),alwaysSet:c in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let l=[];for(let c of u){let f=await c.key,d=await c.value;l.push({key:f,value:d,alwaysSet:c.alwaysSet})}return l}).then(l=>Lt.mergeObjectSync(r,l)):Lt.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return F.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var a,i,s,o;let u=(s=(i=(a=this._def).errorMap)===null||i===void 0?void 0:i.call(a,n,r).message)!==null&&s!==void 0?s:r.defaultError;return n.code==="unrecognized_keys"?{message:(o=F.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:E.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};return we.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new t({...this._def,shape:()=>n})}omit(e){let n={};return we.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new t({...this._def,shape:()=>n})}deepPartial(){return jl(this)}partial(e){let n={};return we.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?n[r]=a:n[r]=a.optional()}),new t({...this._def,shape:()=>n})}required(e){let n={};return we.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof cn;)i=i._def.innerType;n[r]=i}}),new t({...this._def,shape:()=>n})}keyof(){return jO(we.objectKeys(this.shape))}};fn.create=(t,e)=>new fn({shape:()=>t,unknownKeys:"strip",catchall:wr.create(),typeName:E.ZodObject,...se(e)});fn.strictCreate=(t,e)=>new fn({shape:()=>t,unknownKeys:"strict",catchall:wr.create(),typeName:E.ZodObject,...se(e)});fn.lazycreate=(t,e)=>new fn({shape:t,unknownKeys:"strip",catchall:wr.create(),typeName:E.ZodObject,...se(e)});var _o=class extends oe{_parse(e){let{ctx:n}=this._processInputParams(e),r=this._def.options;function a(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;let s=i.map(o=>new jn(o.ctx.common.issues));return k(n,{code:I.invalid_union,unionErrors:s}),X}if(n.common.async)return Promise.all(r.map(async i=>{let s={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:s}),ctx:s}})).then(a);{let i,s=[];for(let u of r){let l={...n,common:{...n.common,issues:[]},parent:null},c=u._parseSync({data:n.data,path:n.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!i&&(i={result:c,ctx:l}),l.common.issues.length&&s.push(l.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;let o=s.map(u=>new jn(u));return k(n,{code:I.invalid_union,unionErrors:o}),X}}get options(){return this._def.options}};_o.create=(t,e)=>new _o({options:t,typeName:E.ZodUnion,...se(e)});var $a=t=>t instanceof vo?$a(t.schema):t instanceof Mn?$a(t.innerType()):t instanceof So?[t.value]:t instanceof xo?t.options:t instanceof Ao?we.objectValues(t.enum):t instanceof To?$a(t._def.innerType):t instanceof yo?[void 0]:t instanceof bo?[null]:t instanceof cn?[void 0,...$a(t.unwrap())]:t instanceof ea?[null,...$a(t.unwrap())]:t instanceof Gf||t instanceof Oo?$a(t.unwrap()):t instanceof Eo?$a(t._def.innerType):[],Fh=class t extends oe{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==M.object)return k(n,{code:I.invalid_type,expected:M.object,received:n.parsedType}),X;let r=this.discriminator,a=n.data[r],i=this.optionsMap.get(a);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(k(n,{code:I.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),X)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let a=new Map;for(let i of n){let s=$a(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,i)}}return new t({typeName:E.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:a,...se(r)})}};function vw(t,e){let n=La(t),r=La(e);if(t===e)return{valid:!0,data:t};if(n===M.object&&r===M.object){let a=we.objectKeys(e),i=we.objectKeys(t).filter(o=>a.indexOf(o)!==-1),s={...t,...e};for(let o of i){let u=vw(t[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(n===M.array&&r===M.array){if(t.length!==e.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let s=t[i],o=e[i],u=vw(s,o);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return n===M.date&&r===M.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var wo=class extends oe{_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=(i,s)=>{if(_w(i)||_w(s))return X;let o=vw(i.value,s.value);return o.valid?((ww(i)||ww(s))&&n.dirty(),{status:n.value,value:o.data}):(k(r,{code:I.invalid_intersection_types}),X)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,s])=>a(i,s)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};wo.create=(t,e,n)=>new wo({left:t,right:e,typeName:E.ZodIntersection,...se(n)});var Wr=class t extends oe{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.array)return k(r,{code:I.invalid_type,expected:M.array,received:r.parsedType}),X;if(r.data.length<this._def.items.length)return k(r,{code:I.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),X;!this._def.rest&&r.data.length>this._def.items.length&&(k(r,{code:I.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let i=[...r.data].map((s,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new Wn(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>Lt.mergeArray(n,s)):Lt.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Wr.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Wr({items:t,typeName:E.ZodTuple,rest:null,...se(e)})};var qh=class t extends oe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.object)return k(r,{code:I.invalid_type,expected:M.object,received:r.parsedType}),X;let a=[],i=this._def.keyType,s=this._def.valueType;for(let o in r.data)a.push({key:i._parse(new Wn(r,o,r.path,o)),value:s._parse(new Wn(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Lt.mergeObjectAsync(n,a):Lt.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof oe?new t({keyType:e,valueType:n,typeName:E.ZodRecord,...se(r)}):new t({keyType:Wi.create(),valueType:e,typeName:E.ZodRecord,...se(n)})}},zl=class extends oe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.map)return k(r,{code:I.invalid_type,expected:M.map,received:r.parsedType}),X;let a=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([o,u],l)=>({key:a._parse(new Wn(r,o,r.path,[l,"key"])),value:i._parse(new Wn(r,u,r.path,[l,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of s){let l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return X;(l.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(l.value,c.value)}return{status:n.value,value:o}})}else{let o=new Map;for(let u of s){let l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return X;(l.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(l.value,c.value)}return{status:n.value,value:o}}}};zl.create=(t,e,n)=>new zl({valueType:e,keyType:t,typeName:E.ZodMap,...se(n)});var Bl=class t extends oe{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.set)return k(r,{code:I.invalid_type,expected:M.set,received:r.parsedType}),X;let a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(k(r,{code:I.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(k(r,{code:I.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let i=this._def.valueType;function s(u){let l=new Set;for(let c of u){if(c.status==="aborted")return X;c.status==="dirty"&&n.dirty(),l.add(c.value)}return{status:n.value,value:l}}let o=[...r.data.values()].map((u,l)=>i._parse(new Wn(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,n){return new t({...this._def,minSize:{value:e,message:F.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:F.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Bl.create=(t,e)=>new Bl({valueType:t,minSize:null,maxSize:null,typeName:E.ZodSet,...se(e)});var Hh=class t extends oe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==M.function)return k(n,{code:I.invalid_type,expected:M.function,received:n.parsedType}),X;function r(o,u){return zh({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Uh(),$l].filter(l=>!!l),issueData:{code:I.invalid_arguments,argumentsError:u}})}function a(o,u){return zh({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Uh(),$l].filter(l=>!!l),issueData:{code:I.invalid_return_type,returnTypeError:u}})}let i={errorMap:n.common.contextualErrorMap},s=n.data;if(this._def.returns instanceof ts){let o=this;return Kt(async function(...u){let l=new jn([]),c=await o._def.args.parseAsync(u,i).catch(p=>{throw l.addIssue(r(u,p)),l}),f=await Reflect.apply(s,this,c);return await o._def.returns._def.type.parseAsync(f,i).catch(p=>{throw l.addIssue(a(f,p)),l})})}else{let o=this;return Kt(function(...u){let l=o._def.args.safeParse(u,i);if(!l.success)throw new jn([r(u,l.error)]);let c=Reflect.apply(s,this,l.data),f=o._def.returns.safeParse(c,i);if(!f.success)throw new jn([a(c,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Wr.create(e).rest(Ua.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new t({args:e||Wr.create([]).rest(Ua.create()),returns:n||Ua.create(),typeName:E.ZodFunction,...se(r)})}},vo=class extends oe{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};vo.create=(t,e)=>new vo({getter:t,typeName:E.ZodLazy,...se(e)});var So=class extends oe{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return k(n,{received:n.data,code:I.invalid_literal,expected:this._def.value}),X}return{status:"valid",value:e.data}}get value(){return this._def.value}};So.create=(t,e)=>new So({value:t,typeName:E.ZodLiteral,...se(e)});function jO(t,e){return new xo({values:t,typeName:E.ZodEnum,...se(e)})}var xo=class t extends oe{constructor(){super(...arguments),qf.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),r=this._def.values;return k(n,{expected:we.joinValues(r),received:n.parsedType,code:I.invalid_type}),X}if(Bh(this,qf,"f")||PO(this,qf,new Set(this._def.values),"f"),!Bh(this,qf,"f").has(e.data)){let n=this._getOrReturnCtx(e),r=this._def.values;return k(n,{received:n.data,code:I.invalid_enum_value,options:r}),X}return Kt(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};qf=new WeakMap;xo.create=jO;var Ao=class extends oe{constructor(){super(...arguments),Hf.set(this,void 0)}_parse(e){let n=we.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==M.string&&r.parsedType!==M.number){let a=we.objectValues(n);return k(r,{expected:we.joinValues(a),received:r.parsedType,code:I.invalid_type}),X}if(Bh(this,Hf,"f")||PO(this,Hf,new Set(we.getValidEnumValues(this._def.values)),"f"),!Bh(this,Hf,"f").has(e.data)){let a=we.objectValues(n);return k(r,{received:r.data,code:I.invalid_enum_value,options:a}),X}return Kt(e.data)}get enum(){return this._def.values}};Hf=new WeakMap;Ao.create=(t,e)=>new Ao({values:t,typeName:E.ZodNativeEnum,...se(e)});var ts=class extends oe{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==M.promise&&n.common.async===!1)return k(n,{code:I.invalid_type,expected:M.promise,received:n.parsedType}),X;let r=n.parsedType===M.promise?n.data:Promise.resolve(n.data);return Kt(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};ts.create=(t,e)=>new ts({type:t,typeName:E.ZodPromise,...se(e)});var Mn=class extends oe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===E.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:s=>{k(r,s),s.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){let s=a.transform(r.data,i);if(r.common.async)return Promise.resolve(s).then(async o=>{if(n.value==="aborted")return X;let u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?X:u.status==="dirty"||n.value==="dirty"?Ml(u.value):u});{if(n.value==="aborted")return X;let o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?X:o.status==="dirty"||n.value==="dirty"?Ml(o.value):o}}if(a.type==="refinement"){let s=o=>{let u=a.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?X:(o.status==="dirty"&&n.dirty(),s(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?X:(o.status==="dirty"&&n.dirty(),s(o.value).then(()=>({status:n.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!fo(s))return s;let o=a.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>fo(s)?Promise.resolve(a.transform(s.value,i)).then(o=>({status:n.value,value:o})):s);we.assertNever(a)}};Mn.create=(t,e,n)=>new Mn({schema:t,typeName:E.ZodEffects,effect:e,...se(n)});Mn.createWithPreprocess=(t,e,n)=>new Mn({schema:e,effect:{type:"preprocess",transform:t},typeName:E.ZodEffects,...se(n)});var cn=class extends oe{_parse(e){return this._getType(e)===M.undefined?Kt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};cn.create=(t,e)=>new cn({innerType:t,typeName:E.ZodOptional,...se(e)});var ea=class extends oe{_parse(e){return this._getType(e)===M.null?Kt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ea.create=(t,e)=>new ea({innerType:t,typeName:E.ZodNullable,...se(e)});var To=class extends oe{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return n.parsedType===M.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};To.create=(t,e)=>new To({innerType:t,typeName:E.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...se(e)});var Eo=class extends oe{_parse(e){let{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Vf(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new jn(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new jn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Eo.create=(t,e)=>new Eo({innerType:t,typeName:E.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...se(e)});var Fl=class extends oe{_parse(e){if(this._getType(e)!==M.nan){let r=this._getOrReturnCtx(e);return k(r,{code:I.invalid_type,expected:M.nan,received:r.parsedType}),X}return{status:"valid",value:e.data}}};Fl.create=t=>new Fl({typeName:E.ZodNaN,...se(t)});var QM=Symbol("zod_brand"),Gf=class extends oe{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},Zf=class t extends oe{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?X:i.status==="dirty"?(n.dirty(),Ml(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?X:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,n){return new t({in:e,out:n,typeName:E.ZodPipeline})}},Oo=class extends oe{_parse(e){let n=this._def.innerType._parse(e),r=a=>(fo(a)&&(a.value=Object.freeze(a.value)),a);return Vf(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};Oo.create=(t,e)=>new Oo({innerType:t,typeName:E.ZodReadonly,...se(e)});function RO(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function MO(t,e={},n){return t?es.create().superRefine((r,a)=>{var i,s;let o=t(r);if(o instanceof Promise)return o.then(u=>{var l,c;if(!u){let f=RO(e,r),d=(c=(l=f.fatal)!==null&&l!==void 0?l:n)!==null&&c!==void 0?c:!0;a.addIssue({code:"custom",...f,fatal:d})}});if(!o){let u=RO(e,r),l=(s=(i=u.fatal)!==null&&i!==void 0?i:n)!==null&&s!==void 0?s:!0;a.addIssue({code:"custom",...u,fatal:l})}}):es.create()}var WM={object:fn.lazycreate},E;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(E||(E={}));var e$=(t,e={message:`Input not instance of ${t.name}`})=>MO(n=>n instanceof t,e),$O=Wi.create,LO=po.create,t$=Fl.create,n$=ho.create,UO=mo.create,r$=go.create,a$=Ll.create,i$=yo.create,s$=bo.create,o$=es.create,u$=Ua.create,l$=wr.create,c$=Ul.create,f$=za.create,d$=fn.create,p$=fn.strictCreate,h$=_o.create,m$=Fh.create,g$=wo.create,y$=Wr.create,b$=qh.create,_$=zl.create,w$=Bl.create,v$=Hh.create,S$=vo.create,x$=So.create,A$=xo.create,T$=Ao.create,E$=ts.create,CO=Mn.create,O$=cn.create,R$=ea.create,C$=Mn.createWithPreprocess,I$=Zf.create,P$=()=>$O().optional(),N$=()=>LO().optional(),k$=()=>UO().optional(),D$={string:t=>Wi.create({...t,coerce:!0}),number:t=>po.create({...t,coerce:!0}),boolean:t=>mo.create({...t,coerce:!0}),bigint:t=>ho.create({...t,coerce:!0}),date:t=>go.create({...t,coerce:!0})},j$=X,at=Object.freeze({__proto__:null,defaultErrorMap:$l,setErrorMap:CM,getErrorMap:Uh,makeIssue:zh,EMPTY_PATH:IM,addIssueToContext:k,ParseStatus:Lt,INVALID:X,DIRTY:Ml,OK:Kt,isAborted:_w,isDirty:ww,isValid:fo,isAsync:Vf,get util(){return we},get objectUtil(){return bw},ZodParsedType:M,getParsedType:La,ZodType:oe,datetimeRegex:DO,ZodString:Wi,ZodNumber:po,ZodBigInt:ho,ZodBoolean:mo,ZodDate:go,ZodSymbol:Ll,ZodUndefined:yo,ZodNull:bo,ZodAny:es,ZodUnknown:Ua,ZodNever:wr,ZodVoid:Ul,ZodArray:za,ZodObject:fn,ZodUnion:_o,ZodDiscriminatedUnion:Fh,ZodIntersection:wo,ZodTuple:Wr,ZodRecord:qh,ZodMap:zl,ZodSet:Bl,ZodFunction:Hh,ZodLazy:vo,ZodLiteral:So,ZodEnum:xo,ZodNativeEnum:Ao,ZodPromise:ts,ZodEffects:Mn,ZodTransformer:Mn,ZodOptional:cn,ZodNullable:ea,ZodDefault:To,ZodCatch:Eo,ZodNaN:Fl,BRAND:QM,ZodBranded:Gf,ZodPipeline:Zf,ZodReadonly:Oo,custom:MO,Schema:oe,ZodSchema:oe,late:WM,get ZodFirstPartyTypeKind(){return E},coerce:D$,any:o$,array:f$,bigint:n$,boolean:UO,date:r$,discriminatedUnion:m$,effect:CO,enum:A$,function:v$,instanceof:e$,intersection:g$,lazy:S$,literal:x$,map:_$,nan:t$,nativeEnum:T$,never:l$,null:s$,nullable:R$,number:LO,object:d$,oboolean:k$,onumber:N$,optional:O$,ostring:P$,pipeline:I$,preprocess:C$,promise:E$,record:b$,set:w$,strictObject:p$,string:$O,symbol:a$,transformer:CO,tuple:y$,undefined:i$,union:h$,unknown:u$,void:c$,NEVER:j$,ZodIssueCode:I,quotelessJson:RM,ZodError:jn});var Rv=Z(Zh(),1);var GO=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function B$(t){return typeof t=="string"&&GO.test(t)}var ns=B$;var It=[];for(Kh=0;Kh<256;++Kh)It.push((Kh+256).toString(16).slice(1));var Kh;function ZO(t,e=0){return(It[t[e+0]]+It[t[e+1]]+It[t[e+2]]+It[t[e+3]]+"-"+It[t[e+4]]+It[t[e+5]]+"-"+It[t[e+6]]+It[t[e+7]]+"-"+It[t[e+8]]+It[t[e+9]]+"-"+It[t[e+10]]+It[t[e+11]]+It[t[e+12]]+It[t[e+13]]+It[t[e+14]]+It[t[e+15]]).toLowerCase()}var Yh,F$=new Uint8Array(16);function Sw(){if(!Yh&&(Yh=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Yh))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yh(F$)}var q$=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xw={randomUUID:q$};function H$(t,e,n){if(xw.randomUUID&&!e&&!t)return xw.randomUUID();t=t||{};var r=t.random||(t.rng||Sw)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var a=0;a<16;++a)e[n+a]=r[a];return e}return ZO(r)}var We=H$;var r1=Z(Zh(),1),nm=Z(tm(),1);var W$=(...t)=>fetch(...t),eL=Symbol.for("ls:fetch_implementation");var H=t=>async(...e)=>{var r;if(t||dn("DEBUG")==="true"){let[a,i]=e;console.log(`\u2192 ${(i==null?void 0:i.method)||"GET"} ${a}`)}let n=await((r=globalThis[eL])!=null?r:W$)(...e);return(t||dn("DEBUG")==="true")&&console.log(`\u2190 ${n.status} ${n.statusText} ${n.url}`),n};var tL=[400,401,403,404,405,406,407,408],nL=[409],Yf=class{constructor(e){var n,r;Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=(n=e.maxConcurrency)!=null?n:1/0,this.maxRetries=(r=e.maxRetries)!=null?r:6,this.debug=e.debug,"default"in nm.default?this.queue=new nm.default.default({concurrency:this.maxConcurrency}):this.queue=new nm.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...n){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,r1.default)(()=>e(...n).catch(a=>{throw a instanceof Error?a:new Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||(a==null?void 0:a.code)==="ECONNABORTED")throw a;let i=a==null?void 0:a.response,s=i==null?void 0:i.status;if(s){if(tL.includes(+s))throw a;if(nL.includes(+s))return;r&&await r(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>H(this.debug)(...e).then(n=>n.ok?n:Promise.reject(n)))}};function Iw(t){return typeof(t==null?void 0:t._getType)=="function"}function Pw(t){let e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}function re(t,e){if(!ns(t)){let n=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(n)}return t}var a1={};function rm(t){a1[t]||(console.warn(t),a1[t]=!0)}var QU=Z(YR(),1);function Ba(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);let[e,n]=t.split(":"),r=n||"latest";if(e.includes("/")){let[a,i]=e.split("/",2);if(!a||!i)throw new Error(`Invalid identifier format: ${t}`);return[a,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,r]}}var Jw=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}};async function ue(t,e,n){let r;if(t.ok){n&&(r=await t.text());return}r=await t.text();let a=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${r}`;throw t.status===409?new Jw(a):new Error(a)}var JR="[...]",WU={result:"[Circular]"},gm=[],Vl=[],e3=new TextEncoder;function t3(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function mm(t){return e3.encode(t)}function hn(t,e,n,r){var a;try{let i=JSON.stringify(t,e,n);return mm(i)}catch(i){if(!((a=i.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),mm("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r=="undefined"&&(r=t3()),Qw(t,"",0,[],void 0,0,r);let s;try{Vl.length===0?s=JSON.stringify(t,e,n):s=JSON.stringify(t,n3(e),n)}catch(o){return mm("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;gm.length!==0;){let o=gm.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return mm(s)}}function Xw(t,e,n,r){var a=Object.getOwnPropertyDescriptor(r,n);a.get!==void 0?a.configurable?(Object.defineProperty(r,n,{value:t}),gm.push([r,n,e,a])):Vl.push([e,n,t]):(r[n]=t,gm.push([r,n,e]))}function Qw(t,e,n,r,a,i,s){i+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){Xw(WU,t,e,a);return}if(typeof s.depthLimit!="undefined"&&i>s.depthLimit){Xw(JR,t,e,a);return}if(typeof s.edgesLimit!="undefined"&&n+1>s.edgesLimit){Xw(JR,t,e,a);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)Qw(t[o],o,o,r,t,i,s);else{var u=Object.keys(t);for(o=0;o<u.length;o++){var l=u[o];Qw(t[l],l,o,r,t,i,s)}}r.pop()}}function n3(t){return t=typeof t!="undefined"?t:function(e,n){return n},function(e,n){if(Vl.length>0)for(var r=0;r<Vl.length;r++){var a=Vl[r];if(a[1]===e&&a[0]===n){n=a[2],Vl.splice(r,1);break}}return t.call(this,e,n)}}function XR(t){var i,s;let e=bm(),n=eC(),r=(i=t.extra)!=null?i:{},a=r.metadata;return t.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...n,...n.revision_id||t.revision_id?{revision_id:(s=t.revision_id)!=null?s:n.revision_id}:{},...a}},t}var r3=t=>{var r;let e=(r=t==null?void 0:t.toString())!=null?r:dn("TRACING_SAMPLING_RATE");if(e===void 0)return;let n=parseFloat(e);if(n<0||n>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${n}`);return n},a3=t=>{let n=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"};async function i3(t){let e=[];for await(let n of t)e.push(n);return e}function Ww(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var s3=async t=>{var e;if((t==null?void 0:t.status)===429){let n=parseInt((e=t.headers.get("retry-after"))!=null?e:"30",10)*1e3;if(n>0)return await new Promise(r=>setTimeout(r,n)),!0}return!1};function QR(t){return typeof t=="number"?Number(t.toFixed(4)):t}var ev=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let n,r=new Promise(i=>{n=i}),a=hn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:n,itemPromise:r,size:a}),this.sizeBytes+=a,r}pop(e){var a,i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let n=[],r=0;for(;r+((i=(a=this.peek())==null?void 0:a.size)!=null?i:0)<e&&this.items.length>0;){let s=this.items.shift();s&&(n.push(s),r+=s.size,this.sizeBytes-=s.size)}if(n.length===0&&this.items.length>0){let s=this.items.shift();n.push(s),r+=s.size,this.sizeBytes-=s.size}return[n.map(s=>({action:s.action,item:s.payload})),()=>n.forEach(s=>s.itemPromiseResolve())]}},o3=20971520,u3=2500,Io=class t{constructor(e={}){var r,a,i,s,o,u,l,c,f,d,p,g,b,_,m,h,y,v,S;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new ev}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:na("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:na("LANGSMITH_DEBUG")==="true"});let n=t.getDefaultClientConfig();if(this.tracingSampleRate=r3(e.tracingSamplingRate),this.apiUrl=(a=Ww((r=e.apiUrl)!=null?r:n.apiUrl))!=null?a:"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ww((i=e.apiKey)!=null?i:n.apiKey),this.webUrl=Ww((s=e.webUrl)!=null?s:n.webUrl),(o=this.webUrl)!=null&&o.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=(u=e.timeout_ms)!=null?u:9e4,this.caller=new Yf({...(l=e.callerOptions)!=null?l:{},debug:(c=e.debug)!=null?c:this.debug}),this.traceBatchConcurrency=(f=e.traceBatchConcurrency)!=null?f:this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=(d=e.debug)!=null?d:this.debug,this.batchIngestCaller=new Yf({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...(p=e.callerOptions)!=null?p:{},onFailedResponseHook:s3,debug:(g=e.debug)!=null?g:this.debug}),this.hideInputs=(_=(b=e.hideInputs)!=null?b:e.anonymizer)!=null?_:n.hideInputs,this.hideOutputs=(h=(m=e.hideOutputs)!=null?m:e.anonymizer)!=null?h:n.hideOutputs,this.autoBatchTracing=(y=e.autoBatchTracing)!=null?y:this.autoBatchTracing,this.blockOnRootRunFinalization=(v=e.blockOnRootRunFinalization)!=null?v:this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=(S=e.manualFlushMode)!=null?S:this.manualFlushMode}static getDefaultClientConfig(){var i;let e=dn("API_KEY"),n=(i=dn("ENDPOINT"))!=null?i:"https://api.smith.langchain.com",r=dn("HIDE_INPUTS")==="true",a=dn("HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:a3(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${ym}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let n={...e};return n.inputs!==void 0&&(n.inputs=await this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=await this.processOutputs(n.outputs)),n}async _getResponse(e,n){var s;let r=(s=n==null?void 0:n.toString())!=null?s:"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(H(this.debug),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(i,`Failed to fetch ${e}`),i}async _get(e,n){return(await this._getResponse(e,n)).json()}async*_getPaginated(e,n=new URLSearchParams,r){let a=Number(n.get("offset"))||0,i=Number(n.get("limit"))||100;for(;;){n.set("offset",String(a)),n.set("limit",String(i));let s=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(H(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(o,`Failed to fetch ${e}`);let u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<i))break;a+=u.length}}async*_getCursorPaginatedList(e,n=null,r="POST",a="runs"){let i=n?{...n}:{};for(;;){let o=await(await this.caller.call(H(this.debug),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[a])break;yield o[a];let u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,n=!1){var r;if(this.tracingSampleRate===void 0)return e;if(n){let a=[];for(let i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):a.push(i);return a}else{let a=[];for(let i of e){let s=(r=i.trace_id)!=null?r:i.id;this.filteredPostUuids.has(s)||(i.id===s?this._shouldSample()?a.push(i):this.filteredPostUuids.add(s):a.push(i))}return a}}async _getBatchSizeLimitBytes(){var n,r,a;let e=await this._ensureServerInfo();return(a=(r=this.batchSizeBytesLimit)!=null?r:(n=e.batch_ingest_config)==null?void 0:n.size_limit_bytes)!=null?a:o3}async _getMultiPartSupport(){var n,r;return(r=(n=(await this._ensureServerInfo()).instance_flags)==null?void 0:n.dataset_examples_multipart_enabled)!=null?r:!1}drainAutoBatchQueue(e){let n=[];for(;this.autoBatchQueue.items.length>0;){let[r,a]=this.autoBatchQueue.pop(e);if(!r.length){a();break}let i=this._processBatch(r,a).catch(console.error);n.push(i)}return Promise.all(n)}async _processBatch(e,n){var r;if(!e.length){n();return}try{let a={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},i=await this._ensureServerInfo();(r=i==null?void 0:i.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(a):await this.batchIngestRuns(a)}finally{n()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=XR(e.item));let n=this.autoBatchQueue.push(e);if(this.manualFlushMode)return n;let r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),n}async _getServerInfo(){let e=await H(this.debug)(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(u3),...this.fetchOptions});await ue(e,"get server info");let n=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(n,null,2)+`
`),n}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{var e;if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(n){console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return(e=this._serverInfo)!=null?e:{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){var o;if(!this._filterForSampling([e]).length)return;let n={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:(o=e.start_time)!=null?o:Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}let i=XR(a),s=await this.caller.call(H(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:n,body:hn(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:n}){var o,u;if(e===void 0&&n===void 0)return;let r=await Promise.all((o=e==null?void 0:e.map(l=>this.prepareRunCreateOrUpdateInputs(l)))!=null?o:[]),a=await Promise.all((u=n==null?void 0:n.map(l=>this.prepareRunCreateOrUpdateInputs(l)))!=null?u:[]);if(r.length>0&&a.length>0){let l=r.reduce((f,d)=>(d.id&&(f[d.id]=d),f),{}),c=[];for(let f of a)f.id!==void 0&&l[f.id]?l[f.id]={...l[f.id],...f}:c.push(f);r=Object.values(l),a=c}let i={post:r,patch:a};if(!i.post.length&&!i.patch.length)return;let s={post:[],patch:[]};for(let l of["post","patch"]){let c=l,f=i[c].reverse(),d=f.pop();for(;d!==void 0;)s[c].push(d),d=f.pop()}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(hn(s))}async _postBatchIngestRuns(e){let n={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(H(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;let r={},a=[];for(let c of e!=null?e:[]){let f=await this.prepareRunCreateOrUpdateInputs(c);f.id!==void 0&&f.attachments!==void 0&&(r[f.id]=f.attachments),delete f.attachments,a.push(f)}let i=[];for(let c of n!=null?n:[])i.push(await this.prepareRunCreateOrUpdateInputs(c));if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){let c=a.reduce((d,p)=>(p.id&&(d[p.id]=p),d),{}),f=[];for(let d of i)d.id!==void 0&&c[d.id]?c[d.id]={...c[d.id],...d}:f.push(d);a=Object.values(c),i=f}if(a.length===0&&i.length===0)return;let u=[],l=[];for(let[c,f]of[["post",a],["patch",i]])for(let d of f){let{inputs:p,outputs:g,events:b,attachments:_,...m}=d,h={inputs:p,outputs:g,events:b},y=hn(m);l.push({name:`${c}.${m.id}`,payload:new Blob([y],{type:`application/json; length=${y.length}`})});for(let[v,S]of Object.entries(h)){if(S===void 0)continue;let A=hn(S);l.push({name:`${c}.${m.id}.${v}`,payload:new Blob([A],{type:`application/json; length=${A.length}`})})}if(m.id!==void 0){let v=r[m.id];if(v){delete r[m.id];for(let[S,A]of Object.entries(v)){let T,x;if(Array.isArray(A)?[T,x]=A:(T=A.mimeType,x=A.data),S.includes(".")){console.warn(`Skipping attachment '${S}' for run ${m.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${m.id}.${S}`,payload:new Blob([x],{type:`${T}; length=${x.byteLength}`})})}}}u.push(`trace=${m.trace_id},id=${m.id}`)}await this._sendMultipartRequest(l,u.join("; "))}async _sendMultipartRequest(e,n){try{let r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=[];for(let u of e)a.push(new Blob([`--${r}\r
`])),a.push(new Blob([`Content-Disposition: form-data; name="${u.name}"\r
`,`Content-Type: ${u.payload.type}\r
\r
`])),a.push(u.payload),a.push(new Blob([`\r
`]));a.push(new Blob([`--${r}--\r
`]));let s=await new Blob(a).arrayBuffer(),o=await this.batchIngestCaller.call(H(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:s,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(o,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${n}`)}}async updateRun(e,n){re(e),n.inputs&&(n.inputs=await this.processInputs(n.inputs)),n.outputs&&(n.outputs=await this.processOutputs(n.outputs));let r={...n,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(n.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(H(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:hn(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(i,"update run",!0)}async readRun(e,{loadChildRuns:n}={loadChildRuns:!1}){re(e);let r=await this._get(`/runs/${e}`);return n&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:n,projectOpts:r}){if(n!==void 0){let a;n.session_id?a=n.session_id:r!=null&&r.projectName?a=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?a=r==null?void 0:r.projectId:a=(await this.readProject({projectName:dn("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${a}/r/${n.id}?poll=true`}else if(e!==void 0){let a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let n=await i3(this.listRuns({id:e.child_run_ids})),r={},a={};n.sort((i,s)=>{var o,u;return((o=i==null?void 0:i.dotted_order)!=null?o:"").localeCompare((u=s==null?void 0:s.dotted_order)!=null?u:"")});for(let i of n){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),a[i.id]=i}e.child_runs=r[e.id]||[];for(let i in r)i!==e.id&&(a[i].child_runs=r[i]);return e}async*listRuns(e){let{projectId:n,projectName:r,parentRunId:a,traceId:i,referenceExampleId:s,startTime:o,executionOrder:u,isRoot:l,runType:c,error:f,id:d,query:p,filter:g,traceFilter:b,treeFilter:_,limit:m,select:h}=e,y=[];if(n&&(y=Array.isArray(n)?n:[n]),r){let T=Array.isArray(r)?r:[r],x=await Promise.all(T.map(C=>this.readProject({projectName:C}).then(R=>R.id)));y.push(...x)}let v=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],S={session:y.length?y:null,run_type:c,reference_example:s,query:p,filter:g,trace_filter:b,tree_filter:_,execution_order:u,parent_run:a,start_time:o?o.toISOString():null,error:f,id:d,limit:m,trace:i,select:h||v,is_root:l},A=0;for await(let T of this._getCursorPaginatedList("/runs/query",S))if(m){if(A>=m)break;if(T.length+A>m){yield*T.slice(0,m-A);break}A+=T.length,yield*T}else yield*T}async getRunStats({id:e,trace:n,parentRun:r,runType:a,projectNames:i,projectIds:s,referenceExampleIds:o,startTime:u,endTime:l,error:c,query:f,filter:d,traceFilter:p,treeFilter:g,isRoot:b,dataSourceType:_}){let m=s||[];i&&(m=[...s||[],...await Promise.all(i.map(A=>this.readProject({projectName:A}).then(T=>T.id)))]);let y=Object.fromEntries(Object.entries({id:e,trace:n,parent_run:r,run_type:a,session:m,reference_example:o,start_time:u,end_time:l,error:c,query:f,filter:d,trace_filter:p,tree_filter:g,is_root:b,data_source_type:_}).filter(([A,T])=>T!==void 0));return await(await this.caller.call(H(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:n}={}){let r={run_id:e,share_token:n||We()};re(e);let i=await(await this.caller.call(H(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){re(e);let n=await this.caller.call(H(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(n,"unshare run",!0)}async readRunSharedLink(e){re(e);let r=await(await this.caller.call(H(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:n}={}){let r=new URLSearchParams({share_token:e});if(n!==void 0)for(let s of n)r.append("id",s);return re(e),await(await this.caller.call(H(this.debug),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id),re(e);let a=await(await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id);let r={dataset_id:e};re(e);let i=await(await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){re(e);let n=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(n,"unshare dataset",!0)}async readSharedDataset(e){return re(e),await(await this.caller.call(H(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,n){let r={};n!=null&&n.exampleIds&&(r.id=n.exampleIds);let a=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>a.append(o,l)):a.append(o,u)});let i=await this.caller.call(H(this.debug),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await i.json();if(!i.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${s.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return s.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:n=null,metadata:r=null,upsert:a=!1,projectExtra:i=null,referenceDatasetId:s=null}){let o=a?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=i||{};r&&(l.metadata=r);let c={name:e,extra:l,description:n};s!==null&&(c.reference_dataset_id=s);let f=await this.caller.call(H(this.debug),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(f,"create project"),await f.json()}async updateProject(e,{name:n=null,description:r=null,metadata:a=null,projectExtra:i=null,endTime:s=null}){let o=`${this.apiUrl}/sessions/${e}`,u=i;a&&(u={...u||{},metadata:a});let l={name:n,extra:u,description:r,end_time:s?new Date(s).toISOString():null},c=await this.caller.call(H(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:n}){let r="/sessions",a=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)re(e),r+=`/${e}`;else if(n!==void 0)a.append("name",n);else throw new Error("Must provide projectName or projectId");let i=await this.caller.call(H(this.debug),`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let s=await i.json();return i.ok?Array.isArray(s)?s.length>0:!0:!1}catch(s){return!1}}async readProject({projectId:e,projectName:n,includeStats:r}){let a="/sessions",i=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)re(e),a+=`/${e}`;else if(n!==void 0)i.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());let s=await this._get(a,i),o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${n}] not found`);o=s[0]}else o=s;return o}async getProjectUrl({projectId:e,projectName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:n}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:n}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let n of this._getPaginated("/sessions",e))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:n,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:s,metadata:o}={}){let u=new URLSearchParams;if(e!==void 0)for(let l of e)u.append("id",l);if(n!==void 0&&u.append("name",n),r!==void 0&&u.append("name_contains",r),a!==void 0)u.append("reference_dataset",a);else if(i!==void 0){let l=await this.readDataset({datasetName:i});u.append("reference_dataset",l.id)}s!==void 0&&u.append("reference_free",s.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(let l of this._getPaginated("/sessions",u))yield*l}async deleteProject({projectId:e,projectName:n}){let r;if(e===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:n})).id:r=e,re(r);let a=await this.caller.call(H(this.debug),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(a,`delete session ${r} (${n})`,!0)}async uploadCsv({csvFile:e,fileName:n,inputKeys:r,outputKeys:a,description:i,dataType:s,name:o}){let u=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,n),r.forEach(d=>{l.append("input_keys",d)}),a.forEach(d=>{l.append("output_keys",d)}),i&&l.append("description",i),s&&l.append("data_type",s),o&&l.append("name",o);let c=await this.caller.call(H(this.debug),u,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(c,"upload CSV"),await c.json()}async createDataset(e,{description:n,dataType:r,inputsSchema:a,outputsSchema:i,metadata:s}={}){let o={name:e,description:n,extra:s?{metadata:s}:void 0};r&&(o.data_type=r),a&&(o.inputs_schema_definition=a),i&&(o.outputs_schema_definition=i);let u=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:n}){let r="/datasets",a=new URLSearchParams({limit:"1"});if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)re(e),r+=`/${e}`;else if(n!==void 0)a.append("name",n);else throw new Error("Must provide datasetName or datasetId");let i=await this._get(r,a),s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${n}] not found`);s=i[0]}else s=i;return s}async hasDataset({datasetId:e,datasetName:n}){try{return await this.readDataset({datasetId:e,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:n,fromVersion:r,toVersion:a}){let i=e;if(i===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:n})).id);let s=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:n}){let r="/datasets";if(e===void 0)if(n!==void 0)e=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:n=0,datasetIds:r,datasetName:a,datasetNameContains:i,metadata:s}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:n.toString()});if(r!==void 0)for(let l of r)u.append("id",l);a!==void 0&&u.append("name",a),i!==void 0&&u.append("name_contains",i),s!==void 0&&u.append("metadata",JSON.stringify(s));for await(let l of this._getPaginated(o,u))yield*l}async updateDataset(e){let{datasetId:n,datasetName:r,...a}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");let i=n!=null?n:(await this.readDataset({datasetName:r})).id;re(i);let s=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(s,"update dataset"),await s.json()}async updateDatasetTag(e){let{datasetId:n,datasetName:r,asOf:a,tag:i}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");let s=n!=null?n:(await this.readDataset({datasetName:r})).id;re(s);let o=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:n}){let r="/datasets",a=e;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(a=(await this.readDataset({datasetName:n})).id),a!==void 0)re(a),r+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");let i=await this.caller.call(H(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(i,`delete ${r}`),await i.json()}async indexDataset({datasetId:e,datasetName:n,tag:r}){let a=e;if(!a&&!n)throw new Error("Must provide either datasetName or datasetId");if(a&&n)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:n})).id),re(a);let i={tag:r},s=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(s,"index dataset"),await s.json()}async similarExamples(e,n,r,{filter:a}={}){let i={limit:r,inputs:e};a!==void 0&&(i.filter=a),re(n);let s=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${n}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,n,r){var c,f;if(WR(e)&&(n!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let a=n?r==null?void 0:r.datasetId:e.dataset_id,i=n?r==null?void 0:r.datasetName:e.dataset_name;if(a===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:i})).id);let s=(n?r==null?void 0:r.createdAt:e.created_at)||new Date,o;WR(e)?o=e:o={inputs:e,outputs:n,created_at:s==null?void 0:s.toISOString(),id:r==null?void 0:r.exampleId,metadata:r==null?void 0:r.metadata,split:r==null?void 0:r.split,source_run_id:r==null?void 0:r.sourceRunId,use_source_run_io:r==null?void 0:r.useSourceRunIO,use_source_run_attachments:r==null?void 0:r.useSourceRunAttachments,attachments:r==null?void 0:r.attachments};let u=await this._uploadExamplesMultipart(a,[o]);return await this.readExample((f=(c=u.example_ids)==null?void 0:c[0])!=null?f:We())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];let h=e,y=h[0].dataset_id,v=h[0].dataset_name;if(y===void 0&&v===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&v!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:v})).id);let S=await this._uploadExamplesMultipart(y,h);return await Promise.all(S.example_ids.map(T=>this.readExample(T)))}let{inputs:n,outputs:r,metadata:a,splits:i,sourceRunIds:s,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:l,exampleIds:c,datasetId:f,datasetName:d}=e;if(n===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=f,g=d;if(p===void 0&&g===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&g!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:g})).id);let b=n.map((h,y)=>({dataset_id:p,inputs:h,outputs:r==null?void 0:r[y],metadata:a==null?void 0:a[y],split:i==null?void 0:i[y],id:c==null?void 0:c[y],attachments:l==null?void 0:l[y],source_run_id:s==null?void 0:s[y],use_source_run_io:o==null?void 0:o[y],use_source_run_attachments:u==null?void 0:u[y]})),_=await this._uploadExamplesMultipart(p,b);return await Promise.all(_.example_ids.map(h=>this.readExample(h)))}async createLLMExample(e,n,r){return this.createExample({input:e},{output:n},r)}async createChatExample(e,n,r){let a=e.map(s=>Iw(s)?Pw(s):s),i=Iw(n)?Pw(n):n;return this.createExample({input:a},{output:i},r)}async readExample(e){re(e);let n=`/examples/${e}`,r=await this._get(n),{attachment_urls:a,...i}=r,s=i;return a&&(s.attachments=Object.entries(a).reduce((o,[u,l])=>(o[u.slice(11)]={presigned_url:l.presigned_url,mime_type:l.mime_type},o),{})),s}async*listExamples({datasetId:e,datasetName:n,exampleIds:r,asOf:a,splits:i,inlineS3Urls:s,metadata:o,limit:u,offset:l,filter:c,includeAttachments:f}={}){let d;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(n!==void 0)d=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:d}),g=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;g&&p.append("as_of",g);let b=s!=null?s:!0;if(p.append("inline_s3_urls",b.toString()),r!==void 0)for(let m of r)p.append("id",m);if(i!==void 0)for(let m of i)p.append("splits",m);if(o!==void 0){let m=JSON.stringify(o);p.append("metadata",m)}u!==void 0&&p.append("limit",u.toString()),l!==void 0&&p.append("offset",l.toString()),c!==void 0&&p.append("filter",c),f===!0&&["attachment_urls","outputs","metadata"].forEach(m=>p.append("select",m));let _=0;for await(let m of this._getPaginated("/examples",p)){for(let h of m){let{attachment_urls:y,...v}=h,S=v;y&&(S.attachments=Object.entries(y).reduce((A,[T,x])=>(A[T.slice(11)]={presigned_url:x.presigned_url,mime_type:x.mime_type||void 0},A),{})),yield S,_++}if(u!==void 0&&_>=u)break}}async deleteExample(e){re(e);let n=`/examples/${e}`,r=await this.caller.call(H(this.debug),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(r,`delete ${n}`),await r.json()}async updateExample(e,n){let r;n?r=e:r=e.id,re(r);let a;n?a={id:r,...n}:a=e;let i;return a.dataset_id!==void 0?i=a.dataset_id:i=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(i,[a])}async updateExamples(e){let n;return e[0].dataset_id===void 0?n=(await this.readExample(e[0].id)).dataset_id:n=e[0].dataset_id,this._updateExamplesMultipart(n,e)}async readDatasetVersion({datasetId:e,datasetName:n,asOf:r,tag:a}){let i;if(e?i=e:i=(await this.readDataset({datasetName:n})).id,re(i),r&&a||!r&&!a)throw new Error("Exactly one of asOf and tag must be specified.");let s=new URLSearchParams;r!==void 0&&s.append("as_of",typeof r=="string"?r:r.toISOString()),a!==void 0&&s.append("tag",a);let o=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${i}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:n,asOf:r}){let a;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:n})).id:a=e,re(a);let i=new URLSearchParams,s=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return s&&i.append("as_of",s),await this._get(`/datasets/${a}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:n,splitName:r,exampleIds:a,remove:i=!1}){let s;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:n})).id:s=e,re(s);let o={split_name:r,examples:a.map(l=>(re(l),l)),remove:i},u=await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(u,"update dataset splits",!0)}async evaluateRun(e,n,{sourceInfo:r,loadChildRuns:a,referenceExample:i}={loadChildRuns:!1}){rm("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(i=await this.readExample(s.reference_example_id));let o=await n.evaluateRun(s,i),[u,l]=await this._logEvaluationFeedback(o,s,r);return l[0]}async createFeedback(e,n,{score:r,value:a,correction:i,comment:s,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:c,feedbackConfig:f,projectId:d,comparativeExperimentId:p}){var h;if(!e&&!d)throw new Error("One of runId or projectId must be provided");if(e&&d)throw new Error("Only one of runId or projectId can be provided");let g={type:u!=null?u:"api",metadata:o!=null?o:{}};l!==void 0&&(g==null?void 0:g.metadata)!==void 0&&!g.metadata.__run&&(g.metadata.__run={run_id:l}),(g==null?void 0:g.metadata)!==void 0&&((h=g.metadata.__run)==null?void 0:h.run_id)!==void 0&&re(g.metadata.__run.run_id);let b={id:c!=null?c:We(),run_id:e,key:n,score:QR(r),value:a,correction:i,comment:s,feedback_source:g,comparative_experiment_id:p,feedbackConfig:f,session_id:d},_=`${this.apiUrl}/feedback`,m=await this.caller.call(H(this.debug),_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(b),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(m,"create feedback",!0),b}async updateFeedback(e,{score:n,value:r,correction:a,comment:i}){let s={};n!=null&&(s.score=QR(n)),r!=null&&(s.value=r),a!=null&&(s.correction=a),i!=null&&(s.comment=i),re(e);let o=await this.caller.call(H(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(o,"update feedback",!0)}async readFeedback(e){re(e);let n=`/feedback/${e}`;return await this._get(n)}async deleteFeedback(e){re(e);let n=`/feedback/${e}`,r=await this.caller.call(H(this.debug),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(r,`delete ${n}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:n,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),n)for(let i of n)a.append("key",i);if(r)for(let i of r)a.append("source",i);for await(let i of this._getPaginated("/feedback",a))yield*i}async createPresignedFeedbackToken(e,n,{expiration:r,feedbackConfig:a}={}){let i={run_id:e,feedback_key:n,feedback_config:a};return r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3},await(await this.caller.call(H(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:n,referenceDatasetId:r,createdAt:a,description:i,metadata:s,id:o}){var c;if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let u={id:o,name:e,experiment_ids:n,reference_dataset_id:r,description:i,created_at:(c=a!=null?a:new Date)==null?void 0:c.toISOString(),extra:{}};return s&&(u.extra.metadata=s),await(await this.caller.call(H(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){re(e);let n=new URLSearchParams({run_id:e});for await(let r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(e){let n;return"results"in e?n=e.results:Array.isArray(e)?n=e:n=[e],n}async _logEvaluationFeedback(e,n,r){let a=this._selectEvalResults(e),i=[];for(let s of a){let o=r||{};s.evaluatorInfo&&(o={...s.evaluatorInfo,...o});let u=null;s.targetRunId?u=s.targetRunId:n&&(u=n.id),i.push(await this.createFeedback(u,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[a,i]}async logEvaluationFeedback(e,n,r){let[a]=await this._logEvaluationFeedback(e,n,r);return a}async*listAnnotationQueues(e={}){let{queueIds:n,name:r,nameContains:a,limit:i}=e,s=new URLSearchParams;n&&n.forEach((u,l)=>{re(u,`queueIds[${l}]`),s.append("ids",u)}),r&&s.append("name",r),a&&s.append("name_contains",a),s.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(let u of this._getPaginated("/annotation-queues",s))if(yield*u,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){let{name:n,description:r,queueId:a,rubricInstructions:i}=e,s={name:n,description:r,id:a||We(),rubric_instructions:i},o=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){let n=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues/${re(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(n,"read annotation queue"),await n.json()}async updateAnnotationQueue(e,n){let{name:r,description:a,rubricInstructions:i}=n,s=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues/${re(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:a,rubric_instructions:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(s,"update annotation queue")}async deleteAnnotationQueue(e){let n=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues/${re(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(n,"delete annotation queue")}async addRunsToAnnotationQueue(e,n){let r=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues/${re(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n.map((a,i)=>re(a,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,n){let r=`/annotation-queues/${re(e,"queueId")}/run`,a=await this.caller.call(H(this.debug),`${this.apiUrl}${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,n){let r=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues/${re(e,"queueId")}/runs/${re(n,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){let n=await this.caller.call(H(this.debug),`${this.apiUrl}/annotation-queues/${re(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(n,"get size from annotation queue"),await n.json()}async _currentTenantIsOwner(e){let n=await this._getSettings();return e=="-"||n.tenant_handle===e}async _ownerConflictError(e,n){let r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${n}`)}async _getLatestCommitHash(e){let n=await this.caller.call(H(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();if(!n.ok){let a=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),i=new Error(`Error ${n.status}: ${n.statusText}
${a}`);throw i.statusCode=n.status,i}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,n){let[r,a,i]=Ba(e),s=await this.caller.call(H(this.debug),`${this.apiUrl}/likes/${r}/${a}`,{method:"POST",body:JSON.stringify({like:n}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(s,`${n?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){let[n,r,a]=Ba(e);if(await this._currentTenantIsOwner(n)){let i=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${n}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${n}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let n of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*n}async*listPrompts(e){var r;let n=new URLSearchParams;n.append("sort_field",(r=e==null?void 0:e.sortField)!=null?r:"updated_at"),n.append("sort_direction","desc"),n.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&n.append("is_public",e.isPublic.toString()),e!=null&&e.query&&n.append("query",e.query);for await(let a of this._getPaginated("/repos",n,i=>i.repos))yield*a}async getPrompt(e){let[n,r,a]=Ba(e),i=await this.caller.call(H(this.debug),`${this.apiUrl}/repos/${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await ue(i,"get prompt");let s=await i.json();return s.repo?s.repo:null}async createPrompt(e,n){let r=await this._getSettings();if(n!=null&&n.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[a,i,s]=Ba(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);let o={repo_handle:i,...(n==null?void 0:n.description)&&{description:n.description},...(n==null?void 0:n.readme)&&{readme:n.readme},...(n==null?void 0:n.tags)&&{tags:n.tags},is_public:!!(n!=null&&n.isPublic)},u=await this.caller.call(H(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(u,"create prompt");let{repo:l}=await u.json();return l}async createCommit(e,n,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[a,i,s]=Ba(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${a}/${i}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(n)),parent_commit:o},l=await this.caller.call(H(this.debug),`${this.apiUrl}/commits/${a}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(l,"create commit");let c=await l.json();return this._getPromptUrl(`${a}/${i}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,n=[]){return this._updateExamplesMultipart(e,n)}async _updateExamplesMultipart(e,n=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let u of n){let l=u.id,c={...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split}},f=hn(c),d=new Blob([f],{type:"application/json"});if(r.append(l,d),u.inputs){let p=hn(u.inputs),g=new Blob([p],{type:"application/json"});r.append(`${l}.inputs`,g)}if(u.outputs){let p=hn(u.outputs),g=new Blob([p],{type:"application/json"});r.append(`${l}.outputs`,g)}if(u.attachments)for(let[p,g]of Object.entries(u.attachments)){let b,_;Array.isArray(g)?[b,_]=g:(b=g.mimeType,_=g.data);let m=new Blob([_],{type:`${b}; length=${_.byteLength}`});r.append(`${l}.attachment.${p}`,m)}if(u.attachments_operations){let p=hn(u.attachments_operations),g=new Blob([p],{type:"application/json"});r.append(`${l}.attachments_operations`,g)}}let a=e!=null?e:(o=n[0])==null?void 0:o.dataset_id;return await(await this.caller.call(H(this.debug),`${this.apiUrl}/v1/platform/datasets/${a}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,n=[]){return this._uploadExamplesMultipart(e,n)}async _uploadExamplesMultipart(e,n=[]){var s;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let o of n){let u=((s=o.id)!=null?s:We()).toString(),l={created_at:o.created_at,...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split},...o.source_run_id&&{source_run_id:o.source_run_id},...o.use_source_run_io&&{use_source_run_io:o.use_source_run_io},...o.use_source_run_attachments&&{use_source_run_attachments:o.use_source_run_attachments}},c=hn(l),f=new Blob([c],{type:"application/json"});if(r.append(u,f),o.inputs){let d=hn(o.inputs),p=new Blob([d],{type:"application/json"});r.append(`${u}.inputs`,p)}if(o.outputs){let d=hn(o.outputs),p=new Blob([d],{type:"application/json"});r.append(`${u}.outputs`,p)}if(o.attachments)for(let[d,p]of Object.entries(o.attachments)){let g,b;Array.isArray(p)?[g,b]=p:(g=p.mimeType,b=p.data);let _=new Blob([b],{type:`${g}; length=${b.byteLength}`});r.append(`${u}.attachment.${d}`,_)}}let a=await this.caller.call(H(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r});return await ue(a,"upload examples"),await a.json()}async updatePrompt(e,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,a]=Ba(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let i={};if((n==null?void 0:n.description)!==void 0&&(i.description=n.description),(n==null?void 0:n.readme)!==void 0&&(i.readme=n.readme),(n==null?void 0:n.tags)!==void 0&&(i.tags=n.tags),(n==null?void 0:n.isPublic)!==void 0&&(i.is_public=n.isPublic),(n==null?void 0:n.isArchived)!==void 0&&(i.is_archived=n.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");let s=await this.caller.call(H(this.debug),`${this.apiUrl}/repos/${r}/${a}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ue(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[n,r,a]=Ba(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("delete a prompt",n);return await(await this.caller.call(H(this.debug),`${this.apiUrl}/repos/${n}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,n){let[r,a,i]=Ba(e),s=await this.caller.call(H(this.debug),`${this.apiUrl}/commits/${r}/${a}/${i}${n!=null&&n.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ue(s,"pull prompt commit");let o=await s.json();return{owner:r,repo:a,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,n){let r=await this.pullPromptCommit(e,{includeModel:n==null?void 0:n.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,n){return await this.promptExists(e)?n&&Object.keys(n).some(a=>a!=="object")&&await this.updatePrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}):await this.createPrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}),n!=null&&n.object?await this.createCommit(e,n==null?void 0:n.object,{parentCommitHash:n==null?void 0:n.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,n={}){var d,p;let{sourceApiUrl:r=this.apiUrl,datasetName:a}=n,[i,s]=this.parseTokenOrUrl(e,r),o=new t({apiUrl:i,apiKey:"placeholder"}),u=await o.readSharedDataset(s),l=a||u.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch(g){}let c=await o.listSharedExamples(s),f=await this.createDataset(l,{description:u.description,dataType:u.data_type||"kv",inputsSchema:(d=u.inputs_schema_definition)!=null?d:void 0,outputsSchema:(p=u.outputs_schema_definition)!=null?p:void 0});try{await this.createExamples({inputs:c.map(g=>g.inputs),outputs:c.flatMap(g=>g.outputs?[g.outputs]:[]),datasetId:f.id})}catch(g){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),g}}parseTokenOrUrl(e,n,r=2,a="dataset"){try{return re(e),[n,e]}catch(i){}try{let s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){let o=s[s.length-r];return[n,o]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch(i){throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}};function WR(t){return"dataset_id"in t||"dataset_name"in t}var ym="0.3.25";var qa,l3=()=>typeof window!="undefined"&&typeof window.document!="undefined",c3=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",f3=()=>typeof window!="undefined"&&window.name==="nodejs"||typeof navigator!="undefined"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),tC=()=>typeof Deno!="undefined",d3=()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined"&&!tC(),p3=()=>qa||(l3()?qa="browser":d3()?qa="node":c3()?qa="webworker":f3()?qa="jsdom":tC()?qa="deno":qa="other",qa),tv;function bm(){if(tv===void 0){let t=p3(),e=m3();tv={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:ym,...e}}return tv}function eC(){let t=h3()||{},e={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[r,a]of Object.entries(t))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof a=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[r]=a);return e}function h3(){try{return typeof process!="undefined"&&process.env?Object.entries(process.env).reduce((t,[e,n])=>(t[e]=String(n),t),{}):void 0}catch(t){return}}function na(t){var e;try{return typeof process!="undefined"?(e=process.env)==null?void 0:e[t]:void 0}catch(n){return}}function dn(t){return na(`LANGSMITH_${t}`)||na(`LANGCHAIN_${t}`)}var nv;function m3(){if(nv!==void 0)return nv;let t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let n of t){let r=na(n);r!==void 0&&(e[n]=r)}return nv=e,e}var nC=t=>t!==void 0?t:!!["TRACING_V2","TRACING"].find(n=>dn(n)==="true");var _m=Symbol.for("lc:context_variables");function g3(t){return t.replace(/[-:.]/g,"")}function y3(t,e,n=1){let r=n.toFixed(0).slice(0,3).padStart(3,"0");return g3(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}var wm=class t{constructor(e,n,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=n,this.project_name=r}static fromHeader(e){let n=e.split(","),r={},a=[],i;for(let s of n){let[o,u]=s.split("="),l=decodeURIComponent(u);o==="langsmith-metadata"?r=JSON.parse(l):o==="langsmith-tags"?a=l.split(","):o==="langsmith-project"&&(i=l)}return new t(r,a,i)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},Fa=class t{constructor(e){var o,u,l,c,f;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),vm(e)){Object.assign(this,{...e});return}let n=t.getDefaultConfig(),{metadata:r,...a}=e,i=(o=a.client)!=null?o:t.getSharedClient(),s={...r,...(u=a==null?void 0:a.extra)==null?void 0:u.metadata};if(a.extra={...a.extra,metadata:s},Object.assign(this,{...n,...a,client:i}),this.trace_id||(this.parent_run?this.trace_id=(l=this.parent_run.trace_id)!=null?l:this.id:this.trace_id=this.id),(c=this.execution_order)!=null||(this.execution_order=1),(f=this.child_execution_order)!=null||(this.child_execution_order=1),!this.dotted_order){let d=y3(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+d:this.dotted_order=d}}static getDefaultConfig(){var e,n,r;return{id:We(),run_type:"chain",project_name:(n=(e=dn("PROJECT"))!=null?e:na("LANGCHAIN_SESSION"))!=null?n:"default",child_runs:[],api_url:(r=na("LANGCHAIN_ENDPOINT"))!=null?r:"http://localhost:1984",api_key:na("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return t.sharedClient||(t.sharedClient=new Io),t.sharedClient}createChild(e){var u,l,c,f,d,p,g;let n=this.child_execution_order+1,r=new t({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:n,child_execution_order:n});_m in this&&(r[_m]=this[_m]);let a=Symbol.for("lc:child_config"),i=(l=(u=e.extra)==null?void 0:u[a])!=null?l:this.extra[a];if(_3(i)){let b={...i},_=b3(b.callbacks)?(f=(c=b.callbacks).copy)==null?void 0:f.call(c):void 0;_&&(Object.assign(_,{_parentRunId:r.id}),(g=(p=(d=_.handlers)==null?void 0:d.find(aC))==null?void 0:p.updateFromRunTree)==null||g.call(p,r),b.callbacks=_),r.extra[a]=b}let s=new Set,o=this;for(;o!=null&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,n),o=o.parent_run;return this.child_runs.push(r),r}async end(e,n,r=Date.now(),a){var i,s,o;this.outputs=(i=this.outputs)!=null?i:e,this.error=(s=this.error)!=null?s:n,this.end_time=(o=this.end_time)!=null?o:r,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,n,r=!0){var u,l;let a=(u=e.extra)!=null?u:{};if(a.runtime||(a.runtime={}),n)for(let[c,f]of Object.entries(n))a.runtime[c]||(a.runtime[c]=f);let i,s;return r?(s=(l=e.parent_run)==null?void 0:l.id,i=[]):(i=e.child_runs.map(c=>this._convertToCreate(c,n,r)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{let n=bm(),r=await this._convertToCreate(this,n,!0);if(await this.client.createRun(r),!e){rm("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let a of this.child_runs)await a.postRun(!1)}}catch(n){console.error(`Error in postRun for run ${this.id}:`,n)}}async patchRun(){var e;try{let n={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){var n;this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:(n=e.time)!=null?n:new Date().toISOString()})}static fromRunnableConfig(e,n){var l,c,f,d,p,g,b;let r=e==null?void 0:e.callbacks,a,i,s,o=nC();if(r){let _=(c=(l=r==null?void 0:r.getParentRunId)==null?void 0:l.call(r))!=null?c:"",m=(f=r==null?void 0:r.handlers)==null?void 0:f.find(h=>(h==null?void 0:h.name)=="langchain_tracer");a=(d=m==null?void 0:m.getRun)==null?void 0:d.call(m,_),i=m==null?void 0:m.projectName,s=m==null?void 0:m.client,o=o||!!m}return a?new t({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:s,tracingEnabled:o,project_name:i,tags:[...new Set(((p=a==null?void 0:a.tags)!=null?p:[]).concat((g=e==null?void 0:e.tags)!=null?g:[]))],extra:{metadata:{...(b=a==null?void 0:a.extra)==null?void 0:b.metadata,...e==null?void 0:e.metadata}}}).createChild(n):new t({...n,client:s,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,n){var l,c,f,d;let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||typeof a!="string")return;let i=a.trim(),s=i.split(".").map(p=>{let[g,b]=p.split("Z");return{strTime:g,time:Date.parse(g+"Z"),uuid:b}}),o=s[0].uuid,u={...n,name:(l=n==null?void 0:n.name)!=null?l:"parent",run_type:(c=n==null?void 0:n.run_type)!=null?c:"chain",start_time:(f=n==null?void 0:n.start_time)!=null?f:Date.now(),id:(d=s.at(-1))==null?void 0:d.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){let p=wm.fromHeader(r.baggage);u.metadata=p.metadata,u.tags=p.tags,u.project_name=p.project_name}return new t(u)}toHeaders(e){var r;let n={"langsmith-trace":this.dotted_order,baggage:new wm((r=this.extra)==null?void 0:r.metadata,this.tags,this.project_name).toHeader()};if(e)for(let[a,i]of Object.entries(n))e.set(a,i);return n}};Object.defineProperty(Fa,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function vm(t){return t!==void 0&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function aC(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function rC(t){return Array.isArray(t)&&t.some(e=>aC(e))}function b3(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function _3(t){var e;return t!==void 0&&typeof t.callbacks=="object"&&(rC((e=t.callbacks)==null?void 0:e.handlers)||rC(t.callbacks))}var av=class{getStore(){}run(e,n){return n()}},rv=Symbol.for("ls:tracing_async_local_storage"),w3=new av,iv=class{getInstance(){var e;return(e=globalThis[rv])!=null?e:w3}initializeGlobalInstance(e){globalThis[rv]===void 0&&(globalThis[rv]=e)}},v3=new iv,iC=()=>{let t=v3.getInstance().getStore();if(!vm(t))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return t};var A7=Symbol.for("langsmith:traceable:root");function Sm(t){return typeof t=="function"&&"langsmith:traceable"in t}var sv={};Lg(sv,{JsonPatchError:()=>et,_areEquals:()=>ad,applyOperation:()=>No,applyPatch:()=>rs,applyReducer:()=>T3,deepClone:()=>x3,getValueByPointer:()=>Om,validate:()=>oC,validator:()=>Rm});var S3=Object.prototype.hasOwnProperty;function Am(t,e){return S3.call(t,e)}function Tm(t){if(Array.isArray(t)){let n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(t);let e=[];for(let n in t)Am(t,n)&&e.push(n);return e}function Bt(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Em(t){let e=0,n=t.length,r;for(;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function ra(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function rd(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function xm(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(xm(t[n]))return!0}else if(typeof t=="object"){let n=Tm(t),r=n.length;for(var e=0;e<r;e++)if(xm(t[n[e]]))return!0}}return!1}function sC(t,e){let n=[t];for(let r in e){let a=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof a!="undefined"&&n.push(`${r}: ${a}`)}return n.join(`
`)}var Po=class extends Error{constructor(e,n,r,a,i){super(sC(e,{name:n,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=sC(e,{name:n,index:r,operation:a,tree:i})}};var et=Po,x3=Bt,Gl={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){let r=Om(n,this.path);r&&(r=Bt(r));let a=No(n,{op:"remove",path:this.from}).removed;return No(n,{op:"add",path:this.path,value:a}),{newDocument:n,removed:r}},copy:function(t,e,n){let r=Om(n,this.from);return No(n,{op:"add",path:this.path,value:Bt(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ad(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},A3={add:function(t,e,n){return Em(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Gl.move,copy:Gl.copy,test:Gl.test,_get:Gl._get};function Om(t,e){if(e=="")return t;var n={op:"_get",path:e};return No(t,n),n.value}function No(t,e,n=!1,r=!0,a=!0,i=0){if(n&&(typeof n=="function"?n(e,0,t,e.path):Rm(e,0)),e.path===""){let s={newDocument:t};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=t,s;if(e.op==="move"||e.op==="copy")return s.newDocument=Om(t,e.from),e.op==="move"&&(s.removed=t),s;if(e.op==="test"){if(s.test=ad(t,e.value),s.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return s.newDocument=t,s}else{if(e.op==="remove")return s.removed=t,s.newDocument=null,s;if(e.op==="_get")return e.value=t,s;if(n)throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,t);return s}}else{r||(t=Bt(t));let o=(e.path||"").split("/"),u=t,l=1,c=o.length,f,d,p;for(typeof n=="function"?p=n:p=Rm;;){if(d=o[l],d&&d.indexOf("~")!=-1&&(d=rd(d)),a&&(d=="__proto__"||d=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=o.slice(0,l).join("/"):l==c-1&&(f=e.path),f!==void 0&&p(e,0,t,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!Em(d))throw new et("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,t);Em(d)&&(d=~~d)}if(l>=c){if(n&&e.op==="add"&&d>u.length)throw new et("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,t);let g=A3[e.op].call(e,u,d,t);if(g.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return g}}else if(l>=c){let g=Gl[e.op].call(e,u,d,t);if(g.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return g}if(u=u[d],n&&l<c&&(!u||typeof u!="object"))throw new et("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,t)}}}function rs(t,e,n,r=!0,a=!0){if(n&&!Array.isArray(e))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Bt(t));let i=new Array(e.length);for(let s=0,o=e.length;s<o;s++)i[s]=No(t,e[s],n,!0,a,s),t=i[s].newDocument;return i.newDocument=t,i}function T3(t,e,n){let r=No(t,e);if(r.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Rm(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new et("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Gl[t.op]){if(typeof t.path!="string")throw new et("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new et('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new et("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&xm(t.value))throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var a=t.path.split("/").length,i=r.split("/").length;if(a!==i+1&&a!==i)throw new et("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new et("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var s={op:"_get",path:t.from,value:void 0},o=oC([s],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new et("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function oC(t,e,n){try{if(!Array.isArray(t))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)rs(Bt(e),Bt(t),n||!0);else{n=n||Rm;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(a){if(a instanceof et)return a;throw a}}function ad(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),a,i,s;if(n&&r){if(i=t.length,i!=e.length)return!1;for(a=i;a--!==0;)if(!ad(t[a],e[a]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(i=o.length,i!==Object.keys(e).length)return!1;for(a=i;a--!==0;)if(!e.hasOwnProperty(o[a]))return!1;for(a=i;a--!==0;)if(s=o[a],!ad(t[s],e[s]))return!1;return!0}return t!==t&&e!==e}function uC(t,e,n,r,a){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Tm(e),s=Tm(t),o=!1,u=!1,l=s.length-1;l>=0;l--){var c=s[l],f=t[c];if(Am(e,c)&&!(e[c]===void 0&&f!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof f=="object"&&f!=null&&typeof d=="object"&&d!=null&&Array.isArray(f)===Array.isArray(d)?uC(f,d,n,r+"/"+ra(c),a):f!==d&&(o=!0,a&&n.push({op:"test",path:r+"/"+ra(c),value:Bt(f)}),n.push({op:"replace",path:r+"/"+ra(c),value:Bt(d)}))}else Array.isArray(t)===Array.isArray(e)?(a&&n.push({op:"test",path:r+"/"+ra(c),value:Bt(f)}),n.push({op:"remove",path:r+"/"+ra(c)}),u=!0):(a&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}),o=!0)}if(!(!u&&i.length==s.length))for(var l=0;l<i.length;l++){var c=i[l];!Am(t,c)&&e[c]!==void 0&&n.push({op:"add",path:r+"/"+ra(c),value:Bt(e[c])})}}}function Cm(t,e,n=!1){var r=[];return uC(t,e,r,"",n),r}var D7={...sv,JsonPatchError:Po,deepClone:Bt,escapePathComponent:ra,unescapePathComponent:rd};var E3=()=>typeof window!="undefined"&&typeof window.document!="undefined",O3=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",R3=()=>typeof window!="undefined"&&window.name==="nodejs"||typeof navigator!="undefined"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),uv=()=>typeof Deno!="undefined",C3=()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined"&&!uv(),lC=()=>{let t;return E3()?t="browser":C3()?t="node":O3()?t="webworker":R3()?t="jsdom":uv()?t="deno":t="other",t},ov;async function cC(){return ov===void 0&&(ov={library:"langchain-js",runtime:lC()}),ov}function He(t){var e;try{return typeof process!="undefined"?(e=process.env)==null?void 0:e[t]:uv()?Deno==null?void 0:Deno.env.get(t):void 0}catch(n){return}}var lv=class{};function cv(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}var ko=class t extends lv{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,lw(this.constructor)]}constructor(e){var n,r,a,i,s,o,u;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:He("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=(n=e.ignoreLLM)!=null?n:this.ignoreLLM,this.ignoreChain=(r=e.ignoreChain)!=null?r:this.ignoreChain,this.ignoreAgent=(a=e.ignoreAgent)!=null?a:this.ignoreAgent,this.ignoreRetriever=(i=e.ignoreRetriever)!=null?i:this.ignoreRetriever,this.ignoreCustomEvent=(s=e.ignoreCustomEvent)!=null?s:this.ignoreCustomEvent,this.raiseError=(o=e.raiseError)!=null?o:this.raiseError,this.awaitHandlers=this.raiseError||((u=e._awaitHandler)!=null?u:this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return yr.prototype.toJSON.call(this)}toJSONNotImplemented(){return yr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class n extends t{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:We()}),Object.assign(this,e)}}return new n}},fC=t=>{let e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function fv(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function I3(t){return t.replace(/[-:.]/g,"")}function P3(t,e,n){let r=n.toFixed(0).slice(0,3).padStart(3,"0");return I3(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}function Zl(t){return typeof t._addRunToRunMap=="function"}var rr=class extends ko{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,n){e.child_runs.push(n)}_addRunToRunMap(e){let n=P3(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){let a=this.runMap.get(r.parent_run_id);a&&(this._addChildRun(a,r),a.child_execution_order=Math.max(a.child_execution_order,r.child_execution_order),r.trace_id=a.trace_id,a.dotted_order!==void 0&&(r.dotted_order=[a.dotted_order,n].join(".")))}else r.trace_id=r.id,r.dotted_order=n;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;let n=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);n?n.child_execution_order=Math.max(n.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){let n=e!==void 0&&this.runMap.get(e);return n?n.child_execution_order+1:1}_createRunForLLMStart(e,n,r,a,i,s,o,u){let l=this._getExecutionOrder(a),c=Date.now(),f=o?{...i,metadata:o}:i,d={id:r,name:u!=null?u:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:n},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:f!=null?f:{},tags:s||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,n,r,a,i,s,o,u){var c,f,d;let l=(c=this.runMap.get(r))!=null?c:this._createRunForLLMStart(e,n,r,a,i,s,o,u);return await((f=this.onRunCreate)==null?void 0:f.call(this,l)),await((d=this.onLLMStart)==null?void 0:d.call(this,l)),l}_createRunForChatModelStart(e,n,r,a,i,s,o,u){let l=this._getExecutionOrder(a),c=Date.now(),f=o?{...i,metadata:o}:i,d={id:r,name:u!=null?u:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:n},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:f!=null?f:{},tags:s||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,n,r,a,i,s,o,u){var c,f,d;let l=(c=this.runMap.get(r))!=null?c:this._createRunForChatModelStart(e,n,r,a,i,s,o,u);return await((f=this.onRunCreate)==null?void 0:f.call(this,l)),await((d=this.onLLMStart)==null?void 0:d.call(this,l)),l}async handleLLMEnd(e,n,r,a,i){var o;let s=this.runMap.get(n);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleLLMError(e,n,r,a,i){var o;let s=this.runMap.get(n);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForChainStart(e,n,r,a,i,s,o,u){let l=this._getExecutionOrder(a),c=Date.now(),f={id:r,name:u!=null?u:e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:n,execution_order:l,child_execution_order:l,run_type:o!=null?o:"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(f)}async handleChainStart(e,n,r,a,i,s,o,u){var c,f,d;let l=(c=this.runMap.get(r))!=null?c:this._createRunForChainStart(e,n,r,a,i,s,o,u);return await((f=this.onRunCreate)==null?void 0:f.call(this,l)),await((d=this.onChainStart)==null?void 0:d.call(this,l)),l}async handleChainEnd(e,n,r,a,i){var o;let s=this.runMap.get(n);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=fv(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=fv(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleChainError(e,n,r,a,i){var o;let s=this.runMap.get(n);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=fv(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForToolStart(e,n,r,a,i,s,o){let u=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:o!=null?o:e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:n},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleToolStart(e,n,r,a,i,s,o){var l,c,f;let u=(l=this.runMap.get(r))!=null?l:this._createRunForToolStart(e,n,r,a,i,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((f=this.onToolStart)==null?void 0:f.call(this,u)),u}async handleToolEnd(e,n){var a;let r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleToolError(e,n){var a;let r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,n){var i;let r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="chain")return;let a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,n){var a;let r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,r)))}_createRunForRetrieverStart(e,n,r,a,i,s,o){let u=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:o!=null?o:e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:n},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,n,r,a,i,s,o){var l,c,f;let u=(l=this.runMap.get(r))!=null?l:this._createRunForRetrieverStart(e,n,r,a,i,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((f=this.onRetrieverStart)==null?void 0:f.call(this,u)),u}async handleRetrieverEnd(e,n){var a;let r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,n){var a;let r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleText(e,n){var a;let r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,r)))}async handleLLMNewToken(e,n,r,a,i,s){var u;let o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:n,chunk:s==null?void 0:s.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:s==null?void 0:s.chunk})),o}};var dv=Z(mC(),1);function Qt(t,e){return`${t.open}${e}${t.close}`}function ar(t,e){try{return JSON.stringify(t,null,2)}catch(n){return e}}function gC(t){return typeof t=="string"?t.trim():t==null?t:ar(t,t.toString())}function as(t){if(!t.end_time)return"";let e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:mn}=dv.default,id=class extends rr{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let n=[],r=e;for(;r.parent_run_id;){let a=this.runMap.get(r.parent_run_id);if(a)n.push(a),r=a;else break}return n}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((a,i,s)=>{let o=`${a.execution_order}:${a.run_type}:${a.name}`;return i===s.length-1?Qt(dv.default.bold,o):o}).join(" > ");return Qt(mn.grey,r)}onChainStart(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.green,"[chain/start]")} [${n}] Entering Chain run with input: ${ar(e.inputs,"[inputs]")}`)}onChainEnd(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.cyan,"[chain/end]")} [${n}] [${as(e)}] Exiting Chain run with output: ${ar(e.outputs,"[outputs]")}`)}onChainError(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.red,"[chain/error]")} [${n}] [${as(e)}] Chain run errored with error: ${ar(e.error,"[error]")}`)}onLLMStart(e){let n=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Qt(mn.green,"[llm/start]")} [${n}] Entering LLM run with input: ${ar(r,"[inputs]")}`)}onLLMEnd(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.cyan,"[llm/end]")} [${n}] [${as(e)}] Exiting LLM run with output: ${ar(e.outputs,"[response]")}`)}onLLMError(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.red,"[llm/error]")} [${n}] [${as(e)}] LLM run errored with error: ${ar(e.error,"[error]")}`)}onToolStart(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.green,"[tool/start]")} [${n}] Entering Tool run with input: "${gC(e.inputs.input)}"`)}onToolEnd(e){var r;let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.cyan,"[tool/end]")} [${n}] [${as(e)}] Exiting Tool run with output: "${gC((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.red,"[tool/error]")} [${n}] [${as(e)}] Tool run errored with error: ${ar(e.error,"[error]")}`)}onRetrieverStart(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.green,"[retriever/start]")} [${n}] Entering Retriever run with input: ${ar(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.cyan,"[retriever/end]")} [${n}] [${as(e)}] Exiting Retriever run with output: ${ar(e.outputs,"[outputs]")}`)}onRetrieverError(e){let n=this.getBreadcrumbs(e);console.log(`${Qt(mn.red,"[retriever/error]")} [${n}] [${as(e)}] Retriever run errored with error: ${ar(e.error,"[error]")}`)}onAgentAction(e){let n=e,r=this.getBreadcrumbs(e);console.log(`${Qt(mn.blue,"[agent/action]")} [${r}] Agent selected action: ${ar(n.actions[n.actions.length-1],"[action]")}`)}};var pv,yC=()=>{if(pv===void 0){let t=He("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};pv=new Io(t)}return pv};var Kl=class t extends rr{constructor(e={}){var s;super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:n,projectName:r,client:a}=e;this.projectName=(s=r!=null?r:He("LANGCHAIN_PROJECT"))!=null?s:He("LANGCHAIN_SESSION"),this.exampleId=n,this.client=a!=null?a:yC();let i=t.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,n=void 0){return{...e,extra:{...e.extra,runtime:await cC()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:n}}async persistRun(e){}async onRunCreate(e){let n=await this._convertToCreate(e,this.exampleId);await this.client.createRun(n)}async onRunUpdate(e){let n={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra,session_name:this.projectName};await this.client.updateRun(e.id,n)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){var i,s,o;let n=e,r=new Set;for(;n.parent_run&&!(r.has(n.id)||(r.add(n.id),!n.parent_run));)n=n.parent_run;r.clear();let a=[n];for(;a.length>0;){let u=a.shift();!u||r.has(u.id)||(r.add(u.id),this.runMap.set(u.id,u),u.child_runs&&a.push(...u.child_runs))}this.client=(i=e.client)!=null?i:this.client,this.projectName=(s=e.project_name)!=null?s:this.projectName,this.exampleId=(o=e.reference_example_id)!=null?o:this.exampleId}convertToRunTree(e){let n={},r=[];for(let[a,i]of this.runMap){let s=new Fa({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});n[a]=s,r.push([a,i.dotted_order])}r.sort((a,i)=>!a[1]||!i[1]?0:a[1].localeCompare(i[1]));for(let[a]of r){let i=this.runMap.get(a),s=n[a];if(!(!i||!s)&&i.parent_run_id){let o=n[i.parent_run_id];o&&(o.child_runs.push(s),s.parent_run=o)}}return n[e]}static getTraceableRunTree(){try{return iC()}catch(e){return}}};var Im=Z(tm(),1);var bC=Symbol.for("ls:tracing_async_local_storage"),Do=Symbol.for("lc:context_variables"),_C=t=>{globalThis[bC]=t},is=()=>globalThis[bC];var sd;function k3(){let t="default"in Im.default?Im.default.default:Im.default;return new t({autoStart:!0,concurrency:1})}function D3(){return typeof sd=="undefined"&&(sd=k3()),sd}async function it(t,e){if(e===!0){let n=is();n!==void 0?await n.run(void 0,async()=>t()):await t()}else sd=D3(),sd.add(async()=>{let n=is();n!==void 0?await n.run(void 0,async()=>t()):await t()})}var wC=t=>t!==void 0?t:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(n=>He(n)==="true");function hv(t){var r;let e=is();if(e===void 0)return;let n=e.getStore();return(r=n==null?void 0:n[Do])==null?void 0:r[t]}var j3=Symbol("lc:configure_hooks"),vC=()=>hv(j3)||[];function SC(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}var mv=class{setHandler(e){return this.setHandlers([e])}},Yl=class{constructor(e,n,r,a,i,s,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;try{await((r=n.handleText)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleText: ${a}`),n.raiseError)throw a}},n.awaitHandlers)))}async handleCustomEvent(e,n,r,a,i){await Promise.all(this.handlers.map(s=>it(async()=>{var o;try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,n,this.runId,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}},gv=class extends Yl{getChild(e){let n=new Pt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetriever`),n.raiseError)throw a}},n.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleRetrieverError: ${a}`),n.raiseError)throw e}},n.awaitHandlers)))}},Pm=class extends Yl{async handleLLMNewToken(e,n,r,a,i,s){await Promise.all(this.handlers.map(o=>it(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,n!=null?n:{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e,n,r,a,i){await Promise.all(this.handlers.map(s=>it(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleLLMEnd(e,n,r,a,i){await Promise.all(this.handlers.map(s=>it(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}},yv=class extends Yl{getChild(e){let n=new Pt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleChainError(e,n,r,a,i){await Promise.all(this.handlers.map(s=>it(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleChainEnd(e,n,r,a,i){await Promise.all(this.handlers.map(s=>it(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentAction)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleAgentAction: ${a}`),n.raiseError)throw a}},n.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleAgentEnd: ${a}`),n.raiseError)throw a}},n.awaitHandlers)))}},bv=class extends Yl{getChild(e){let n=new Pt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleToolError(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolError: ${a}`),n.raiseError)throw a}},n.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(n=>it(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(a){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleToolEnd: ${a}`),n.raiseError)throw a}},n.awaitHandlers)))}},Pt=class t extends mv{constructor(e,n){var r,a,i,s,o,u;super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(r=n==null?void 0:n.handlers)!=null?r:this.handlers,this.inheritableHandlers=(a=n==null?void 0:n.inheritableHandlers)!=null?a:this.inheritableHandlers,this.tags=(i=n==null?void 0:n.tags)!=null?i:this.tags,this.inheritableTags=(s=n==null?void 0:n.inheritableTags)!=null?s:this.inheritableTags,this.metadata=(o=n==null?void 0:n.metadata)!=null?o:this.metadata,this.inheritableMetadata=(u=n==null?void 0:n.inheritableMetadata)!=null?u:this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,n,r=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(n.map(async(l,c)=>{let f=c===0&&r?r:We();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return Zl(d)&&d._createRunForLLMStart(e,[l],f,this._parentRunId,i,this.tags,this.metadata,u),it(async()=>{var p;try{await((p=d.handleLLMStart)==null?void 0:p.call(d,e,[l],f,this._parentRunId,i,this.tags,this.metadata,u))}catch(g){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${g}`),d.raiseError)throw g}},d.awaitHandlers)})),new Pm(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,n,r=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(n.map(async(l,c)=>{let f=c===0&&r?r:We();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return Zl(d)&&d._createRunForChatModelStart(e,[l],f,this._parentRunId,i,this.tags,this.metadata,u),it(async()=>{var p,g;try{if(d.handleChatModelStart)await((p=d.handleChatModelStart)==null?void 0:p.call(d,e,[l],f,this._parentRunId,i,this.tags,this.metadata,u));else if(d.handleLLMStart){let b=Ff(l);await((g=d.handleLLMStart)==null?void 0:g.call(d,e,[b],f,this._parentRunId,i,this.tags,this.metadata,u))}}catch(b){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${b}`),d.raiseError)throw b}},d.awaitHandlers)})),new Pm(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,n,r=We(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Zl(u)&&u._createRunForChainStart(e,n,r,this._parentRunId,this.tags,this.metadata,a,o),it(async()=>{var l;try{await((l=u.handleChainStart)==null?void 0:l.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,a,o))}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new yv(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,n,r=We(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Zl(u)&&u._createRunForToolStart(e,n,r,this._parentRunId,this.tags,this.metadata,o),it(async()=>{var l;try{await((l=u.handleToolStart)==null?void 0:l.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new bv(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,n,r=We(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Zl(u)&&u._createRunForRetrieverStart(e,n,r,this._parentRunId,this.tags,this.metadata,o),it(async()=>{var l;try{await((l=u.handleRetrieverStart)==null?void 0:l.call(u,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new gv(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,n,r,a,i){await Promise.all(this.handlers.map(s=>it(async()=>{var o;if(!s.ignoreCustomEvent)try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,n,r,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}addHandler(e,n=!0){this.handlers.push(e),n&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(n=>n!==e),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==e)}setHandlers(e,n=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,n)}addTags(e,n=!0){this.removeTags(e),this.tags.push(...e),n&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(n=>!e.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!e.includes(n))}addMetadata(e,n=!0){this.metadata={...this.metadata,...e},n&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let n of Object.keys(e))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(e=[],n=!0){let r=new t(this._parentRunId);for(let a of this.handlers){let i=this.inheritableHandlers.includes(a);r.addHandler(a,i)}for(let a of this.tags){let i=this.inheritableTags.includes(a);r.addTags([a],i)}for(let a of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},i)}for(let a of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||r.addHandler(a,n);return r}static fromHandlers(e){class n extends ko{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:We()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new n),r}static configure(e,n,r,a,i,s,o){return this._configureSync(e,n,r,a,i,s,o)}static _configureSync(e,n,r,a,i,s,o){var d,p,g,b,_;let u;(e||n)&&(Array.isArray(e)||!e?(u=new t,u.setHandlers((d=e==null?void 0:e.map(od))!=null?d:[],!0)):u=e,u=u.copy(Array.isArray(n)?n.map(od):n==null?void 0:n.handlers,!1));let l=He("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=((p=Kl.getTraceableRunTree())==null?void 0:p.tracingEnabled)||wC(),f=c||((g=He("LANGCHAIN_TRACING"))!=null?g:!1);if(l||f){if(u||(u=new t),l&&!u.handlers.some(m=>m.name===id.prototype.name)){let m=new id;u.addHandler(m,!0)}if(f&&!u.handlers.some(m=>m.name==="langchain_tracer")&&c){let m=new Kl;u.addHandler(m,!0),u._parentRunId=(_=(b=Kl.getTraceableRunTree())==null?void 0:b.id)!=null?_:u._parentRunId}}for(let{contextVar:m,inheritable:h=!0,handlerClass:y,envVar:v}of vC()){let S=v&&He(v)==="true"&&y,A,T=m!==void 0?hv(m):void 0;T&&fC(T)?A=T:S&&(A=new y({})),A!==void 0&&(u||(u=new t),u.handlers.some(x=>x.name===A.name)||u.addHandler(A,h))}return(r||a)&&u&&(u.addTags(r!=null?r:[]),u.addTags(a!=null?a:[],!1)),(i||s)&&u&&(u.addMetadata(i!=null?i:{}),u.addMetadata(s!=null?s:{},!1)),u}};function od(t){return"name"in t?t:ko.fromMethods(t)}var Nm=class{getStore(){}run(e,n){return n()}enterWith(e){}},M3=new Nm,xC=Symbol.for("lc:child_config"),_v=class{getInstance(){var e;return(e=is())!=null?e:M3}getRunnableConfig(){var n,r;return(r=(n=this.getInstance().getStore())==null?void 0:n.extra)==null?void 0:r[xC]}runWithConfig(e,n,r){var c;let a=Pt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),s=i.getStore(),o=a==null?void 0:a.getParentRunId(),u=(c=a==null?void 0:a.handlers)==null?void 0:c.find(f=>(f==null?void 0:f.name)==="langchain_tracer"),l;return u&&o?l=u.convertToRunTree(o):r||(l=new Fa({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[xC]:e}),s!==void 0&&s[Do]!==void 0&&(l===void 0&&(l={}),l[Do]=s[Do]),i.run(l,n)}initializeGlobalInstance(e){is()===void 0&&_C(e)}},gn=new _v;var km=25;async function yn(t){return Pt._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function Dm(...t){var n,r,a;let e={};for(let i of t.filter(s=>!!s))for(let s of Object.keys(i))if(s==="metadata")e[s]={...e[s],...i[s]};else if(s==="tags"){let o=(n=e[s])!=null?n:[];e[s]=[...new Set(o.concat((r=i[s])!=null?r:[]))]}else if(s==="configurable")e[s]={...e[s],...i[s]};else if(s==="timeout")e.timeout===void 0?e.timeout=i.timeout:i.timeout!==void 0&&(e.timeout=Math.min(e.timeout,i.timeout));else if(s==="signal")e.signal===void 0?e.signal=i.signal:i.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,i.signal]):e.signal=i.signal);else if(s==="callbacks"){let o=e.callbacks,u=i.callbacks;if(Array.isArray(u))if(!o)e.callbacks=u;else if(Array.isArray(o))e.callbacks=o.concat(u);else{let l=o.copy();for(let c of u)l.addHandler(od(c),!0);e.callbacks=l}else if(u)if(!o)e.callbacks=u;else if(Array.isArray(o)){let l=u.copy();for(let c of o)l.addHandler(od(c),!0);e.callbacks=l}else e.callbacks=new Pt(u._parentRunId,{handlers:o.handlers.concat(u.handlers),inheritableHandlers:o.inheritableHandlers.concat(u.inheritableHandlers),tags:Array.from(new Set(o.tags.concat(u.tags))),inheritableTags:Array.from(new Set(o.inheritableTags.concat(u.inheritableTags))),metadata:{...o.metadata,...u.metadata}})}else{let o=s;e[o]=(a=i[o])!=null?a:e[o]}return e}var $3=new Set(["string","number","boolean"]);function me(t){var r;let e=gn.getRunnableConfig(),n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:a,runName:i,...s}=e;n=Object.entries(s).reduce((o,[u,l])=>(l!==void 0&&(o[u]=l),o),n)}if(t&&(n=Object.entries(t).reduce((a,[i,s])=>(s!==void 0&&(a[i]=s),a),n)),n!=null&&n.configurable)for(let a of Object.keys(n.configurable))$3.has(typeof n.configurable[a])&&!((r=n.metadata)!=null&&r[a])&&(n.metadata||(n.metadata={}),n.metadata[a]=n.configurable[a]);if(n.timeout!==void 0){if(n.timeout<=0)throw new Error("Timeout must be a positive number");let a=AbortSignal.timeout(n.timeout);n.signal!==void 0?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,a])):n.signal=a,delete n.timeout}return n}function ct(t={},{callbacks:e,maxConcurrency:n,recursionLimit:r,runName:a,configurable:i,runId:s}={}){let o=me(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),a!==void 0&&(o.runName=a),i!==void 0&&(o.configurable={...o.configurable,...i}),s!==void 0&&delete o.runId,o}function vr(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function aa(t,e){if(e===void 0)return t;let n;return Promise.race([t.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,a)=>{n=()=>{a(new Error("Aborted"))},e.addEventListener("abort",n),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",n))}var Ft=class t extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let n=this.reader.cancel();this.reader.releaseLock(),await n}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let n=e.getReader();return new t({start(r){return a();function a(){return n.read().then(({done:i,value:s})=>{if(i){r.close();return}return r.enqueue(s),a()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(e){return new t({async pull(n){let{value:r,done:a}=await e.next();a&&n.close(),n.enqueue(r)},async cancel(n){await e.return(n)}})}};function wv(t,e=2){let n=Array.from({length:e},()=>[]);return n.map(async function*(a){for(;;)if(a.length===0){let i=await t.next();for(let s of n)s.push(i)}else{if(a[0].done)return;yield a.shift().value}})}function qt(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){let n={...t};for(let[r,a]of Object.entries(e))r in n&&!Array.isArray(n[r])?n[r]=qt(n[r],a):n[r]=a;return n}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}var Ha=class{constructor(e){var n,r;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=(r=e.signal)!=null?r:(n=this.config)==null?void 0:n.signal,this.setup=new Promise((a,i)=>{gn.runWithConfig(vr(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(a,i):this.firstResult.then(s=>a(void 0),i)},!0)})}async next(...e){var n;return(n=this.signal)==null||n.throwIfAborted(),this.firstResultUsed?gn.runWithConfig(vr(this.config),this.signal?async()=>aa(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function AC(t,e,n,r,...a){let i=new Ha({generator:e,startSetup:n,signal:r}),s=await i.setup;return{output:t(i,s,...a),setup:s}}var Sr=class{constructor(e){var n;Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=(n=e.ops)!=null?n:[]}concat(e){let n=this.ops.concat(e.ops),r=rs({},n);return new ud({ops:n,state:r[r.length-1].newDocument})}},ud=class t extends Sr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let n=this.ops.concat(e.ops),r=rs(this.state,e.ops);return new t({ops:n,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let n=rs({},e.ops);return new t({ops:e.ops,state:n[n.length-1].newDocument})}},OC=t=>t.name==="log_stream_tracer";async function TC(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:n}=t;if(["retriever","llm","prompt"].includes(t.run_type))return n;if(!(Object.keys(n).length===1&&(n==null?void 0:n.input)===""))return n.input}async function EC(t,e){let{outputs:n}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?n:n!==void 0&&Object.keys(n).length===1&&(n==null?void 0:n.output)!==void 0?n.output:n}function L3(t){return t!==void 0&&t.message!==void 0}var ld=class extends rr{constructor(e){var n,r;super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(n=e==null?void 0:e.autoClose)!=null?n:!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(r=e==null?void 0:e._schemaFormat)!=null?r:this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){var a;if(e.id===this.rootId)return!1;let n=(a=e.tags)!=null?a:[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||n.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&n.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),r}async*tapOutputIterable(e,n){for await(let r of n){if(e!==this.rootId){let a=this.keyMapByRunId[e];a&&await this.writer.write(new Sr({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var a,i,s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Sr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let n=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=n===1?e.name:`${e.name}:${n}`;let r={id:e.id,name:e.name,type:e.run_type,tags:(a=e.tags)!=null?a:[],metadata:(s=(i=e.extra)==null?void 0:i.metadata)!=null?s:{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await TC(e,this._schemaFormat)),await this.writer.write(new Sr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let n=this.keyMapByRunId[e.id];if(n===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${n}/inputs`,value:await TC(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${n}/final_output`,value:await EC(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${n}/end_time`,value:new Date(e.end_time).toISOString()});let a=new Sr({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){let n=new Sr({ops:[{op:"replace",path:"/final_output",value:await EC(e,this._schemaFormat)}]});await this.writer.write(n),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,n,r){let a=this.keyMapByRunId[e.id];if(a===void 0)return;let i=e.inputs.messages!==void 0,s;i?L3(r==null?void 0:r.chunk)?s=r==null?void 0:r.chunk:s=new Dn({id:`run-${e.id}`,content:n}):s=n;let o=new Sr({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:n},{op:"add",path:`/logs/${a}/streamed_output/-`,value:s}]});await this.writer.write(o)}};var jm="__run",ia=class t{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new t({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Va=class t extends ia{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new t({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}};function Mm({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}var RC=t=>t.name==="event_stream_tracer",$m=class extends rr{constructor(e){var n;super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(n=e==null?void 0:e.autoClose)!=null?n:!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){var a;let n=(a=e.tags)!=null?a:[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||n.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&n.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),r}async*tapOutputIterable(e,n){let r=await n.next();if(r.done)return;let a=this.runInfoMap.get(e);if(a===void 0){yield r.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new ia({text:u}):u}let s=this.tappedPromises.get(e);if(s===void 0){let o;s=new Promise(u=>{o=u}),this.tappedPromises.set(e,s);try{let u={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...u,data:{chunk:i(a.runType,r.value)}},a),yield r.value;for await(let l of n)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...u,data:{chunk:i(a.runType,l)}},a),yield l}finally{o()}}else{yield r.value;for await(let o of n)yield o}}async send(e,n){this._includeRun(n)&&await this.writer.write(e)}async sendEndEvent(e,n){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,n)}):await this.send(e,n)}async onLLMStart(e){var s,o,u,l,c,f;let n=Mm(e),r=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:(s=e.tags)!=null?s:[],metadata:(u=(o=e.extra)==null?void 0:o.metadata)!=null?u:{},name:n,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);let i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:n,tags:(l=e.tags)!=null?l:[],run_id:e.id,metadata:(f=(c=e.extra)==null?void 0:c.metadata)!=null?f:{}},a)}async onLLMNewToken(e,n,r){let a=this.runInfoMap.get(e.id),i,s;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")s="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new Dn({content:n,id:`run-${e.id}`}):i=r.chunk.message;else if(a.runType==="llm")s="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new ia({text:n}):i=r.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:s,data:{chunk:i},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var s,o,u,l;let n=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(n===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let a=(s=e.outputs)==null?void 0:s.generations,i;if(n.runType==="chat_model"){for(let c of a!=null?a:[]){if(i!==void 0)break;i=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(n.runType==="llm")i={generations:a==null?void 0:a.map(c=>c.map(f=>({text:f.text,generationInfo:f.generationInfo}))),llmOutput:(l=(u=e.outputs)==null?void 0:u.llmOutput)!=null?l:{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${n.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onChainStart(e){var s,o,u,l,c,f,d;let n=Mm(e),r=(s=e.run_type)!=null?s:"chain",a={tags:(o=e.tags)!=null?o:[],metadata:(l=(u=e.extra)==null?void 0:u.metadata)!=null?l:{},name:n,runType:e.run_type},i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},a.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,a.inputs=e.inputs.input):(i.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${r}_start`,data:i,name:n,tags:(c=e.tags)!=null?c:[],run_id:e.id,metadata:(d=(f=e.extra)==null?void 0:f.metadata)!=null?d:{}},a)}async onChainEnd(e){var o,u,l,c,f;let n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,a=(u=(o=e.inputs)!=null?o:n.inputs)!=null?u:{},s={output:(c=(l=e.outputs)==null?void 0:l.output)!=null?c:e.outputs,input:a};a.input&&Object.keys(a).length===1&&(s.input=a.input,n.inputs=a.input),await this.sendEndEvent({event:r,data:s,run_id:e.id,name:n.name,tags:n.tags,metadata:(f=n.metadata)!=null?f:{}},n)}async onToolStart(e){var a,i,s,o,u,l,c,f;let n=Mm(e),r={tags:(a=e.tags)!=null?a:[],metadata:(s=(i=e.extra)==null?void 0:i.metadata)!=null?s:{},name:n,runType:"tool",inputs:(o=e.inputs)!=null?o:{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:(u=e.inputs)!=null?u:{}},name:n,run_id:e.id,tags:(l=e.tags)!=null?l:[],metadata:(f=(c=e.extra)==null?void 0:c.metadata)!=null?f:{}},r)}async onToolEnd(e){var a;let n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(n.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onRetrieverStart(e){var i,s,o,u,l,c;let n=Mm(e),a={tags:(i=e.tags)!=null?i:[],metadata:(o=(s=e.extra)==null?void 0:s.metadata)!=null?o:{},name:n,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:n,tags:(u=e.tags)!=null?u:[],run_id:e.id,metadata:(c=(l=e.extra)==null?void 0:l.metadata)!=null?c:{}},a)}async onRetrieverEnd(e){var r,a;let n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:(a=(r=e.outputs)==null?void 0:r.documents)!=null?a:e.outputs,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async handleCustomEvent(e,n,r){let a=this.runInfoMap.get(r);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:n},a)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};var CC=Z(Zh(),1),Lm=Z(tm(),1),U3=[400,401,402,403,404,405,406,407,409],z3=t=>{var n,r,a;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;let e=(r=(n=t==null?void 0:t.response)==null?void 0:n.status)!=null?r:t==null?void 0:t.status;if(e&&U3.includes(+e))throw t;if(((a=t==null?void 0:t.error)==null?void 0:a.code)==="insufficient_quota"){let i=new Error(t==null?void 0:t.message);throw i.name="InsufficientQuotaError",i}},Ga=class{constructor(e){var r,a,i;Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=(r=e.maxConcurrency)!=null?r:1/0,this.maxRetries=(a=e.maxRetries)!=null?a:6,this.onFailedAttempt=(i=e.onFailedAttempt)!=null?i:z3;let n="default"in Lm.default?Lm.default.default:Lm.default;this.queue=new n({concurrency:this.maxConcurrency})}call(e,...n){return this.queue.add(()=>(0,CC.default)(()=>e(...n).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>fetch(...e).then(n=>n.ok?n:Promise.reject(n)))}};var cd=class extends rr{constructor({config:e,onStart:n,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=n,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function fd(t){return t?t.lc_runnable:!1}var Um=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,n){var i;let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,a=(i=e.tags)!=null?i:[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(n)),this.includeTags!==void 0&&(r=r||a.some(s=>{var o;return(o=this.includeTags)==null?void 0:o.includes(s)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(n)),this.excludeTags!==void 0&&(r=r&&a.every(s=>{var o;return!((o=this.excludeTags)!=null&&o.includes(s))})),r}};var PC=Symbol("Let zodToJsonSchema decide on which parser to use");var IC={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},NC=t=>typeof t=="string"?{...IC,name:t}:{...IC,...t};var kC=t=>{let e=NC(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function vv(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function ge(t,e,n,r,a){t[e]=n,vv(t,e,r,a)}function DC(){return{}}function jC(t,e){var r,a,i;let n={type:"array"};return(r=t.type)!=null&&r._def&&((i=(a=t.type)==null?void 0:a._def)==null?void 0:i.typeName)!==E.ZodAny&&(n.items=Y(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&ge(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&ge(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(ge(n,"minItems",t.exactLength.value,t.exactLength.message,e),ge(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function MC(t,e){let n={type:"integer",format:"int64"};if(!t.checks)return n;for(let r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?ge(n,"minimum",r.value,r.message,e):ge(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),ge(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ge(n,"maximum",r.value,r.message,e):ge(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),ge(n,"maximum",r.value,r.message,e));break;case"multipleOf":ge(n,"multipleOf",r.value,r.message,e);break}return n}function $C(){return{type:"boolean"}}function zm(t,e){return Y(t.type._def,e)}var LC=(t,e)=>Y(t.innerType._def,e);function Sv(t,e,n){let r=n!=null?n:e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,i)=>Sv(t,e,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return B3(t,e)}}var B3=(t,e)=>{let n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(let r of t.checks)switch(r.kind){case"min":ge(n,"minimum",r.value,r.message,e);break;case"max":ge(n,"maximum",r.value,r.message,e);break}return n};function UC(t,e){return{...Y(t.innerType._def,e),default:t.defaultValue()}}function zC(t,e){return e.effectStrategy==="input"?Y(t.schema._def,e):{}}function BC(t){return{type:"string",enum:Array.from(t.values)}}var F3=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function FC(t,e){let n=[Y(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Y(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,a=[];return n.forEach(i=>{if(F3(i))a.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;s=u}else r=void 0;a.push(s)}}),a.length?{allOf:a,...r}:void 0}function qC(t,e){let n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}var xv,xr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(xv===void 0&&(xv=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),xv),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Bm(t,e){let n={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":ge(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e);break;case"max":ge(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ar(n,"email",r.message,e);break;case"format:idn-email":Ar(n,"idn-email",r.message,e);break;case"pattern:zod":Wt(n,xr.email,r.message,e);break}break;case"url":Ar(n,"uri",r.message,e);break;case"uuid":Ar(n,"uuid",r.message,e);break;case"regex":Wt(n,r.regex,r.message,e);break;case"cuid":Wt(n,xr.cuid,r.message,e);break;case"cuid2":Wt(n,xr.cuid2,r.message,e);break;case"startsWith":Wt(n,RegExp(`^${Av(r.value,e)}`),r.message,e);break;case"endsWith":Wt(n,RegExp(`${Av(r.value,e)}$`),r.message,e);break;case"datetime":Ar(n,"date-time",r.message,e);break;case"date":Ar(n,"date",r.message,e);break;case"time":Ar(n,"time",r.message,e);break;case"duration":Ar(n,"duration",r.message,e);break;case"length":ge(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e),ge(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"includes":{Wt(n,RegExp(Av(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Ar(n,"ipv4",r.message,e),r.version!=="v4"&&Ar(n,"ipv6",r.message,e);break}case"base64url":Wt(n,xr.base64url,r.message,e);break;case"jwt":Wt(n,xr.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&Wt(n,xr.ipv4Cidr,r.message,e),r.version!=="v4"&&Wt(n,xr.ipv6Cidr,r.message,e);break}case"emoji":Wt(n,xr.emoji(),r.message,e);break;case"ulid":{Wt(n,xr.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ar(n,"binary",r.message,e);break}case"contentEncoding:base64":{ge(n,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{Wt(n,xr.base64,r.message,e);break}}break}case"nanoid":Wt(n,xr.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return n}function Av(t,e){return e.patternStrategy==="escape"?H3(t):t}var q3=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function H3(t){let e="";for(let n=0;n<t.length;n++)q3.has(t[n])||(e+="\\"),e+=t[n];return e}function Ar(t,e,n,r){var a;t.format||(a=t.anyOf)!=null&&a.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):ge(t,"format",e,n,r)}function Wt(t,e,n,r){var a;t.pattern||(a=t.allOf)!=null&&a.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:HC(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):ge(t,"pattern",HC(e,r),n,r)}function HC(t,e){var u;if(!e.applyRegexFlags||!t.flags)return t.source;let n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source,a="",i=!1,s=!1,o=!1;for(let l=0;l<r.length;l++){if(i){a+=r[l],i=!1;continue}if(n.i){if(s){if(r[l].match(/[a-z]/)){o?(a+=r[l],a+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(a+=r[l],o=!0):a+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){a+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(n.m){if(r[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[l]==="."){a+=s?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}a+=r[l],r[l]==="\\"?i=!0:s&&r[l]==="]"?s=!1:!s&&r[l]==="["&&(s=!0)}try{new RegExp(a)}catch(l){return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a}function Fm(t,e){var r,a,i,s,o,u,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===E.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((c,f)=>{var d;return{...c,[f]:(d=Y(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",f]}))!=null?d:{}}},{}),additionalProperties:e.rejectedAdditionalProperties};let n={type:"object",additionalProperties:(a=Y(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?a:e.allowedAdditionalProperties};if(e.target==="openApi3")return n;if(((i=t.keyType)==null?void 0:i._def.typeName)===E.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:c,...f}=Bm(t.keyType._def,e);return{...n,propertyNames:f}}else{if(((o=t.keyType)==null?void 0:o._def.typeName)===E.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};if(((u=t.keyType)==null?void 0:u._def.typeName)===E.ZodBranded&&t.keyType._def.type._def.typeName===E.ZodString&&((l=t.keyType._def.type._def.checks)!=null&&l.length)){let{type:c,...f}=zm(t.keyType._def,e);return{...n,propertyNames:f}}}return n}function VC(t,e){if(e.mapStrategy==="record")return Fm(t,e);let n=Y(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=Y(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function GC(t){let e=t.values,r=Object.keys(t.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),a=Array.from(new Set(r.map(i=>typeof i)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function ZC(){return{not:{}}}function KC(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var dd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function JC(t,e){if(e.target==="openApi3")return YC(t,e);let n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in dd&&(!r._def.checks||!r._def.checks.length))){let r=n.reduce((a,i)=>{let s=dd[i._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=n.reduce((a,i)=>{let s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(i._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){let a=r.filter((i,s,o)=>o.indexOf(i)===s);return{type:a.length>1?a:a[0],enum:n.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(i=>!r.includes(i))],[])};return YC(t,e)}var YC=(t,e)=>{let n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,a)=>Y(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function XC(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:dd[t.innerType._def.typeName],nullable:!0}:{type:[dd[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=Y(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let n=Y(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function QC(t,e){let n={type:"number"};if(!t.checks)return n;for(let r of t.checks)switch(r.kind){case"int":n.type="integer",vv(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?ge(n,"minimum",r.value,r.message,e):ge(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),ge(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ge(n,"maximum",r.value,r.message,e):ge(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),ge(n,"maximum",r.value,r.message,e));break;case"multipleOf":ge(n,"multipleOf",r.value,r.message,e);break}return n}function WC(t,e){let n=e.target==="openAi",r={type:"object",properties:{}},a=[],i=t.shape();for(let o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let l=G3(u);l&&n&&(u instanceof cn&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);let c=Y(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(r.properties[o]=c,l||a.push(o))}a.length&&(r.required=a);let s=V3(t,e);return s!==void 0&&(r.additionalProperties=s),r}function V3(t,e){if(t.catchall._def.typeName!=="ZodNever")return Y(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function G3(t){try{return t.isOptional()}catch(e){return!0}}var eI=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Y(t.innerType._def,e);let n=Y(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}};var tI=(t,e)=>{if(e.pipeStrategy==="input")return Y(t.in._def,e);if(e.pipeStrategy==="output")return Y(t.out._def,e);let n=Y(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Y(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function nI(t,e){return Y(t.type._def,e)}function rI(t,e){let r={type:"array",uniqueItems:!0,items:Y(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&ge(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&ge(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function aI(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>Y(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Y(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>Y(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function iI(){return{not:{}}}function sI(){return{}}var oI=(t,e)=>Y(t.innerType._def,e);var uI=(t,e,n)=>{switch(e){case E.ZodString:return Bm(t,n);case E.ZodNumber:return QC(t,n);case E.ZodObject:return WC(t,n);case E.ZodBigInt:return MC(t,n);case E.ZodBoolean:return $C();case E.ZodDate:return Sv(t,n);case E.ZodUndefined:return iI();case E.ZodNull:return KC(n);case E.ZodArray:return jC(t,n);case E.ZodUnion:case E.ZodDiscriminatedUnion:return JC(t,n);case E.ZodIntersection:return FC(t,n);case E.ZodTuple:return aI(t,n);case E.ZodRecord:return Fm(t,n);case E.ZodLiteral:return qC(t,n);case E.ZodEnum:return BC(t);case E.ZodNativeEnum:return GC(t);case E.ZodNullable:return XC(t,n);case E.ZodOptional:return eI(t,n);case E.ZodMap:return VC(t,n);case E.ZodSet:return rI(t,n);case E.ZodLazy:return()=>t.getter()._def;case E.ZodPromise:return nI(t,n);case E.ZodNaN:case E.ZodNever:return ZC();case E.ZodEffects:return zC(t,n);case E.ZodAny:return DC();case E.ZodUnknown:return sI();case E.ZodDefault:return UC(t,n);case E.ZodBranded:return zm(t,n);case E.ZodReadonly:return oI(t,n);case E.ZodCatch:return LC(t,n);case E.ZodPipeline:return tI(t,n);case E.ZodFunction:case E.ZodVoid:case E.ZodSymbol:return;default:return(r=>{})(e)}};function Y(t,e,n=!1){var o;let r=e.seen.get(t);if(e.override){let u=(o=e.override)==null?void 0:o.call(e,t,e,r,n);if(u!==PC)return u}if(r&&!n){let u=Z3(r,e);if(u!==void 0)return u}let a={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,a);let i=uI(t,t.typeName,e),s=typeof i=="function"?Y(i(),e):i;if(s&&Y3(t,e,s),e.postProcess){let u=e.postProcess(s,t,e);return a.jsonSchema=s,u}return a.jsonSchema=s,s}var Z3=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:K3(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},K3=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},Y3=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n);var ir=(t,e)=>{var u;let n=kC(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[c,f])=>{var d;return{...l,[c]:(d=Y(f._def,{...n,currentPath:[...n.basePath,n.definitionPath,c]},!0))!=null?d:{}}},{}):void 0,a=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,i=(u=Y(t._def,a===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1))!=null?u:{},s=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;s!==void 0&&(i.title=s);let o=a===void 0?r?{...i,[n.definitionPath]:r}:i:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:i}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Tv(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}var J3=["*","_","`"];function X3(t){let e="";for(let[n,r]of Object.entries(t))e+=`	classDef ${n} ${r};
`;return e}function lI(t,e,n){var p,g,b,_,m;let{firstNode:r,lastNode:a,nodeColors:i,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=n!=null?n:{},l=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(s){let h="default",y={[h]:"{0}({1})"};r!==void 0&&(y[r]="{0}([{1}]):::first"),a!==void 0&&(y[a]="{0}([{1}]):::last");for(let[v,S]of Object.entries(t)){let A=(p=S.name.split(":").pop())!=null?p:"",x=J3.some(R=>A.startsWith(R)&&A.endsWith(R))?`<p>${A}</p>`:A;Object.keys((g=S.metadata)!=null?g:{}).length&&(x+=`<hr/><small><em>${Object.entries((b=S.metadata)!=null?b:{}).map(([R,B])=>`${R} = ${B}`).join(`
`)}</em></small>`);let C=((_=y[v])!=null?_:y[h]).replace("{0}",Tv(v)).replace("{1}",x);l+=`	${C}
`}}let c={};for(let h of e){let y=h.source.split(":"),v=h.target.split(":"),S=y.filter((A,T)=>A===v[T]).join(":");c[S]||(c[S]=[]),c[S].push(h)}let f=new Set;function d(h,y){let v=h.length===1&&h[0].source===h[0].target;if(y&&!v){let S=y.split(":").pop();if(f.has(S))throw new Error(`Found duplicate subgraph '${S}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);f.add(S),l+=`	subgraph ${S}
`}for(let S of h){let{source:A,target:T,data:x,conditional:C}=S,R="";if(x!==void 0){let B=x,te=B.split(" ");te.length>u&&(B=Array.from({length:Math.ceil(te.length/u)},(je,Ge)=>te.slice(Ge*u,(Ge+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),R=C?` -. &nbsp;${B}&nbsp; .-> `:` -- &nbsp;${B}&nbsp; --> `}else R=C?" -.-> ":" --> ";l+=`	${Tv(A)}${R}${Tv(T)};
`}for(let S in c)S.startsWith(`${y}:`)&&S!==y&&d(c[S],S);y&&!v&&(l+=`	end
`)}d((m=c[""])!=null?m:[],"");for(let h in c)!h.includes(":")&&h!==""&&d(c[h],h);return s&&(l+=X3(i!=null?i:{})),l}async function cI(t,e){let{backgroundColor:n="white"}=e!=null?e:{},r=btoa(t);n!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));let a=`https://mermaid.ink/img/${r}?bgColor=${n}`,i=await fetch(a);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function Q3(t,e){var n;if(t!==void 0&&!ns(t))return t;if(fd(e))try{let r=e.getName();return r=r.startsWith("Runnable")?r.slice(8):r,r}catch(r){return e.getName()}else return(n=e.name)!=null?n:"UnknownSchema"}function W3(t){return fd(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...ir(t.data.schema),title:t.data.name}}}var pd=class t{constructor(e){var n,r;Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(n=e==null?void 0:e.nodes)!=null?n:this.nodes,this.edges=(r=e==null?void 0:e.edges)!=null?r:this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((n,r)=>{e[n.id]=ns(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:e[n.id],...W3(n)})),edges:this.edges.map(n=>{let r={source:e[n.source],target:e[n.target]};return typeof n.data!="undefined"&&(r.data=n.data),typeof n.conditional!="undefined"&&(r.conditional=n.conditional),r})}}addNode(e,n,r){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);let a=n!=null?n:We(),i={id:a,data:e,name:Q3(n,e),metadata:r};return this.nodes[a]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(n=>n.source!==e.id&&n.target!==e.id)}addEdge(e,n,r,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);let i={source:e.id,target:n.id,data:r,conditional:a};return this.edges.push(i),i}firstNode(){return fI(this)}lastNode(){return dI(this)}extend(e,n=""){let r=n;Object.values(e.nodes).map(l=>l.id).every(ns)&&(r="");let i=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[i(l)]={...c,id:i(l)}});let s=e.edges.map(l=>({...l,source:i(l.source),target:i(l.target)}));this.edges=[...this.edges,...s];let o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&fI(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&dI(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),n=new Map;Object.values(e).forEach(a=>{n.set(a,(n.get(a)||0)+1)});let r=a=>{let i=e[a];return ns(a)&&n.get(i)===1?i:a};return new t({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,i])=>[r(a),{...i,id:r(a)}])),edges:this.edges.map(a=>({...a,source:r(a.source),target:r(a.target)}))})}drawMermaid(e){let{withStyles:n,curveStyle:r,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e!=null?e:{},s=this.reid(),o=s.firstNode(),u=s.lastNode();return lI(s.nodes,s.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:n,curveStyle:r,nodeColors:a,wrapLabelNWords:i})}async drawMermaidPng(e){let n=this.drawMermaid(e);return cI(n,{backgroundColor:e==null?void 0:e.backgroundColor})}};function fI(t,e=[]){let n=new Set(t.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),r=[];for(let a of Object.values(t.nodes))!e.includes(a.id)&&!n.has(a.id)&&r.push(a);return r.length===1?r[0]:void 0}function dI(t,e=[]){let n=new Set(t.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),r=[];for(let a of Object.values(t.nodes))!e.includes(a.id)&&!n.has(a.id)&&r.push(a);return r.length===1?r[0]:void 0}function pI(t){let e=new TextEncoder,n=new ReadableStream({async start(r){for await(let a of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Ft.fromReadableStream(n)}function Ev(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}var hI=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function qm(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*Ov(t,e){for(;;){let{value:n,done:r}=gn.runWithConfig(vr(t),e.next.bind(e),!0);if(r)break;yield n}}async function*Hm(t,e){let n=e[Symbol.asyncIterator]();for(;;){let{value:r,done:a}=await gn.runWithConfig(vr(t),n.next.bind(e),!0);if(a)break;yield r}}function gt(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}var ke=class extends yr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){var r,a;let n=(a=(r=this.name)!=null?r:this.constructor.lc_name())!=null?a:this.constructor.name;return e?`${n}${e}`:n}bind(e){return new Ka({bound:this,kwargs:e,config:{}})}map(){return new Vm({bound:this})}withRetry(e){return new Gm({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Ka({bound:this,config:e,kwargs:{}})}withFallbacks(e){let n=Array.isArray(e)?e:e.fallbacks;return new Zm({runnable:this,fallbacks:n})}_getOptionsList(e,n=0){if(Array.isArray(e)&&e.length!==n)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${n} inputs`);if(Array.isArray(e))return e.map(me);if(n>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:n},(a,i)=>me(i===0?e:r))}return Array.from({length:n},()=>me(e))}async batch(e,n,r){var u,l;let a=this._getOptionsList(n!=null?n:{},e.length),i=(l=(u=a[0])==null?void 0:u.maxConcurrency)!=null?l:r==null?void 0:r.maxConcurrency,s=new Ga({maxConcurrency:i,onFailedAttempt:c=>{throw c}}),o=e.map((c,f)=>s.call(async()=>{try{return await this.invoke(c,a[f])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,n){yield this.invoke(e,n)}async stream(e,n){let r=me(n),a=new Ha({generator:this._streamIterator(e,r),config:r});return await a.setup,Ft.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let n;e===void 0?n=me(e):n=me({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[n,r]}async _callWithConfig(e,n,r){var u;let a=me(r),i=await yn(a),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),gt(n,"input"),a.runId,a==null?void 0:a.runType,void 0,void 0,(u=a==null?void 0:a.runName)!=null?u:this.getName()));delete a.runId;let o;try{let l=e.call(this,n,a,s);o=await aa(l,r==null?void 0:r.signal)}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}return await(s==null?void 0:s.handleChainEnd(gt(o,"output"))),o}async _batchWithConfig(e,n,r,a){var l;let i=this._getOptionsList(r!=null?r:{},n.length),s=await Promise.all(i.map(yn)),o=await Promise.all(s.map(async(c,f)=>{var p;let d=await(c==null?void 0:c.handleChainStart(this.toJSON(),gt(n[f],"input"),i[f].runId,i[f].runType,void 0,void 0,(p=i[f].runName)!=null?p:this.getName()));return delete i[f].runId,d})),u;try{let c=e.call(this,n,i,o,a);u=await aa(c,(l=i==null?void 0:i[0])==null?void 0:l.signal)}catch(c){throw await Promise.all(o.map(f=>f==null?void 0:f.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(gt(u,"output")))),u}async*_transformStreamWithConfig(e,n,r){let a,i=!0,s,o=!0,u=me(r),l=await yn(u);async function*c(){for await(let d of e){if(i)if(a===void 0)a=d;else try{a=qt(a,d)}catch(p){a=void 0,i=!1}yield d}}let f;try{let d=await AC(n.bind(this),c(),async()=>{var _;return l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,(_=u.runName)!=null?_:this.getName())},r==null?void 0:r.signal,u);delete u.runId,f=d.setup;let p=f==null?void 0:f.handlers.find(RC),g=d.output;p!==void 0&&f!==void 0&&(g=p.tapOutputIterable(f.runId,g));let b=f==null?void 0:f.handlers.find(OC);b!==void 0&&f!==void 0&&(g=b.tapOutputIterable(f.runId,g));for await(let _ of g)if(yield _,o)if(s===void 0)s=_;else try{s=qt(s,_)}catch(m){s=void 0,o=!1}}catch(d){throw await(f==null?void 0:f.handleChainError(d,void 0,void 0,void 0,{inputs:gt(a,"input")})),d}await(f==null?void 0:f.handleChainEnd(s!=null?s:{},void 0,void 0,void 0,{inputs:gt(a,"input")}))}getGraph(e){let n=new pd,r=n.addNode({name:`${this.getName()}Input`,schema:at.any()}),a=n.addNode(this),i=n.addNode({name:`${this.getName()}Output`,schema:at.any()});return n.addEdge(r,a),n.addEdge(a,i),n}pipe(e){return new Ya({first:this,last:Za(e)})}pick(e){return this.pipe(new Km(e))}assign(e){return this.pipe(new Jl(new ss({steps:e})))}async*transform(e,n){let r;for await(let a of e)r===void 0?r=a:r=qt(r,a);yield*this._streamIterator(r,me(n))}async*streamLog(e,n,r){let a=new ld({...r,autoClose:!1,_schemaFormat:"original"}),i=me(n);yield*this._streamLog(e,a,i)}async*_streamLog(e,n,r){let{callbacks:a}=r;if(a===void 0)r.callbacks=[n];else if(Array.isArray(a))r.callbacks=a.concat([n]);else{let u=a.copy();u.addHandler(n,!0),r.callbacks=u}let i=this.stream(e,r);async function s(){try{let u=await i;for await(let l of u){let c=new Sr({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await n.writer.write(c)}}finally{await n.writer.close()}}let o=s();try{for await(let u of n)yield u}finally{await o}}streamEvents(e,n,r){let a;if(n.version==="v1")a=this._streamEventsV1(e,n,r);else if(n.version==="v2")a=this._streamEventsV2(e,n,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return n.encoding==="text/event-stream"?pI(a):Ft.fromAsyncGenerator(a)}async*_streamEventsV2(e,n,r){var g,b;let a=new $m({...r,autoClose:!1}),i=me(n),s=(g=i.runId)!=null?g:We();i.runId=s;let o=i.callbacks;if(o===void 0)i.callbacks=[a];else if(Array.isArray(o))i.callbacks=o.concat(a);else{let _=o.copy();_.addHandler(a,!0),i.callbacks=_}let u=new AbortController,l=this;async function c(){try{let _;n!=null&&n.signal?"any"in AbortSignal?_=AbortSignal.any([u.signal,n.signal]):(_=n.signal,n.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):_=u.signal;let m=await l.stream(e,{...i,signal:_}),h=a.tapOutputIterable(s,m);for await(let y of h)if(u.signal.aborted)break}finally{await a.finish()}}let f=c(),d=!1,p;try{for await(let _ of a){if(!d){_.data.input=e,d=!0,p=_.run_id,yield _;continue}_.run_id===p&&_.event.endsWith("_end")&&(b=_.data)!=null&&b.input&&delete _.data.input,yield _}}finally{u.abort(),await f}}async*_streamEventsV1(e,n,r){var g,b,_;let a,i=!1,s=me(n),o=(g=s.tags)!=null?g:[],u=(b=s.metadata)!=null?b:{},l=(_=s.runName)!=null?_:this.getName(),c=new ld({...r,autoClose:!1,_schemaFormat:"streaming_events"}),f=new Um({...r}),d=this._streamLog(e,c,s);for await(let m of d){if(a?a=a.concat(m):a=ud.fromRunLogPatch(m),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let S={...a.state},A={run_id:S.id,event:`on_${S.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};f.includeEvent(A,S.type)&&(yield A)}let h=m.ops.filter(S=>S.path.startsWith("/logs/")).map(S=>S.path.split("/")[2]),y=[...new Set(h)];for(let S of y){let A,T={},x=a.state.logs[S];if(x.end_time===void 0?x.streamed_output.length>0?A="stream":A="start":A="end",A==="start")x.inputs!==void 0&&(T.input=x.inputs);else if(A==="end")x.inputs!==void 0&&(T.input=x.inputs),T.output=x.final_output;else if(A==="stream"){let C=x.streamed_output.length;if(C!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${C} instead. Encountered in: "${x.name}"`);T={chunk:x.streamed_output[0]},x.streamed_output=[]}yield{event:`on_${x.type}_${A}`,name:x.name,run_id:x.id,tags:x.tags,metadata:x.metadata,data:T}}let{state:v}=a;if(v.streamed_output.length>0){let S=v.streamed_output.length;if(S!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${S} instead. Encountered in: "${v.name}"`);let A={chunk:v.streamed_output[0]};v.streamed_output=[];let T={event:`on_${v.type}_stream`,run_id:v.id,tags:o,metadata:u,name:l,data:A};f.includeEvent(T,v.type)&&(yield T)}}let p=a==null?void 0:a.state;if(p!==void 0){let m={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};f.includeEvent(m,p.type)&&(yield m)}}static isRunnable(e){return fd(e)}withListeners({onStart:e,onEnd:n,onError:r}){return new Ka({bound:this,config:{},configFactories:[a=>({callbacks:[new cd({config:a,onStart:e,onEnd:n,onError:r})]})]})}asTool(e){return t9(this,e)}},Ka=class t extends ke{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let n=Dm(this.config,...e);return Dm(n,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(n))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,n){return this.bound.invoke(e,await this._mergeConfig(me(n),this.kwargs))}async batch(e,n,r){let a=Array.isArray(n)?await Promise.all(n.map(async i=>this._mergeConfig(me(i),this.kwargs))):await this._mergeConfig(me(n),this.kwargs);return this.bound.batch(e,a,r)}async*_streamIterator(e,n){yield*this.bound._streamIterator(e,await this._mergeConfig(me(n),this.kwargs))}async stream(e,n){return this.bound.stream(e,await this._mergeConfig(me(n),this.kwargs))}async*transform(e,n){yield*this.bound.transform(e,await this._mergeConfig(me(n),this.kwargs))}streamEvents(e,n,r){let a=this,i=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(me(n),a.kwargs),version:n.version},r)};return Ft.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&ke.isRunnable(e.bound)}withListeners({onStart:e,onEnd:n,onError:r}){return new t({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new cd({config:a,onStart:e,onEnd:n,onError:r})]})]})}},Vm=class t extends ke{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new t({bound:this.bound.bind(e)})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _invoke(e,n,r){return this.bound.batch(e,ct(n,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:n,onError:r}){return new t({bound:this.bound.withListeners({onStart:e,onEnd:n,onError:r})})}},Gm=class extends Ka{static lc_name(){return"RunnableRetry"}constructor(e){var n,r;super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=(n=e.maxAttemptNumber)!=null?n:this.maxAttemptNumber,this.onFailedAttempt=(r=e.onFailedAttempt)!=null?r:this.onFailedAttempt}_patchConfigForRetry(e,n,r){let a=e>1?`retry:attempt:${e}`:void 0;return ct(n,{callbacks:r==null?void 0:r.getChild(a)})}async _invoke(e,n,r){return(0,Rv.default)(a=>super.invoke(e,this._patchConfigForRetry(a,n,r)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _batch(e,n,r,a){let i={};try{await(0,Rv.default)(async s=>{let o=e.map((d,p)=>p).filter(d=>i[d.toString()]===void 0||i[d.toString()]instanceof Error),u=o.map(d=>e[d]),l=o.map(d=>this._patchConfigForRetry(s,n==null?void 0:n[d],r==null?void 0:r[d])),c=await super.batch(u,l,{...a,returnExceptions:!0}),f;for(let d=0;d<c.length;d+=1){let p=c[d],g=o[d];p instanceof Error&&f===void 0&&(f=p,f.input=u[d]),i[g.toString()]=p}if(f)throw f;return c},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((a==null?void 0:a.returnExceptions)!==!0)throw s}return Object.keys(i).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>i[parseInt(s,10)])}async batch(e,n,r){return this._batchWithConfig(this._batch.bind(this),e,n,r)}},Ya=class t extends ke{static lc_name(){return"RunnableSequence"}constructor(e){var n,r;super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=(n=e.middle)!=null?n:this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=(r=e.omitSequenceTags)!=null?r:this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,n){var u;let r=me(n),a=await yn(r),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),gt(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s=e,o;try{let l=[this.first,...this.middle];for(let c=0;c<l.length;c+=1){let d=l[c].invoke(s,ct(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));s=await aa(d,n==null?void 0:n.signal)}if((u=n==null?void 0:n.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(s,ct(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(gt(o,"output"))),o}async batch(e,n,r){var u;let a=this._getOptionsList(n!=null?n:{},e.length),i=await Promise.all(a.map(yn)),s=await Promise.all(i.map(async(l,c)=>{let f=await(l==null?void 0:l.handleChainStart(this.toJSON(),gt(e[c],"input"),a[c].runId,void 0,void 0,void 0,a[c].runName));return delete a[c].runId,f})),o=e;try{for(let l=0;l<this.steps.length;l+=1){let f=this.steps[l].batch(o,s.map((d,p)=>{let g=d==null?void 0:d.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return ct(a[p],{callbacks:g})}),r);o=await aa(f,(u=a[0])==null?void 0:u.signal)}}catch(l){throw await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(l))),l}return await Promise.all(s.map(l=>l==null?void 0:l.handleChainEnd(gt(o,"output")))),o}async*_streamIterator(e,n){var f;let r=await yn(n),{runId:a,...i}=n!=null?n:{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),gt(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last],u=!0,l;async function*c(){yield e}try{let d=o[0].transform(c(),ct(i,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<o.length;p+=1)d=await o[p].transform(d,ct(i,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(let p of d)if((f=n==null?void 0:n.signal)==null||f.throwIfAborted(),yield p,u)if(l===void 0)l=p;else try{l=qt(l,p)}catch(g){l=void 0,u=!1}}catch(d){throw await(s==null?void 0:s.handleChainError(d)),d}await(s==null?void 0:s.handleChainEnd(gt(l,"output")))}getGraph(e){let n=new pd,r=null;return this.steps.forEach((a,i)=>{let s=a.getGraph(e);i!==0&&s.trimFirstNode(),i!==this.steps.length-1&&s.trimLastNode(),n.extend(s);let o=s.firstNode();if(!o)throw new Error(`Runnable ${a} has no first node`);r&&n.addEdge(r,o),r=s.lastNode()}),n}pipe(e){var n;return t.isRunnableSequence(e)?new t({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:(n=this.name)!=null?n:e.name}):new t({first:this.first,middle:[...this.middle,this.last],last:Za(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ke.isRunnable(e)}static from([e,...n],r){let a={};return typeof r=="string"?a.name=r:r!==void 0&&(a=r),new t({...a,first:Za(e),middle:n.slice(0,-1).map(Za),last:Za(n[n.length-1])})}},ss=class t extends ke{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[n,r]of Object.entries(e.steps))this.steps[n]=Za(r)}static from(e){return new t({steps:e})}async invoke(e,n){let r=me(n),a=await yn(r),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s={};try{let o=Object.entries(this.steps).map(async([u,l])=>{s[u]=await l.invoke(e,ct(r,{callbacks:i==null?void 0:i.getChild(`map:key:${u}`)}))});await aa(Promise.all(o),n==null?void 0:n.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(s)),s}async*_transform(e,n,r){let a={...this.steps},i=wv(e,Object.keys(a).length),s=new Map(Object.entries(a).map(([o,u],l)=>{let c=u.transform(i[l],ct(r,{callbacks:n==null?void 0:n.getChild(`map:key:${o}`)}));return[o,c.next().then(f=>({key:o,gen:c,result:f}))]}));for(;s.size;){let o=Promise.race(s.values()),{key:u,result:l,gen:c}=await aa(o,r==null?void 0:r.signal);s.delete(u),l.done||(yield{[u]:l.value},s.set(u,c.next().then(f=>({key:u,gen:c,result:f}))))}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}let a=me(n),i=new Ha({generator:this.transform(r(),a),config:a});return await i.setup,Ft.fromAsyncGenerator(i)}},Cv=class t extends ke{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Sm(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,n){let[r]=this._getOptionsList(n!=null?n:{},1),a=await yn(r),i=this.func(ct(r,{callbacks:a}),e);return aa(i,r==null?void 0:r.signal)}async*_streamIterator(e,n){var i,s;let[r]=this._getOptionsList(n!=null?n:{},1),a=await this.invoke(e,n);if(qm(a)){for await(let o of a)(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield o;return}if(hI(a)){for(;;){(s=r==null?void 0:r.signal)==null||s.throwIfAborted();let o=a.next();if(o.done)break;yield o.value}return}yield a}static from(e){return new t({func:e})}};function e9(t){if(Sm(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var Tr=class t extends ke{static lc_name(){return"RunnableLambda"}constructor(e){if(Sm(e.func))return Cv.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e9(e.func),this.func=e.func}static from(e){return new t({func:e})}async _invoke(e,n,r){return new Promise((a,i)=>{var o;let s=ct(n,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((o=n==null?void 0:n.recursionLimit)!=null?o:km)-1});gn.runWithConfig(vr(s),async()=>{var u,l,c;try{let f=await this.func(e,{...s});if(f&&ke.isRunnable(f)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");f=await f.invoke(e,{...s,recursionLimit:((u=s.recursionLimit)!=null?u:km)-1})}else if(qm(f)){let d;for await(let p of Hm(s,f))if((l=n==null?void 0:n.signal)==null||l.throwIfAborted(),d===void 0)d=p;else try{d=qt(d,p)}catch(g){d=p}f=d}else if(Ev(f)){let d;for(let p of Ov(s,f))if((c=n==null?void 0:n.signal)==null||c.throwIfAborted(),d===void 0)d=p;else try{d=qt(d,p)}catch(g){d=p}f=d}a(f)}catch(f){i(f)}})})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async*_transform(e,n,r){var o,u,l;let a;for await(let c of e)if(a===void 0)a=c;else try{a=qt(a,c)}catch(f){a=c}let i=ct(r,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((o=r==null?void 0:r.recursionLimit)!=null?o:km)-1}),s=await new Promise((c,f)=>{gn.runWithConfig(vr(i),async()=>{try{let d=await this.func(a,{...i,config:i});c(d)}catch(d){f(d)}})});if(s&&ke.isRunnable(s)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");let c=await s.stream(a,i);for await(let f of c)yield f}else if(qm(s))for await(let c of Hm(i,s))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield c;else if(Ev(s))for(let c of Ov(i,s))(l=r==null?void 0:r.signal)==null||l.throwIfAborted(),yield c;else yield s}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}let a=me(n),i=new Ha({generator:this.transform(r(),a),config:a});return await i.setup,Ft.fromAsyncGenerator(i)}};var Zm=class extends ke{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,n){let r=me(n),a=await yn(r),{runId:i,...s}=r,o=await(a==null?void 0:a.handleChainStart(this.toJSON(),gt(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName)),u=ct(s,{callbacks:o==null?void 0:o.getChild()});return await gn.runWithConfig(u,async()=>{var f;let c;for(let d of this.runnables()){(f=r==null?void 0:r.signal)==null||f.throwIfAborted();try{let p=await d.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(gt(p,"output"))),p}catch(p){c===void 0&&(c=p)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,n){var f;let r=me(n),a=await yn(r),{runId:i,...s}=r,o=await(a==null?void 0:a.handleChainStart(this.toJSON(),gt(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName)),u,l;for(let d of this.runnables()){(f=r==null?void 0:r.signal)==null||f.throwIfAborted();let p=ct(s,{callbacks:o==null?void 0:o.getChild()});try{let g=await d.stream(e,p);l=Hm(p,g);break}catch(g){u===void 0&&(u=g)}}if(l===void 0){let d=u!=null?u:new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(d)),d}let c;try{for await(let d of l){yield d;try{c=c===void 0?c:qt(c,d)}catch(p){c=void 0}}}catch(d){throw await(o==null?void 0:o.handleChainError(d)),d}await(o==null?void 0:o.handleChainEnd(gt(c,"output")))}async batch(e,n,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");let a=this._getOptionsList(n!=null?n:{},e.length),i=await Promise.all(a.map(l=>yn(l))),s=await Promise.all(i.map(async(l,c)=>{let f=await(l==null?void 0:l.handleChainStart(this.toJSON(),gt(e[c],"input"),a[c].runId,void 0,void 0,void 0,a[c].runName));return delete a[c].runId,f})),o;for(let l of this.runnables()){(u=a[0].signal)==null||u.throwIfAborted();try{let c=await l.batch(e,s.map((f,d)=>ct(a[d],{callbacks:f==null?void 0:f.getChild()})),r);return await Promise.all(s.map((f,d)=>f==null?void 0:f.handleChainEnd(gt(c[d],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(s.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function Za(t){if(typeof t=="function")return new Tr({func:t});if(ke.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){let e={};for(let[n,r]of Object.entries(t))e[n]=Za(r);return new ss({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var Jl=class extends ke{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof ss&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,n){let r=await this.mapper.invoke(e,n);return{...e,...r}}async*_transform(e,n,r){let a=this.mapper.getStepsKeys(),[i,s]=wv(e),o=this.mapper.transform(s,ct(r,{callbacks:n==null?void 0:n.getChild()})),u=o.next();for await(let l of i){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);let c=Object.fromEntries(Object.entries(l).filter(([f])=>!a.includes(f)));Object.keys(c).length>0&&(yield c)}yield(await u).value;for await(let l of o)yield l}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}let a=me(n),i=new Ha({generator:this.transform(r(),a),config:a});return await i.setup,Ft.fromAsyncGenerator(i)}},Km=class extends ke{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let n=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return n.length===0?void 0:Object.fromEntries(n)}}async invoke(e,n){return this._callWithConfig(this._pick.bind(this),e,n)}async*_transform(e){for await(let n of e){let r=await this._pick(n);r!==void 0&&(yield r)}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}let a=me(n),i=new Ha({generator:this.transform(r(),a),config:a});return await i.setup,Ft.fromAsyncGenerator(i)}},hd=class extends Ka{constructor(e){var r;let n=Ya.from([Tr.from(async a=>{let i;if(Dl(a))try{i=await this.schema.parseAsync(a.args)}catch(s){throw new lo("Received tool input did not match expected schema",JSON.stringify(a.args))}else i=a;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:n,config:(r=e.config)!=null?r:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function t9(t,e){var a,i,s;let n=(a=e.name)!=null?a:t.getName(),r=(s=e.description)!=null?s:(i=e.schema)==null?void 0:i.description;return e.schema.constructor===at.ZodString?new hd({name:n,description:r,schema:at.object({input:at.string()}).transform(o=>o.input),bound:t}):new hd({name:n,description:r,schema:e.schema,bound:t})}var n9=typeof window=="object"?window:{},ce="0123456789abcdef".split(""),r9=[-2147483648,8388608,32768,128],Er=[24,16,8,0];var xt=[];function Or(t){t?(xt[0]=xt[16]=xt[1]=xt[2]=xt[3]=xt[4]=xt[5]=xt[6]=xt[7]=xt[8]=xt[9]=xt[10]=xt[11]=xt[12]=xt[13]=xt[14]=xt[15]=0,this.blocks=xt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Or.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===n9.ArrayBuffer&&(t=new Uint8Array(t));for(var n,r=0,a,i=t.length||0,s=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(a=this.start;r<i&&a<64;++r)s[a>>2]|=t[r]<<Er[a++&3];else for(a=this.start;r<i&&a<64;++r)n=t.charCodeAt(r),n<128?s[a>>2]|=n<<Er[a++&3]:n<2048?(s[a>>2]|=(192|n>>6)<<Er[a++&3],s[a>>2]|=(128|n&63)<<Er[a++&3]):n<55296||n>=57344?(s[a>>2]|=(224|n>>12)<<Er[a++&3],s[a>>2]|=(128|n>>6&63)<<Er[a++&3],s[a>>2]|=(128|n&63)<<Er[a++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++r)&1023),s[a>>2]|=(240|n>>18)<<Er[a++&3],s[a>>2]|=(128|n>>12&63)<<Er[a++&3],s[a>>2]|=(128|n>>6&63)<<Er[a++&3],s[a>>2]|=(128|n&63)<<Er[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=s[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Or.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=r9[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};Or.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,r=this.h3,a=this.h4,i,s,o,u=this.blocks;for(s=16;s<80;++s)o=u[s-3]^u[s-8]^u[s-14]^u[s-16],u[s]=o<<1|o>>>31;for(s=0;s<20;s+=5)i=e&n|~e&r,o=t<<5|t>>>27,a=o+i+a+1518500249+u[s]<<0,e=e<<30|e>>>2,i=t&e|~t&n,o=a<<5|a>>>27,r=o+i+r+1518500249+u[s+1]<<0,t=t<<30|t>>>2,i=a&t|~a&e,o=r<<5|r>>>27,n=o+i+n+1518500249+u[s+2]<<0,a=a<<30|a>>>2,i=r&a|~r&t,o=n<<5|n>>>27,e=o+i+e+1518500249+u[s+3]<<0,r=r<<30|r>>>2,i=n&r|~n&a,o=e<<5|e>>>27,t=o+i+t+1518500249+u[s+4]<<0,n=n<<30|n>>>2;for(;s<40;s+=5)i=e^n^r,o=t<<5|t>>>27,a=o+i+a+1859775393+u[s]<<0,e=e<<30|e>>>2,i=t^e^n,o=a<<5|a>>>27,r=o+i+r+1859775393+u[s+1]<<0,t=t<<30|t>>>2,i=a^t^e,o=r<<5|r>>>27,n=o+i+n+1859775393+u[s+2]<<0,a=a<<30|a>>>2,i=r^a^t,o=n<<5|n>>>27,e=o+i+e+1859775393+u[s+3]<<0,r=r<<30|r>>>2,i=n^r^a,o=e<<5|e>>>27,t=o+i+t+1859775393+u[s+4]<<0,n=n<<30|n>>>2;for(;s<60;s+=5)i=e&n|e&r|n&r,o=t<<5|t>>>27,a=o+i+a-1894007588+u[s]<<0,e=e<<30|e>>>2,i=t&e|t&n|e&n,o=a<<5|a>>>27,r=o+i+r-1894007588+u[s+1]<<0,t=t<<30|t>>>2,i=a&t|a&e|t&e,o=r<<5|r>>>27,n=o+i+n-1894007588+u[s+2]<<0,a=a<<30|a>>>2,i=r&a|r&t|a&t,o=n<<5|n>>>27,e=o+i+e-1894007588+u[s+3]<<0,r=r<<30|r>>>2,i=n&r|n&a|r&a,o=e<<5|e>>>27,t=o+i+t-1894007588+u[s+4]<<0,n=n<<30|n>>>2;for(;s<80;s+=5)i=e^n^r,o=t<<5|t>>>27,a=o+i+a-899497514+u[s]<<0,e=e<<30|e>>>2,i=t^e^n,o=a<<5|a>>>27,r=o+i+r-899497514+u[s+1]<<0,t=t<<30|t>>>2,i=a^t^e,o=r<<5|r>>>27,n=o+i+n-899497514+u[s+2]<<0,a=a<<30|a>>>2,i=r^a^t,o=n<<5|n>>>27,e=o+i+e-899497514+u[s+3]<<0,r=r<<30|r>>>2,i=n^r^a,o=e<<5|e>>>27,t=o+i+t-899497514+u[s+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+a<<0};Or.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,a=this.h4;return ce[t>>28&15]+ce[t>>24&15]+ce[t>>20&15]+ce[t>>16&15]+ce[t>>12&15]+ce[t>>8&15]+ce[t>>4&15]+ce[t&15]+ce[e>>28&15]+ce[e>>24&15]+ce[e>>20&15]+ce[e>>16&15]+ce[e>>12&15]+ce[e>>8&15]+ce[e>>4&15]+ce[e&15]+ce[n>>28&15]+ce[n>>24&15]+ce[n>>20&15]+ce[n>>16&15]+ce[n>>12&15]+ce[n>>8&15]+ce[n>>4&15]+ce[n&15]+ce[r>>28&15]+ce[r>>24&15]+ce[r>>20&15]+ce[r>>16&15]+ce[r>>12&15]+ce[r>>8&15]+ce[r>>4&15]+ce[r&15]+ce[a>>28&15]+ce[a>>24&15]+ce[a>>20&15]+ce[a>>16&15]+ce[a>>12&15]+ce[a>>8&15]+ce[a>>4&15]+ce[a&15]};Or.prototype.toString=Or.prototype.hex;Or.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,a=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24&255,r>>16&255,r>>8&255,r&255,a>>24&255,a>>16&255,a>>8&255,a&255]};Or.prototype.array=Or.prototype.digest;Or.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};var Iv=t=>new Or(!0).update(t).hex();var mI=(...t)=>Iv(t.join("_"));var Pv=class{},a9=new Map,Ym=class t extends Pv{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e!=null?e:new Map}lookup(e,n){var r;return Promise.resolve((r=this.cache.get(mI(e,n)))!=null?r:null)}async update(e,n,r){this.cache.set(mI(e,n),r)}static global(){return new t(a9)}};var Jm=class extends yr{},Xm=class extends Jm{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new _r(this.value)]}},Qm=class extends Jm{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Ff(this.messages)}toChatMessages(){return this.messages}};var _I=Z(bI(),1);var d9=Object.defineProperty,p9=(t,e,n)=>e in t?d9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,h9=(t,e,n)=>(p9(t,typeof e!="symbol"?e+"":e,n),n);function m9(t,e){let n=Array.from({length:t.length},(r,a)=>({start:a,end:a+1}));for(;n.length>1;){let r=null;for(let a=0;a<n.length-1;a++){let i=t.slice(n[a].start,n[a+1].end),s=e.get(i.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,a])}if(r!=null){let a=r[1];n[a]={start:n[a].start,end:n[a+1].end},n.splice(a+1,1)}else break}return n}function g9(t,e){return t.length===1?[e.get(t.join(","))]:m9(t,e).map(n=>e.get(t.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function y9(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var kv=class{constructor(t,e){Ue(this,"specialTokens");Ue(this,"inverseSpecialTokens");Ue(this,"patStr");Ue(this,"textEncoder",new TextEncoder);Ue(this,"textDecoder",new TextDecoder("utf-8"));Ue(this,"rankMap",new Map);Ue(this,"textMap",new Map);this.patStr=t.pat_str;let n=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,a)=>{let[i,s,...o]=a.split(" "),u=Number.parseInt(s,10);return o.forEach((l,c)=>r[l]=u+c),r},{});for(let[r,a]of Object.entries(n)){let i=_I.default.toByteArray(r);this.rankMap.set(i.join(","),a),this.textMap.set(a,i)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[a,i])=>(r[i]=this.textEncoder.encode(a),r),{})}encode(t,e=[],n="all"){var l;let r=new RegExp(this.patStr,"ug"),a=kv.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(c=>!s.has(c)):n);if(o.size>0){let c=kv.specialTokenRegex([...o]),f=t.match(c);if(f!=null)throw new Error(`The text contains a special token that is not allowed: ${f[0]}`)}let u=0;for(;;){let c=null,f=u;for(;a.lastIndex=f,c=a.exec(t),!(c==null||s.has(c[0]));)f=c.index+1;let d=(l=c==null?void 0:c.index)!=null?l:t.length;for(let g of t.substring(u,d).matchAll(r)){let b=this.textEncoder.encode(g[0]),_=this.rankMap.get(b.join(","));if(_!=null){i.push(_);continue}i.push(...g9(b,this.rankMap))}if(c==null)break;let p=this.specialTokens[c[0]];i.push(p),u=c.index+c[0].length}return i}decode(t){var i;let e=[],n=0;for(let s=0;s<t.length;++s){let o=t[s],u=(i=this.textMap.get(o))!=null?i:this.inverseSpecialTokens[o];u!=null&&(e.push(u),n+=u.length)}let r=new Uint8Array(n),a=0;for(let s of e)r.set(s,a),a+=s.length;return this.textDecoder.decode(r)}},eg=kv;h9(eg,"specialTokenRegex",t=>new RegExp(t.map(e=>y9(e)).join("|"),"g"));function Dv(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw new Error("Unknown model")}}var tg={},b9=new Ga({});async function _9(t){return t in tg||(tg[t]=b9.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new eg(e)).catch(e=>{throw delete tg[t],e})),await tg[t]}async function wI(t){return _9(Dv(t))}var w9=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t;function jv(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}var v9=()=>!1,md=class extends ke{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){var n,r,a;super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=(n=e.verbose)!=null?n:v9(),this.callbacks=e.callbacks,this.tags=(r=e.tags)!=null?r:[],this.metadata=(a=e.metadata)!=null?a:{}}},gd=class extends md{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:n,...r}){let{cache:a,...i}=r;super({callbacks:e!=null?e:n,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof a=="object"?this.cache=a:a?this.cache=Ym.global():this.cache=void 0,this.caller=new Ga(r!=null?r:{})}async getNumTokens(e){if(typeof e!="string")return 0;let n=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await wI("modelName"in this?w9(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new Xm(e):Array.isArray(e)?new Qm(e.map(co)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...n}){let r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([s,o])=>o!==void 0).map(([s,o])=>`${s}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};var oa=class extends ke{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,n){let r=me(n);return this.func&&await this.func(e,r),this._callWithConfig(a=>Promise.resolve(a),e,r)}async*transform(e,n){let r=me(n),a,i=!0;for await(let s of this._transformStreamWithConfig(e,o=>o,r))if(yield s,i)if(a===void 0)a=s;else try{a=qt(a,s)}catch(o){a=void 0,i=!1}this.func&&a!==void 0&&await this.func(a,r)}static assign(e){return new Jl(new ss({steps:e}))}};function Ja(t){var r,a;if(!t||typeof t!="object"||Array.isArray(t))return!1;let e=t;return e._def||Object.values(at.ZodFirstPartyTypeKind).includes((a=(r=e.constructor)==null?void 0:r.name)!=null?a:"NOT_INCLUDED")?!0:typeof e.parse=="function"&&typeof e.parseAsync=="function"&&typeof e.safeParse=="function"&&typeof e.safeParseAsync=="function"}function Mv(t){let e=[];for(let n of t){let r=n;if(Array.isArray(n.content))for(let a=0;a<n.content.length;a++){let i=n.content[a];(_O(i)||wO(i))&&r===n&&(r=new n.constructor({...r,content:[...n.content.slice(0,a),vO(i),...n.content.slice(a+1)]}))}e.push(r)}return e}var ng=class t extends gd{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){let[n,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=n.signal,[n,r]}async invoke(e,n){let r=t._convertInputToPromptValue(e);return(await this.generatePrompt([r],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,n,r){throw new Error("Not implemented.")}async*_streamIterator(e,n){var r;if(this._streamResponseChunks===t.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,n);else{let i=t._convertInputToPromptValue(e).toChatMessages(),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(n),u={...s.metadata,...this.getLsParams(o)},l=await Pt.configure(s.callbacks,this.callbacks,s.tags,this.tags,u,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},f=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),[Mv(i)],s.runId,void 0,c,void 0,void 0,s.runName)),d,p;try{for await(let g of this._streamResponseChunks(i,o,f==null?void 0:f[0])){if(g.message.id==null){let b=(r=f==null?void 0:f.at(0))==null?void 0:r.runId;b!=null&&g.message._updateId(`run-${b}`)}g.message.response_metadata={...g.generationInfo,...g.message.response_metadata},yield g.message,d?d=d.concat(g):d=g,hw(g.message)&&g.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}}catch(g){throw await Promise.all((f!=null?f:[]).map(b=>b==null?void 0:b.handleLLMError(g))),g}await Promise.all((f!=null?f:[]).map(g=>g==null?void 0:g.handleLLMEnd({generations:[[d]],llmOutput:p})))}}getLsParams(e){let n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:n}}async _generateUncached(e,n,r,a){var f,d;let i=e.map(p=>p.map(co)),s;if(a!==void 0&&a.length===i.length)s=a;else{let p={...r.metadata,...this.getLsParams(n)},g=await Pt.configure(r.callbacks,this.callbacks,r.tags,this.tags,p,this.metadata,{verbose:this.verbose}),b={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1};s=await(g==null?void 0:g.handleChatModelStart(this.toJSON(),i.map(Mv),r.runId,void 0,b,void 0,void 0,r.runName))}let o=[],u=[];if(!!(s!=null&&s[0].handlers.find(cv))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==t.prototype._streamResponseChunks)try{let p=await this._streamResponseChunks(i[0],n,s==null?void 0:s[0]),g,b;for await(let _ of p){if(_.message.id==null){let m=(f=s==null?void 0:s.at(0))==null?void 0:f.runId;m!=null&&_.message._updateId(`run-${m}`)}g===void 0?g=_:g=qt(g,_),hw(_.message)&&_.message.usage_metadata!==void 0&&(b={tokenUsage:{promptTokens:_.message.usage_metadata.input_tokens,completionTokens:_.message.usage_metadata.output_tokens,totalTokens:_.message.usage_metadata.total_tokens}})}if(g===void 0)throw new Error("Received empty response from chat model call.");o.push([g]),await(s==null?void 0:s[0].handleLLMEnd({generations:o,llmOutput:b}))}catch(p){throw await(s==null?void 0:s[0].handleLLMError(p)),p}else{let p=await Promise.allSettled(i.map((g,b)=>this._generate(g,{...n,promptIndex:b},s==null?void 0:s[b])));await Promise.all(p.map(async(g,b)=>{var _,m,h;if(g.status==="fulfilled"){let y=g.value;for(let v of y.generations){if(v.message.id==null){let S=(_=s==null?void 0:s.at(0))==null?void 0:_.runId;S!=null&&v.message._updateId(`run-${S}`)}v.message.response_metadata={...v.generationInfo,...v.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),o[b]=y.generations,u[b]=y.llmOutput,(m=s==null?void 0:s[b])==null?void 0:m.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((h=s==null?void 0:s[b])==null?void 0:h.handleLLMError(g.reason)),Promise.reject(g.reason)}))}let c={generations:o,llmOutput:u.length?(d=this._combineLLMOutput)==null?void 0:d.call(this,...u):void 0};return Object.defineProperty(c,jm,{value:s?{runIds:s==null?void 0:s.map(p=>p.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:n,llmStringKey:r,parsedOptions:a,handledOptions:i}){let s=e.map(_=>_.map(co)),o={...i.metadata,...this.getLsParams(a)},u=await Pt.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},c=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),s.map(Mv),i.runId,void 0,l,void 0,void 0,i.runName)),f=[],p=(await Promise.allSettled(s.map(async(_,m)=>{let h=t._convertInputToPromptValue(_).toString(),y=await n.lookup(h,r);return y==null&&f.push(m),y}))).map((_,m)=>({result:_,runManager:c==null?void 0:c[m]})).filter(({result:_})=>_.status==="fulfilled"&&_.value!=null||_.status==="rejected"),g=[];await Promise.all(p.map(async({result:_,runManager:m},h)=>{if(_.status==="fulfilled"){let y=_.value;return g[h]=y.map(v=>("message"in v&&Ji(v.message)&&br(v.message)&&(v.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),v.generationInfo={...v.generationInfo,tokenUsage:{}},v)),y.length&&await(m==null?void 0:m.handleLLMNewToken(y[0].text)),m==null?void 0:m.handleLLMEnd({generations:[y]},void 0,void 0,void 0,{cached:!0})}else return await(m==null?void 0:m.handleLLMError(_.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(_.reason)}));let b={generations:g,missingPromptIndices:f,startedRunManagers:c};return Object.defineProperty(b,jm,{value:c?{runIds:c==null?void 0:c.map(_=>_.runId)}:void 0,configurable:!0}),b}async generate(e,n,r){var g,b;let a;Array.isArray(n)?a={stop:n}:a=n;let i=e.map(_=>_.map(co)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(a);if(s.callbacks=(g=s.callbacks)!=null?g:r,!this.cache)return this._generateUncached(i,o,s);let{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:f,startedRunManagers:d}=await this._generateCached({messages:i,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:s}),p={};if(f.length>0){let _=await this._generateUncached(f.map(m=>i[m]),o,s,d!==void 0?f.map(m=>d==null?void 0:d[m]):void 0);await Promise.all(_.generations.map(async(m,h)=>{let y=f[h];c[y]=m;let v=t._convertInputToPromptValue(i[y]).toString();return u.update(v,l,m)})),p=(b=_.llmOutput)!=null?b:{}}return{generations:c,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,n,r){let a=e.map(i=>i.toChatMessages());return this.generate(a,n,r)}async call(e,n,r){return(await this.generate([e.map(co)],n,r)).generations[0][0].message}async callPrompt(e,n,r){let a=e.toChatMessages();return this.call(a,n,r)}async predictMessages(e,n,r){return this.call(e,n,r)}async predict(e,n,r){let a=new _r(e),i=await this.call([a],n,r);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,n){var b;if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n!=null&&n.strict)throw new Error('"strict" mode is not supported for this model by default.');let r=e,a=n==null?void 0:n.name,i=(b=r.description)!=null?b:"A function available to call.",s=n==null?void 0:n.method,o=n==null?void 0:n.includeRaw;if(s==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=a!=null?a:"extract",l;Ja(r)?l=[{type:"function",function:{name:u,description:i,parameters:ir(r)}}]:("name"in r&&(u=r.name),l=[{type:"function",function:{name:u,description:i,parameters:r}}]);let c=this.bindTools(l),f=Tr.from(_=>{if(!_.tool_calls||_.tool_calls.length===0)throw new Error("No tool calls found in the response.");let m=_.tool_calls.find(h=>h.name===u);if(!m)throw new Error(`No tool call found with name ${u}.`);return m.args});if(!o)return c.pipe(f).withConfig({runName:"StructuredOutput"});let d=oa.assign({parsed:(_,m)=>f.invoke(_.raw,m)}),p=oa.assign({parsed:()=>null}),g=d.withFallbacks({fallbacks:[p]});return Ya.from([{raw:c},g]).withConfig({runName:"StructuredOutputRunnable"})}};var $v=class extends ke{parseResultWithPrompt(e,n,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,n){return typeof e=="string"?this._callWithConfig(async(r,a)=>this.parseResult([{text:r}],a==null?void 0:a.callbacks),e,{...n,runType:"parser"}):this._callWithConfig(async(r,a)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],a==null?void 0:a.callbacks),e,{...n,runType:"parser"})}},Xl=class extends $v{parseResult(e,n){return this.parse(e[0].text,n)}async parseWithPrompt(e,n,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}},os=class extends Error{constructor(e,n,r,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=n,this.observation=r,this.sendToLLM=a,a&&(r===void 0||n===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Lh(this,"OUTPUT_PARSING_FAILURE")}};function Xa(t,e){let n=typeof t;if(n!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;let r=t.length;if(r!==e.length)return!1;for(let a=0;a<r;a++)if(!Xa(t[a],e[a]))return!1;return!0}if(n==="object"){if(!t||!e)return t===e;let r=Object.keys(t),a=Object.keys(e);if(r.length!==a.length)return!1;for(let s of r)if(!Xa(t[s],e[s]))return!1;return!0}return t===e}function $n(t){return encodeURI(S9(t))}function S9(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}var x9={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},A9={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},T9={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},E9=typeof self!="undefined"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function us(t,e=Object.create(null),n=E9,r=""){if(t&&typeof t=="object"&&!Array.isArray(t)){let i=t.$id||t.id;if(i){let s=new URL(i,n.href);s.hash.length>1?e[s.href]=t:(s.hash="",r===""?n=s:us(t,e,n))}}else if(t!==!0&&t!==!1)return e;let a=n.href+(r?"#"+r:"");if(e[a]!==void 0)throw new Error(`Duplicate schema URI "${a}".`);if(e[a]=t,t===!0||t===!1)return e;if(t.__absolute_uri__===void 0&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:a}),t.$ref&&t.__absolute_ref__===void 0){let i=new URL(t.$ref,n.href);i.hash=i.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:i.href})}if(t.$recursiveRef&&t.__absolute_recursive_ref__===void 0){let i=new URL(t.$recursiveRef,n.href);i.hash=i.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(t.$anchor){let i=new URL("#"+t.$anchor,n.href);e[i.href]=t}for(let i in t){if(T9[i])continue;let s=`${r}/${$n(i)}`,o=t[i];if(Array.isArray(o)){if(x9[i]){let u=o.length;for(let l=0;l<u;l++)us(o[l],e,n,`${s}/${l}`)}}else if(A9[i])for(let u in o)us(o[u],e,n,`${s}/${$n(u)}`);else us(o,e,n,s)}return e}var O9=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,R9=[0,31,28,31,30,31,30,31,31,30,31,30,31],C9=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,I9=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,P9=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,N9=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,k9=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,D9=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,j9=/^(?:\/(?:[^~/]|~0|~1)*)*$/,M9=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,$9=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,L9=t=>{if(t[0]==='"')return!1;let[e,n,...r]=t.split("@");return!e||!n||r.length!==0||e.length>64||n.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(n)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:n.split(".").every(a=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(a))},U9=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,z9=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,B9=t=>t.length>1&&t.length<80&&(/^P\d+([.,]\d+)?W$/.test(t)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(t)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(t));function ua(t){return t.test.bind(t)}var Lv={date:vI,time:SI.bind(void 0,!1),"date-time":H9,duration:B9,uri:Z9,"uri-reference":ua(P9),"uri-template":ua(N9),url:ua(k9),email:L9,hostname:ua(I9),ipv4:ua(U9),ipv6:ua(z9),regex:Y9,uuid:ua(D9),"json-pointer":ua(j9),"json-pointer-uri-fragment":ua(M9),"relative-json-pointer":ua($9)};function F9(t){return t%4===0&&(t%100!==0||t%400===0)}function vI(t){let e=t.match(O9);if(!e)return!1;let n=+e[1],r=+e[2],a=+e[3];return r>=1&&r<=12&&a>=1&&a<=(r==2&&F9(n)?29:R9[r])}function SI(t,e){let n=e.match(C9);if(!n)return!1;let r=+n[1],a=+n[2],i=+n[3],s=!!n[5];return(r<=23&&a<=59&&i<=59||r==23&&a==59&&i==60)&&(!t||s)}var q9=/t|\s/i;function H9(t){let e=t.split(q9);return e.length==2&&vI(e[0])&&SI(!0,e[1])}var V9=/\/|:/,G9=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Z9(t){return V9.test(t)&&G9.test(t)}var K9=/[^\\]\\Z/;function Y9(t){if(K9.test(t))return!1;try{return new RegExp(t,"u"),!0}catch(e){return!1}}var xI;(function(t){t[t.Flag=1]="Flag",t[t.Basic=2]="Basic",t[t.Detailed=4]="Detailed"})(xI||(xI={}));function AI(t){let e=0,n=t.length,r=0,a;for(;r<n;)e++,a=t.charCodeAt(r++),a>=55296&&a<=56319&&r<n&&(a=t.charCodeAt(r),(a&64512)==56320&&r++);return e}function Le(t,e,n="2019-09",r=us(e),a=!0,i=null,s="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};let l=typeof t,c;switch(l){case"boolean":case"number":case"string":c=l;break;case"object":t===null?c="null":Array.isArray(t)?c="array":c="object";break;default:throw new Error(`Instances of "${l}" type are not supported.`)}let{$ref:f,$recursiveRef:d,$recursiveAnchor:p,type:g,const:b,enum:_,required:m,not:h,anyOf:y,allOf:v,oneOf:S,if:A,then:T,else:x,format:C,properties:R,patternProperties:B,additionalProperties:te,unevaluatedProperties:je,minProperties:Ge,maxProperties:st,propertyNames:fs,dependentRequired:Tt,dependentSchemas:Zo,dependencies:Ko,prefixItems:Yo,items:ni,additionalItems:cc,unevaluatedItems:fc,contains:dc,minContains:zn,maxContains:ds,minItems:Jo,maxItems:Xo,uniqueItems:kd,minimum:Pr,maximum:Nr,exclusiveMinimum:ri,exclusiveMaximum:ai,multipleOf:ps,minLength:hs,maxLength:ms,pattern:pc,__absolute_ref__:gs,__absolute_recursive_ref__:Dd}=e,D=[];if(p===!0&&i===null&&(i=e),d==="#"){let G=i===null?r[Dd]:i,q=`${o}/$recursiveRef`,Q=Le(t,i===null?e:i,n,r,a,G,s,q,u);Q.valid||D.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:q,error:"A subschema had errors."},...Q.errors)}if(f!==void 0){let q=r[gs||f];if(q===void 0){let j=`Unresolved $ref "${f}".`;throw gs&&gs!==f&&(j+=`  Absolute URI "${gs}".`),j+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(j)}let Q=`${o}/$ref`,U=Le(t,q,n,r,a,i,s,Q,u);if(U.valid||D.push({instanceLocation:s,keyword:"$ref",keywordLocation:Q,error:"A subschema had errors."},...U.errors),n==="4"||n==="7")return{valid:D.length===0,errors:D}}if(Array.isArray(g)){let G=g.length,q=!1;for(let Q=0;Q<G;Q++)if(c===g[Q]||g[Q]==="integer"&&c==="number"&&t%1===0&&t===t){q=!0;break}q||D.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${g.join('", "')}".`})}else g==="integer"?(c!=="number"||t%1||t!==t)&&D.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${g}".`}):g!==void 0&&c!==g&&D.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${g}".`});if(b!==void 0&&(c==="object"||c==="array"?Xa(t,b)||D.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`}):t!==b&&D.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`})),_!==void 0&&(c==="object"||c==="array"?_.some(G=>Xa(t,G))||D.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(_)}.`}):_.some(G=>t===G)||D.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(_)}.`})),h!==void 0){let G=`${o}/not`;Le(t,h,n,r,a,i,s,G).valid&&D.push({instanceLocation:s,keyword:"not",keywordLocation:G,error:'Instance matched "not" schema.'})}let ys=[];if(y!==void 0){let G=`${o}/anyOf`,q=D.length,Q=!1;for(let U=0;U<y.length;U++){let j=y[U],ne=Object.create(u),W=Le(t,j,n,r,a,p===!0?i:null,s,`${G}/${U}`,ne);D.push(...W.errors),Q=Q||W.valid,W.valid&&ys.push(ne)}Q?D.length=q:D.splice(q,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:G,error:"Instance does not match any subschemas."})}if(v!==void 0){let G=`${o}/allOf`,q=D.length,Q=!0;for(let U=0;U<v.length;U++){let j=v[U],ne=Object.create(u),W=Le(t,j,n,r,a,p===!0?i:null,s,`${G}/${U}`,ne);D.push(...W.errors),Q=Q&&W.valid,W.valid&&ys.push(ne)}Q?D.length=q:D.splice(q,0,{instanceLocation:s,keyword:"allOf",keywordLocation:G,error:"Instance does not match every subschema."})}if(S!==void 0){let G=`${o}/oneOf`,q=D.length,Q=S.filter((U,j)=>{let ne=Object.create(u),W=Le(t,U,n,r,a,p===!0?i:null,s,`${G}/${j}`,ne);return D.push(...W.errors),W.valid&&ys.push(ne),W.valid}).length;Q===1?D.length=q:D.splice(q,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:G,error:`Instance does not match exactly one subschema (${Q} matches).`})}if((c==="object"||c==="array")&&Object.assign(u,...ys),A!==void 0){let G=`${o}/if`;if(Le(t,A,n,r,a,i,s,G,u).valid){if(T!==void 0){let Q=Le(t,T,n,r,a,i,s,`${o}/then`,u);Q.valid||D.push({instanceLocation:s,keyword:"if",keywordLocation:G,error:'Instance does not match "then" schema.'},...Q.errors)}}else if(x!==void 0){let Q=Le(t,x,n,r,a,i,s,`${o}/else`,u);Q.valid||D.push({instanceLocation:s,keyword:"if",keywordLocation:G,error:'Instance does not match "else" schema.'},...Q.errors)}}if(c==="object"){if(m!==void 0)for(let U of m)U in t||D.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${U}".`});let G=Object.keys(t);if(Ge!==void 0&&G.length<Ge&&D.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${Ge} properties.`}),st!==void 0&&G.length>st&&D.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${st} properties.`}),fs!==void 0){let U=`${o}/propertyNames`;for(let j in t){let ne=`${s}/${$n(j)}`,W=Le(j,fs,n,r,a,i,ne,U);W.valid||D.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:U,error:`Property name "${j}" does not match schema.`},...W.errors)}}if(Tt!==void 0){let U=`${o}/dependantRequired`;for(let j in Tt)if(j in t){let ne=Tt[j];for(let W of ne)W in t||D.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:U,error:`Instance has "${j}" but does not have "${W}".`})}}if(Zo!==void 0)for(let U in Zo){let j=`${o}/dependentSchemas`;if(U in t){let ne=Le(t,Zo[U],n,r,a,i,s,`${j}/${$n(U)}`,u);ne.valid||D.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:j,error:`Instance has "${U}" but does not match dependant schema.`},...ne.errors)}}if(Ko!==void 0){let U=`${o}/dependencies`;for(let j in Ko)if(j in t){let ne=Ko[j];if(Array.isArray(ne))for(let W of ne)W in t||D.push({instanceLocation:s,keyword:"dependencies",keywordLocation:U,error:`Instance has "${j}" but does not have "${W}".`});else{let W=Le(t,ne,n,r,a,i,s,`${U}/${$n(j)}`);W.valid||D.push({instanceLocation:s,keyword:"dependencies",keywordLocation:U,error:`Instance has "${j}" but does not match dependant schema.`},...W.errors)}}}let q=Object.create(null),Q=!1;if(R!==void 0){let U=`${o}/properties`;for(let j in R){if(!(j in t))continue;let ne=`${s}/${$n(j)}`,W=Le(t[j],R[j],n,r,a,i,ne,`${U}/${$n(j)}`);if(W.valid)u[j]=q[j]=!0;else if(Q=a,D.push({instanceLocation:s,keyword:"properties",keywordLocation:U,error:`Property "${j}" does not match schema.`},...W.errors),Q)break}}if(!Q&&B!==void 0){let U=`${o}/patternProperties`;for(let j in B){let ne=new RegExp(j,"u"),W=B[j];for(let tn in t){if(!ne.test(tn))continue;let O0=`${s}/${$n(tn)}`,R0=Le(t[tn],W,n,r,a,i,O0,`${U}/${$n(j)}`);R0.valid?u[tn]=q[tn]=!0:(Q=a,D.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:U,error:`Property "${tn}" matches pattern "${j}" but does not match associated schema.`},...R0.errors))}}}if(!Q&&te!==void 0){let U=`${o}/additionalProperties`;for(let j in t){if(q[j])continue;let ne=`${s}/${$n(j)}`,W=Le(t[j],te,n,r,a,i,ne,U);W.valid?u[j]=!0:(Q=a,D.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:U,error:`Property "${j}" does not match additional properties schema.`},...W.errors))}}else if(!Q&&je!==void 0){let U=`${o}/unevaluatedProperties`;for(let j in t)if(!u[j]){let ne=`${s}/${$n(j)}`,W=Le(t[j],je,n,r,a,i,ne,U);W.valid?u[j]=!0:D.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:U,error:`Property "${j}" does not match unevaluated properties schema.`},...W.errors)}}}else if(c==="array"){Xo!==void 0&&t.length>Xo&&D.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${t.length} > ${Xo}).`}),Jo!==void 0&&t.length<Jo&&D.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${t.length} < ${Jo}).`});let G=t.length,q=0,Q=!1;if(Yo!==void 0){let U=`${o}/prefixItems`,j=Math.min(Yo.length,G);for(;q<j;q++){let ne=Le(t[q],Yo[q],n,r,a,i,`${s}/${q}`,`${U}/${q}`);if(u[q]=!0,!ne.valid&&(Q=a,D.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:U,error:"Items did not match schema."},...ne.errors),Q))break}}if(ni!==void 0){let U=`${o}/items`;if(Array.isArray(ni)){let j=Math.min(ni.length,G);for(;q<j;q++){let ne=Le(t[q],ni[q],n,r,a,i,`${s}/${q}`,`${U}/${q}`);if(u[q]=!0,!ne.valid&&(Q=a,D.push({instanceLocation:s,keyword:"items",keywordLocation:U,error:"Items did not match schema."},...ne.errors),Q))break}}else for(;q<G;q++){let j=Le(t[q],ni,n,r,a,i,`${s}/${q}`,U);if(u[q]=!0,!j.valid&&(Q=a,D.push({instanceLocation:s,keyword:"items",keywordLocation:U,error:"Items did not match schema."},...j.errors),Q))break}if(!Q&&cc!==void 0){let j=`${o}/additionalItems`;for(;q<G;q++){let ne=Le(t[q],cc,n,r,a,i,`${s}/${q}`,j);u[q]=!0,ne.valid||(Q=a,D.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:j,error:"Items did not match additional items schema."},...ne.errors))}}}if(dc!==void 0)if(G===0&&zn===void 0)D.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(zn!==void 0&&G<zn)D.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${G}) than minContains (${zn}).`});else{let U=`${o}/contains`,j=D.length,ne=0;for(let W=0;W<G;W++){let tn=Le(t[W],dc,n,r,a,i,`${s}/${W}`,U);tn.valid?(u[W]=!0,ne++):D.push(...tn.errors)}ne>=(zn||0)&&(D.length=j),zn===void 0&&ds===void 0&&ne===0?D.splice(j,0,{instanceLocation:s,keyword:"contains",keywordLocation:U,error:"Array does not contain item matching schema."}):zn!==void 0&&ne<zn?D.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${zn} items matching schema. Only ${ne} items were found.`}):ds!==void 0&&ne>ds&&D.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${ds} items matching schema. ${ne} items were found.`})}if(!Q&&fc!==void 0){let U=`${o}/unevaluatedItems`;for(q;q<G;q++){if(u[q])continue;let j=Le(t[q],fc,n,r,a,i,`${s}/${q}`,U);u[q]=!0,j.valid||D.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:U,error:"Items did not match unevaluated items schema."},...j.errors)}}if(kd)for(let U=0;U<G;U++){let j=t[U],ne=typeof j=="object"&&j!==null;for(let W=0;W<G;W++){if(U===W)continue;let tn=t[W];(j===tn||ne&&(typeof tn=="object"&&tn!==null)&&Xa(j,tn))&&(D.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${U} and ${W}.`}),U=Number.MAX_SAFE_INTEGER,W=Number.MAX_SAFE_INTEGER)}}}else if(c==="number"){if(n==="4"?(Pr!==void 0&&(ri===!0&&t<=Pr||t<Pr)&&D.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${ri?"or equal to ":""} ${Pr}.`}),Nr!==void 0&&(ai===!0&&t>=Nr||t>Nr)&&D.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${ai?"or equal to ":""} ${Nr}.`})):(Pr!==void 0&&t<Pr&&D.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${Pr}.`}),Nr!==void 0&&t>Nr&&D.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${Nr}.`}),ri!==void 0&&t<=ri&&D.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${t} is less than ${ri}.`}),ai!==void 0&&t>=ai&&D.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${t} is greater than or equal to ${ai}.`})),ps!==void 0){let G=t%ps;Math.abs(0-G)>=11920929e-14&&Math.abs(ps-G)>=11920929e-14&&D.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${t} is not a multiple of ${ps}.`})}}else if(c==="string"){let G=hs===void 0&&ms===void 0?0:AI(t);hs!==void 0&&G<hs&&D.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${G} < ${hs}).`}),ms!==void 0&&G>ms&&D.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${G} > ${ms}).`}),pc!==void 0&&!new RegExp(pc,"u").test(t)&&D.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),C!==void 0&&Lv[C]&&!Lv[C](t)&&D.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${C}".`})}return{valid:D.length===0,errors:D}}var Ql=class extends Xl{async*_transform(e){for await(let n of e)typeof n=="string"?yield this.parseResult([{text:n}]):yield this.parseResult([{message:n,text:this._baseMessageToString(n)}])}async*transform(e,n){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...n,runType:"parser"})}},Mo=class extends Ql{constructor(e){var n;super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(n=e==null?void 0:e.diff)!=null?n:this.diff}async*_transform(e){let n,r;for await(let a of e){if(typeof a!="string"&&typeof a.content!="string")throw new Error("Cannot handle non-string output.");let i;if(pw(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");i=new Va({message:a,text:a.content})}else if(Ji(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");i=new Va({message:gw(a),text:a.content})}else i=new ia({text:a});r===void 0?r=i:r=r.concat(i);let s=await this.parsePartialResult([r]);s!=null&&!Xa(s,n)&&(this.diff?yield this._diff(n,s):yield s,n=s)}}getFormatInstructions(){return""}};var yd=class extends Xl{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let n=at.object(Object.fromEntries(Object.entries(e).map(([r,a])=>[r,at.string().describe(a)])));return new this(n)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(ir(this.schema))}
\`\`\`
`}async parse(e){try{let r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(a,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(n){throw new os(`Failed to parse. Text: "${e}". Error: ${n}`,e)}}};var bd=class extends Mo{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,n){if(n)return e?Cm(e,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(e){return ow(e[0].text)}async parse(e){return ow(e,JSON.parse)}getFormatInstructions(){return""}};function rg(t,e){var a;if(t.function===void 0)return;let n;if(e!=null&&e.partial)try{n=Nl((a=t.function.arguments)!=null?a:"{}")}catch(i){return}else try{n=JSON.parse(t.function.arguments)}catch(i){throw new os([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${i.message}`].join(`
`))}let r={name:t.function.name,args:n,type:"tool_call"};return e!=null&&e.returnId&&(r.id=t.id),r}function TI(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function zv(t,e){var n,r;return{name:(n=t.function)==null?void 0:n.name,args:(r=t.function)==null?void 0:r.arguments,id:t.id,error:e,type:"invalid_tool_call"}}var Uv=class extends Mo{static lc_name(){return"JsonOutputToolsParser"}constructor(e){var n;super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(n=e==null?void 0:e.returnId)!=null?n:this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,n=!0){var s;let r=e[0].message,a;if(br(r)&&((s=r.tool_calls)!=null&&s.length)?a=r.tool_calls.map(o=>{let{id:u,...l}=o;return this.returnId?{id:u,...l}:l}):r.additional_kwargs.tool_calls!==void 0&&(a=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>rg(u,{returnId:this.returnId,partial:n}))),!a)return[];let i=[];for(let o of a)if(o!==void 0){let u={type:o.name,args:o.args,id:o.id};i.push(u)}return i}},_d=class extends Uv{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){var n;super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=(n=e.returnSingle)!=null?n:this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let n=await this.zodSchema.safeParseAsync(e);if(n.success)return n.data;throw new os(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let r=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName),a=r;if(r.length)return this.returnId||(a=r.map(i=>i.args)),this.returnSingle?a[0]:a}async parseResult(e){let r=(await super.parsePartialResult(e,!1)).filter(s=>s.type===this.keyName),a=r;return r.length?(this.returnId||(a=r.map(s=>s.args)),this.returnSingle?this._validateResult(a[0]):await Promise.all(a.map(s=>this._validateResult(s)))):void 0}};var OI=Symbol("Let zodToJsonSchema decide on which parser to use"),EI={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},RI=t=>typeof t=="string"?{...EI,basePath:["#"],definitions:{},name:t}:{...EI,basePath:["#"],definitions:{},...t};var wd=t=>"_def"in t?t._def:t;function CI(t){if(!t)return!0;for(let e in t)return!1;return!0}var II=t=>{let e=RI(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[wd(a),{def:wd(a),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function Bv(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function ye(t,e,n,r,a){t[e]=n,Bv(t,e,r,a)}function PI(){return{}}function NI(t,e){var r,a;let n={type:"array"};return((a=(r=t.type)==null?void 0:r._def)==null?void 0:a.typeName)!==E.ZodAny&&(n.items=K(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&ye(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&ye(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(ye(n,"minItems",t.exactLength.value,t.exactLength.message,e),ye(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function kI(t,e){let n={type:"integer",format:"int64"};if(!t.checks)return n;for(let r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?ye(n,"minimum",r.value,r.message,e):ye(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),ye(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ye(n,"maximum",r.value,r.message,e):ye(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),ye(n,"maximum",r.value,r.message,e));break;case"multipleOf":ye(n,"multipleOf",r.value,r.message,e);break}return n}function DI(){return{type:"boolean"}}function jI(t,e){return K(t.type._def,e)}var MI=(t,e)=>K(t.innerType._def,e);function Fv(t,e,n){let r=n!=null?n:e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,i)=>Fv(t,e,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return J9(t,e)}}var J9=(t,e)=>{let n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(let r of t.checks)switch(r.kind){case"min":ye(n,"minimum",r.value,r.message,e);break;case"max":ye(n,"maximum",r.value,r.message,e);break}return n};function $I(t,e){return{...K(t.innerType._def,e),default:t.defaultValue()}}function LI(t,e,n){return e.effectStrategy==="input"?K(t.schema._def,e,n):{}}function UI(t){return{type:"string",enum:[...t.values]}}var X9=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function zI(t,e){let n=[K(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),K(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,a=[];return n.forEach(i=>{if(X9(i))a.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;s=u}else r=void 0;a.push(s)}}),a.length?{allOf:a,...r}:void 0}function BI(t,e){let n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}var qv,$o={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(qv===void 0&&(qv=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),qv),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function ag(t,e){let n={type:"string"};function r(a){return e.patternStrategy==="escape"?Q9(a):a}if(t.checks)for(let a of t.checks)switch(a.kind){case"min":ye(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,e);break;case"max":ye(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Rr(n,"email",a.message,e);break;case"format:idn-email":Rr(n,"idn-email",a.message,e);break;case"pattern:zod":Cr(n,$o.email,a.message,e);break}break;case"url":Rr(n,"uri",a.message,e);break;case"uuid":Rr(n,"uuid",a.message,e);break;case"regex":Cr(n,a.regex,a.message,e);break;case"cuid":Cr(n,$o.cuid,a.message,e);break;case"cuid2":Cr(n,$o.cuid2,a.message,e);break;case"startsWith":Cr(n,RegExp(`^${r(a.value)}`),a.message,e);break;case"endsWith":Cr(n,RegExp(`${r(a.value)}$`),a.message,e);break;case"datetime":Rr(n,"date-time",a.message,e);break;case"date":Rr(n,"date",a.message,e);break;case"time":Rr(n,"time",a.message,e);break;case"duration":Rr(n,"duration",a.message,e);break;case"length":ye(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,e),ye(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,e);break;case"includes":{Cr(n,RegExp(r(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&Rr(n,"ipv4",a.message,e),a.version!=="v4"&&Rr(n,"ipv6",a.message,e);break}case"emoji":Cr(n,$o.emoji,a.message,e);break;case"ulid":{Cr(n,$o.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Rr(n,"binary",a.message,e);break}case"contentEncoding:base64":{ye(n,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{Cr(n,$o.base64,a.message,e);break}}break}case"nanoid":Cr(n,$o.nanoid,a.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return n}var Q9=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Rr=(t,e,n,r)=>{var a;t.format||(a=t.anyOf)!=null&&a.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):ye(t,"format",e,n,r)},Cr=(t,e,n,r)=>{var a;t.pattern||(a=t.allOf)!=null&&a.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:FI(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):ye(t,"pattern",FI(e,r),n,r)},FI=(t,e)=>{var l;let n=typeof t=="function"?t():t;if(!e.applyRegexFlags||!n.flags)return n.source;let r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},a=r.i?n.source.toLowerCase():n.source,i="",s=!1,o=!1,u=!1;for(let c=0;c<a.length;c++){if(s){i+=a[c],s=!1;continue}if(r.i){if(o){if(a[c].match(/[a-z]/)){u?(i+=a[c],i+=`${a[c-2]}-${a[c]}`.toUpperCase(),u=!1):a[c+1]==="-"&&((l=a[c+2])!=null&&l.match(/[a-z]/))?(i+=a[c],u=!0):i+=`${a[c]}${a[c].toUpperCase()}`;continue}}else if(a[c].match(/[a-z]/)){i+=`[${a[c]}${a[c].toUpperCase()}]`;continue}}if(r.m){if(a[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(a[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&a[c]==="."){i+=o?`${a[c]}\r
`:`[${a[c]}\r
]`;continue}i+=a[c],a[c]==="\\"?s=!0:o&&a[c]==="]"?o=!1:!o&&a[c]==="["&&(o=!0)}try{let c=new RegExp(i)}catch(c){return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i};function ig(t,e){var r,a,i,s,o;if(e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===E.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((u,l)=>{var c;return{...u,[l]:(c=K(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]}))!=null?c:{}}},{}),additionalProperties:!1};let n={type:"object",additionalProperties:(a=K(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?a:{}};if(e.target==="openApi3")return n;if(((i=t.keyType)==null?void 0:i._def.typeName)===E.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let u=Object.entries(ag(t.keyType._def,e)).reduce((l,[c,f])=>c==="type"?l:{...l,[c]:f},{});return{...n,propertyNames:u}}else if(((o=t.keyType)==null?void 0:o._def.typeName)===E.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};return n}function qI(t,e){if(e.mapStrategy==="record")return ig(t,e);let n=K(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=K(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function HI(t){let e=t.values,r=Object.keys(t.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),a=Array.from(new Set(r.map(i=>typeof i)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function VI(){return{not:{}}}function GI(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var vd={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function KI(t,e){if(e.target==="openApi3")return ZI(t,e);let n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in vd&&(!r._def.checks||!r._def.checks.length))){let r=n.reduce((a,i)=>{let s=vd[i._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=n.reduce((a,i)=>{let s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(i._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){let a=r.filter((i,s,o)=>o.indexOf(i)===s);return{type:a.length>1?a:a[0],enum:n.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(i=>!r.includes(i))],[])};return ZI(t,e)}var ZI=(t,e)=>{let n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,a)=>K(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function YI(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:vd[t.innerType._def.typeName],nullable:!0}:{type:[vd[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=K(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let n=K(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function JI(t,e){let n={type:"number"};if(!t.checks)return n;for(let r of t.checks)switch(r.kind){case"int":n.type="integer",Bv(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?ye(n,"minimum",r.value,r.message,e):ye(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),ye(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ye(n,"maximum",r.value,r.message,e):ye(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),ye(n,"maximum",r.value,r.message,e));break;case"multipleOf":ye(n,"multipleOf",r.value,r.message,e);break}return n}function W9(t,e){var n,r;return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":(n=K(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?n:!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":(r=K(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?r:!0}function XI(t,e){let n={type:"object",...Object.entries(t.shape()).reduce((r,[a,i])=>{if(i===void 0||i._def===void 0)return r;let s=[...e.currentPath,"properties",a],o=K(i._def,{...e,currentPath:s,propertyPath:s});return o===void 0?r:(e.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&console.warn(`Zod field at \`${s.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...r.properties,[a]:o},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,a]})},{properties:{},required:[]}),additionalProperties:W9(t,e)};return n.required.length||delete n.required,n}var QI=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return K(t.innerType._def,e);let n=K(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}};var WI=(t,e)=>{if(e.pipeStrategy==="input")return K(t.in._def,e);if(e.pipeStrategy==="output")return K(t.out._def,e);let n=K(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=K(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function eP(t,e){return K(t.type._def,e)}function tP(t,e){let r={type:"array",uniqueItems:!0,items:K(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&ye(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&ye(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function nP(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>K(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:K(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>K(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function rP(){return{not:{}}}function aP(){return{}}var iP=(t,e)=>K(t.innerType._def,e);function K(t,e,n=!1){var s;let r=e.seen.get(t);if(e.override){let o=(s=e.override)==null?void 0:s.call(e,t,e,r,n);if(o!==OI)return o}if(r&&!n){let o=ez(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}let a={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,a);let i=nz(t,t.typeName,e,n);return i&&rz(t,e,i),a.jsonSchema=i,i}var ez=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"extract-to-root":let n=t.path.slice(e.basePath.length+1).join("_");return n!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[n]=t.def),{$ref:[...e.basePath,e.definitionPath,n].join("/")};case"relative":return{$ref:tz(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,a)=>e.currentPath[a]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},tz=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},nz=(t,e,n,r)=>{switch(e){case E.ZodString:return ag(t,n);case E.ZodNumber:return JI(t,n);case E.ZodObject:return XI(t,n);case E.ZodBigInt:return kI(t,n);case E.ZodBoolean:return DI();case E.ZodDate:return Fv(t,n);case E.ZodUndefined:return rP();case E.ZodNull:return GI(n);case E.ZodArray:return NI(t,n);case E.ZodUnion:case E.ZodDiscriminatedUnion:return KI(t,n);case E.ZodIntersection:return zI(t,n);case E.ZodTuple:return nP(t,n);case E.ZodRecord:return ig(t,n);case E.ZodLiteral:return BI(t,n);case E.ZodEnum:return UI(t);case E.ZodNativeEnum:return HI(t);case E.ZodNullable:return YI(t,n);case E.ZodOptional:return QI(t,n);case E.ZodMap:return qI(t,n);case E.ZodSet:return tP(t,n);case E.ZodLazy:return K(t.getter()._def,n);case E.ZodPromise:return eP(t,n);case E.ZodNaN:case E.ZodNever:return VI();case E.ZodEffects:return LI(t,n,r);case E.ZodAny:return PI();case E.ZodUnknown:return aP();case E.ZodDefault:return $I(t,n);case E.ZodBranded:return jI(t,n);case E.ZodReadonly:return iP(t,n);case E.ZodCatch:return MI(t,n);case E.ZodPipeline:return WI(t,n);case E.ZodFunction:case E.ZodVoid:case E.ZodSymbol:return;default:return(a=>{})(e)}},rz=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n);var sP=(t,e)=>{var u;let n=II(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,a=(u=K(t._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1))!=null?u:{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(a.title=i);let s=(()=>{var f;if(CI(n.definitions))return;let l={},c=new Set;for(let d=0;d<500;d++){let p=Object.entries(n.definitions).filter(([g])=>!c.has(g));if(p.length===0)break;for(let[g,b]of p)l[g]=(f=K(wd(b),{...n,currentPath:[...n.basePath,n.definitionPath,g]},!0))!=null?f:{},c.add(g)}return l})(),o=r===void 0?s?{...a,[n.definitionPath]:s}:a:n.nameStrategy==="duplicate-ref"?{...a,...s||n.seenRefs.size?{[n.definitionPath]:{...s,...n.seenRefs.size?{[r]:a}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...s,[r]:a}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function az(t,e){return sP(t,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function oP(t,e,n){return VE({type:"json_schema",json_schema:{...n,name:e,strict:!0,schema:az(t,{name:e})}},r=>t.parse(JSON.parse(r)))}function Lo(t){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:i,azureADTokenProvider:s,azureOpenAIEndpoint:o}=t;if((r||s)&&a&&e)return`${a}/${e}`;if((r||s)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||s){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${e}`}return i}function uP(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function lP(t){return t!==void 0&&ke.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function cP(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&Ja(t.schema)}function Sd(t){return cP(t)||lP(t)||uP(t)}function fP(t){return Ja(t)?ir(t):t}function dP(t,e){let n=typeof e=="number"?void 0:e;return{name:t.name,description:t.description,parameters:fP(t.schema),...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}}function Hv(t,e){let n=typeof e=="number"?void 0:e,r;return Sd(t)?r={type:"function",function:dP(t)}:r=t,(n==null?void 0:n.strict)!==void 0&&(r.function.strict=n.strict),r}function xd(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function Uo(t){let e;return t.constructor.name===dr.name?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===Ke.name?(e=new Error(t.message),e.name="AbortError"):t.status===400&&t.message.includes("tool_calls")?e=xd(t,"INVALID_TOOL_RESULTS"):t.status===401?e=xd(t,"MODEL_AUTHENTICATION"):t.status===429?e=xd(t,"MODEL_RATE_LIMIT"):t.status===404?e=xd(t,"MODEL_NOT_FOUND"):e=t,e}function Vv(t){if(t)return t==="any"||t==="required"?"required":t==="auto"?"auto":t==="none"?"none":typeof t=="string"?{type:"function",function:{name:t}}:t}function iz(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function pP(t){var n;let e=["namespace functions {",""];for(let r of t)r.description&&e.push(`// ${r.description}`),Object.keys((n=r.parameters.properties)!=null?n:{}).length>0?(e.push(`type ${r.name} = (_: {`),e.push(hP(r.parameters,0)),e.push("}) => any;")):e.push(`type ${r.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function hP(t,e){var r,a;let n=[];for(let[i,s]of Object.entries((r=t.properties)!=null?r:{}))s.description&&e<2&&n.push(`// ${s.description}`),(a=t.required)!=null&&a.includes(i)?n.push(`${i}: ${sg(s,e)},`):n.push(`${i}?: ${sg(s,e)},`);return n.map(i=>" ".repeat(e)+i).join(`
`)}function sg(t,e){if(iz(t))return t.anyOf.map(n=>sg(n,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",hP(t,e+2),"}"].join(`
`);case"array":return t.items?`${sg(t.items,e)}[]`:"any[]";default:return""}}function mP(t,e){let n;return Sd(t)?n=Hv(t):n=t,(e==null?void 0:e.strict)!==void 0&&(n.function.strict=e.strict),n}function sz(t){return t.role!=="system"&&t.role!=="developer"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function Kv(t){let e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Xi.isInstance(t))throw new Error("Invalid generic chat message");return sz(t)}default:throw new Error(`Unknown message type: ${e}`)}}var bP={providerName:"ChatOpenAI",fromStandardTextBlock(t){return{type:"text",text:t.text}},fromStandardImageBlock(t){var e,n,r;if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url,...(e=t.metadata)!=null&&e.detail?{detail:t.metadata.detail}:{}}};if(t.source_type==="base64")return{type:"image_url",image_url:{url:`data:${(n=t.mime_type)!=null?n:""};base64,${t.data}`,...(r=t.metadata)!=null&&r.detail?{detail:t.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(t){var e;if(t.source_type==="url"){let n=fw({dataUrl:t.url});if(!n)throw new Error(`URL audio blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);let r=n.mime_type||t.mime_type||"",a;try{a=cw(r)}catch(i){throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(a.type!=="audio"||a.subtype!=="wav"&&a.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:a.subtype,data:n.data}}}if(t.source_type==="base64"){let n;try{n=cw((e=t.mime_type)!=null?e:"")}catch(r){throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(n.type!=="audio"||n.subtype!=="wav"&&n.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:n.subtype,data:t.data}}}throw new Error(`Audio content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(t){var e,n,r,a,i,s,o,u,l,c,f;if(t.source_type==="url"){if(!fw({dataUrl:t.url}))throw new Error(`URL file blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:t.url,...(e=t.metadata)!=null&&e.filename||(n=t.metadata)!=null&&n.name?{filename:((r=t.metadata)==null?void 0:r.filename)||((a=t.metadata)==null?void 0:a.name)}:{}}}}if(t.source_type==="base64")return{type:"file",file:{file_data:`data:${(i=t.mime_type)!=null?i:""};base64,${t.data}`,...(s=t.metadata)!=null&&s.filename||(o=t.metadata)!=null&&o.name||(u=t.metadata)!=null&&u.title?{filename:((l=t.metadata)==null?void 0:l.filename)||((c=t.metadata)==null?void 0:c.name)||((f=t.metadata)==null?void 0:f.title)}:{}}};if(t.source_type==="id")return{type:"file",file:{file_id:t.id}};throw new Error(`File content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)}};function Zv(t,e){return t.flatMap(n=>{var s;let r=Kv(n);r==="system"&&ug(e)&&(r="developer");let a=typeof n.content=="string"?n.content:n.content.map(o=>ja(o)?dw(o,bP):o),i={role:r,content:a};if(n.name!=null&&(i.name=n.name),n.additional_kwargs.function_call!=null&&(i.function_call=n.additional_kwargs.function_call,i.content=""),br(n)&&((s=n.tool_calls)!=null&&s.length)?(i.tool_calls=n.tool_calls.map(TI),i.content=""):(n.additional_kwargs.tool_calls!=null&&(i.tool_calls=n.additional_kwargs.tool_calls),n.tool_call_id!=null&&(i.tool_call_id=n.tool_call_id)),n.additional_kwargs.audio&&typeof n.additional_kwargs.audio=="object"&&"id"in n.additional_kwargs.audio){let o={role:"assistant",audio:{id:n.additional_kwargs.audio.id}};return[i,o]}return i})}var Wl="__openai_function_call_ids__";function oz(t){let e=(t.summary.length>1?t.summary.reduce((n,r)=>{let a=n.at(-1);return a.index===r.index?a.text+=r.text:n.push(r),n},[{...t.summary[0]}]):t.summary).map(n=>Object.fromEntries(Object.entries(n).filter(([r])=>r!=="index")));return{...t,summary:e}}function gP(t,e,n){var s;let r=t.filter(o=>br(o)).pop(),a=(s=r==null?void 0:r.response_metadata)==null?void 0:s.id;return(a&&a.startsWith("resp_")&&!n?t.slice(t.indexOf(r)+1):t).flatMap(o=>{var c,f,d;let u=Kv(o);if(u==="system"&&ug(e)&&(u="developer"),u==="function")throw new Error("Function messages are not supported in Responses API");if(u==="tool"){let p=o;return((c=p.additional_kwargs)==null?void 0:c.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof p.content=="string")return{type:"computer_screenshot",image_url:p.content};if(Array.isArray(p.content)){let b=p.content.find(m=>m.type==="computer_screenshot");if(b)return b;let _=p.content.find(m=>m.type==="image_url");if(_)return{type:"computer_screenshot",image_url:typeof _.image_url=="string"?_.image_url:_.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:p.tool_call_id}:{type:"function_call_output",call_id:p.tool_call_id,id:p.id,output:typeof p.content!="string"?JSON.stringify(p.content):p.content}}if(u==="assistant"){if(!n&&o.response_metadata.output!=null&&Array.isArray(o.response_metadata.output)&&o.response_metadata.output.length>0&&o.response_metadata.output.every(h=>"type"in h))return o.response_metadata.output;let p=[];if(!n&&o.additional_kwargs.reasoning!=null&&(y=>typeof y=="object"&&y!=null&&"type"in y&&y.type==="reasoning")(o.additional_kwargs.reasoning)){let y=oz(o.additional_kwargs.reasoning);p.push(y)}let{content:g}=o;o.additional_kwargs.refusal!=null&&(typeof g=="string"&&(g=[{type:"output_text",text:g,annotations:[]}]),g=[...g,{type:"refusal",refusal:o.additional_kwargs.refusal}]),p.push({type:"message",role:"assistant",...o.id&&!n?{id:o.id}:{},content:typeof g=="string"?g:g.flatMap(h=>{var y;return h.type==="text"?{type:"output_text",text:h.text,annotations:(y=h.annotations)!=null?y:[]}:h.type==="output_text"||h.type==="refusal"?h:[]})});let b=o.additional_kwargs[Wl];br(o)&&((f=o.tool_calls)!=null&&f.length)?p.push(...o.tool_calls.map(h=>({type:"function_call",name:h.name,arguments:JSON.stringify(h.args),call_id:h.id,...n?{id:b==null?void 0:b[h.id]}:{}}))):o.additional_kwargs.tool_calls!=null&&p.push(...o.additional_kwargs.tool_calls.map(h=>({type:"function_call",name:h.function.name,call_id:h.id,...n?{id:b==null?void 0:b[h.id]}:{},arguments:h.function.arguments})));let _=(d=o.response_metadata.output)!=null&&d.length?o.response_metadata.output:o.additional_kwargs.tool_outputs,m=[];if(_!=null){let h=_;m=h==null?void 0:h.filter(y=>y.type==="computer_call"),m.length>0&&p.push(...m)}return p}let l=typeof o.content=="string"?o.content:o.content.flatMap(p=>{if(ja(p))return dw(p,bP);if(p.type==="text")return{type:"input_text",text:p.text};if(p.type==="image_url"){let g=typeof p.image_url=="string"?p.image_url:p.image_url.url,b=typeof p.image_url=="string"?"auto":p.image_url.detail;return{type:"input_image",image_url:g,detail:b}}return p.type==="input_text"||p.type==="input_image"||p.type==="input_file"?p:[]});return u==="user"||u==="system"||u==="developer"?{type:"message",role:u,content:l}:(console.warn(`Unsupported role found when converting to OpenAI Responses API: ${u}`),[])})}function _P(t){var o,u;if(t.error){let l=new Error(t.error.message);throw l.name=t.error.code,l}let e,n=[],r=[],a=[],i={model:t.model,created_at:t.created_at,id:t.id,incomplete_details:t.incomplete_details,metadata:t.metadata,object:t.object,status:t.status,user:t.user,model_name:t.model},s={};for(let l of t.output)if(l.type==="message")e=l.id,n.push(...l.content.flatMap(c=>c.type==="output_text"?("parsed"in c&&c.parsed!=null&&(s.parsed=c.parsed),{type:"text",text:c.text,annotations:c.annotations}):c.type==="refusal"?(s.refusal=c.refusal,[]):c));else if(l.type==="function_call"){let c={function:{name:l.name,arguments:l.arguments},id:l.call_id};try{r.push(rg(c,{returnId:!0}))}catch(f){let d;typeof f=="object"&&f!=null&&"message"in f&&typeof f.message=="string"&&(d=f.message),a.push(zv(c,d))}(o=s[Wl])!=null||(s[Wl]={}),l.id&&(s[Wl][l.call_id]=l.id)}else l.type==="reasoning"?s.reasoning=l:((u=s.tool_outputs)!=null||(s.tool_outputs=[]),s.tool_outputs.push(l));return new kn({id:e,content:n,tool_calls:r,invalid_tool_calls:a,usage_metadata:t.usage,additional_kwargs:s,response_metadata:i})}function uz(t){var u,l,c;let e=[],n={},r,a=[],i={},s={},o;if(t.type==="response.output_text.delta")e.push({type:"text",text:t.delta,index:t.content_index});else if(t.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[t.annotation],index:t.content_index});else if(t.type==="response.output_item.added"&&t.item.type==="message")o=t.item.id;else if(t.type==="response.output_item.added"&&t.item.type==="function_call")a.push({type:"tool_call_chunk",name:t.item.name,args:t.item.arguments,id:t.item.call_id,index:t.output_index}),s[Wl]={[t.item.call_id]:t.item.id};else if(t.type==="response.output_item.done"&&(t.item.type==="web_search_call"||t.item.type==="file_search_call"||t.item.type==="computer_call"))s.tool_outputs=[t.item];else if(t.type==="response.created")i.id=t.response.id,i.model_name=t.response.model,i.model=t.response.model;else if(t.type==="response.completed"){let f=_P(t.response);r=t.response.usage,((l=(u=t.response.text)==null?void 0:u.format)==null?void 0:l.type)==="json_schema"&&((c=s.parsed)!=null||(s.parsed=JSON.parse(f.text)));for(let[d,p]of Object.entries(t.response))d!=="id"&&(i[d]=p)}else if(t.type==="response.function_call_arguments.delta")a.push({type:"tool_call_chunk",args:t.delta,index:t.output_index});else if(t.type==="response.web_search_call.completed"||t.type==="response.file_search_call.completed")n={tool_outputs:{id:t.item_id,type:t.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(t.type==="response.refusal.done")s.refusal=t.refusal;else if(t.type==="response.output_item.added"&&"item"in t&&t.item.type==="reasoning"){let f=t.item.summary?t.item.summary.map((d,p)=>({...d,index:p})):void 0;s.reasoning={id:t.item.id,type:t.item.type,...f?{summary:f}:{}}}else if(t.type==="response.reasoning_summary_part.added")s.reasoning={type:"reasoning",summary:[{...t.part,index:t.summary_index}]};else if(t.type==="response.reasoning_summary_text.delta")s.reasoning={type:"reasoning",summary:[{text:t.delta,type:"summary_text",index:t.summary_index}]};else return null;return new Va({text:e.map(f=>f.text).join(""),message:new Dn({id:o,content:e,tool_call_chunks:a,usage_metadata:r,additional_kwargs:s,response_metadata:i}),generationInfo:n})}function Gv(t){return"type"in t&&t.type!=="function"}function lz(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type!=="function"}function yP(t,e){return jv(t)?(e==null?void 0:e.strict)!==void 0?{...t,function:{...t.function,strict:e.strict}}:t:mP(t,e)}function ug(t){return t&&/^o\d/.test(t)}var ec=class extends ng{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){var n,r,a,i,s,o,u,l,c,f,d,p,g,b,_,m,h,y,v,S,A,T,x,C;super(e!=null?e:{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(i=(a=(n=e==null?void 0:e.apiKey)!=null?n:e==null?void 0:e.openAIApiKey)!=null?a:(r=e==null?void 0:e.configuration)==null?void 0:r.apiKey)!=null?i:He("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=(o=(s=e==null?void 0:e.configuration)==null?void 0:s.organization)!=null?o:He("OPENAI_ORGANIZATION"),this.model=(l=(u=e==null?void 0:e.model)!=null?u:e==null?void 0:e.modelName)!=null?l:this.model,this.modelName=this.model,this.modelKwargs=(c=e==null?void 0:e.modelKwargs)!=null?c:{},this.timeout=e==null?void 0:e.timeout,this.temperature=(f=e==null?void 0:e.temperature)!=null?f:this.temperature,this.topP=(d=e==null?void 0:e.topP)!=null?d:this.topP,this.frequencyPenalty=(p=e==null?void 0:e.frequencyPenalty)!=null?p:this.frequencyPenalty,this.presencePenalty=(g=e==null?void 0:e.presencePenalty)!=null?g:this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(b=e==null?void 0:e.n)!=null?b:this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(_=e==null?void 0:e.stopSequences)!=null?_:e==null?void 0:e.stop,this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=(h=e==null?void 0:e.reasoningEffort)!=null?h:(m=e==null?void 0:e.reasoning)==null?void 0:m.effort,this.reasoning=(y=e==null?void 0:e.reasoning)!=null?y:e!=null&&e.reasoningEffort?{effort:e.reasoningEffort}:void 0,this.maxTokens=(v=e==null?void 0:e.maxCompletionTokens)!=null?v:e==null?void 0:e.maxTokens,this.useResponsesApi=(S=e==null?void 0:e.useResponsesApi)!=null?S:this.useResponsesApi,this.disableStreaming=(A=e==null?void 0:e.disableStreaming)!=null?A:this.disableStreaming,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(T=e==null?void 0:e.streaming)!=null?T:!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(x=e==null?void 0:e.streamUsage)!=null?x:this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),this.zdrEnabled=(C=e==null?void 0:e.zdrEnabled)!=null?C:!1}getLsParams(e){var r,a;let n=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:(r=n.temperature)!=null?r:void 0,ls_max_tokens:(a=n.max_tokens)!=null?a:void 0,ls_stop:e.stop}}bindTools(e,n){let r;return(n==null?void 0:n.strict)!==void 0?r=n.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(a=>Gv(a)?a:yP(a,{strict:r})),...n})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&og(e.json_schema.schema)?oP(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){if(!ug(this.model))return;let n;return this.reasoningEffort!==void 0&&(n={effort:this.reasoningEffort}),this.reasoning!==void 0&&(n={...n,...this.reasoning}),(e==null?void 0:e.reasoning_effort)!==void 0&&(n={...n,effort:e.reasoning_effort}),(e==null?void 0:e.reasoning)!==void 0&&(n={...n,...e.reasoning}),n}invocationParams(e,n){var o,u,l;let r;if((e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this._useResponseApi(e)){let c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(d=>Gv(d)?d:jv(d)?{type:"function",name:d.function.name,parameters:d.function.parameters,description:d.function.description,strict:r}:null).filter(d=>d!==null):void 0,tool_choice:lz(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{let d=Vv(e==null?void 0:e.tool_choice);if(typeof d=="object"&&"type"in d)return{type:"function",name:d.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;let d=this.createResponseFormat(e==null?void 0:e.response_format);return(d==null?void 0:d.type)==="json_schema"?d.json_schema.schema!=null?{format:{type:"json_schema",schema:d.json_schema.schema,description:d.json_schema.description,name:d.json_schema.name,strict:d.json_schema.strict}}:void 0:{format:d}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},f=this.getReasoningParams(e);return f!==void 0&&(c.reasoning=f),c}let a={};(e==null?void 0:e.stream_options)!==void 0?a={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||n!=null&&n.streaming)&&(a={stream_options:{include_usage:!0}});let i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(u=e==null?void 0:e.stop)!=null?u:this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(l=e==null?void 0:e.tools)!=null&&l.length?e.tools.map(c=>yP(c,{strict:r})):void 0,tool_choice:Vv(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...a,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);let s=this.getReasoningParams(e);return s!==void 0&&s.effort!==void 0&&(i.reasoning_effort=s.effort),ug(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,n){var a;let r=e.tool_calls;switch(e.role){case"assistant":{let i=[],s=[];for(let l of r!=null?r:[])try{i.push(rg(l,{returnId:!0}))}catch(c){s.push(zv(l,c.message))}let o={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(o.__raw_response=n);let u={model_name:n.model,...n.system_fingerprint?{usage:{...n.usage},system_fingerprint:n.system_fingerprint}:{}};return e.audio&&(o.audio=e.audio),new kn({content:e.content||"",tool_calls:i,invalid_tool_calls:s,additional_kwargs:o,response_metadata:u,id:n.id})}default:return new Xi(e.content||"",(a=e.role)!=null?a:"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,n,r){var u,l,c,f;let a=(u=e.role)!=null?u:r,i=(l=e.content)!=null?l:"",s;e.function_call?s={function_call:e.function_call}:e.tool_calls?s={tool_calls:e.tool_calls}:s={},this.__includeRawResponse&&(s.__raw_response=n),e.audio&&(s.audio={...e.audio,index:n.choices[0].index});let o={usage:{...n.usage}};if(a==="user")return new uo({content:i,response_metadata:o});if(a==="assistant"){let d=[];if(Array.isArray(e.tool_calls))for(let p of e.tool_calls)d.push({name:(c=p.function)==null?void 0:c.name,args:(f=p.function)==null?void 0:f.arguments,id:p.id,index:p.index,type:"tool_call_chunk"});return new Dn({content:i,tool_call_chunks:d,additional_kwargs:s,id:n.id,response_metadata:o})}else return a==="system"?new Qi({content:i,response_metadata:o}):a==="developer"?new Qi({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):a==="function"?new oo({content:i,additional_kwargs:s,name:e.name,response_metadata:o}):a==="tool"?new kl({content:i,additional_kwargs:s,tool_call_id:e.tool_call_id,response_metadata:o}):new so({content:i,role:a,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,n,r){var l,c,f,d,p,g,b,_,m,h,y,v,S,A,T;if(this._useResponseApi(n)){let x=e.filter(B=>br(B)).pop(),C=(l=x==null?void 0:x.response_metadata)==null?void 0:l.id,R=await this.responseApiWithRetry({...this.invocationParams(n,{streaming:!0}),input:gP(e,this.model,this.zdrEnabled),stream:!0,...C&&C.startsWith("resp_")&&!this.zdrEnabled?{previous_response_id:C}:{}},n);for await(let B of R){let te=uz(B);te!=null&&(yield te)}return}let a=Zv(e,this.model),i={...this.invocationParams(n,{streaming:!0}),messages:a,stream:!0},s,o=await this.completionWithRetry(i,n),u;for await(let x of o){let C=(c=x==null?void 0:x.choices)==null?void 0:c[0];if(x.usage&&(u=x.usage),!C)continue;let{delta:R}=C;if(!R)continue;let B=this._convertOpenAIDeltaToBaseMessageChunk(R,x,s);s=(f=R.role)!=null?f:s;let te={prompt:(d=n.promptIndex)!=null?d:0,completion:(p=C.index)!=null?p:0};if(typeof B.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let je={...te};C.finish_reason!=null&&(je.finish_reason=C.finish_reason,je.system_fingerprint=x.system_fingerprint,je.model_name=x.model),this.logprobs&&(je.logprobs=C.logprobs);let Ge=new Va({message:B,text:B.content,generationInfo:je});yield Ge,await(r==null?void 0:r.handleLLMNewToken((g=Ge.text)!=null?g:"",te,void 0,void 0,void 0,{chunk:Ge}))}if(u){let x={...((b=u.prompt_tokens_details)==null?void 0:b.audio_tokens)!==null&&{audio:(_=u.prompt_tokens_details)==null?void 0:_.audio_tokens},...((m=u.prompt_tokens_details)==null?void 0:m.cached_tokens)!==null&&{cache_read:(h=u.prompt_tokens_details)==null?void 0:h.cached_tokens}},C={...((y=u.completion_tokens_details)==null?void 0:y.audio_tokens)!==null&&{audio:(v=u.completion_tokens_details)==null?void 0:v.audio_tokens},...((S=u.completion_tokens_details)==null?void 0:S.reasoning_tokens)!==null&&{reasoning:(A=u.completion_tokens_details)==null?void 0:A.reasoning_tokens}};yield new Va({message:new Dn({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(x).length>0&&{input_token_details:x},...Object.keys(C).length>0&&{output_token_details:C}}}),text:""})}if((T=n.signal)!=null&&T.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,n,r){var l,c,f;let a=this.invocationParams(n);if(a.stream){let d=this._streamResponseChunks(e,n,r),p;for await(let g of d)g.message.response_metadata={...g.generationInfo,...g.message.response_metadata},p=(l=p==null?void 0:p.concat(g))!=null?l:g;return{generations:p?[p]:[],llmOutput:{estimatedTokenUsage:(c=p==null?void 0:p.message)==null?void 0:c.usage_metadata}}}let i=e.filter(d=>br(d)).pop(),s=(f=i==null?void 0:i.response_metadata)==null?void 0:f.id,o=gP(e,this.model,this.zdrEnabled),u=await this.responseApiWithRetry({input:o,...a,...s&&s.startsWith("resp_")&&!this.zdrEnabled?{previous_response_id:s}:{}},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options});return{generations:[{text:u.output_text,message:_P(u)}],llmOutput:{id:u.id,estimatedTokenUsage:u.usage?{promptTokens:u.usage.input_tokens,completionTokens:u.usage.output_tokens,totalTokens:u.usage.total_tokens}:void 0}}}_useResponseApi(e){var a,i,s;let n=(a=e==null?void 0:e.tools)==null?void 0:a.some(Gv),r=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null||((i=e==null?void 0:e.reasoning)==null?void 0:i.summary)!=null||((s=this.reasoning)==null?void 0:s.summary)!=null;return this.useResponsesApi||n||r}async _generate(e,n,r){var o,u,l,c,f,d,p,g,b,_;if(this._useResponseApi(n))return this._responseApiGenerate(e,n,r);let a={},i=this.invocationParams(n),s=Zv(e,this.model);if(i.stream){let m=this._streamResponseChunks(e,n,r),h={};for await(let x of m){x.message.response_metadata={...x.generationInfo,...x.message.response_metadata};let C=(u=(o=x.generationInfo)==null?void 0:o.completion)!=null?u:0;h[C]===void 0?h[C]=x:h[C]=h[C].concat(x)}let y=Object.entries(h).sort(([x],[C])=>parseInt(x,10)-parseInt(C,10)).map(([x,C])=>C),{functions:v,function_call:S}=this.invocationParams(n),A=await this.getEstimatedTokenCountFromPrompt(e,v,S),T=await this.getNumTokensFromGenerations(y);return a.input_tokens=A,a.output_tokens=T,a.total_tokens=A+T,{generations:y,llmOutput:{estimatedTokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}else{let m;n.response_format&&n.response_format.type==="json_schema"?m=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:s},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options}):m=await this.completionWithRetry({...i,stream:!1,messages:s},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options});let{completion_tokens:h,prompt_tokens:y,total_tokens:v,prompt_tokens_details:S,completion_tokens_details:A}=(l=m==null?void 0:m.usage)!=null?l:{};h&&(a.output_tokens=((c=a.output_tokens)!=null?c:0)+h),y&&(a.input_tokens=((f=a.input_tokens)!=null?f:0)+y),v&&(a.total_tokens=((d=a.total_tokens)!=null?d:0)+v),((S==null?void 0:S.audio_tokens)!==null||(S==null?void 0:S.cached_tokens)!==null)&&(a.input_token_details={...(S==null?void 0:S.audio_tokens)!==null&&{audio:S==null?void 0:S.audio_tokens},...(S==null?void 0:S.cached_tokens)!==null&&{cache_read:S==null?void 0:S.cached_tokens}}),((A==null?void 0:A.audio_tokens)!==null||(A==null?void 0:A.reasoning_tokens)!==null)&&(a.output_token_details={...(A==null?void 0:A.audio_tokens)!==null&&{audio:A==null?void 0:A.audio_tokens},...(A==null?void 0:A.reasoning_tokens)!==null&&{reasoning:A==null?void 0:A.reasoning_tokens}});let T=[];for(let x of(p=m==null?void 0:m.choices)!=null?p:[]){let R={text:(b=(g=x.message)==null?void 0:g.content)!=null?b:"",message:this._convertOpenAIChatCompletionMessageToBaseMessage((_=x.message)!=null?_:{role:"assistant"},m)};R.generationInfo={...x.finish_reason?{finish_reason:x.finish_reason}:{},...x.logprobs?{logprobs:x.logprobs}:{}},br(R.message)&&(R.message.usage_metadata=a),R.message=new kn(Object.fromEntries(Object.entries(R.message).filter(([B])=>!B.startsWith("lc_")))),T.push(R)}return{generations:T,llmOutput:{tokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,n,r){let a=(await this.getNumTokensFromMessages(e)).totalCount;if(n&&r!=="auto"){let i=pP(n);a+=await this.getNumTokens(i),a+=9}return n&&e.find(i=>i._getType()==="system")&&(a-=4),r==="none"?a+=1:typeof r=="object"&&(a+=await this.getNumTokens(r.name)+4),a}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var a;return(a=r.message.additional_kwargs)!=null&&a.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,a)=>r+a,0)}async getNumTokensFromMessages(e){let n=0,r=0,a=0;this.model==="gpt-3.5-turbo-0301"?(r=4,a=-1):(r=3,a=1);let i=await Promise.all(e.map(async s=>{var d,p,g,b,_,m;let o=await this.getNumTokens(s.content),u=await this.getNumTokens(Kv(s)),l=s.name!==void 0?a+await this.getNumTokens(s.name):0,c=o+r+u+l,f=s;if(f._getType()==="function"&&(c-=2),(d=f.additional_kwargs)!=null&&d.function_call&&(c+=3),(p=f==null?void 0:f.additional_kwargs.function_call)!=null&&p.name&&(c+=await this.getNumTokens((g=f.additional_kwargs.function_call)==null?void 0:g.name)),(b=f.additional_kwargs.function_call)!=null&&b.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((_=f.additional_kwargs.function_call)==null?void 0:_.arguments)))}catch(h){console.error("Error parsing function arguments",h,JSON.stringify(f.additional_kwargs.function_call)),c+=await this.getNumTokens((m=f.additional_kwargs.function_call)==null?void 0:m.arguments)}return n+=c,c}));return n+=3,{totalCount:n,countPerMessage:i}}async completionWithRetry(e,n){let r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw Uo(a)}})}async responseApiWithRetry(e,n){return this.caller.call(async()=>{var a,i;let r=this._getClientOptions(n);try{return((i=(a=e.text)==null?void 0:a.format)==null?void 0:i.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,r):await this.client.responses.create(e,r)}catch(s){throw Uo(s)}})}async betaParsedCompletionWithRetry(e,n){let r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(a){throw Uo(a)}})}_getClientOptions(e){if(!this.client){let r={baseURL:this.clientConfig.baseURL},a=Lo(r),i={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new ee(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((n,r)=>{var a,i,s;return r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=(a=r.tokenUsage.completionTokens)!=null?a:0,n.tokenUsage.promptTokens+=(i=r.tokenUsage.promptTokens)!=null?i:0,n.tokenUsage.totalTokens+=(s=r.tokenUsage.totalTokens)!=null?s:0),n},{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,n){var d,p;let r,a,i,s;cz(e)?(r=e.schema,a=e.name,i=e.method,s=e.includeRaw):(r=e,a=n==null?void 0:n.name,i=n==null?void 0:n.method,s=n==null?void 0:n.includeRaw);let o,u;if((n==null?void 0:n.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),og(r)?u=yd.fromZodSchema(r):u=new bd;else if(i==="jsonSchema")if(o=this.bind({response_format:{type:"json_schema",json_schema:{name:a!=null?a:"extract",description:r.description,schema:r,strict:n==null?void 0:n.strict}}}),og(r)){let g=yd.fromZodSchema(r);u=Tr.from(b=>"parsed"in b.additional_kwargs?b.additional_kwargs.parsed:g)}else u=new bd;else{let g=a!=null?a:"extract";if(og(r)){let b=ir(r);o=this.bind({tools:[{type:"function",function:{name:g,description:b.description,parameters:b}}],tool_choice:{type:"function",function:{name:g}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),u=new _d({returnSingle:!0,keyName:g,zodSchema:r})}else{let b;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(b=r,g=r.name):(g=(d=r.title)!=null?d:g,b={name:g,description:(p=r.description)!=null?p:"",parameters:r}),o=this.bind({tools:[{type:"function",function:b}],tool_choice:{type:"function",function:{name:g}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),u=new _d({returnSingle:!0,keyName:g})}}if(!s)return o.pipe(u);let l=oa.assign({parsed:(g,b)=>u.invoke(g.raw,b)}),c=oa.assign({parsed:()=>null}),f=l.withFallbacks({fallbacks:[c]});return Ya.from([{raw:o},f])}};function og(t){return typeof(t==null?void 0:t.parse)=="function"}function cz(t){return t!==void 0&&typeof t.schema=="object"}var Yv=class extends md{get lc_namespace(){return["langchain","tools"]}constructor(e){var n,r;super(e!=null?e:{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(n=e==null?void 0:e.verboseParsingErrors)!=null?n:this.verboseParsingErrors,this.responseFormat=(r=e==null?void 0:e.responseFormat)!=null?r:this.responseFormat}async invoke(e,n){let r,a,i=me(n);return Dl(e)?(r=e.id,a=e.args,i={...i,toolCall:e,configurable:{...i.configurable,tool_call_id:r}}):a=e,this.call(a,i)}async call(e,n,r){let a=e;if(Ja(this.schema))try{a=await this.schema.parseAsync(e)}catch(p){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${p.message}`),new lo(g,JSON.stringify(e))}else{let p=Le(e,this.schema);if(!p.valid){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${p.errors.map(b=>`${b.keywordLocation}: ${b.error}`).join(`
`)}`),new lo(g,JSON.stringify(e))}}let i=SC(n),s=Pt.configure(i.callbacks,this.callbacks,i.tags||r,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(s==null?void 0:s.handleToolStart(this.toJSON(),typeof a=="string"?a:JSON.stringify(a),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;let u;try{u=await this._call(a,o,i)}catch(p){throw await(o==null?void 0:o.handleToolError(p)),p}let l,c;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[l,c]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else l=u;let f;i&&"configurable"in i&&(f=i.configurable.tool_call_id);let d=dz({content:l,artifact:c,toolCallId:f,name:this.name});return await(o==null?void 0:o.handleToolEnd(d)),d}},lg=class extends Yv{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:at.object({input:at.string().optional()}).transform(n=>n.input)})}call(e,n){return super.call(typeof e=="string"||!e?{input:e}:e,n)}};function dz(t){let{content:e,artifact:n,toolCallId:r}=t;return r&&!TO(e)?typeof e=="string"||Array.isArray(e)&&e.every(a=>typeof a=="object")?new Ma({content:e,artifact:n,tool_call_id:r,name:t.name}):new Ma({content:pz(e),artifact:n,tool_call_id:r,name:t.name}):e}function pz(t){try{return JSON.stringify(t,null,2)}catch(e){return`${t}`}}var Jv=class extends lg{static lc_name(){return"DallEAPIWrapper"}constructor(e){var i,s,o,u,l,c,f,d,p,g;(e==null?void 0:e.responseFormat)!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let n=(s=(i=e==null?void 0:e.apiKey)!=null?i:e==null?void 0:e.openAIApiKey)!=null?s:He("OPENAI_API_KEY"),r=(o=e==null?void 0:e.organization)!=null?o:He("OPENAI_ORGANIZATION"),a={apiKey:n,organization:r,dangerouslyAllowBrowser:!0,baseURL:e==null?void 0:e.baseUrl};this.client=new ee(a),this.model=(l=(u=e==null?void 0:e.model)!=null?u:e==null?void 0:e.modelName)!=null?l:this.model,this.style=(c=e==null?void 0:e.style)!=null?c:this.style,this.quality=(f=e==null?void 0:e.quality)!=null?f:this.quality,this.n=(d=e==null?void 0:e.n)!=null?d:this.n,this.size=(p=e==null?void 0:e.size)!=null?p:this.size,this.dallEResponseFormat=(g=e==null?void 0:e.dallEResponseFormat)!=null?g:this.dallEResponseFormat,this.user=e==null?void 0:e.user}processMultipleGeneratedUrls(e){return this.dallEResponseFormat==="url"?e.flatMap(n=>{var a,i;return(i=(a=n.data)==null?void 0:a.flatMap(s=>s.url?{type:"image_url",image_url:s.url}:[]).filter(s=>s!==void 0&&s.type==="image_url"&&typeof s.image_url=="string"&&s.image_url!==void 0))!=null?i:[]}):e.flatMap(n=>{var a,i;return(i=(a=n.data)==null?void 0:a.flatMap(s=>s.b64_json?{type:"image_url",image_url:{url:s.b64_json}}:[]).filter(s=>s!==void 0&&s.type==="image_url"&&typeof s.image_url=="object"&&"url"in s.image_url&&typeof s.image_url.url=="string"&&s.image_url.url!==void 0))!=null?i:[]})}async _call(e){var i,s,o,u;let n={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let l=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(n)));return this.processMultipleGeneratedUrls(l)}let r=await this.client.images.generate(n),a="";return this.dallEResponseFormat==="url"?[a]=(s=(i=r.data)==null?void 0:i.map(l=>l.url).filter(l=>l!=="undefined"))!=null?s:[]:[a]=(u=(o=r.data)==null?void 0:o.map(l=>l.b64_json).filter(l=>l!=="undefined"))!=null?u:[],a}};Object.defineProperty(Jv,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var wP=require("obsidian");var la=(h=>(h.auto="auto",h.en="en",h.es="es",h.fr="fr",h.de="de",h.it="it",h.pt="pt",h.nl="nl",h.hi="hi",h.ja="ja",h.zh="zh",h.fi="fi",h.ko="ko",h.pl="pl",h.ru="ru",h.tr="tr",h.uk="uk",h.vi="vi",h))(la||{}),tc={auto:"Auto Detect",en:"English",es:"Spanish",fr:"French",de:"German",it:"Italian",pt:"Portuguese",nl:"Dutch",hi:"Hindi",ja:"Japanese",zh:"Chinese",fi:"Finnish",ko:"Korean",pl:"Polish",ru:"Russian",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese"};function Xv(t){let n=/```mermaid\s+([\s\S]*?)```/g.exec(t);if(n&&n.length>1)return n[1]}function cg(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")}var nc=(t=>(t["gpt-4.1"]="gpt-4.1",t["gpt-4.1-mini"]="gpt-4.1-mini",t["gpt-4o"]="gpt-4o",t["gpt-4o-mini"]="gpt-4o-mini",t["gpt-4-turbo"]="gpt-4-turbo",t))(nc||{}),hz=25*1024*1024;async function vP(t,e,{audioFileLanguage:n}){let r=new iO({apiKey:t,dangerouslyAllowBrowser:!0}),a=await sw(e,hz);return new wP.Notice(`Scribe: \u{1F3A7} Split transcript into ${a.length} files`),await mz(r,{audioFiles:a,audioFileLanguage:n})}async function mz(t,{audioFiles:e,onChunkStart:n,audioFileLanguage:r}){let a="";for(let[i,s]of e.entries()){n&&n(i,e.length);let o=r&&r!=="auto",u={model:"whisper-1",file:s},l=o?{...u,language:r}:u,c=await t.audio.transcriptions.create(l);a+=(i===0?"":" ")+c.text.trim()}return a}async function SP(t,e,{scribeOutputLanguage:n,activeNoteTemplate:r},a="gpt-4o"){let i=`
  You are "Scribe" an expert note-making AI for Obsidian you specialize in the Linking Your Thinking (LYK) strategy.  
  The following is the transcription generated from a recording of someone talking aloud or multiple people in a conversation. 
  There may be a lot of random things said given fluidity of conversation or thought process and the microphone's ability to pick up all audio.  

  The transcription may address you by calling you "Scribe" or saying "Hey Scribe" and asking you a question, they also may just allude to you by asking "you" to do something.
  Give them the answers to this question

  Give me notes in Markdown language on what was said, they should be
  - Easy to understand
  - Succinct
  - Clean
  - Logical
  - Insightful
  
  It will be nested under a h2 # tag, feel free to nest headers underneath it
  Rules:
  - Do not include escaped new line characters
  - Do not mention "the speaker" anywhere in your response.  
  - The notes should be written as if I were writing them. 

  The following is the transcribed audio:
  <transcript>
  ${e}
  </transcript>
  `,s=new ec({model:a,apiKey:t,temperature:.5}),o=[new Qr(i)];n&&o.push(new Qr(`Please respond in ${n} language`));let u={fileTitle:at.string().describe("A suggested title for the Obsidian Note. Ensure that it is in the proper format for a file on mac, windows and linux, do not include any special characters")};r.sections.forEach(d=>{let{sectionHeader:p,sectionInstructions:g,isSectionOptional:b}=d;u[cg(p)]=b?at.string().nullish().describe(g):at.string().describe(g)});let l=at.object(u);return await await s.withStructuredOutput(l).invoke(o)}async function xP(t,e,n="gpt-4o"){let r=`
You are an expert in mermaid charts and Obsidian (the note taking app)
Below is a <broken-mermaid-chart> that isn't rendering correctly in Obsidian
There may be some new line characters, or tab characters, or special characters.  
Strip them out and only return a fully valid unicode Mermaid chart that will render properly in Obsidian
Remove any special characters in the nodes text that isn't valid.

<broken-mermaid-chart>
${e}
</broken-mermaid-chart>

Thank you
  `,a=new ec({model:n,apiKey:t,temperature:.3}),i=[new Qr(r)],s=at.object({mermaidChart:at.string().describe("A fully valid unicode mermaid chart")}),o=a.withStructuredOutput(s),{mermaidChart:u}=await o.invoke(i);return{mermaidChart:u}}var dg=Z(ur());var AP=require("obsidian");function zo(t,e){return t.includes("{{date}}")?t.replace("{{date}}",(0,AP.moment)().format(e)):t}var Bo=Z(Oe()),Pe=({name:t,description:e,control:n})=>(0,Bo.jsxs)("div",{className:"setting-item",children:[(0,Bo.jsxs)("div",{className:"setting-item-info",children:[(0,Bo.jsx)("div",{className:"setting-item-name",children:t}),(0,Bo.jsx)("div",{className:"setting-item-description",children:e})]}),(0,Bo.jsx)("div",{className:"setting-item-control",children:n})]});var bn=Z(Oe()),RP=({plugin:t,saveSettings:e})=>{let[n,r]=(0,dg.useState)(t.settings.noteFilenamePrefix),[a,i]=(0,dg.useState)(t.settings.recordingFilenamePrefix),[s,o]=(0,dg.useState)(t.settings.dateFilenameFormat),u=(n||"").includes("{{date}}")||(a||"").includes("{{date}}");return(0,bn.jsxs)("div",{children:[(0,bn.jsx)("h2",{children:"File name properties"}),(0,bn.jsx)(Pe,{name:"Transcript filename prefix",description:"This will be the prefix of the note filename, use {{date}} to include the date",control:(0,bn.jsx)("input",{type:"text",placeholder:"scribe-",value:n,onChange:l=>{r(l.target.value),t.settings.noteFilenamePrefix=l.target.value,e()}})}),(0,bn.jsx)(Pe,{name:"Audio recording filename prefix",description:"This will be the prefix of the audio recording filename, use {{date}} to include the date",control:(0,bn.jsx)("input",{type:"text",placeholder:"scribe-",value:a,onChange:l=>{i(l.target.value),t.settings.recordingFilenamePrefix=l.target.value,e()}})}),(0,bn.jsx)(Pe,{name:"Date format",description:"This will only be used if {{date}} is in the transcript or audio recording filename prefix above.",control:(0,bn.jsx)("div",{children:(0,bn.jsx)("input",{type:"text",placeholder:"YYYY-MM-DD",disabled:!u,value:s,onChange:l=>{o(l.target.value),t.settings.dateFilenameFormat=l.target.value,e()}})})}),u&&(0,bn.jsxs)("div",{children:[(0,bn.jsxs)("p",{children:[zo(`${n}`,s),"filename"]}),(0,bn.jsxs)("p",{children:[zo(`${a}`,s),"filename"]})]})]})};var Ad=Z(ur());var Je=Z(Oe()),CP=({plugin:t,saveSettings:e})=>{let[n,r]=(0,Ad.useState)(t.settings.transcriptPlatform),[a,i]=(0,Ad.useState)(t.settings.llmModel),[s,o]=(0,Ad.useState)(t.settings.isMultiSpeakerEnabled),[u,l]=(0,Ad.useState)(t.settings.isDisableLlmTranscription),c=()=>{let d=!s;o(d),t.settings.isMultiSpeakerEnabled=d,e()},f=()=>{let d=!u;l(d),t.settings.isDisableLlmTranscription=d,e()};return(0,Je.jsxs)("div",{children:[(0,Je.jsx)("h2",{children:"AI model options"}),(0,Je.jsx)(Pe,{name:"Disable LLM transcription",description:"If enabled, audio will not be sent to any LLM for transcription",control:(0,Je.jsx)("div",{className:`checkbox-container ${u?"is-enabled":""}`,onClick:d=>{f()},onKeyDown:d=>{d.key==="Enter"&&f()},children:(0,Je.jsx)("input",{type:"checkbox",checked:u,onChange:f})})}),(0,Je.jsx)(Pe,{name:"Transcript platform",description:"Your recording is uploaded to this service",control:(0,Je.jsxs)("select",{defaultValue:n,className:"dropdown",onChange:d=>{let p=d.target.value;r(p),t.settings.transcriptPlatform=p,e()},children:[(0,Je.jsx)("option",{value:"openAi",children:"OpenAi"}),(0,Je.jsx)("option",{value:"assemblyAi",children:"AssemblyAI"})]})}),n==="assemblyAi"&&(0,Je.jsx)(Pe,{name:"Multi-speaker enabled",description:"Enable this if you have multiple speakers in your recording",control:(0,Je.jsx)("div",{className:`checkbox-container ${s?"is-enabled":""}`,onClick:d=>{c()},onKeyDown:d=>{d.key==="Enter"&&c()},children:(0,Je.jsx)("input",{type:"checkbox",checked:s,onChange:c})})}),(0,Je.jsx)(Pe,{name:"LLM model for creating the summary",description:"The transcript is sent to this service",control:(0,Je.jsx)("select",{defaultValue:a,className:"dropdown",onChange:d=>{let p=d.target.value;i(p),t.settings.llmModel=p,e()},children:Object.keys(nc).map(d=>(0,Je.jsx)("option",{value:d,children:d},d))})}),(0,Je.jsx)(Pe,{name:"Spoken language",description:"The default spoken language for audio transcription, changing from auto may increase accuracy",control:(0,Je.jsx)("select",{defaultValue:t.settings.audioFileLanguage,className:"dropdown",onChange:d=>{let p=d.target.value;t.settings.audioFileLanguage=p,e()},children:Object.keys(la).map(d=>(0,Je.jsx)("option",{value:d,children:tc[d]},d))})}),(0,Je.jsx)(Pe,{name:"Scribe output language",description:"The language for the notes generated by Scribe to be in",control:(0,Je.jsx)("select",{defaultValue:t.settings.scribeOutputLanguage,className:"dropdown",onChange:d=>{let p=d.target.value;t.settings.scribeOutputLanguage=p,e()},children:Object.keys(la).filter(d=>d!=="auto").map(d=>(0,Je.jsx)("option",{value:d,children:tc[d]},d))})})]})};var ac=Z(ur());var Fo=Z(Oe());function IP({plugin:t,saveSettings:e}){let[n,r]=(0,ac.useState)([]),[a,i]=(0,ac.useState)(!0),[s,o]=(0,ac.useState)(t.settings.selectedAudioDeviceId);(0,ac.useEffect)(()=>{(async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(p=>p.stop());let d=(await navigator.mediaDevices.enumerateDevices()).filter(p=>p.kind==="audioinput").map(p=>({deviceId:p.deviceId,label:p.label||`Microphone (${p.deviceId.slice(0,8)}...)`}));r(d)}catch(c){console.error("Error getting audio devices:",c)}finally{i(!1)}})()},[]);let u=l=>{o(l),t.settings.selectedAudioDeviceId=l,e()};return(0,Fo.jsx)(Pe,{name:"Audio Input Device",description:"Select which microphone to use for recording",control:a?(0,Fo.jsx)("div",{children:"Loading devices..."}):(0,Fo.jsxs)("select",{value:s,className:"dropdown",onChange:l=>u(l.target.value),children:[(0,Fo.jsx)("option",{value:"",children:"System Default"}),n.map(l=>(0,Fo.jsx)("option",{value:l.deviceId,children:l.label},l.deviceId))]})})}var Td=Z(ur());var ve=Z(Oe()),Ed={id:"default",name:"Scribe",sections:[{id:"1",sectionHeader:"Summary",sectionInstructions:`A summary of the transcript in Markdown.  It will be nested under a h2 # tag, so use a tag less than that for headers
Concise bullet points containing the primary points of the speaker`},{id:"2",sectionHeader:"Insights",sectionInstructions:`Insights that you gained from the transcript in Markdown.
A brief section, a paragraph or two on what insights and enhancements you think of
Several bullet points on things you think would be an improvement, feel free to use headers
It will be nested under an h2 tag, so use a tag less than that for headers
        `},{id:"3",sectionHeader:"Mermaid Chart",sectionOutputPrefix:"```mermaid",sectionOutputPostfix:"```",sectionInstructions:`A valid unicode mermaid chart that shows a concept map consisting of both what insights you had along with what the speaker said for the mermaid chart, 
Dont wrap it in anything, just output the mermaid chart.  
Do not use any special characters that arent letters in the nodes text, particularly new lines, tabs, or special characters like apostraphes or quotes or commas`},{id:"4",sectionHeader:"Answered Questions",isSectionOptional:!0,sectionInstructions:`If the user says "Hey Scribe" or alludes to you, asking you to do something, answer the question or do the ask and put the answers here
Put the text in markdown, it will be nested under an h2 tag, so use a tag less than that for headers
Summarize the question in a short sentence as a header and place your reply nicely below for as many questions as there are
Answer their questions in a clear and concise manner`}]},bz=({section:t,activeTemplate:e,setActiveTemplate:n,isTemplateLocked:r,setNoteTemplates:a,noteTemplates:i})=>{let s=u=>{let l=e.sections.map(f=>f.sectionHeader===t.sectionHeader?u:f),c=i.map(f=>(f.id||(f.id=Math.random().toString(36).substring(2,9)),f.id===e.id||f.name===e.name?{...f,sections:l}:f));a(c),n({...e,sections:l})},o=()=>{let u=e.sections.filter(l=>l.id!==t.id);n({...e,sections:u})};return(0,ve.jsxs)("div",{style:{width:"100%"},children:[(0,ve.jsx)(Pe,{name:"Section Header",description:"",control:(0,ve.jsx)("input",{disabled:r,type:"text",value:t.sectionHeader,onChange:u=>{s({...t,sectionHeader:u.target.value})}})}),(0,ve.jsx)("p",{children:"Section Instructions"}),(0,ve.jsx)("textarea",{disabled:r,value:t.sectionInstructions,onChange:u=>{s({...t,sectionInstructions:u.target.value})},rows:3,style:{width:"100%",overflow:"visible",height:"auto"},onFocus:u=>{let l=u.target;l.style.height=`${l.scrollHeight}px`},onInput:u=>{let l=u.target;l.style.height=`${l.scrollHeight}px`}}),(0,ve.jsx)(Pe,{name:"Section Optional",description:'Marks the section as optional - for example "Ask Scribe"',control:(0,ve.jsx)("input",{disabled:r,type:"checkbox",checked:!!t.isSectionOptional,onChange:u=>{s({...t,isSectionOptional:u.target.checked})}})}),(0,ve.jsx)(Pe,{name:"Section Output Prefix",description:"Prefix for the section output - this is useful for code blocks",control:(0,ve.jsx)("input",{disabled:r,type:"text",value:t.sectionOutputPrefix||"",onChange:u=>{s({...t,sectionOutputPrefix:u.target.value})}})}),(0,ve.jsx)(Pe,{name:"Section Output Postfix",description:"Postfix for the section output - this is useful for codeblocks",control:(0,ve.jsx)("input",{disabled:r,type:"text",value:t.sectionOutputPostfix||"",onChange:u=>{s({...t,sectionOutputPostfix:u.target.value})}})}),(0,ve.jsx)("button",{type:"button",onClick:o,disabled:r,children:"Remove Section"}),(0,ve.jsx)("hr",{})]})},_z=({noteTemplates:t,activeTemplate:e,setNoteTemplates:n,setActiveTemplate:r,isTemplateLocked:a})=>(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(Pe,{name:"Active Template",description:"Select the active note template - this will be auto selected in the modal",control:(0,ve.jsx)("select",{value:e.name,className:"dropdown",onChange:i=>{let s=t.find(o=>o.name===i.target.value);s&&r(s)},children:t.map(i=>(0,ve.jsxs)("option",{value:i.name,children:[i.name," ",i.name===Ed.name?"(Locked)":""]},i.name))})}),(0,ve.jsx)("button",{type:"button",onClick:()=>{let i={id:Math.random().toString(36).substring(2,9),name:Date.now().toString(),sections:[]},s=[...t,i];n(s),r(i)},children:"New Template"}),(0,ve.jsx)("button",{type:"button",onClick:()=>{let i={...e,name:`${e.name} (Copy)`},s=[...t,i];n(s),r(i)},children:"Clone Template"}),(0,ve.jsx)("button",{disabled:a,type:"button",onClick:()=>{let i=t.filter(s=>s.name!==e.name);n(i),r(i[0])},children:"Remove Active Template"}),(0,ve.jsx)(Pe,{name:"Template Name",description:"Change the name of the active template",control:(0,ve.jsx)("input",{disabled:a,type:"text",value:e.name,onChange:i=>{let s={...e,name:i.target.value},o=t.findIndex(l=>l.name===e.name),u=[...t];u[o]=s,r(s),n(u)}})}),(0,ve.jsx)("button",{type:"button",disabled:a,onClick:()=>{let i={id:Math.random().toString(36).substring(2,9),sectionHeader:"New Section",sectionInstructions:"New Section Instructions"},s={...e,sections:[...e.sections,i]},o=t.findIndex(l=>l.name===e.name),u=[...t];u[o]=s,r(s),n(u)},children:"Add New Section"}),(0,ve.jsx)("hr",{})]}),PP=({plugin:t,saveSettings:e})=>{let[n,r]=(0,Td.useState)(t.settings.noteTemplates),[a,i]=(0,Td.useState)(t.settings.activeNoteTemplate),s=a.name===Ed.name;return(0,Td.useEffect)(()=>{t.settings.noteTemplates=n,t.settings.activeNoteTemplate=a,e()},[n,a,t,e]),(0,ve.jsxs)("div",{children:[(0,ve.jsx)("h2",{children:"Templates"}),(0,ve.jsx)(_z,{noteTemplates:n,activeTemplate:a,setNoteTemplates:r,setActiveTemplate:i,isTemplateLocked:s}),a.sections.map(o=>(0,ve.jsx)(bz,{section:o,activeTemplate:a,setActiveTemplate:i,setNoteTemplates:r,noteTemplates:n,isTemplateLocked:s},o.id))]})};var Qv=require("obsidian");async function qo(t){let e=t.app.fileManager,n=t.app.workspace.getActiveFile(),r=(0,Qv.normalizePath)(e.getNewFileParent((n==null?void 0:n.path)||"","").path),a=Date.now(),i=(await e.getAvailablePathForAttachment(a.toString())).split("/"),s=(0,Qv.normalizePath)(i.splice(0,i.length-1).join("/"));return{defaultNewFilePath:r,defaultNewResourcePath:s}}var ls=Z(Oe()),rc=(n=>(n.assemblyAi="assemblyAi",n.openAi="openAi",n))(rc||{});var pg={assemblyAiApiKey:"",openAiApiKey:"",recordingDirectory:"matchObsidianResourceFolder",transcriptDirectory:"matchObsidianNoteFolder",transcriptPlatform:"openAi",isMultiSpeakerEnabled:!1,llmModel:"gpt-4o",noteFilenamePrefix:"scribe-{{date}}-",recordingFilenamePrefix:"scribe-recording-{{date}}",dateFilenameFormat:"YYYY-MM-DD",isSaveAudioFileActive:!0,isOnlyTranscribeActive:!1,isAppendToActiveFile:!1,isDisableLlmTranscription:!1,audioFileLanguage:"auto",scribeOutputLanguage:"en",activeNoteTemplate:Ed,noteTemplates:[Ed],isFrontMatterLinkToScribe:!0,selectedAudioDeviceId:"",audioFileFormat:"webm"};async function kP(t){t.addSettingTab(new Wv(t.app,t))}var Wv=class extends Ln.PluginSettingTab{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty(),this.plugin.loadSettings(),new Ln.Setting(e).setName("Open AI API key").setDesc("You can find this in your OpenAI dev console - https://platform.openai.com/settings").addText(a=>a.setPlaceholder("sk-....").setValue(this.plugin.settings.openAiApiKey).onChange(async i=>{this.plugin.settings.openAiApiKey=i,await this.plugin.saveSettings()})),new Ln.Setting(e).setName("AssemblyAI API key").setDesc("You can find this in your AssemblyAI dev console - https://www.assemblyai.com/app/account").addText(a=>a.setPlaceholder("c3p0....").setValue(this.plugin.settings.assemblyAiApiKey).onChange(async i=>{this.plugin.settings.assemblyAiApiKey=i,await this.plugin.saveSettings()}));let n=this.plugin.app.vault.getAllFolders();new Ln.Setting(e).setName("Directory for recordings").setDesc("Defaults to your resources folder").addDropdown(a=>{a.addOption("","Vault folder"),a.addOption("matchObsidianResourceFolder","Obsidian resource folder");for(let i of n){let s=i.path?i.path:"Vault Folder";a.addOption(i.path,s)}a.onChange(async i=>{this.plugin.settings.recordingDirectory=i,await this.saveSettings()}),a.setValue(this.plugin.settings.recordingDirectory)}),new Ln.Setting(e).setName("Directory for transcripts").setDesc("Defaults to your new note folder").addDropdown(async a=>{let i=await qo(this.plugin);a.addOption("","Vault folder"),a.addOption("matchObsidianNoteFolder","Obsidian note folder");for(let s of n){let o=s.path===""?"Vault Folder":s.path;a.addOption(s.path,o)}a.onChange(async s=>{this.plugin.settings.transcriptDirectory=s,await this.saveSettings()}),a.setValue(this.plugin.settings.transcriptDirectory)}),e.createEl("h2",{text:"Default recording options"}),new Ln.Setting(e).setName("Save audio file").setDesc('Save the audio file after Scribing it. If false, the audio file will be permanently deleted after transcription. This will not affect the Command for "Transcribe existing file"').addToggle(a=>{a.setValue(this.plugin.settings.isSaveAudioFileActive),a.onChange(async i=>{this.plugin.settings.isSaveAudioFileActive=i,await this.saveSettings()})}),new Ln.Setting(e).setName("Audio file format").setDesc("Choose the format for saving audio recordings. MP3 format will be converted from WebM on the client side.").addDropdown(a=>{a.addOption("webm","WebM").addOption("mp3","MP3").setValue(this.plugin.settings.audioFileFormat).onChange(async i=>{this.plugin.settings.audioFileFormat=i,await this.saveSettings()})}),new Ln.Setting(e).setName("Only transcribe recording").setDesc("If true, we will only transcribe the recording and not generate anything additional like a summary, insights or a new filename.").addToggle(a=>{a.setValue(this.plugin.settings.isOnlyTranscribeActive),a.onChange(async i=>{this.plugin.settings.isOnlyTranscribeActive=i,await this.saveSettings()})}),new Ln.Setting(e).setName("Append to active file by default").setDesc("If true, the default behavior will be to append the transcription to the active file. If false, it will create a new note with the transcription.").addToggle(a=>{a.setValue(this.plugin.settings.isAppendToActiveFile),a.onChange(async i=>{this.plugin.settings.isAppendToActiveFile=i,await this.saveSettings()})}),new Ln.Setting(e).setName('Link to Scribe in "created_by" frontmatter').setDesc("If true, we will add a link to the Scribe in the frontmatter of the note.  This is useful for knowing which notes were created by Scribe.").addToggle(a=>{a.setValue(this.plugin.settings.isFrontMatterLinkToScribe),a.onChange(async i=>{this.plugin.settings.isFrontMatterLinkToScribe=i,await this.saveSettings()})});let r=e.createDiv({cls:"scribe-settings-react"});this.reactRoot=(0,NP.createRoot)(r),this.reactRoot.render((0,ls.jsx)(wz,{plugin:this.plugin})),new Ln.Setting(e).addButton(a=>{a.setButtonText("Reset to default"),a.onClick(async()=>{this.plugin.settings={...pg,openAiApiKey:this.plugin.settings.openAiApiKey,assemblyAiApiKey:this.plugin.settings.assemblyAiApiKey},this.saveSettings(),this.display()})})}saveSettings(){this.plugin.saveSettings()}},wz=({plugin:t})=>{let e=pE(()=>{t.saveSettings()},500);return(0,ls.jsxs)("div",{children:[(0,ls.jsx)(IP,{plugin:t,saveSettings:e}),(0,ls.jsx)(CP,{plugin:t,saveSettings:e}),(0,ls.jsx)(RP,{plugin:t,saveSettings:e}),(0,ls.jsx)(PP,{plugin:t,saveSettings:e})]})};var DP=require("obsidian");function jP(t){t.addRibbonIcon("mic-vocal","Scribe",n=>{vz(t).showAtMouseEvent(n)}).addClass("scribe-plugin-ribbon")}function vz(t){var r,a;let e=new DP.Menu;return((a=(r=t.state.audioRecord)==null?void 0:r.mediaRecorder)==null?void 0:a.state)==="recording"?(e.addItem(i=>{i.setIcon("trash-2"),i.setTitle("Cancel Recording"),i.onClick(()=>{t.cancelRecording()})}),e.addItem(i=>{i.setIcon("save"),i.setTitle("Stop Recording"),i.onClick(()=>{t.scribe()})})):(e.addItem(i=>{i.setIcon("joystick"),i.setTitle("Open Controls"),i.onClick(()=>{t.state.isOpen=!0,t.controlModal.open()})}),e.addItem(i=>{i.setIcon("mic-vocal"),i.setTitle("Start Recording"),i.onClick(()=>{t.startRecording()})})),e}var GP=Z(__()),ZP=require("obsidian"),Ho=Z(ur());var hg=Z(ur()),ic=Z(Oe());function MP({startTimeMs:t}){let[e,n]=(0,hg.useState)({minutes:0,seconds:0,milliseconds:0});return(0,hg.useEffect)(()=>{let r;return t&&!r?r=window.setInterval(()=>{let{minutes:a,seconds:i,milliseconds:s}=Sz(t);n({minutes:a,seconds:i,milliseconds:s})},10):(n({minutes:0,seconds:0,milliseconds:0}),r&&window.clearInterval(r)),()=>{r&&window.clearInterval(r)}},[t]),(0,ic.jsxs)("div",{className:"scribe-timer",children:[(0,ic.jsxs)("span",{className:"scribe-timer-digits",children:[e0(e.minutes,2),":"]}),(0,ic.jsxs)("span",{className:"scribe-timer-digits scribe-timer-millis",children:[e0(e.seconds,2),"."]}),(0,ic.jsx)("span",{className:"scribe-timer-digits scribe-timer-millis",children:e0(e.milliseconds,2)})]})}function Sz(t){let r=Date.now()-t,a=Math.floor(r/(1e3*60*60));r-=a*(1e3*60*60);let i=Math.floor(r/(1e3*60));r-=i*(1e3*60);let s=Math.floor(r/1e3);r-=s*1e3;let o=r;return o>=100&&(o=Math.floor(o/10)),{hours:a,minutes:i,seconds:s,milliseconds:o}}var e0=(t,e)=>{let n=t.toString();for(;n.length<e;)n=`0${n}`;return n};var At=Z(Oe());function $P(){return(0,At.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"lucide lucide-mic-vocal",children:[(0,At.jsx)("title",{children:"Microphone Icon"}),(0,At.jsx)("path",{d:"m11 7.601-5.994 8.19a1 1 0 0 0 .1 1.298l.817.818a1 1 0 0 0 1.314.087L15.09 12"}),(0,At.jsx)("path",{d:"M16.5 21.174C15.5 20.5 14.372 20 13 20c-2.058 0-3.928 2.356-6 2-2.072-.356-2.775-3.369-1.5-4.5"}),(0,At.jsx)("circle",{cx:16,cy:7,r:5})]})}function LP(){return(0,At.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"lucide lucide-save",children:[(0,At.jsx)("title",{children:"Save Icon"}),(0,At.jsx)("path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}),(0,At.jsx)("path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7M7 3v4a1 1 0 0 0 1 1h7"})]})}function UP(){return(0,At.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"lucide lucide-trash-2",children:[(0,At.jsx)("title",{children:"Trash / Delete Icon"}),(0,At.jsx)("path",{d:"M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"})]})}var zP=()=>(0,At.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"lucide lucide-circle-alert",children:[(0,At.jsx)("title",{children:"Circle Alert Icon"}),(0,At.jsx)("circle",{cx:12,cy:12,r:10}),(0,At.jsx)("path",{d:"M12 8v4M12 16h.01"})]});var or=Z(Oe());function BP({active:t,isPaused:e,isScribing:n,recordingState:r,handleStart:a,handlePauseResume:i,handleReset:s,handleComplete:o}){return(0,or.jsx)("div",{className:"scribe-control-buttons-container",children:t?(0,or.jsxs)("div",{className:"scribe-active-buttons-container",children:[(0,or.jsxs)("div",{className:"scribe-buttons-row",children:[(0,or.jsxs)("button",{className:"scribe-btn",onClick:s,type:"button",disabled:n,children:[(0,or.jsx)(UP,{}),"Reset"]}),(0,or.jsxs)("button",{className:"scribe-btn scribe-btn-save",onClick:o,type:"button",disabled:n,children:[(0,or.jsx)(LP,{}),"Complete"]})]}),n&&(0,or.jsx)("h2",{children:"\u267D Scribe in progress"})]}):(0,or.jsxs)("button",{className:"scribe-btn scribe-btn-start",onClick:a,type:"button",children:[(0,or.jsx)($P,{}),"Start"]})})}var t0=Z(ur());var _n=Z(Oe());function FP({options:t,setOptions:e,noteTemplates:n}){let r=c=>{e({...t,...c})},{isAppendToActiveFile:a,isOnlyTranscribeActive:i,isSaveAudioFileActive:s,isMultiSpeakerEnabled:o,transcriptPlatform:u,activeNoteTemplate:l}=t;return(0,_n.jsxs)("div",{className:"scribe-recording-options",children:[(0,_n.jsxs)("label",{children:[(0,_n.jsx)("input",{type:"checkbox",checked:a,onChange:c=>{r({isAppendToActiveFile:c.target.checked})}}),"Append to active file"]}),(0,_n.jsxs)("label",{children:[(0,_n.jsx)("input",{type:"checkbox",checked:i,onChange:c=>{r({isOnlyTranscribeActive:c.target.checked})}}),"Only transcribe recording"]}),(0,_n.jsxs)("label",{children:[(0,_n.jsx)("input",{type:"checkbox",checked:s,onChange:c=>{r({isSaveAudioFileActive:c.target.checked})}}),"Save audio file"]}),u==="assemblyAi"&&(0,_n.jsxs)("label",{children:[(0,_n.jsx)("input",{type:"checkbox",checked:o,onChange:c=>{r({isMultiSpeakerEnabled:c.target.checked})}}),"Multi-speaker enabled"]}),(0,_n.jsx)(Pe,{name:"Active template",description:"",control:(0,_n.jsx)("select",{defaultValue:l.name,className:"dropdown",onChange:c=>{let f=n.find(d=>d.name===c.target.value);r({activeNoteTemplate:f})},children:n.map(c=>(0,_n.jsx)("option",{value:c.name,children:c.name},c.name))})})]})}var Qa=Z(Oe());function qP({options:t,setOptions:e}){let n=i=>{e({...t,...i})},{transcriptPlatform:r,llmModel:a}=t;return(0,Qa.jsxs)("div",{className:"scribe-recording-options",children:[(0,Qa.jsx)(Pe,{name:"LLM model",description:"",control:(0,Qa.jsx)("select",{defaultValue:a,className:"dropdown",onChange:i=>{n({llmModel:i.target.value})},children:Object.keys(nc).map(i=>(0,Qa.jsx)("option",{value:i,children:i},i))})}),(0,Qa.jsx)(Pe,{name:"Transcript platform",description:"",control:(0,Qa.jsx)("select",{defaultValue:r,className:"dropdown",onChange:i=>{n({transcriptPlatform:i.target.value})},children:Object.keys(rc).map(i=>(0,Qa.jsx)("option",{value:i,children:i},i))})})]})}var Wa=Z(Oe());function HP({options:t,setOptions:e}){let n=i=>{e({...t,...i})},{audioFileLanguage:r,scribeOutputLanguage:a}=t;return(0,Wa.jsxs)("div",{className:"scribe-recording-options",children:[(0,Wa.jsx)(Pe,{name:"Spoken language",description:"",control:(0,Wa.jsx)("select",{defaultValue:r,className:"dropdown",onChange:i=>{n({audioFileLanguage:i.target.value})},children:Object.keys(la).map(i=>(0,Wa.jsx)("option",{value:i,children:tc[i]},i))})}),(0,Wa.jsx)(Pe,{name:"Scribe output language",description:"",control:(0,Wa.jsx)("select",{defaultValue:a,className:"dropdown",onChange:i=>{n({scribeOutputLanguage:i.target.value})},children:Object.keys(la).filter(i=>i!=="auto").map(i=>(0,Wa.jsx)("option",{value:i,children:tc[i]},i))})})]})}var Nt=Z(Oe());function VP({plugin:t,options:e,setOptions:n}){let[r,a]=(0,t0.useState)(!1),[i,s]=(0,t0.useState)(!1);return(0,Nt.jsxs)("div",{children:[(0,Nt.jsx)("p",{children:"Session settings"}),(0,Nt.jsx)("div",{className:"scribe-options-container",children:(0,Nt.jsx)(FP,{options:e,setOptions:n,noteTemplates:t.settings.noteTemplates})}),(0,Nt.jsx)("button",{onClick:()=>s(!i),type:"button",className:"scribe-settings-btn",children:"Language options"}),(0,Nt.jsx)("button",{onClick:()=>a(!r),type:"button",className:"scribe-settings-btn",children:"Model options"}),i&&(0,Nt.jsxs)(Nt.Fragment,{children:[(0,Nt.jsx)("h5",{children:"Language options"}),(0,Nt.jsx)(HP,{options:e,setOptions:n})]}),r&&(0,Nt.jsxs)(Nt.Fragment,{children:[(0,Nt.jsx)("h5",{children:"AI model options"}),(0,Nt.jsx)(qP,{options:e,setOptions:n})]})]})}var kt=Z(Oe()),sc=class extends ZP.Modal{constructor(e){super(e.app),this.plugin=e}async onOpen(){this.plugin.state.isOpen=!0,this.initModal()}async onClose(){var n;let{contentEl:e}=this;e.empty(),this.plugin.state.isOpen=!1,this.plugin.cancelRecording(),(n=this.root)==null||n.unmount()}initModal(){let{contentEl:e}=this;this.modalEl.addClass("scribe-modal");let n=e.createDiv({cls:"scribe-controls-modal-react"});this.root=(0,GP.createRoot)(n),this.root.render((0,kt.jsx)(xz,{plugin:this.plugin}))}},xz=({plugin:t})=>{let[e,n]=(0,Ho.useState)(!1),[r,a]=(0,Ho.useState)(!0),[i,s]=(0,Ho.useState)("inactive"),[o,u]=(0,Ho.useState)(!1),[l,c]=(0,Ho.useState)(null),[f,d]=(0,Ho.useState)({isAppendToActiveFile:t.settings.isAppendToActiveFile,isOnlyTranscribeActive:t.settings.isOnlyTranscribeActive,isSaveAudioFileActive:t.settings.isSaveAudioFileActive,isMultiSpeakerEnabled:t.settings.isMultiSpeakerEnabled,isDisableLlmTranscription:t.settings.isDisableLlmTranscription,audioFileLanguage:t.settings.audioFileLanguage,scribeOutputLanguage:t.settings.scribeOutputLanguage,transcriptPlatform:t.settings.transcriptPlatform,llmModel:t.settings.llmModel,activeNoteTemplate:t.settings.activeNoteTemplate}),p=!!t.settings.openAiApiKey;return(0,kt.jsxs)("div",{className:"scribe-modal-container",children:[!p&&(0,kt.jsxs)("div",{className:"scribe-settings-warning-container",children:[(0,kt.jsxs)("h1",{children:["\uFE0F",(0,kt.jsx)(zP,{})," Missing Open AI API key"]}),(0,kt.jsx)("h2",{className:"scribe-settings-warning",children:"Please enter the key in the plugin settings."}),(0,kt.jsx)("p",{children:"You can get your API key here"}),(0,kt.jsx)("a",{href:"https://platform.openai.com/settings",children:"OpenAI Platform"})]}),p&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(MP,{startTimeMs:l}),(0,kt.jsx)(BP,{recordingState:i,active:e,isPaused:r,isScribing:o,handleStart:async()=>{s("recording"),await t.startRecording(),c(Date.now()),n(!0),a(!1)},handlePauseResume:()=>{let h=!r;a(h),s(h?"paused":"recording"),t.handlePauseResumeRecording()},handleComplete:async()=>{a(!0),u(!0),c(null),s("inactive"),await t.scribe(f),a(!1),n(!1),u(!1)},handleReset:()=>{t.cancelRecording(),s("inactive"),n(!1),c(null)}})]}),(0,kt.jsx)("hr",{}),(0,kt.jsx)(VP,{plugin:t,options:f,setOptions:d})]})};function KP(t){t.addCommand({id:"scribe-recording-modal",name:"Open recording modal",callback:()=>{t.state.isOpen=!0,new sc(t).open()}}),t.addCommand({id:"scribe-recording-toggle-recording",name:"Start/Stop recording",callback:()=>{var n,r;((r=(n=t.state.audioRecord)==null?void 0:n.mediaRecorder)==null?void 0:r.state)==="recording"?t.scribe():t.startRecording()}}),t.addCommand({id:"scribe-transcribe-summarize",name:"Transcribe & summarize current file",callback:async()=>{let e=t.app.workspace.getActiveFile();e&&t.scribeExistingFile(e)}}),t.addCommand({id:"scribe-fix-mermaid-chart",name:"Fix mermaid chart",callback:()=>{let e=t.app.workspace.getActiveFile();e&&t.fixMermaidChart(e)}})}var _0=require("obsidian"),FN=Z(IN());var Fz="0.12.9",Oae=`https://unpkg.com/@ffmpeg/core@${Fz}/dist/umd/ffmpeg-core.js`,Ae;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(Ae||(Ae={}));var PN=(()=>{let t=0;return()=>t++})();var Iae=new Error("unknown message type"),NN=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),kN=new Error("called FFmpeg.terminate()"),Pae=new Error("failed to import ffmpeg-core.js");var DN={};var Un,cs,ti,Vo,Go,Ng,en,Pg=class{constructor(){ii(this,Un,null);ii(this,cs,{});ii(this,ti,{});ii(this,Vo,[]);ii(this,Go,[]);Ue(this,"loaded",!1);ii(this,Ng,()=>{fe(this,Un)&&(fe(this,Un).onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case Ae.LOAD:this.loaded=!0,fe(this,cs)[e](r);break;case Ae.MOUNT:case Ae.UNMOUNT:case Ae.EXEC:case Ae.FFPROBE:case Ae.WRITE_FILE:case Ae.READ_FILE:case Ae.DELETE_FILE:case Ae.RENAME:case Ae.CREATE_DIR:case Ae.LIST_DIR:case Ae.DELETE_DIR:fe(this,cs)[e](r);break;case Ae.LOG:fe(this,Vo).forEach(a=>a(r));break;case Ae.PROGRESS:fe(this,Go).forEach(a=>a(r));break;case Ae.ERROR:fe(this,ti)[e](r);break}delete fe(this,cs)[e],delete fe(this,ti)[e]})});ii(this,en,({type:e,data:n},r=[],a)=>fe(this,Un)?new Promise((i,s)=>{let o=PN();fe(this,Un)&&fe(this,Un).postMessage({id:o,type:e,data:n},r),fe(this,cs)[o]=i,fe(this,ti)[o]=s,a==null||a.addEventListener("abort",()=>{s(new DOMException(`Message # ${o} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(NN));Ue(this,"load",({classWorkerURL:e,...n}={},{signal:r}={})=>(fe(this,Un)||(gc(this,Un,e?new Worker(new URL(e,DN.url),{type:"module"}):new Worker(new URL("./worker.js",DN.url),{type:"module"})),fe(this,Ng).call(this)),fe(this,en).call(this,{type:Ae.LOAD,data:n},void 0,r)));Ue(this,"exec",(e,n=-1,{signal:r}={})=>fe(this,en).call(this,{type:Ae.EXEC,data:{args:e,timeout:n}},void 0,r));Ue(this,"ffprobe",(e,n=-1,{signal:r}={})=>fe(this,en).call(this,{type:Ae.FFPROBE,data:{args:e,timeout:n}},void 0,r));Ue(this,"terminate",()=>{let e=Object.keys(fe(this,ti));for(let n of e)fe(this,ti)[n](kN),delete fe(this,ti)[n],delete fe(this,cs)[n];fe(this,Un)&&(fe(this,Un).terminate(),gc(this,Un,null),this.loaded=!1)});Ue(this,"writeFile",(e,n,{signal:r}={})=>{let a=[];return n instanceof Uint8Array&&a.push(n.buffer),fe(this,en).call(this,{type:Ae.WRITE_FILE,data:{path:e,data:n}},a,r)});Ue(this,"mount",(e,n,r)=>{let a=[];return fe(this,en).call(this,{type:Ae.MOUNT,data:{fsType:e,options:n,mountPoint:r}},a)});Ue(this,"unmount",e=>{let n=[];return fe(this,en).call(this,{type:Ae.UNMOUNT,data:{mountPoint:e}},n)});Ue(this,"readFile",(e,n="binary",{signal:r}={})=>fe(this,en).call(this,{type:Ae.READ_FILE,data:{path:e,encoding:n}},void 0,r));Ue(this,"deleteFile",(e,{signal:n}={})=>fe(this,en).call(this,{type:Ae.DELETE_FILE,data:{path:e}},void 0,n));Ue(this,"rename",(e,n,{signal:r}={})=>fe(this,en).call(this,{type:Ae.RENAME,data:{oldPath:e,newPath:n}},void 0,r));Ue(this,"createDir",(e,{signal:n}={})=>fe(this,en).call(this,{type:Ae.CREATE_DIR,data:{path:e}},void 0,n));Ue(this,"listDir",(e,{signal:n}={})=>fe(this,en).call(this,{type:Ae.LIST_DIR,data:{path:e}},void 0,n));Ue(this,"deleteDir",(e,{signal:n}={})=>fe(this,en).call(this,{type:Ae.DELETE_DIR,data:{path:e}},void 0,n))}on(e,n){e==="log"?fe(this,Vo).push(n):e==="progress"&&fe(this,Go).push(n)}off(e,n){e==="log"?gc(this,Vo,fe(this,Vo).filter(r=>r!==n)):e==="progress"&&gc(this,Go,fe(this,Go).filter(r=>r!==n))}};Un=new WeakMap,cs=new WeakMap,ti=new WeakMap,Vo=new WeakMap,Go=new WeakMap,Ng=new WeakMap,en=new WeakMap;var jN;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(jN||(jN={}));var MN=new Error("failed to get response body reader"),$N=new Error("failed to complete download");var LN="Content-Length";var qz=t=>new Promise((e,n)=>{let r=new FileReader;r.onload=()=>{let{result:a}=r;a instanceof ArrayBuffer?e(new Uint8Array(a)):e(new Uint8Array)},r.onerror=a=>{var i,s;n(Error(`File could not be read! Code=${((s=(i=a==null?void 0:a.target)==null?void 0:i.error)==null?void 0:s.code)||-1}`))},r.readAsArrayBuffer(t)}),UN=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await qz(t);else return new Uint8Array;return new Uint8Array(e)};var Hz=async(t,e)=>{var a;let n=await fetch(t),r;try{let i=parseInt(n.headers.get(LN)||"-1"),s=(a=n.body)==null?void 0:a.getReader();if(!s)throw MN;let o=[],u=0;for(;;){let{done:f,value:d}=await s.read(),p=d?d.length:0;if(f){if(i!=-1&&i!==u)throw $N;e&&e({url:t,total:i,received:u,delta:p,done:f});break}o.push(d),u+=p,e&&e({url:t,total:i,received:u,delta:p,done:f})}let l=new Uint8Array(u),c=0;for(let f of o)l.set(f,c),c+=f.length;r=l.buffer}catch(i){console.log("failed to send download progress event: ",i),r=await n.arrayBuffer(),e&&e({url:t,total:r.byteLength,received:r.byteLength,delta:0,done:!0})}return r},b0=async(t,e,n=!1,r)=>{let a=n?await Hz(t,r):await(await fetch(t)).arrayBuffer(),i=new Blob([a],{type:e});return URL.createObjectURL(i)};var Vz=["audio/webm; codecs=opus","audio/webm","audio/ogg","audio/mp4","audio/mp3","audio/m4a","audio/wav","audio/flac"],Gz={"audio/webm; codecs=opus":"webm","audio/webm":"webm","audio/ogg":"ogg","audio/mp4":"mp4","audio/mp3":"mp3","audio/m4a":"m4a","audio/wav":"wav","audio/flac":"flac"};function zN(t){if(MediaRecorder.isTypeSupported(t))return t;for(let e of Vz)if(MediaRecorder.isTypeSupported(e))return e;throw new Error("No supported mime types found")}function BN(t){return Gz[t]}var kg=class{constructor(e="webm"){this.data=[];this.startTime=null;this.mimeType=zN("audio/webm; codecs=opus");this.bitRate=32e3;this.desiredFormat=e,this.fileExtension=e}async startRecording(e){let n=e&&e!==""?{deviceId:{exact:e}}:!0;navigator.mediaDevices.getUserMedia({audio:n}).then(r=>{this.mediaRecorder=this.setupMediaRecorder(r),this.mediaRecorder.start(),this.startTime=Date.now()}).catch(r=>{new _0.Notice("Scribe: Failed to access the microphone"),console.error("Error accessing microphone:",r)})}async handlePauseResume(){if(!this.mediaRecorder||this.mediaRecorder.state==="inactive")throw console.error("There is no mediaRecorder, cannot resume handlePauseResume"),new Error("There is no mediaRecorder, cannot handlePauseResume");this.mediaRecorder.state==="paused"?this.resumeRecording():this.mediaRecorder.state==="recording"&&this.pauseRecording()}async resumeRecording(){var e;if(!this.mediaRecorder||this.mediaRecorder.state==="inactive")throw console.error("There is no mediaRecorder, cannot resume resumeRecording"),new Error("There is no mediaRecorder, cannot resumeRecording");(e=this.mediaRecorder)==null||e.resume()}async pauseRecording(){var e;if(!this.mediaRecorder||this.mediaRecorder.state==="inactive")throw console.error("There is no mediaRecorder, cannot pauseRecording"),new Error("There is no mediaRecorder, cannot pauseRecording");(e=this.mediaRecorder)==null||e.pause()}async convertWebmToMp3(e){try{let n=new Pg,r="https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd";await n.load({coreURL:await b0(`${r}/ffmpeg-core.js`,"text/javascript"),wasmURL:await b0(`${r}/ffmpeg-core.wasm`,"application/wasm")}),await n.writeFile("input.webm",await UN(e)),await n.exec(["-i","input.webm","-c:a","libmp3lame","-q:a","2","output.mp3"]);let a=await n.readFile("output.mp3");return new Blob([a],{type:"audio/mp3"})}catch(n){throw console.error("Error converting WebM to MP3:",n),new Error(`Failed to convert WebM to MP3: ${n.message}`)}}stopRecording(){return new Promise((e,n)=>{if(!this.mediaRecorder||this.mediaRecorder.state==="inactive"){let r=new Error("There is no mediaRecorder, cannot stopRecording");console.error(r.message),n(r);return}this.mediaRecorder.onstop=async()=>{var r;try{if((r=this.mediaRecorder)==null||r.stream.getTracks().forEach(o=>o.stop()),this.data.length===0)throw new Error("No audio data recorded.");let a=new Blob(this.data,{type:this.mimeType}),i=this.startTime&&Date.now()-this.startTime||0,s=await(0,FN.fixWebmDuration)(a,i,{});if(this.mediaRecorder=null,this.startTime=null,this.desiredFormat==="mp3")try{let o=await this.convertWebmToMp3(s);e(o)}catch(o){console.error("Error converting to MP3, falling back to WebM:",o),new _0.Notice("Scribe: Failed to convert to MP3, saving as WebM instead"),e(s)}else e(s)}catch(a){console.log("Error during recording stop:",a),n(a)}},this.mediaRecorder.stop()})}setupMediaRecorder(e){let n=new MediaRecorder(e,{mimeType:this.mimeType,audioBitsPerSecond:this.bitRate});return n.ondataavailable=r=>{this.data.push(r.data)},n}};var Dg=require("obsidian");async function qN(t,e,n){var o,u;let r=await qo(t),a=t.settings.recordingDirectory==="matchObsidianResourceFolder"?r.defaultNewResourcePath:t.settings.recordingDirectory,i=(0,Dg.normalizePath)(`${a}/${n}.${(o=t.state.audioRecord)==null?void 0:o.fileExtension}`);if(console.log("Saving audio to path:",i),await t.app.vault.adapter.exists(i,!0)){let l=Math.floor(Math.random()*1e3);i=`${a}/${n}.${l}.${(u=t.state.audioRecord)==null?void 0:u.fileExtension}`}try{return await t.app.vault.createBinary(i,e)}catch(l){throw console.error(`Failed to save file in: ${i}`,l),l}}async function jg(t,e){try{let n=await qo(t),r=t.settings.transcriptDirectory==="matchObsidianNoteFolder"?n.defaultNewFilePath:t.settings.transcriptDirectory,a=`${r}/${e}.md`,i=(0,Dg.normalizePath)(a);if(console.log("Saving note to path:",i),await t.app.vault.adapter.exists(i,!0)){let u=Math.floor(Math.random()*1e3);i=(0,Dg.normalizePath)(`${r}/${e}.${u}.md`)}return await t.app.vault.create(i,"")}catch(n){throw console.error("Failed to save file",n),n==="Error: File already exists"&&jg(t,`${e}.${Math.random()*100}`),n}}async function HN(t,e,n){let r=e.path.replace(e.name,""),a=`${r}/${n}.md`;if(await t.app.vault.adapter.exists(a,!0)){let s=Math.floor(Math.random()*1e3);a=`${r}/${n}.${s}.md`}await t.app.fileManager.renameFile(e,`${a}`)}async function w0(t,e,n){try{return await t.app.fileManager.processFrontMatter(e,r=>{let a={...r,audio:n?[...r.source||[],`[[${n.path}]]`]:r.source};t.settings.isFrontMatterLinkToScribe&&(a.created_by="[[Scribe]]"),Object.assign(r,a)}),e}catch(r){throw console.error("Failed to addAudioSourceToFrontmatter",r),r}}async function Cd(t,e,n,r){try{return await t.app.vault.process(e,a=>{try{if(r)return a.replace(r,n)}catch(i){return console.error("Failed to replace text",i),`${a}
${n}`}return`${a.length&&`${a}
`}${n}`}),e}catch(a){throw console.error("Failed to addAudioSourceToFrontmatter",a),a}}var Id={cache:"no-store"},Zz=t=>Pd+(t===!1?"":" AssemblyAI/1.0 ("+Object.entries({...Mg,...t}).map(([e,n])=>n?`${e}=${n.name}/${n.version}`:"").join(" ")+")"),Pd="";typeof navigator!="undefined"&&navigator.userAgent&&(Pd+=navigator.userAgent);var Mg={sdk:{name:"JavaScript",version:"4.12.2"}};typeof process!="undefined"&&(process.versions.node&&Pd.indexOf("Node")===-1&&(Mg.runtime_env={name:"Node",version:process.versions.node}),process.versions.bun&&Pd.indexOf("Bun")===-1&&(Mg.runtime_env={name:"Bun",version:process.versions.bun}));typeof Deno!="undefined"&&process.versions.bun&&Pd.indexOf("Deno")===-1&&(Mg.runtime_env={name:"Deno",version:Deno.version.deno});var lc=class{constructor(e){this.params=e,e.userAgent===!1?this.userAgent=void 0:this.userAgent=Zz(e.userAgent||{})}async fetch(e,n){n={...Id,...n};let r={Authorization:this.params.apiKey,"Content-Type":"application/json"};Id!=null&&Id.headers&&(r={...r,...Id.headers}),n!=null&&n.headers&&(r={...r,...n.headers}),this.userAgent&&(r["User-Agent"]=this.userAgent,typeof window!="undefined"&&"chrome"in window&&(r["AssemblyAI-Agent"]=this.userAgent)),n.headers=r,e.startsWith("http")||(e=this.params.baseUrl+e);let a=await fetch(e,n);if(a.status>=400){let i,s=await a.text();if(s){try{i=JSON.parse(s)}catch(o){}throw i!=null&&i.error?new Error(i.error):new Error(s)}throw new Error(`HTTP Error: ${a.status} ${a.statusText}`)}return a}async fetchJson(e,n){return(await this.fetch(e,n)).json()}},v0=class extends lc{summary(e){return this.fetchJson("/lemur/v3/generate/summary",{method:"POST",body:JSON.stringify(e)})}questionAnswer(e){return this.fetchJson("/lemur/v3/generate/question-answer",{method:"POST",body:JSON.stringify(e)})}actionItems(e){return this.fetchJson("/lemur/v3/generate/action-items",{method:"POST",body:JSON.stringify(e)})}task(e){return this.fetchJson("/lemur/v3/generate/task",{method:"POST",body:JSON.stringify(e)})}getResponse(e){return this.fetchJson(`/lemur/v3/${e}`)}purgeRequestData(e){return this.fetchJson(`/lemur/v3/${e}`,{method:"DELETE"})}},{WritableStream:Kz}=typeof window!="undefined"?window:typeof global!="undefined"?global:globalThis,JN,XN,VN=(XN=(JN=WebSocket!=null?WebSocket:global==null?void 0:global.WebSocket)!=null?JN:window==null?void 0:window.WebSocket)!=null?XN:self==null?void 0:self.WebSocket,GN=(t,e)=>e?new VN(t,e):new VN(t),yt={BadSampleRate:4e3,AuthFailed:4001,InsufficientFundsOrFreeAccount:4002,InsufficientFunds:4002,FreeTierUser:4003,NonexistentSessionId:4004,SessionExpired:4008,ClosedSession:4010,RateLimited:4029,UniqueSessionViolation:4030,SessionTimeout:4031,AudioTooShort:4032,AudioTooLong:4033,AudioTooSmallToTranscode:4034,BadJson:4100,BadSchema:4101,TooManyStreams:4102,Reconnected:4103,ReconnectAttemptsExhausted:1013,WordBoostParameterParsingFailed:4104},ZN={[yt.BadSampleRate]:"Sample rate must be a positive integer",[yt.AuthFailed]:"Not Authorized",[yt.InsufficientFunds]:"Insufficient funds",[yt.FreeTierUser]:"This feature is paid-only and requires you to add a credit card. Please visit https://app.assemblyai.com/ to add a credit card to your account.",[yt.NonexistentSessionId]:"Session ID does not exist",[yt.SessionExpired]:"Session has expired",[yt.ClosedSession]:"Session is closed",[yt.RateLimited]:"Rate limited",[yt.UniqueSessionViolation]:"Unique session violation",[yt.SessionTimeout]:"Session Timeout",[yt.AudioTooShort]:"Audio too short",[yt.AudioTooLong]:"Audio too long",[yt.AudioTooSmallToTranscode]:"Audio too small to transcode",[yt.BadJson]:"Bad JSON",[yt.BadSchema]:"Bad schema",[yt.TooManyStreams]:"Too many streams",[yt.Reconnected]:"This session has been reconnected. This WebSocket is no longer valid.",[yt.ReconnectAttemptsExhausted]:"Reconnect attempts exhausted",[yt.WordBoostParameterParsingFailed]:"Could not parse word boost parameter"},S0=class extends Error{},Yz="wss://api.assemblyai.com/v2/realtime/ws",Jz='{"force_end_utterance":true}',KN='{"terminate_session":true}',x0=class{constructor(e){var n,r;if(this.listeners={},this.realtimeUrl=(n=e.realtimeUrl)!=null?n:Yz,this.sampleRate=(r=e.sampleRate)!=null?r:16e3,this.wordBoost=e.wordBoost,this.encoding=e.encoding,this.endUtteranceSilenceThreshold=e.endUtteranceSilenceThreshold,this.disablePartialTranscripts=e.disablePartialTranscripts,"token"in e&&e.token&&(this.token=e.token),"apiKey"in e&&e.apiKey&&(this.apiKey=e.apiKey),!(this.token||this.apiKey))throw new Error("API key or temporary token is required.")}connectionUrl(){let e=new URL(this.realtimeUrl);if(e.protocol!=="wss:")throw new Error("Invalid protocol, must be wss");let n=new URLSearchParams;return this.token&&n.set("token",this.token),n.set("sample_rate",this.sampleRate.toString()),this.wordBoost&&this.wordBoost.length>0&&n.set("word_boost",JSON.stringify(this.wordBoost)),this.encoding&&n.set("encoding",this.encoding),n.set("enable_extra_session_information","true"),this.disablePartialTranscripts&&n.set("disable_partial_transcripts",this.disablePartialTranscripts.toString()),e.search=n.toString(),e}on(e,n){this.listeners[e]=n}connect(){return new Promise(e=>{if(this.socket)throw new Error("Already connected");let n=this.connectionUrl();this.token?this.socket=GN(n.toString()):(console.warn(`API key authentication is not supported for the RealtimeTranscriber in browser environment. Use temporary token authentication instead.
Learn more at https://github.com/AssemblyAI/assemblyai-node-sdk/blob/main/docs/compat.md#browser-compatibility.`),this.socket=GN(n.toString(),{headers:{Authorization:this.apiKey}})),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{this.endUtteranceSilenceThreshold===void 0||this.endUtteranceSilenceThreshold===null||this.configureEndUtteranceSilenceThreshold(this.endUtteranceSilenceThreshold)},this.socket.onclose=({code:r,reason:a})=>{var i,s;a||r in ZN&&(a=ZN[r]),(s=(i=this.listeners).close)==null||s.call(i,r,a)},this.socket.onerror=r=>{var a,i,s,o;r.error?(i=(a=this.listeners).error)==null||i.call(a,r.error):(o=(s=this.listeners).error)==null||o.call(s,new Error(r.message))},this.socket.onmessage=({data:r})=>{var i,s,o,u,l,c,f,d,p,g,b,_,m,h,y;let a=JSON.parse(r.toString());if("error"in a){(s=(i=this.listeners).error)==null||s.call(i,new S0(a.error));return}switch(a.message_type){case"SessionBegins":{let v={sessionId:a.session_id,expiresAt:new Date(a.expires_at)};e(v),(u=(o=this.listeners).open)==null||u.call(o,v);break}case"PartialTranscript":{a.created=new Date(a.created),(c=(l=this.listeners).transcript)==null||c.call(l,a),(d=(f=this.listeners)["transcript.partial"])==null||d.call(f,a);break}case"FinalTranscript":{a.created=new Date(a.created),(g=(p=this.listeners).transcript)==null||g.call(p,a),(_=(b=this.listeners)["transcript.final"])==null||_.call(b,a);break}case"SessionInformation":{(h=(m=this.listeners).session_information)==null||h.call(m,a);break}case"SessionTerminated":{(y=this.sessionTerminatedResolve)==null||y.call(this);break}}}})}sendAudio(e){this.send(e)}stream(){return new Kz({write:e=>{this.sendAudio(e)}})}forceEndUtterance(){this.send(Jz)}configureEndUtteranceSilenceThreshold(e){this.send(`{"end_utterance_silence_threshold":${e}}`)}send(e){if(!this.socket||this.socket.readyState!==this.socket.OPEN)throw new Error("Socket is not open for communication");this.socket.send(e)}async close(e=!0){var n;if(this.socket){if(this.socket.readyState===this.socket.OPEN)if(e){let r=new Promise(a=>{this.sessionTerminatedResolve=a});this.socket.send(KN),await r}else this.socket.send(KN);(n=this.socket)!=null&&n.removeAllListeners&&this.socket.removeAllListeners(),this.socket.close()}this.listeners={},this.socket=void 0}};var A0=class extends lc{constructor(e){super(e),this.rtFactoryParams=e}createService(e){return this.transcriber(e)}transcriber(e){let n={...e};return!n.token&&!n.apiKey&&(n.apiKey=this.rtFactoryParams.apiKey),new x0(n)}async createTemporaryToken(e){return(await this.fetchJson("/v2/realtime/token",{method:"POST",body:JSON.stringify(e)})).token}};function YN(t){return t.startsWith("http")||t.startsWith("https")||t.startsWith("data:")?null:t.startsWith("file://")?t.substring(7):t.startsWith("file:")?t.substring(5):t}var T0=class extends lc{constructor(e,n){super(e),this.files=n}async transcribe(e,n){let r=await this.submit(e);return await this.waitUntilReady(r.id,n)}async submit(e){let n,r;if("audio"in e){let{audio:i,...s}=e;if(typeof i=="string"){let o=YN(i);o!==null?n=await this.files.upload(o):i.startsWith("data:")?n=await this.files.upload(i):n=i}else n=await this.files.upload(i);r={...s,audio_url:n}}else r=e;return await this.fetchJson("/v2/transcript",{method:"POST",body:JSON.stringify(r)})}async create(e,n){var i;let r=YN(e.audio_url);if(r!==null){let s=await this.files.upload(r);e.audio_url=s}let a=await this.fetchJson("/v2/transcript",{method:"POST",body:JSON.stringify(e)});return(i=n==null?void 0:n.poll)==null||i?await this.waitUntilReady(a.id,n):a}async waitUntilReady(e,n){var s,o;let r=(s=n==null?void 0:n.pollingInterval)!=null?s:3e3,a=(o=n==null?void 0:n.pollingTimeout)!=null?o:-1,i=Date.now();for(;;){let u=await this.get(e);if(u.status==="completed"||u.status==="error")return u;if(a>0&&Date.now()-i>a)throw new Error("Polling timeout");await new Promise(l=>setTimeout(l,r))}}get(e){return this.fetchJson(`/v2/transcript/${e}`)}async list(e){let n="/v2/transcript";typeof e=="string"?n=e:e&&(n=`${n}?${new URLSearchParams(Object.keys(e).map(a=>{var i;return[a,((i=e[a])==null?void 0:i.toString())||""]}))}`);let r=await this.fetchJson(n);for(let a of r.transcripts)a.created=new Date(a.created),a.completed&&(a.completed=new Date(a.completed));return r}delete(e){return this.fetchJson(`/v2/transcript/${e}`,{method:"DELETE"})}wordSearch(e,n){let r=new URLSearchParams({words:n.join(",")});return this.fetchJson(`/v2/transcript/${e}/word-search?${r.toString()}`)}sentences(e){return this.fetchJson(`/v2/transcript/${e}/sentences`)}paragraphs(e){return this.fetchJson(`/v2/transcript/${e}/paragraphs`)}async subtitles(e,n="srt",r){let a=`/v2/transcript/${e}/${n}`;if(r){let s=new URLSearchParams;s.set("chars_per_caption",r.toString()),a+=`?${s.toString()}`}return await(await this.fetch(a)).text()}redactions(e){return this.redactedAudio(e)}redactedAudio(e){return this.fetchJson(`/v2/transcript/${e}/redacted-audio`)}async redactedAudioFile(e){let{redacted_audio_url:n,status:r}=await this.redactedAudio(e);if(r!=="redacted_audio_ready")throw new Error(`Redacted audio status is ${r}`);let a=await fetch(n);if(!a.ok)throw new Error(`Failed to fetch redacted audio: ${a.statusText}`);return{arrayBuffer:a.arrayBuffer.bind(a),blob:a.blob.bind(a),body:a.body,bodyUsed:a.bodyUsed}}},Xz=async function(t){throw new Error("Interacting with the file system is not supported in this environment.")},E0=class extends lc{async upload(e){let n;return typeof e=="string"?e.startsWith("data:")?n=Qz(e):n=await Xz():n=e,(await this.fetchJson("/v2/upload",{method:"POST",body:n,headers:{"Content-Type":"application/octet-stream"},duplex:"half"})).upload_url}};function Qz(t){let e=t.split(","),n=e[0].match(/:(.*?);/)[1],r=atob(e[1]),a=r.length,i=new Uint8Array(a);for(;a--;)i[a]=r.charCodeAt(a);return new Blob([i],{type:n})}var Wz="https://api.assemblyai.com",$g=class{constructor(e){e.baseUrl=e.baseUrl||Wz,e.baseUrl&&e.baseUrl.endsWith("/")&&(e.baseUrl=e.baseUrl.slice(0,-1)),this.files=new E0(e),this.transcripts=new T0(e,this.files),this.lemur=new v0(e),this.realtime=new A0(e)}};async function QN(t,e,n){let{isMultiSpeakerEnabled:r=!1,audioFileLanguage:a}=n||{},i=new $g({apiKey:t}),s=a&&a!=="auto",o={audio:e,format_text:!0,speaker_labels:r},u=s?{...o,language_code:a}:o,l=await i.transcripts.transcribe(u),c;try{let{paragraphs:d}=await i.transcripts.paragraphs(l.id);c=d}catch(d){console.error("Failed to fetch paragraphs from AssemblyAI, moving forward with raw text:",d)}let f="";if(r&&l.utterances?f=(l.utterances||[]).map(d=>`**Speaker ${d.speaker}**: ${d.text}`).join(`
`):c?f=c.map(d=>d.text).join(`

`):f=l.text||"",l.error)throw console.error("Failed to transcribe with AssemblyAI, please try again",l.error),new Error(l.error);return f}var eB={isOpen:!1,counter:0,audioRecord:null,openAiClient:null},Nd=class extends Ve.Plugin{constructor(){super(...arguments);this.settings=pg;this.state=eB}async onload(){this.app.workspace.onLayoutReady(async()=>{await this.loadSettings(),jP(this),KP(this),kP(this),this.controlModal=new sc(this)})}onunload(){}async loadSettings(){let n=await this.loadData();this.settings={...pg,...n};let r=await qo(this);this.settings.openAiApiKey||(console.error("OpenAI API key is needed in Scribes settings - https://platform.openai.com/settings"),new Ve.Notice("\u26A0\uFE0F Scribe: OpenAI API key is missing for Scribe")),this.settings.recordingDirectory||(this.settings.recordingDirectory=r.defaultNewResourcePath),this.settings.transcriptDirectory||(this.settings.transcriptDirectory=r.defaultNewFilePath)}async saveSettings(){new Ve.Notice("Scribe: \u2705 Settings saved"),await this.saveData(this.settings)}async startRecording(){new Ve.Notice("Scribe: \u{1F399}\uFE0F Recording started");let n=new kg(this.settings.audioFileFormat);this.state.audioRecord=n,n.startRecording(this.settings.selectedAudioDeviceId)}async handlePauseResumeRecording(){var n,r,a,i,s;(n=this.state.audioRecord)==null||n.handlePauseResume(),((a=(r=this.state.audioRecord)==null?void 0:r.mediaRecorder)==null?void 0:a.state)==="recording"&&new Ve.Notice("Scribe: \u25B6\uFE0F\u{1F399}\uFE0F Resuming recording"),((s=(i=this.state.audioRecord)==null?void 0:i.mediaRecorder)==null?void 0:s.state)==="paused"&&new Ve.Notice("Scribe: \u23F8\uFE0F\u{1F399}\uFE0F Recording paused")}async cancelRecording(){var n,r;(n=this.state.audioRecord)!=null&&n.mediaRecorder&&(new Ve.Notice("Scribe: \u{1F6D1}\uFE0F Recording cancelled"),await((r=this.state.audioRecord)==null?void 0:r.stopRecording()))}async scribe(n={isAppendToActiveFile:this.settings.isAppendToActiveFile,isOnlyTranscribeActive:this.settings.isOnlyTranscribeActive,isMultiSpeakerEnabled:this.settings.isMultiSpeakerEnabled,isSaveAudioFileActive:this.settings.isSaveAudioFileActive,isDisableLlmTranscription:this.settings.isDisableLlmTranscription,audioFileLanguage:this.settings.audioFileLanguage,scribeOutputLanguage:this.settings.scribeOutputLanguage,transcriptPlatform:this.settings.transcriptPlatform,llmModel:this.settings.llmModel,activeNoteTemplate:this.settings.activeNoteTemplate}){try{let r=zo(this.settings.recordingFilenamePrefix,this.settings.dateFilenameFormat),{recordingBuffer:a,recordingFile:i}=await this.handleStopAndSaveRecording(r);if(await this.handleScribeFile({audioRecordingFile:i,audioRecordingBuffer:a,scribeOptions:n}),!n.isSaveAudioFileActive){let s=i.name;await this.app.vault.delete(i),new Ve.Notice(`Scribe: \u2705\u{1F5D1}\uFE0F Audio file deleted ${s}`)}}catch(r){new Ve.Notice(`Scribe: Something went wrong ${r.toString()}`),console.error("Scribe: Something went wrong",r)}finally{await this.cleanup()}}async scribeExistingFile(n,r={isAppendToActiveFile:this.settings.isAppendToActiveFile,isOnlyTranscribeActive:this.settings.isOnlyTranscribeActive,isMultiSpeakerEnabled:this.settings.isMultiSpeakerEnabled,isSaveAudioFileActive:this.settings.isSaveAudioFileActive,isDisableLlmTranscription:this.settings.isDisableLlmTranscription,audioFileLanguage:this.settings.audioFileLanguage,scribeOutputLanguage:this.settings.scribeOutputLanguage,transcriptPlatform:this.settings.transcriptPlatform,llmModel:this.settings.llmModel,activeNoteTemplate:this.settings.activeNoteTemplate}){try{if(!BN(`audio/${n.extension}`)){new Ve.Notice("Scribe: \u26A0\uFE0F This file type is not supported.");return}let a=await this.app.vault.readBinary(n);await this.handleScribeFile({audioRecordingFile:n,audioRecordingBuffer:a,scribeOptions:r})}catch(a){new Ve.Notice(`Scribe: Something went wrong ${a.toString()}`),console.error("Scribe: Something went wrong",a)}finally{await this.cleanup()}}async fixMermaidChart(n){try{let r;await this.app.vault.process(n,i=>(r=Xv(i),i));let a;r&&(a=(await xP(this.settings.openAiApiKey,r)).mermaidChart),r&&a&&await this.app.vault.process(n,i=>(r=Xv(i),i.replace(r,`${a}
`)))}catch(r){new Ve.Notice(`Scribe: Something went wrong ${r.toString()}`)}finally{await this.cleanup()}}async handleStopAndSaveRecording(n){let i=await(await this.state.audioRecord.stopRecording()).arrayBuffer(),s=await qN(this,i,n);return new Ve.Notice(`Scribe: \u2705 Audio file saved ${s.name}`),{recordingBuffer:i,recordingFile:s}}async handleScribeFile({audioRecordingFile:n,audioRecordingBuffer:r,scribeOptions:a}){var _,m,h,y;let{isAppendToActiveFile:i,isOnlyTranscribeActive:s,isSaveAudioFileActive:o,activeNoteTemplate:u}=a,l=`${zo(this.settings.noteFilenamePrefix,this.settings.dateFilenameFormat)}`,c=i?this.app.workspace.getActiveFile():await jg(this,l);if(!c){new Ve.Notice("Scribe: \u26A0\uFE0F No active file to append to, creating new one!"),c=await jg(this,l);let v=(m=(_=this.app.workspace.getActiveFile())==null?void 0:_.path)!=null?m:"";this.app.workspace.openLinkText(c==null?void 0:c.path,v,!0)}if(o?await w0(this,c,n):await w0(this,c),await this.cleanup(),!i){let v=(y=(h=this.app.workspace.getActiveFile())==null?void 0:h.path)!=null?y:"";this.app.workspace.openLinkText(c==null?void 0:c.path,v,!0)}await Cd(this,c,"# Audio in progress");let f=await this.handleTranscription(r,a),d=i?"# Audio in progress":`
# Audio in progress`,p=o?`# Audio
![[${n.path}]]
${f}`:`# Audio
${f}`;if(await Cd(this,c,p,d),s)return;let g=await this.handleTranscriptSummary(f,a);if(u.sections.forEach(async v=>{let{sectionHeader:S,sectionOutputPrefix:A,sectionOutputPostfix:T,isSectionOptional:x}=v,C=cg(S),R=g[C];if(!(x&&!R)){if(A||T){let B=`## ${S}
${A||""}
${R}
${T||""}`;await Cd(this,c,B);return}await Cd(this,c,`## ${S}
${R}`)}}),!i&&g.fileTitle){let v=`${zo(this.settings.noteFilenamePrefix,this.settings.dateFilenameFormat)}${(0,Ve.normalizePath)(g.fileTitle)}`;await HN(this,c,v)}}async handleTranscription(n,r){try{if(this.settings.isDisableLlmTranscription)return new Ve.Notice("Scribe: \u{1F3A7} Transcription is disabled in settings"),"";new Ve.Notice(`Scribe: \u{1F3A7} Beginning transcription w/ ${this.settings.transcriptPlatform}`);let a=this.settings.transcriptPlatform==="assemblyAi"?await QN(this.settings.assemblyAiApiKey,n,r):await vP(this.settings.openAiApiKey,n,r);return new Ve.Notice(`Scribe: \u{1F3A7} Completed transcription  w/ ${this.settings.transcriptPlatform}`),a}catch(a){throw new Ve.Notice(`Scribe: \u{1F3A7} \u{1F6D1} Something went wrong trying to Transcribe w/  ${this.settings.transcriptPlatform}
        ${a.toString()}`),a}}async handleTranscriptSummary(n,r){new Ve.Notice("Scribe: \u{1F9E0} Sending to LLM to summarize");let a=await SP(this.settings.openAiApiKey,n,r,this.settings.llmModel);return new Ve.Notice("Scribe: \u{1F9E0} LLM summation complete"),a}cleanup(){var n,r,a;this.controlModal.close(),((r=(n=this.state.audioRecord)==null?void 0:n.mediaRecorder)==null?void 0:r.state)==="recording"&&((a=this.state.audioRecord)==null||a.stopRecording()),this.state.audioRecord=null}};var tB=Nd;
/*! Bundled license information:

scheduler/cjs/scheduler.production.js:
  (**
   * @license React
   * scheduler.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react.production.js:
  (**
   * @license React
   * react.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.js:
  (**
   * @license React
   * react-dom.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom-client.production.js:
  (**
   * @license React
   * react-dom-client.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.js:
  (**
   * @license React
   * react-jsx-runtime.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)
*/

/* nosourcemap */